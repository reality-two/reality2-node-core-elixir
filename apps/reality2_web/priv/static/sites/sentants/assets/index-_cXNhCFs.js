var Rg=Object.defineProperty;var Cf=n=>{throw TypeError(n)};var wg=(n,c,l)=>c in n?Rg(n,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[c]=l;var ml=(n,c,l)=>wg(n,typeof c!="symbol"?c+"":c,l),wd=(n,c,l)=>c.has(n)||Cf("Cannot "+l);var jn=(n,c,l)=>(wd(n,c,"read from private field"),l?l.call(n):c.get(n)),Ma=(n,c,l)=>c.has(n)?Cf("Cannot add the same private member more than once"):c instanceof WeakSet?c.add(n):c.set(n,l),Ad=(n,c,l,h)=>(wd(n,c,"write to private field"),h?h.call(n,l):c.set(n,l),l),Rf=(n,c,l)=>(wd(n,c,"access private method"),l);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))h(p);new MutationObserver(p=>{for(const g of p)if(g.type==="childList")for(const T of g.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&h(T)}).observe(document,{childList:!0,subtree:!0});function l(p){const g={};return p.integrity&&(g.integrity=p.integrity),p.referrerPolicy&&(g.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?g.credentials="include":p.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(p){if(p.ep)return;p.ep=!0;const g=l(p);fetch(p.href,g)}})();const tableSort=function(){$.tablesort=function(n,c){var l=this;this.$table=n,this.$thead=this.$table.find("thead"),this.settings=$.extend({},$.tablesort.defaults,c),this.$sortCells=this.$thead.length>0?this.$thead.find("th:not(.no-sort)"):this.$table.find("th:not(.no-sort)"),this.$sortCells.on("click.tablesort",function(){l.sort($(this))}),this.index=null,this.$th=null,this.direction=null},$.tablesort.prototype={sort:function(n,c){var l=new Date,h=this,p=this.$table,g=p.find("tbody").length>0?p.find("tbody"):p,T=g.find("tr").has("td, th"),v=T.find(":nth-child("+(n.index()+1)+")").filter("td, th"),I=n.data().sortBy,R=[],w=v.map(function(C,N){return I?typeof I=="function"?I($(n),$(N),h):I:$(this).data().sortValue!=null?$(this).data().sortValue:$(this).text()});w.length!==0&&(this.index!==n.index()?(this.direction="asc",this.index=n.index()):c!=="asc"&&c!=="desc"?this.direction=this.direction==="asc"?"desc":"asc":this.direction=c,c=this.direction=="asc"?1:-1,h.$table.trigger("tablesort:start",[h]),h.log("Sorting by "+this.index+" "+this.direction),h.$table.css("display"),setTimeout(function(){h.$sortCells.removeClass(h.settings.asc+" "+h.settings.desc);for(var C=0,N=w.length;C<N;C++)R.push({index:C,cell:v[C],row:T[C],value:w[C]});R.sort(function(D,V){return h.settings.compare(D.value,V.value)*c}),$.each(R,function(D,V){g.append(V.row)}),n.addClass(h.settings[h.direction]),h.log("Sort finished in "+(new Date().getTime()-l.getTime())+"ms"),h.$table.trigger("tablesort:complete",[h]),h.$table.css("display")},w.length>2e3?200:10))},log:function(n){($.tablesort.DEBUG||this.settings.debug)&&console&&console.log&&console.log("[tablesort] "+n)},destroy:function(){return this.$sortCells.off("click.tablesort"),this.$table.data("tablesort",null),null}},$.tablesort.DEBUG=!1,$.tablesort.defaults={debug:$.tablesort.DEBUG,asc:"sorted ascending",desc:"sorted descending",compare:function(n,c){return n>c?1:n<c?-1:0}},$.fn.tablesort=function(n){var c,l;return this.each(function(){c=$(this),l=c.data("tablesort"),l&&l.destroy(),c.data("tablesort",new $.tablesort(c,n))})}};function super_stringify(n,c=!1){let l="";if(typeof n=="string")l+='"'+n.replace(/"/g,'\\"').replace(/'/g,"\\'")+'"';else if(Array.isArray(n))l+="[",n.forEach((h,p)=>{h!=null&&h!=null&&(l+=super_stringify(h,c)+",")}),l=l.replace(/,+$/,"")+"]";else if(typeof n=="function"){let h=n.toString().replace(/[\n\t\r](?=(?:(?:[^"]*"){2})*[^"]*$)/g,"");c&&(h=h.replace(/"/g,'\\"').replace(/'/g,"\\'")),l+=(c?'"':"")+h+(c?'"':"")}else typeof n=="object"?(l+="{",Object.keys(n).forEach((p,g)=>{n[p]!==void 0&&n[p]!==null&&(l+='"'+p.toString()+'":'+super_stringify(n[p],c)+",")}),l=l.replace(/,+$/,"")+"}"):l+=n.toString();return l}document.addEventListener("DOMContentLoaded",function(){window.jQuery&&tableSort(),reload()});const reload=function(n=null){window.jQuery&&(n===null?$("[data-module]").each(function(){reload_module(this)}):$("#"+n).find("[data-module]").each(function(){reload_module(this)}))},reload_module=function(n){let c=get_settings($(n).data("module"));$.each(c,(l,h)=>{if(h.hasOwnProperty("type")){let p=h.type,g=h.hasOwnProperty("activate")?h.activate:!1,T=h.hasOwnProperty("settings")?h.settings.hasOwnProperty("settings")?h.settings.settings:h.settings:{};switch(p){case"":break;case"menu":$("#"+$(n).attr("id")+" .item").tab({silent:!0,...T});break;case"tab":break;case"calendar":typeof T=="object"&&T&&(T.hasOwnProperty("startCalendar")&&(T.startCalendar=$("#"+T.startCalendar)),T.hasOwnProperty("endCalendar")&&(T.endCalendar=$("#"+T.endCalendar))),$(n)[p](T);break;case"flyout":case"sidebar":const v={silent:!0};$(n)[p]({...v,...T});break;case"popup":const I={delay:{show:100,hide:300}};$(n)[p]({...I,...T});break;case"dropdown":$(n)[p](T);break;case"progress":case"embed":g&&$(n)[p](T);break;default:$(n)[p](T);break}}})};function construct_jquery_command(n){var c="";let l="";if(n.hasOwnProperty("id")){let h=get_settings($("#"+n.id).data("module"));l=extract_module_type_from_settings(h),(!l||l==="")&&(l=n.type)}else l=n.type;if(l!==""){if(c+="$",n.hasOwnProperty("id")?c+="('#"+n.id+"')":n.hasOwnProperty("class")&&(c+="('."+n.class+"')"),n.hasOwnProperty("settings")){let h=super_stringify(n.settings);c+="."+l+"("+h+")"}n.hasOwnProperty("commands")?n.commands.forEach(h=>{c+="."+l+"('"+h+"')"}):n.hasOwnProperty("settings")||(c+="."+l+"()")}return c}const behavior=function(...n){if(window.jQuery){let c=n.shift(),l;if(typeof c=="object")l=new Function(construct_jquery_command(c))();else{let h=c,p=get_settings($("#"+h).data("module")),g=extract_module_type_from_settings(p);if(g&&h&&$("#"+h)[g])l=$("#"+h)[g](...n);else return null}return l}else return null};function get_settings(n){let c=[];return window.jQuery&&n&&(Array.isArray(n)?n.forEach(l=>{typeof l=="string"?c.push(deserialize(l)):c.push(l)}):c.push(n)),c}function extract_module_type_from_settings(n){let c;return window.jQuery&&(n.hasOwnProperty("type")?c=n.type:n.forEach(l=>{l.type!=="popup"&&(c=l.type),!c&&n.length>0&&(c="popup")})),c}function deserialize(serialized){let deserialized={};try{deserialized=JSON.parse(serialized)}catch(n){}const obj={};if(window.jQuery){for(const key in deserialized)if(deserialized.hasOwnProperty(key)){const val=deserialized[key];if(key==="settings"){obj.settings={};for(const key2 in val){const val2=val[key2];typeof val2=="string"&&(val2.startsWith("function")||val2.indexOf("=>")>-1)?obj.settings[key2]=eval("("+val2+")"):obj.settings[key2]=val2}}else typeof val=="string"&&(val.startsWith("function")||val.indexOf("=>")>-1)?obj[key]=eval(val):obj[key]=val}}return obj}const DEV=!1;var is_array=Array.isArray,index_of=Array.prototype.indexOf,array_from=Array.from,define_property=Object.defineProperty,get_descriptor=Object.getOwnPropertyDescriptor,get_descriptors=Object.getOwnPropertyDescriptors,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf;function is_function(n){return typeof n=="function"}const noop=()=>{};function run(n){return n()}function run_all(n){for(var c=0;c<n.length;c++)n[c]()}const DERIVED=2,EFFECT=4,RENDER_EFFECT=8,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,UNOWNED=256,DISCONNECTED=512,CLEAN=1024,DIRTY=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EFFECT_TRANSPARENT=65536,LEGACY_DERIVED_PROP=1<<17,HEAD_EFFECT=1<<19,EFFECT_HAS_DERIVED=1<<20,STATE_SYMBOL=Symbol("$state"),LEGACY_PROPS=Symbol("legacy props"),LOADING_ATTR_SYMBOL=Symbol("");function equals(n){return n===this.v}function safe_not_equal(n,c){return n!=n?c==c:n!==c||n!==null&&typeof n=="object"||typeof n=="function"}function safe_equals(n){return!safe_not_equal(n,this.v)}function effect_in_teardown(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function effect_in_unowned_derived(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function effect_orphan(n){throw new Error("https://svelte.dev/e/effect_orphan")}function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function lifecycle_legacy_only(n){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function props_invalid_value(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_local_read(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let legacy_mode_flag=!1,tracing_mode_flag=!1;function enable_legacy_mode_flag(){legacy_mode_flag=!0}const EACH_ITEM_REACTIVE=1,EACH_INDEX_REACTIVE=2,EACH_ITEM_IMMUTABLE=16,PROPS_IS_IMMUTABLE=1,PROPS_IS_RUNES=2,PROPS_IS_UPDATED=4,PROPS_IS_BINDABLE=8,PROPS_IS_LAZY_INITIAL=16,TRANSITION_GLOBAL=4,TEMPLATE_FRAGMENT=1,TEMPLATE_USE_IMPORT_NODE=2,UNINITIALIZED=Symbol();function lifecycle_outside_component(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let component_context=null;function set_component_context(n){component_context=n}function push(n,c=!1,l){component_context={p:component_context,c:null,e:null,m:!1,s:n,x:null,l:null},legacy_mode_flag&&!c&&(component_context.l={s:null,u:null,r1:[],r2:source(!1)})}function pop(n){const c=component_context;if(c!==null){const T=c.e;if(T!==null){var l=active_effect,h=active_reaction;c.e=null;try{for(var p=0;p<T.length;p++){var g=T[p];set_active_effect(g.effect),set_active_reaction(g.reaction),effect(g.fn)}}finally{set_active_effect(l),set_active_reaction(h)}}component_context=c.p,c.m=!0}return{}}function is_runes(){return!legacy_mode_flag||component_context!==null&&component_context.l===null}function source(n,c){var l={f:0,v:n,reactions:null,equals,rv:0,wv:0};return l}function mutable_source(n,c=!1){var h;const l=source(n);return c||(l.equals=safe_equals),legacy_mode_flag&&component_context!==null&&component_context.l!==null&&((h=component_context.l).s??(h.s=[])).push(l),l}function mutable_state(n,c=!1){return push_derived_source(mutable_source(n,c))}function push_derived_source(n){return active_reaction!==null&&!untracking&&active_reaction.f&DERIVED&&(derived_sources===null?set_derived_sources([n]):derived_sources.push(n)),n}function mutate(n,c){return set$1(n,untrack(()=>get(n))),c}function set$1(n,c){return active_reaction!==null&&!untracking&&is_runes()&&active_reaction.f&(DERIVED|BLOCK_EFFECT)&&(derived_sources===null||!derived_sources.includes(n))&&state_unsafe_mutation(),internal_set(n,c)}function internal_set(n,c){return n.equals(c)||(n.v,n.v=c,n.wv=increment_write_version(),mark_reactions(n,DIRTY),is_runes()&&active_effect!==null&&active_effect.f&CLEAN&&!(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))&&(untracked_writes===null?set_untracked_writes([n]):untracked_writes.push(n))),c}function update(n,c=1){var l=get(n),h=c===1?l++:l--;return set$1(n,l),h}function mark_reactions(n,c){var l=n.reactions;if(l!==null)for(var h=is_runes(),p=l.length,g=0;g<p;g++){var T=l[g],v=T.f;v&DIRTY||!h&&T===active_effect||(set_signal_status(T,c),v&(CLEAN|UNOWNED)&&(v&DERIVED?mark_reactions(T,MAYBE_DIRTY):schedule_effect(T)))}}let hydrating=!1;function proxy(n,c=null,l){if(typeof n!="object"||n===null||STATE_SYMBOL in n)return n;const h=get_prototype_of(n);if(h!==object_prototype&&h!==array_prototype)return n;var p=new Map,g=is_array(n),T=source(0);g&&p.set("length",source(n.length));var v;return new Proxy(n,{defineProperty(I,R,w){(!("value"in w)||w.configurable===!1||w.enumerable===!1||w.writable===!1)&&state_descriptors_fixed();var C=p.get(R);return C===void 0?(C=source(w.value),p.set(R,C)):set$1(C,proxy(w.value,v)),!0},deleteProperty(I,R){var w=p.get(R);if(w===void 0)R in I&&p.set(R,source(UNINITIALIZED));else{if(g&&typeof R=="string"){var C=p.get("length"),N=Number(R);Number.isInteger(N)&&N<C.v&&set$1(C,N)}set$1(w,UNINITIALIZED),update_version(T)}return!0},get(I,R,w){var V;if(R===STATE_SYMBOL)return n;var C=p.get(R),N=R in I;if(C===void 0&&(!N||(V=get_descriptor(I,R))!=null&&V.writable)&&(C=source(proxy(N?I[R]:UNINITIALIZED,v)),p.set(R,C)),C!==void 0){var D=get(C);return D===UNINITIALIZED?void 0:D}return Reflect.get(I,R,w)},getOwnPropertyDescriptor(I,R){var w=Reflect.getOwnPropertyDescriptor(I,R);if(w&&"value"in w){var C=p.get(R);C&&(w.value=get(C))}else if(w===void 0){var N=p.get(R),D=N==null?void 0:N.v;if(N!==void 0&&D!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:D,writable:!0}}return w},has(I,R){var D;if(R===STATE_SYMBOL)return!0;var w=p.get(R),C=w!==void 0&&w.v!==UNINITIALIZED||Reflect.has(I,R);if(w!==void 0||active_effect!==null&&(!C||(D=get_descriptor(I,R))!=null&&D.writable)){w===void 0&&(w=source(C?proxy(I[R],v):UNINITIALIZED),p.set(R,w));var N=get(w);if(N===UNINITIALIZED)return!1}return C},set(I,R,w,C){var z;var N=p.get(R),D=R in I;if(g&&R==="length")for(var V=w;V<N.v;V+=1){var B=p.get(V+"");B!==void 0?set$1(B,UNINITIALIZED):V in I&&(B=source(UNINITIALIZED),p.set(V+"",B))}N===void 0?(!D||(z=get_descriptor(I,R))!=null&&z.writable)&&(N=source(void 0),set$1(N,proxy(w,v)),p.set(R,N)):(D=N.v!==UNINITIALIZED,set$1(N,proxy(w,v)));var ie=Reflect.getOwnPropertyDescriptor(I,R);if(ie!=null&&ie.set&&ie.set.call(C,w),!D){if(g&&typeof R=="string"){var ne=p.get("length"),P=Number(R);Number.isInteger(P)&&P>=ne.v&&set$1(ne,P+1)}update_version(T)}return!0},ownKeys(I){get(T);var R=Reflect.ownKeys(I).filter(N=>{var D=p.get(N);return D===void 0||D.v!==UNINITIALIZED});for(var[w,C]of p)C.v!==UNINITIALIZED&&!(w in I)&&R.push(w);return R},setPrototypeOf(){state_prototype_fixed()}})}function update_version(n,c=1){set$1(n,n.v+c)}function get_proxied_value(n){return n!==null&&typeof n=="object"&&STATE_SYMBOL in n?n[STATE_SYMBOL]:n}function is(n,c){return Object.is(get_proxied_value(n),get_proxied_value(c))}var $window,first_child_getter,next_sibling_getter;function init_operations(){if($window===void 0){$window=window;var n=Element.prototype,c=Node.prototype;first_child_getter=get_descriptor(c,"firstChild").get,next_sibling_getter=get_descriptor(c,"nextSibling").get,n.__click=void 0,n.__className="",n.__attributes=null,n.__styles=null,n.__e=void 0,Text.prototype.__t=void 0}}function create_text(n=""){return document.createTextNode(n)}function get_first_child(n){return first_child_getter.call(n)}function get_next_sibling(n){return next_sibling_getter.call(n)}function child(n,c){return get_first_child(n)}function first_child(n,c){{var l=get_first_child(n);return l instanceof Comment&&l.data===""?get_next_sibling(l):l}}function sibling(n,c=1,l=!1){let h=n;for(;c--;)h=get_next_sibling(h);return h}function clear_text_content(n){n.textContent=""}function derived(n){var c=DERIVED|DIRTY,l=active_reaction!==null&&active_reaction.f&DERIVED?active_reaction:null;return active_effect===null||l!==null&&l.f&UNOWNED?c|=UNOWNED:active_effect.f|=EFFECT_HAS_DERIVED,{ctx:component_context,deps:null,effects:null,equals,f:c,fn:n,reactions:null,rv:0,v:null,wv:0,parent:l??active_effect}}function derived_safe_equal(n){const c=derived(n);return c.equals=safe_equals,c}function destroy_derived_effects(n){var c=n.effects;if(c!==null){n.effects=null;for(var l=0;l<c.length;l+=1)destroy_effect(c[l])}}function get_derived_parent_effect(n){for(var c=n.parent;c!==null;){if(!(c.f&DERIVED))return c;c=c.parent}return null}function execute_derived(n){var c,l=active_effect;set_active_effect(get_derived_parent_effect(n));try{destroy_derived_effects(n),c=update_reaction(n)}finally{set_active_effect(l)}return c}function update_derived(n){var c=execute_derived(n),l=(skip_reaction||n.f&UNOWNED)&&n.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(n,l),n.equals(c)||(n.v=c,n.wv=increment_write_version())}function destroy_derived(n){destroy_derived_effects(n),remove_reactions(n,0),set_signal_status(n,DESTROYED),n.v=n.deps=n.ctx=n.reactions=null}function validate_effect(n){active_effect===null&&active_reaction===null&&effect_orphan(),active_reaction!==null&&active_reaction.f&UNOWNED&&active_effect===null&&effect_in_unowned_derived(),is_destroying_effect&&effect_in_teardown()}function push_effect(n,c){var l=c.last;l===null?c.last=c.first=n:(l.next=n,n.prev=l,c.last=n)}function create_effect(n,c,l,h=!0){var p=(n&ROOT_EFFECT)!==0,g=active_effect,T={ctx:component_context,deps:null,nodes_start:null,nodes_end:null,f:n|DIRTY,first:null,fn:c,last:null,next:null,parent:p?null:g,prev:null,teardown:null,transitions:null,wv:0};if(l){var v=is_flushing_effect;try{set_is_flushing_effect(!0),update_effect(T),T.f|=EFFECT_RAN}catch(w){throw destroy_effect(T),w}finally{set_is_flushing_effect(v)}}else c!==null&&schedule_effect(T);var I=l&&T.deps===null&&T.first===null&&T.nodes_start===null&&T.teardown===null&&(T.f&(EFFECT_HAS_DERIVED|BOUNDARY_EFFECT))===0;if(!I&&!p&&h&&(g!==null&&push_effect(T,g),active_reaction!==null&&active_reaction.f&DERIVED)){var R=active_reaction;(R.effects??(R.effects=[])).push(T)}return T}function teardown(n){const c=create_effect(RENDER_EFFECT,null,!1);return set_signal_status(c,CLEAN),c.teardown=n,c}function user_effect(n){validate_effect();var c=active_effect!==null&&(active_effect.f&BRANCH_EFFECT)!==0&&component_context!==null&&!component_context.m;if(c){var l=component_context;(l.e??(l.e=[])).push({fn:n,effect:active_effect,reaction:active_reaction})}else{var h=effect(n);return h}}function user_pre_effect(n){return validate_effect(),render_effect(n)}function component_root(n){const c=create_effect(ROOT_EFFECT,n,!0);return(l={})=>new Promise(h=>{l.outro?pause_effect(c,()=>{destroy_effect(c),h(void 0)}):(destroy_effect(c),h(void 0))})}function effect(n){return create_effect(EFFECT,n,!1)}function legacy_pre_effect(n,c){var l=component_context,h={effect:null,ran:!1};l.l.r1.push(h),h.effect=render_effect(()=>{n(),!h.ran&&(h.ran=!0,set$1(l.l.r2,!0),untrack(c))})}function legacy_pre_effect_reset(){var n=component_context;render_effect(()=>{if(get(n.l.r2)){for(var c of n.l.r1){var l=c.effect;l.f&CLEAN&&set_signal_status(l,MAYBE_DIRTY),check_dirtiness(l)&&update_effect(l),c.ran=!1}n.l.r2.v=!1}})}function render_effect(n){return create_effect(RENDER_EFFECT,n,!0)}function template_effect(n,c=[],l=derived){const h=c.map(l);return block(()=>n(...h.map(get)))}function block(n,c=0){return create_effect(RENDER_EFFECT|BLOCK_EFFECT|c,n,!0)}function branch(n,c=!0){return create_effect(RENDER_EFFECT|BRANCH_EFFECT,n,!0,c)}function execute_effect_teardown(n){var c=n.teardown;if(c!==null){const l=is_destroying_effect,h=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{c.call(null)}finally{set_is_destroying_effect(l),set_active_reaction(h)}}}function destroy_effect_children(n,c=!1){var l=n.first;for(n.first=n.last=null;l!==null;){var h=l.next;destroy_effect(l,c),l=h}}function destroy_block_effect_children(n){for(var c=n.first;c!==null;){var l=c.next;c.f&BRANCH_EFFECT||destroy_effect(c),c=l}}function destroy_effect(n,c=!0){var l=!1;if((c||n.f&HEAD_EFFECT)&&n.nodes_start!==null){for(var h=n.nodes_start,p=n.nodes_end;h!==null;){var g=h===p?null:get_next_sibling(h);h.remove(),h=g}l=!0}destroy_effect_children(n,c&&!l),remove_reactions(n,0),set_signal_status(n,DESTROYED);var T=n.transitions;if(T!==null)for(const I of T)I.stop();execute_effect_teardown(n);var v=n.parent;v!==null&&v.first!==null&&unlink_effect(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=null}function unlink_effect(n){var c=n.parent,l=n.prev,h=n.next;l!==null&&(l.next=h),h!==null&&(h.prev=l),c!==null&&(c.first===n&&(c.first=h),c.last===n&&(c.last=l))}function pause_effect(n,c){var l=[];pause_children(n,l,!0),run_out_transitions(l,()=>{destroy_effect(n),c&&c()})}function run_out_transitions(n,c){var l=n.length;if(l>0){var h=()=>--l||c();for(var p of n)p.out(h)}else c()}function pause_children(n,c,l){if(!(n.f&INERT)){if(n.f^=INERT,n.transitions!==null)for(const T of n.transitions)(T.is_global||l)&&c.push(T);for(var h=n.first;h!==null;){var p=h.next,g=(h.f&EFFECT_TRANSPARENT)!==0||(h.f&BRANCH_EFFECT)!==0;pause_children(h,c,g?l:!1),h=p}}}function resume_effect(n){resume_children(n,!0)}function resume_children(n,c){if(n.f&INERT){n.f^=INERT,n.f&CLEAN||(n.f^=CLEAN),check_dirtiness(n)&&(set_signal_status(n,DIRTY),schedule_effect(n));for(var l=n.first;l!==null;){var h=l.next,p=(l.f&EFFECT_TRANSPARENT)!==0||(l.f&BRANCH_EFFECT)!==0;resume_children(l,p?c:!1),l=h}if(n.transitions!==null)for(const g of n.transitions)(g.is_global||c)&&g.in()}}let is_micro_task_queued$1=!1,current_queued_micro_tasks=[];function process_micro_tasks(){is_micro_task_queued$1=!1;const n=current_queued_micro_tasks.slice();current_queued_micro_tasks=[],run_all(n)}function queue_micro_task(n){is_micro_task_queued$1||(is_micro_task_queued$1=!0,queueMicrotask(process_micro_tasks)),current_queued_micro_tasks.push(n)}function flush_tasks(){is_micro_task_queued$1&&process_micro_tasks()}const FLUSH_MICROTASK=0,FLUSH_SYNC=1;let is_throwing_error=!1,scheduler_mode=FLUSH_MICROTASK,is_micro_task_queued=!1,last_scheduled_effect=null,is_flushing_effect=!1,is_destroying_effect=!1;function set_is_flushing_effect(n){is_flushing_effect=n}function set_is_destroying_effect(n){is_destroying_effect=n}let queued_root_effects=[],flush_count=0,dev_effect_stack=[],active_reaction=null,untracking=!1;function set_active_reaction(n){active_reaction=n}let active_effect=null;function set_active_effect(n){active_effect=n}let derived_sources=null;function set_derived_sources(n){derived_sources=n}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(n){untracked_writes=n}let write_version=1,read_version=0,skip_reaction=!1;function increment_write_version(){return++write_version}function check_dirtiness(n){var R;var c=n.f;if(c&DIRTY)return!0;if(c&MAYBE_DIRTY){var l=n.deps,h=(c&UNOWNED)!==0;if(l!==null){var p,g,T=(c&DISCONNECTED)!==0,v=h&&active_effect!==null&&!skip_reaction,I=l.length;if(T||v){for(p=0;p<I;p++)g=l[p],(T||!((R=g==null?void 0:g.reactions)!=null&&R.includes(n)))&&(g.reactions??(g.reactions=[])).push(n);T&&(n.f^=DISCONNECTED)}for(p=0;p<I;p++)if(g=l[p],check_dirtiness(g)&&update_derived(g),g.wv>n.wv)return!0}(!h||active_effect!==null&&!skip_reaction)&&set_signal_status(n,CLEAN)}return!1}function propagate_error(n,c){for(var l=c;l!==null;){if(l.f&BOUNDARY_EFFECT)try{l.fn(n);return}catch{l.f^=BOUNDARY_EFFECT}l=l.parent}throw is_throwing_error=!1,n}function should_rethrow_error(n){return(n.f&DESTROYED)===0&&(n.parent===null||(n.parent.f&BOUNDARY_EFFECT)===0)}function handle_error(n,c,l,h){if(is_throwing_error){if(l===null&&(is_throwing_error=!1),should_rethrow_error(c))throw n;return}l!==null&&(is_throwing_error=!0);{propagate_error(n,c);return}}function schedule_possible_effect_self_invalidation(n,c,l=0){var h=n.reactions;if(h!==null)for(var p=0;p<h.length;p++){var g=h[p];g.f&DERIVED?schedule_possible_effect_self_invalidation(g,c,l+1):c===g&&(l===0?set_signal_status(g,DIRTY):g.f&CLEAN&&set_signal_status(g,MAYBE_DIRTY),schedule_effect(g))}}function update_reaction(n){var D;var c=new_deps,l=skipped_deps,h=untracked_writes,p=active_reaction,g=skip_reaction,T=derived_sources,v=component_context,I=untracking,R=n.f;new_deps=null,skipped_deps=0,untracked_writes=null,active_reaction=R&(BRANCH_EFFECT|ROOT_EFFECT)?null:n,skip_reaction=(R&UNOWNED)!==0&&(!is_flushing_effect||(p===null||I)&&n.parent!==null),derived_sources=null,set_component_context(n.ctx),untracking=!1,read_version++;try{var w=(0,n.fn)(),C=n.deps;if(new_deps!==null){var N;if(remove_reactions(n,skipped_deps),C!==null&&skipped_deps>0)for(C.length=skipped_deps+new_deps.length,N=0;N<new_deps.length;N++)C[skipped_deps+N]=new_deps[N];else n.deps=C=new_deps;if(!skip_reaction)for(N=skipped_deps;N<C.length;N++)((D=C[N]).reactions??(D.reactions=[])).push(n)}else C!==null&&skipped_deps<C.length&&(remove_reactions(n,skipped_deps),C.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!(n.f&(DERIVED|MAYBE_DIRTY|DIRTY)))for(N=0;N<untracked_writes.length;N++)schedule_possible_effect_self_invalidation(untracked_writes[N],n);return p!==null&&read_version++,w}finally{new_deps=c,skipped_deps=l,untracked_writes=h,active_reaction=p,skip_reaction=g,derived_sources=T,set_component_context(v),untracking=I}}function remove_reaction(n,c){let l=c.reactions;if(l!==null){var h=index_of.call(l,n);if(h!==-1){var p=l.length-1;p===0?l=c.reactions=null:(l[h]=l[p],l.pop())}}l===null&&c.f&DERIVED&&(new_deps===null||!new_deps.includes(c))&&(set_signal_status(c,MAYBE_DIRTY),c.f&(UNOWNED|DISCONNECTED)||(c.f^=DISCONNECTED),destroy_derived_effects(c),remove_reactions(c,0))}function remove_reactions(n,c){var l=n.deps;if(l!==null)for(var h=c;h<l.length;h++)remove_reaction(n,l[h])}function update_effect(n){var c=n.f;if(!(c&DESTROYED)){set_signal_status(n,CLEAN);var l=active_effect,h=component_context;active_effect=n;try{c&BLOCK_EFFECT?destroy_block_effect_children(n):destroy_effect_children(n),execute_effect_teardown(n);var p=update_reaction(n);n.teardown=typeof p=="function"?p:null,n.wv=write_version;var g=n.deps,T;DEV&&tracing_mode_flag&&n.f&DIRTY}catch(v){handle_error(v,n,l,h||n.ctx)}finally{active_effect=l}}}function infinite_loop_guard(){if(flush_count>1e3){flush_count=0;try{effect_update_depth_exceeded()}catch(n){if(last_scheduled_effect!==null)handle_error(n,last_scheduled_effect,null);else throw n}}flush_count++}function flush_queued_root_effects(n){var c=n.length;if(c!==0){infinite_loop_guard();var l=is_flushing_effect;is_flushing_effect=!0;try{for(var h=0;h<c;h++){var p=n[h];p.f&CLEAN||(p.f^=CLEAN);var g=[];process_effects(p,g),flush_queued_effects(g)}}finally{is_flushing_effect=l}}}function flush_queued_effects(n){var c=n.length;if(c!==0)for(var l=0;l<c;l++){var h=n[l];if(!(h.f&(DESTROYED|INERT)))try{check_dirtiness(h)&&(update_effect(h),h.deps===null&&h.first===null&&h.nodes_start===null&&(h.teardown===null?unlink_effect(h):h.fn=null))}catch(p){handle_error(p,h,null,h.ctx)}}}function process_deferred(){if(is_micro_task_queued=!1,flush_count>1001)return;const n=queued_root_effects;queued_root_effects=[],flush_queued_root_effects(n),is_micro_task_queued||(flush_count=0,last_scheduled_effect=null)}function schedule_effect(n){scheduler_mode===FLUSH_MICROTASK&&(is_micro_task_queued||(is_micro_task_queued=!0,queueMicrotask(process_deferred))),last_scheduled_effect=n;for(var c=n;c.parent!==null;){c=c.parent;var l=c.f;if(l&(ROOT_EFFECT|BRANCH_EFFECT)){if(!(l&CLEAN))return;c.f^=CLEAN}}queued_root_effects.push(c)}function process_effects(n,c){var l=n.first,h=[];e:for(;l!==null;){var p=l.f,g=(p&BRANCH_EFFECT)!==0,T=g&&(p&CLEAN)!==0,v=l.next;if(!T&&!(p&INERT))if(p&RENDER_EFFECT){if(g)l.f^=CLEAN;else{var I=active_reaction;try{active_reaction=l,check_dirtiness(l)&&update_effect(l)}catch(N){handle_error(N,l,null,l.ctx)}finally{active_reaction=I}}var R=l.first;if(R!==null){l=R;continue}}else p&EFFECT&&h.push(l);if(v===null){let N=l.parent;for(;N!==null;){if(n===N)break e;var w=N.next;if(w!==null){l=w;continue e}N=N.parent}}l=v}for(var C=0;C<h.length;C++)R=h[C],c.push(R),process_effects(R,c)}function flush_sync(n){var c=scheduler_mode,l=queued_root_effects;try{infinite_loop_guard();const p=[];scheduler_mode=FLUSH_SYNC,queued_root_effects=p,is_micro_task_queued=!1,flush_queued_root_effects(l);var h=n==null?void 0:n();return flush_tasks(),(queued_root_effects.length>0||p.length>0)&&flush_sync(),flush_count=0,last_scheduled_effect=null,h}finally{scheduler_mode=c,queued_root_effects=l}}async function tick(){await Promise.resolve(),flush_sync()}function get(n){var c=n.f,l=(c&DERIVED)!==0;if(l&&c&DESTROYED){var h=execute_derived(n);return destroy_derived(n),h}if(active_reaction!==null&&!untracking){derived_sources!==null&&derived_sources.includes(n)&&state_unsafe_local_read();var p=active_reaction.deps;n.rv<read_version&&(n.rv=read_version,new_deps===null&&p!==null&&p[skipped_deps]===n?skipped_deps++:new_deps===null?new_deps=[n]:new_deps.push(n))}else if(l&&n.deps===null&&n.effects===null){var g=n,T=g.parent;T!==null&&!(T.f&UNOWNED)&&(g.f^=UNOWNED)}return l&&(g=n,check_dirtiness(g)&&update_derived(g)),n.v}function safe_get(n){return n&&get(n)}function untrack(n){var c=untracking;try{return untracking=!0,n()}finally{untracking=c}}const STATUS_MASK=-7169;function set_signal_status(n,c){n.f=n.f&STATUS_MASK|c}function deep_read_state(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(STATE_SYMBOL in n)deep_read(n);else if(!Array.isArray(n))for(let c in n){const l=n[c];typeof l=="object"&&l&&STATE_SYMBOL in l&&deep_read(l)}}}function deep_read(n,c=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!c.has(n)){c.add(n),n instanceof Date&&n.getTime();for(let h in n)try{deep_read(n[h],c)}catch{}const l=get_prototype_of(n);if(l!==Object.prototype&&l!==Array.prototype&&l!==Map.prototype&&l!==Set.prototype&&l!==Date.prototype){const h=get_descriptors(l);for(let p in h){const g=h[p].get;if(g)try{g.call(n)}catch{}}}}}function is_capture_event(n){return n.endsWith("capture")&&n!=="gotpointercapture"&&n!=="lostpointercapture"}const DELEGATED_EVENTS=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function is_delegated(n){return DELEGATED_EVENTS.includes(n)}const ATTRIBUTE_ALIASES={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function normalize_attribute(n){return n=n.toLowerCase(),ATTRIBUTE_ALIASES[n]??n}const PASSIVE_EVENTS=["touchstart","touchmove"];function is_passive_event(n){return PASSIVE_EVENTS.includes(n)}function autofocus(n,c){if(c){const l=document.body;n.autofocus=!0,queue_micro_task(()=>{document.activeElement===l&&n.focus()})}}let listening_to_form_reset=!1;function add_form_reset_listener(){listening_to_form_reset||(listening_to_form_reset=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var c;if(!n.defaultPrevented)for(const l of n.target.elements)(c=l.__on_r)==null||c.call(l)})},{capture:!0}))}function without_reactive_context(n){var c=active_reaction,l=active_effect;set_active_reaction(null),set_active_effect(null);try{return n()}finally{set_active_reaction(c),set_active_effect(l)}}function listen_to_event_and_reset_event(n,c,l,h=l){n.addEventListener(c,()=>without_reactive_context(l));const p=n.__on_r;p?n.__on_r=()=>{p(),h(!0)}:n.__on_r=()=>h(!0),add_form_reset_listener()}const all_registered_events=new Set,root_event_handles=new Set;function create_event(n,c,l,h={}){function p(g){if(h.capture||handle_event_propagation.call(c,g),!g.cancelBubble)return without_reactive_context(()=>l==null?void 0:l.call(this,g))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?queue_micro_task(()=>{c.addEventListener(n,p,h)}):c.addEventListener(n,p,h),p}function event(n,c,l,h,p){var g={capture:h,passive:p},T=create_event(n,c,l,g);(c===document.body||c===window||c===document)&&teardown(()=>{c.removeEventListener(n,T,g)})}function delegate(n){for(var c=0;c<n.length;c++)all_registered_events.add(n[c]);for(var l of root_event_handles)l(n)}function handle_event_propagation(n){var P;var c=this,l=c.ownerDocument,h=n.type,p=((P=n.composedPath)==null?void 0:P.call(n))||[],g=p[0]||n.target,T=0,v=n.__root;if(v){var I=p.indexOf(v);if(I!==-1&&(c===document||c===window)){n.__root=c;return}var R=p.indexOf(c);if(R===-1)return;I<=R&&(T=I)}if(g=p[T]||n.target,g!==c){define_property(n,"currentTarget",{configurable:!0,get(){return g||l}});var w=active_reaction,C=active_effect;set_active_reaction(null),set_active_effect(null);try{for(var N,D=[];g!==null;){var V=g.assignedSlot||g.parentNode||g.host||null;try{var B=g["__"+h];if(B!==void 0&&!g.disabled)if(is_array(B)){var[ie,...ne]=B;ie.apply(g,[n,...ne])}else B.call(g,n)}catch(z){N?D.push(z):N=z}if(n.cancelBubble||V===c||V===null)break;g=V}if(N){for(let z of D)queueMicrotask(()=>{throw z});throw N}}finally{n.__root=c,delete n.currentTarget,set_active_reaction(w),set_active_effect(C)}}}function create_fragment_from_html(n){var c=document.createElement("template");return c.innerHTML=n,c.content}function assign_nodes(n,c){var l=active_effect;l.nodes_start===null&&(l.nodes_start=n,l.nodes_end=c)}function template(n,c){var l=(c&TEMPLATE_FRAGMENT)!==0,h=(c&TEMPLATE_USE_IMPORT_NODE)!==0,p,g=!n.startsWith("<!>");return()=>{p===void 0&&(p=create_fragment_from_html(g?n:"<!>"+n),l||(p=get_first_child(p)));var T=h?document.importNode(p,!0):p.cloneNode(!0);if(l){var v=get_first_child(T),I=T.lastChild;assign_nodes(v,I)}else assign_nodes(T,T);return T}}function text(n=""){{var c=create_text(n+"");return assign_nodes(c,c),c}}function comment(){var n=document.createDocumentFragment(),c=document.createComment(""),l=create_text();return n.append(c,l),assign_nodes(c,l),n}function append(n,c){n!==null&&n.before(c)}let should_intro=!0;function set_text(n,c){var l=c==null?"":typeof c=="object"?c+"":c;l!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=l,n.nodeValue=l==null?"":l+"")}function mount(n,c){return _mount(n,c)}const document_listeners=new Map;function _mount(n,{target:c,anchor:l,props:h={},events:p,context:g,intro:T=!0}){init_operations();var v=new Set,I=C=>{for(var N=0;N<C.length;N++){var D=C[N];if(!v.has(D)){v.add(D);var V=is_passive_event(D);c.addEventListener(D,handle_event_propagation,{passive:V});var B=document_listeners.get(D);B===void 0?(document.addEventListener(D,handle_event_propagation,{passive:V}),document_listeners.set(D,1)):document_listeners.set(D,B+1)}}};I(array_from(all_registered_events)),root_event_handles.add(I);var R=void 0,w=component_root(()=>{var C=l??c.appendChild(create_text());return branch(()=>{if(g){push({});var N=component_context;N.c=g}p&&(h.$$events=p),should_intro=T,R=n(C,h)||{},should_intro=!0,g&&pop()}),()=>{var V;for(var N of v){c.removeEventListener(N,handle_event_propagation);var D=document_listeners.get(N);--D===0?(document.removeEventListener(N,handle_event_propagation),document_listeners.delete(N)):document_listeners.set(N,D)}root_event_handles.delete(I),C!==l&&((V=C.parentNode)==null||V.removeChild(C))}});return mounted_components.set(R,w),R}let mounted_components=new WeakMap;function if_block(n,c,l=!1){var h=n,p=null,g=null,T=UNINITIALIZED,v=l?EFFECT_TRANSPARENT:0,I=!1;const R=(C,N=!0)=>{I=!0,w(N,C)},w=(C,N)=>{T!==(T=C)&&(T?(p?resume_effect(p):N&&(p=branch(()=>N(h))),g&&pause_effect(g,()=>{g=null})):(g?resume_effect(g):N&&(g=branch(()=>N(h))),p&&pause_effect(p,()=>{p=null})))};block(()=>{I=!1,c(R),I||w(null,null)},v)}function index(n,c){return c}function pause_effects(n,c,l,h){for(var p=[],g=c.length,T=0;T<g;T++)pause_children(c[T].e,p,!0);var v=g>0&&p.length===0&&l!==null;if(v){var I=l.parentNode;clear_text_content(I),I.append(l),h.clear(),link(n,c[0].prev,c[g-1].next)}run_out_transitions(p,()=>{for(var R=0;R<g;R++){var w=c[R];v||(h.delete(w.k),link(n,w.prev,w.next)),destroy_effect(w.e,!v)}})}function each(n,c,l,h,p,g=null){var T=n,v={items:new Map,first:null},I=null,R=!1,w=derived_safe_equal(()=>{var C=l();return is_array(C)?C:C==null?[]:array_from(C)});block(()=>{var C=get(w),N=C.length;R&&N===0||(R=N===0,reconcile(C,v,T,p,c,h,l),g!==null&&(N===0?I?resume_effect(I):I=branch(()=>g(T)):I!==null&&pause_effect(I,()=>{I=null})),get(w))})}function reconcile(n,c,l,h,p,g,T){var v=n.length,I=c.items,R=c.first,w=R,C,N=null,D=[],V=[],B,ie,ne,P;for(P=0;P<v;P+=1){if(B=n[P],ie=g(B,P),ne=I.get(ie),ne===void 0){var z=w?w.e.nodes_start:l;N=create_item(z,c,N,N===null?c.first:N.next,B,ie,P,h,p,T),I.set(ie,N),D=[],V=[],w=N.next;continue}if(update_item(ne,B,P),ne.e.f&INERT&&resume_effect(ne.e),ne!==w){if(C!==void 0&&C.has(ne)){if(D.length<V.length){var se=V[0],re;N=se.prev;var he=D[0],q=D[D.length-1];for(re=0;re<D.length;re+=1)move(D[re],se,l);for(re=0;re<V.length;re+=1)C.delete(V[re]);link(c,he.prev,q.next),link(c,N,he),link(c,q,se),w=se,N=q,P-=1,D=[],V=[]}else C.delete(ne),move(ne,w,l),link(c,ne.prev,ne.next),link(c,ne,N===null?c.first:N.next),link(c,N,ne),N=ne;continue}for(D=[],V=[];w!==null&&w.k!==ie;)w.e.f&INERT||(C??(C=new Set)).add(w),V.push(w),w=w.next;if(w===null)continue;ne=w}D.push(ne),N=ne,w=ne.next}if(w!==null||C!==void 0){for(var j=C===void 0?[]:array_from(C);w!==null;)w.e.f&INERT||j.push(w),w=w.next;var ye=j.length;if(ye>0){var ge=null;pause_effects(c,j,ge,I)}}active_effect.first=c.first&&c.first.e,active_effect.last=N&&N.e}function update_item(n,c,l,h){internal_set(n.v,c),n.i=l}function create_item(n,c,l,h,p,g,T,v,I,R){var w=(I&EACH_ITEM_REACTIVE)!==0,C=(I&EACH_ITEM_IMMUTABLE)===0,N=w?C?mutable_source(p):source(p):p,D=I&EACH_INDEX_REACTIVE?source(T):T,V={i:D,v:N,k:g,a:null,e:null,prev:l,next:h};try{return V.e=branch(()=>v(n,N,D,R),hydrating),V.e.prev=l&&l.e,V.e.next=h&&h.e,l===null?c.first=V:(l.next=V,l.e.next=V.e),h!==null&&(h.prev=V,h.e.prev=V.e),V}finally{}}function move(n,c,l){for(var h=n.next?n.next.e.nodes_start:l,p=c?c.e.nodes_start:l,g=n.e.nodes_start;g!==h;){var T=get_next_sibling(g);p.before(g),g=T}}function link(n,c,l){c===null?n.first=l:(c.next=l,c.e.next=l&&l.e),l!==null&&(l.prev=c,l.e.prev=c&&c.e)}function slot(n,c,l,h,p){var v;var g=(v=c.$$slots)==null?void 0:v[l],T=!1;g===!0&&(g=c[l==="default"?"children":l],T=!0),g===void 0||g(n,T?()=>h:h)}function r(n){var c,l,h="";if(typeof n=="string"||typeof n=="number")h+=n;else if(typeof n=="object")if(Array.isArray(n)){var p=n.length;for(c=0;c<p;c++)n[c]&&(l=r(n[c]))&&(h&&(h+=" "),h+=l)}else for(l in n)n[l]&&(h&&(h+=" "),h+=l);return h}function clsx$1(){for(var n,c,l=0,h="",p=arguments.length;l<p;l++)(n=arguments[l])&&(c=r(n))&&(h&&(h+=" "),h+=c);return h}function clsx(n){return typeof n=="object"?clsx$1(n):n??""}function set_selected(n,c){c?n.hasAttribute("selected")||n.setAttribute("selected",""):n.removeAttribute("selected")}function set_attribute(n,c,l,h){var p=n.__attributes??(n.__attributes={});p[c]!==(p[c]=l)&&(c==="style"&&"__styles"in n&&(n.__styles={}),c==="loading"&&(n[LOADING_ATTR_SYMBOL]=l),l==null?n.removeAttribute(c):typeof l!="string"&&get_setters(n).includes(c)?n[c]=l:n.setAttribute(c,l))}function set_attributes(n,c,l,h,p=!1,g=!1,T=!1){var v=c||{},I=n.tagName==="OPTION";for(var R in c)R in l||(l[R]=null);l.class&&(l.class=clsx(l.class));var w=get_setters(n),C=n.__attributes??(n.__attributes={});for(const P in l){let z=l[P];if(I&&P==="value"&&z==null){n.value=n.__value="",v[P]=z;continue}var N=v[P];if(z!==N){v[P]=z;var D=P[0]+P[1];if(D!=="$$"){if(D==="on"){const se={},re="$$"+P;let he=P.slice(2);var V=is_delegated(he);if(is_capture_event(he)&&(he=he.slice(0,-7),se.capture=!0),!V&&N){if(z!=null)continue;n.removeEventListener(he,v[re],se),v[re]=null}if(z!=null)if(V)n[`__${he}`]=z,delegate([he]);else{let q=function(j){v[P].call(this,j)};var ne=q;v[re]=create_event(he,n,q,se)}else V&&(n[`__${he}`]=void 0)}else if(P==="style"&&z!=null)n.style.cssText=z+"";else if(P==="autofocus")autofocus(n,!!z);else if(P==="__value"||P==="value"&&z!=null)n.value=n[P]=n.__value=z;else if(P==="selected"&&I)set_selected(n,z);else{var B=P;p||(B=normalize_attribute(B));var ie=B==="defaultValue"||B==="defaultChecked";if(z==null&&!g&&!ie)if(C[P]=null,B==="value"||B==="checked"){let se=n;if(B==="value"){let re=se.defaultValue;se.removeAttribute(B),se.defaultValue=re}else{let re=se.defaultChecked;se.removeAttribute(B),se.defaultChecked=re}}else n.removeAttribute(P);else ie||w.includes(B)&&(g||typeof z!="string")?n[B]=z:typeof z!="function"&&set_attribute(n,B,z)}P==="style"&&"__styles"in n&&(n.__styles={})}}}return v}var setters_cache=new Map;function get_setters(n){var c=setters_cache.get(n.nodeName);if(c)return c;setters_cache.set(n.nodeName,c=[]);for(var l,h=n,p=Element.prototype;p!==h;){l=get_descriptors(h);for(var g in l)l[g].set&&c.push(g);h=get_prototype_of(h)}return c}function handle_lazy_img(n){if(n.loading==="lazy"){var c=n.src;n[LOADING_ATTR_SYMBOL]=null,n.loading="eager",n.removeAttribute("src"),requestAnimationFrame(()=>{n[LOADING_ATTR_SYMBOL]!=="eager"&&(n.loading="lazy"),n.src=c})}}function set_class(n,c,l){var h=n.__className,p=to_class(c);(h!==p||hydrating)&&(c==null?n.removeAttribute("class"):n.className=p,n.__className=p)}function to_class(n,c){return(n??"")+""}const now=()=>performance.now(),raf={tick:n=>requestAnimationFrame(n),now:()=>now(),tasks:new Set};function run_tasks(){const n=raf.now();raf.tasks.forEach(c=>{c.c(n)||(raf.tasks.delete(c),c.f())}),raf.tasks.size!==0&&raf.tick(run_tasks)}function loop(n){let c;return raf.tasks.size===0&&raf.tick(run_tasks),{promise:new Promise(l=>{raf.tasks.add(c={c:n,f:l})}),abort(){raf.tasks.delete(c)}}}function dispatch_event(n,c){n.dispatchEvent(new CustomEvent(c))}function css_property_to_camelcase(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const c=n.split("-");return c.length===1?c[0]:c[0]+c.slice(1).map(l=>l[0].toUpperCase()+l.slice(1)).join("")}function css_to_keyframe(n){const c={},l=n.split(";");for(const h of l){const[p,g]=h.split(":");if(!p||g===void 0)break;const T=css_property_to_camelcase(p.trim());c[T]=g.trim()}return c}const linear$1=n=>n;function transition(n,c,l,h){var p=(n&TRANSITION_GLOBAL)!==0,g="both",T,v=c.inert,I=c.style.overflow,R,w;function C(){var ie=active_reaction,ne=active_effect;set_active_reaction(null),set_active_effect(null);try{return T??(T=l()(c,(h==null?void 0:h())??{},{direction:g}))}finally{set_active_reaction(ie),set_active_effect(ne)}}var N={is_global:p,in(){c.inert=v,dispatch_event(c,"introstart"),R=animate(c,C(),w,1,()=>{dispatch_event(c,"introend"),R==null||R.abort(),R=T=void 0,c.style.overflow=I})},out(ie){c.inert=!0,dispatch_event(c,"outrostart"),w=animate(c,C(),R,0,()=>{dispatch_event(c,"outroend"),ie==null||ie()})},stop:()=>{R==null||R.abort(),w==null||w.abort()}},D=active_effect;if((D.transitions??(D.transitions=[])).push(N),should_intro){var V=p;if(!V){for(var B=D.parent;B&&B.f&EFFECT_TRANSPARENT;)for(;(B=B.parent)&&!(B.f&BLOCK_EFFECT););V=!B||(B.f&EFFECT_RAN)!==0}V&&effect(()=>{untrack(()=>N.in())})}}function animate(n,c,l,h,p){var g=h===1;if(is_function(c)){var T,v=!1;return queue_micro_task(()=>{if(!v){var ie=c({direction:g?"in":"out"});T=animate(n,ie,l,h,p)}}),{abort:()=>{v=!0,T==null||T.abort()},deactivate:()=>T.deactivate(),reset:()=>T.reset(),t:()=>T.t()}}if(l==null||l.deactivate(),!(c!=null&&c.duration))return p(),{abort:noop,deactivate:noop,reset:noop,t:()=>h};const{delay:I=0,css:R,tick:w,easing:C=linear$1}=c;var N=[];if(g&&l===void 0&&(w&&w(0,1),R)){var D=css_to_keyframe(R(0,1));N.push(D,D)}var V=()=>1-h,B=n.animate(N,{duration:I});return B.onfinish=()=>{var ie=(l==null?void 0:l.t())??1-h;l==null||l.abort();var ne=h-ie,P=c.duration*Math.abs(ne),z=[];if(P>0){var se=!1;if(R)for(var re=Math.ceil(P/16.666666666666668),he=0;he<=re;he+=1){var q=ie+ne*C(he/re),j=css_to_keyframe(R(q,1-q));z.push(j),se||(se=j.overflow==="hidden")}se&&(n.style.overflow="hidden"),V=()=>{var ye=B.currentTime;return ie+ne*C(ye/P)},w&&loop(()=>{if(B.playState!=="running")return!1;var ye=V();return w(ye,1-ye),!0})}B=n.animate(z,{duration:P,fill:"forwards"}),B.onfinish=()=>{V=()=>h,w==null||w(h,1-h),p()}},{abort:()=>{B&&(B.cancel(),B.effect=null,B.onfinish=noop)},deactivate:()=>{p=noop},reset:()=>{h===0&&(w==null||w(1,0))},t:()=>V()}}function bind_value(n,c,l=c){var h=is_runes();listen_to_event_and_reset_event(n,"input",p=>{var g=p?n.defaultValue:n.value;if(g=is_numberlike_input(n)?to_number(g):g,l(g),h&&g!==(g=c())){var T=n.selectionStart,v=n.selectionEnd;n.value=g??"",v!==null&&(n.selectionStart=T,n.selectionEnd=Math.min(v,n.value.length))}}),untrack(c)==null&&n.value&&l(is_numberlike_input(n)?to_number(n.value):n.value),render_effect(()=>{var p=c();is_numberlike_input(n)&&p===to_number(n.value)||n.type==="date"&&!p&&!n.value||p!==n.value&&(n.value=p??"")})}const pending=new Set;function bind_group(n,c,l,h,p=h){var g=l.getAttribute("type")==="checkbox",T=n;if(c!==null)for(var v of c)T=T[v]??(T[v]=[]);T.push(l),listen_to_event_and_reset_event(l,"change",()=>{var I=l.__value;g&&(I=get_binding_group_value(T,I,l.checked)),p(I)},()=>p(g?[]:null)),render_effect(()=>{var I=h();g?(I=I||[],l.checked=I.includes(l.__value)):l.checked=is(l.__value,I)}),teardown(()=>{var I=T.indexOf(l);I!==-1&&T.splice(I,1)}),pending.has(T)||(pending.add(T),queue_micro_task(()=>{T.sort((I,R)=>I.compareDocumentPosition(R)===4?-1:1),pending.delete(T)})),queue_micro_task(()=>{})}function bind_checked(n,c,l=c){listen_to_event_and_reset_event(n,"change",h=>{var p=h?n.defaultChecked:n.checked;l(p)}),untrack(c)==null&&l(n.checked),render_effect(()=>{var h=c();n.checked=!!h})}function get_binding_group_value(n,c,l){for(var h=new Set,p=0;p<n.length;p+=1)n[p].checked&&h.add(n[p].__value);return l||h.delete(c),Array.from(h)}function is_numberlike_input(n){var c=n.type;return c==="number"||c==="range"}function to_number(n){return n===""?null:+n}var To,$l,xa,ou,wf;const ru=class ru{constructor(c){Ma(this,ou);Ma(this,To,new WeakMap);Ma(this,$l);Ma(this,xa);Ad(this,xa,c)}observe(c,l){var h=jn(this,To).get(c)||new Set;return h.add(l),jn(this,To).set(c,h),Rf(this,ou,wf).call(this).observe(c,jn(this,xa)),()=>{var p=jn(this,To).get(c);p.delete(l),p.size===0&&(jn(this,To).delete(c),jn(this,$l).unobserve(c))}}};To=new WeakMap,$l=new WeakMap,xa=new WeakMap,ou=new WeakSet,wf=function(){return jn(this,$l)??Ad(this,$l,new ResizeObserver(c=>{for(var l of c){ru.entries.set(l.target,l);for(var h of jn(this,To).get(l.target)||[])h(l)}}))},ml(ru,"entries",new WeakMap);let ResizeObserverSingleton=ru;var resize_observer_border_box=new ResizeObserverSingleton({box:"border-box"});function bind_element_size(n,c,l){var h=resize_observer_border_box.observe(n,()=>l(n[c]));effect(()=>(untrack(()=>l(n[c])),h))}function is_bound_this(n,c){return n===c||(n==null?void 0:n[STATE_SYMBOL])===c}function bind_this(n={},c,l,h){return effect(()=>{var p,g;return render_effect(()=>{p=g,g=[],untrack(()=>{n!==l(...g)&&(c(n,...g),p&&is_bound_this(l(...p),n)&&c(null,...p))})}),()=>{queue_micro_task(()=>{g&&is_bound_this(l(...g),n)&&c(null,...g)})}}),n}function init(n=!1){const c=component_context,l=c.l.u;if(!l)return;let h=()=>deep_read_state(c.s);if(n){let p=0,g={};const T=derived(()=>{let v=!1;const I=c.s;for(const R in I)I[R]!==g[R]&&(g[R]=I[R],v=!0);return v&&p++,p});h=()=>get(T)}l.b.length&&user_pre_effect(()=>{observe_all(c,h),run_all(l.b)}),user_effect(()=>{const p=untrack(()=>l.m.map(run));return()=>{for(const g of p)typeof g=="function"&&g()}}),l.a.length&&user_effect(()=>{observe_all(c,h),run_all(l.a)})}function observe_all(n,c){if(n.l.s)for(const l of n.l.s)get(l);c()}function reactive_import(n){var c=source(0);return function(){return arguments.length===1?(set$1(c,get(c)+1),arguments[0]):(get(c),n())}}function bubble_event(n,c){var g;var l=(g=n.$$events)==null?void 0:g[c.type],h=is_array(l)?l.slice():l==null?[]:[l];for(var p of h)p.call(this,c)}let is_store_binding=!1;function capture_store_binding(n){var c=is_store_binding;try{return is_store_binding=!1,[n(),is_store_binding]}finally{is_store_binding=c}}const legacy_rest_props_handler={get(n,c){if(!n.exclude.includes(c))return get(n.version),c in n.special?n.special[c]():n.props[c]},set(n,c,l){return c in n.special||(n.special[c]=prop({get[c](){return n.props[c]}},c,PROPS_IS_UPDATED)),n.special[c](l),update(n.version),!0},getOwnPropertyDescriptor(n,c){if(!n.exclude.includes(c)&&c in n.props)return{enumerable:!0,configurable:!0,value:n.props[c]}},deleteProperty(n,c){return n.exclude.includes(c)||(n.exclude.push(c),update(n.version)),!0},has(n,c){return n.exclude.includes(c)?!1:c in n.props},ownKeys(n){return Reflect.ownKeys(n.props).filter(c=>!n.exclude.includes(c))}};function legacy_rest_props(n,c){return new Proxy({props:n,exclude:c,special:{},version:source(0)},legacy_rest_props_handler)}function with_parent_branch(n){for(var c=active_effect,l=active_effect;c!==null&&!(c.f&(BRANCH_EFFECT|ROOT_EFFECT));)c=c.parent;try{return set_active_effect(c),n()}finally{set_active_effect(l)}}function prop(n,c,l,h){var q;var p=(l&PROPS_IS_IMMUTABLE)!==0,g=!legacy_mode_flag||(l&PROPS_IS_RUNES)!==0,T=(l&PROPS_IS_BINDABLE)!==0,v=(l&PROPS_IS_LAZY_INITIAL)!==0,I=!1,R;T?[R,I]=capture_store_binding(()=>n[c]):R=n[c];var w=STATE_SYMBOL in n||LEGACY_PROPS in n,C=T&&(((q=get_descriptor(n,c))==null?void 0:q.set)??(w&&c in n&&(j=>n[c]=j)))||void 0,N=h,D=!0,V=!1,B=()=>(V=!0,D&&(D=!1,v?N=untrack(h):N=h),N);R===void 0&&h!==void 0&&(C&&g&&props_invalid_value(),R=B(),C&&C(R));var ie;if(g)ie=()=>{var j=n[c];return j===void 0?B():(D=!0,V=!1,j)};else{var ne=with_parent_branch(()=>(p?derived:derived_safe_equal)(()=>n[c]));ne.f|=LEGACY_DERIVED_PROP,ie=()=>{var j=get(ne);return j!==void 0&&(N=void 0),j===void 0?N:j}}if(!(l&PROPS_IS_UPDATED))return ie;if(C){var P=n.$$legacy;return function(j,ye){return arguments.length>0?((!g||!ye||P||I)&&C(ye?ie():j),j):ie()}}var z=!1,se=!1,re=mutable_source(R),he=with_parent_branch(()=>derived(()=>{var j=ie(),ye=get(re);return z?(z=!1,se=!0,ye):(se=!1,re.v=j)}));return p||(he.equals=safe_equals),function(j,ye){if(arguments.length>0){const ge=ye?get(he):g&&T?proxy(j):j;return he.equals(ge)||(z=!0,set$1(re,ge),V&&N!==void 0&&(N=ge),untrack(()=>get(he))),j}return get(he)}}function onMount(n){component_context===null&&lifecycle_outside_component(),legacy_mode_flag&&component_context.l!==null?init_update_callbacks(component_context).m.push(n):user_effect(()=>{const c=untrack(n);if(typeof c=="function")return c})}function onDestroy(n){component_context===null&&lifecycle_outside_component(),onMount(()=>()=>untrack(n))}function create_custom_event(n,c,{bubbles:l=!1,cancelable:h=!1}={}){return new CustomEvent(n,{detail:c,bubbles:l,cancelable:h})}function createEventDispatcher(){const n=component_context;return n===null&&lifecycle_outside_component(),(c,l,h)=>{var g;const p=(g=n.s.$$events)==null?void 0:g[c];if(p){const T=is_array(p)?p.slice():[p],v=create_custom_event(c,l,h);for(const I of T)I.call(n.x,v);return!v.defaultPrevented}return!0}}function afterUpdate(n){component_context===null&&lifecycle_outside_component(),component_context.l===null&&lifecycle_legacy_only(),init_update_callbacks(component_context).a.push(n)}function init_update_callbacks(n){var c=n.l;return c.u??(c.u={a:[],b:[],m:[]})}const PUBLIC_VERSION="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(PUBLIC_VERSION);enable_legacy_mode_flag();function classString(n,c,l){let h=n?"ui ":"";Object.keys(c).forEach((g,T)=>{typeof c[g]=="boolean"&&c[g]&&(h=h+((T>0?" ":"")+g))}),"_"in c&&(h=h+" "+c._),h+=" "+l;let p=h.trim();return p===""?void 0:p}function otherProps(n){let c={};return Object.keys(n).forEach(l=>{l==="data"?Object.keys(n[l]).forEach(h=>{c["data-"+h]=n[l][h]}):typeof n[l]!="boolean"&&l!="_"&&(c[l]=n[l])}),c}function serialize(...n){let c={};if(n.length>=3)if(n[0])c={type:n[0],settings:n[1],activate:n[2]};else return;else if(n.length>=2)if(n[0])c={type:n[0],settings:n[1]};else return;else if(n.length>=1)if(n[0])c={type:n[0],settings:{}};else return;else return;return super_stringify(c,!0)}function rationalize(n){let c=n.filter(l=>l!=null);if(c.length!==0)return JSON.stringify(c)}function contextualFunction(n,c,l,h,p){let g="{";h.forEach((v,I)=>{g+=v+":"+(I>=h.length-p.length?p[I-(h.length-p.length)]:v)+","}),g=g.replace(/,\s*$/,"")+"}";let T='document.dispatchEvent( new CustomEvent("'+n+c+l+'", { detail: {'+l+":"+g+"} } ) )";return new Function(...h,T)}function initialize(n="",c){let l=[...Array(12)].map(h=>(~~(Math.random()*36)).toString(36)).join("");return c!==void 0&&Object.keys(c).forEach(h=>{document.removeEventListener(l+n+h,()=>{}),document.addEventListener(l+n+h,p=>{c[h]._(p.detail[h])})}),l}function functionize(n,c="",l){let h=[];return l!==void 0&&Object.keys(l).forEach(p=>{let g=Object.keys(l[p]).filter(v=>v.charAt(0)!=="_"),T=Object.keys(l[p]).filter(v=>v.charAt(0)!=="_"&&l[p][v]).map(v=>'"'+l[p][v].toString()+'"');h[p]=contextualFunction(n,c,p,g,T)}),h}function decommission(n,c,l){l!==void 0&&Object.keys(l).forEach(h=>{document.removeEventListener(n+c+h,()=>{})})}var root_1$8=template("<div><!></div>"),root_4$1=template("<div><!></div>");function Button(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","toggle","id","active","on_style","off_style","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"toggle",8,!1),T=prop(c,"id",8,void 0),v=prop(c,"active",12,!1),I=prop(c,"on_style",8,""),R=prop(c,"off_style",8,""),w=prop(c,"value",12,void 0),C=prop(c,"popup",8,void 0);const N=createEventDispatcher();function D(z){z.target.attributes["data-value"]?(w(z.target.attributes["data-value"].value),N("click",{id:T(),target:z.target,value:w()})):N("click",{id:T(),target:z.target})}function V(z){v(!v()),z.target.attributes["data-value"]?(w(z.target.attributes["data-value"].value),N("toggle",{id:T(),active:v(),target:z.target,value:w()})):(w(v()),N("toggle",{id:T(),active:v(),target:z.target}))}init();var B=comment(),ie=first_child(B);{var ne=z=>{var se=root_1$8();let re;var he=child(se);{var q=ye=>{var ge=comment(),Ve=first_child(ge);slot(Ve,c,"on",{}),append(ye,ge)},j=ye=>{var ge=comment(),Ve=first_child(ge);slot(Ve,c,"off",{}),append(ye,ge)};if_block(he,ye=>{v()?ye(q):ye(j,!1)})}template_effect((ye,ge,Ve)=>re=set_attributes(se,re,{id:T(),role:"button",tabindex:0,class:ye,"data-value":w(),"data-module":ge,...Ve}),[()=>classString(p(),h,(v()?I():R())+" button"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),event("click",se,V),event("keydown",se,function(ye){bubble_event.call(this,c,ye)}),event("keypress",se,function(ye){bubble_event.call(this,c,ye)}),event("keyup",se,function(ye){bubble_event.call(this,c,ye)}),append(z,se)},P=z=>{var se=root_4$1();let re;var he=child(se);slot(he,c,"default",{}),template_effect((q,j,ye)=>re=set_attributes(se,re,{id:T(),role:"button",tabindex:0,class:q,"data-value":w(),"data-module":j,...ye}),[()=>classString(p(),h,"button"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),event("click",se,D),event("keydown",se,function(q){bubble_event.call(this,c,q)}),event("keypress",se,function(q){bubble_event.call(this,c,q)}),event("keyup",se,function(q){bubble_event.call(this,c,q)}),append(z,se)};if_block(ie,z=>{g()?z(ne):z(P,!1)})}append(n,B),pop()}var root$l=template("<div><!></div>");function Buttons(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"value",12,void 0),v=prop(c,"popup",8,void 0);const I=createEventDispatcher();function R(D){D.target.attributes["data-value"]&&(T(D.target.attributes["data-value"].value),g()?I("click",{id:g(),target:D.target,value:T()}):I("click",{id:g(),target:D.target}))}init();var w=root$l();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{id:g(),role:"button",tabindex:0,class:D,"data-module":V,...B}),[()=>classString(p(),h,"buttons"),()=>serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),()=>otherProps(h)],derived_safe_equal),event("click",w,R),event("keydown",w,function(D){bubble_event.call(this,c,D)}),event("keypress",w,function(D){bubble_event.call(this,c,D)}),event("keyup",w,function(D){bubble_event.call(this,c,D)}),append(n,w),pop()}var root$k=template("<div><!></div>");function Content(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"value",8,void 0),T=prop(c,"popup",8,void 0);init();var v=root$k();let I;var R=child(v);slot(R,c,"default",{}),template_effect((w,C,N)=>I=set_attributes(v,I,{class:w,"data-value":g(),"data-module":C,...N}),[()=>classString(p(),h,"content"),()=>serialize(T()?"popup":null,typeof T()=="boolean"?void 0:T()),()=>otherProps(h)],derived_safe_equal),append(n,v),pop()}var root$j=template("<div><!></div>");function Divider(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$j();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"divider"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root_1$7=template("<h1><!></h1>"),root_3$3=template("<h2><!></h2>"),root_5$3=template("<h3><!></h3>"),root_7$2=template("<h4><!></h4>"),root_9$2=template("<h5><!></h5>"),root_11$2=template("<h6><!></h6>"),root_12$1=template("<div><!></div>");function Header(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","h1","h2","h3","h4","h5","h6","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"h1",8,!1),T=prop(c,"h2",8,!1),v=prop(c,"h3",8,!1),I=prop(c,"h4",8,!1),R=prop(c,"h5",8,!1),w=prop(c,"h6",8,!1),C=prop(c,"popup",8,void 0);init();var N=comment(),D=first_child(N);{var V=ie=>{var ne=root_1$7();let P;var z=child(ne);slot(z,c,"default",{}),template_effect((se,re,he)=>P=set_attributes(ne,P,{class:se,"data-module":re,...he}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(ie,ne)},B=ie=>{var ne=comment(),P=first_child(ne);{var z=re=>{var he=root_3$3();let q;var j=child(he);slot(j,c,"default",{}),template_effect((ye,ge,Ve)=>q=set_attributes(he,q,{class:ye,"data-module":ge,...Ve}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(re,he)},se=re=>{var he=comment(),q=first_child(he);{var j=ge=>{var Ve=root_5$3();let de;var Tt=child(Ve);slot(Tt,c,"default",{}),template_effect((ze,mt,Ce)=>de=set_attributes(Ve,de,{class:ze,"data-module":mt,...Ce}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(ge,Ve)},ye=ge=>{var Ve=comment(),de=first_child(Ve);{var Tt=mt=>{var Ce=root_7$2();let St;var _e=child(Ce);slot(_e,c,"default",{}),template_effect((nt,be,Ie)=>St=set_attributes(Ce,St,{class:nt,"data-module":be,...Ie}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(mt,Ce)},ze=mt=>{var Ce=comment(),St=first_child(Ce);{var _e=be=>{var Ie=root_9$2();let ot;var Ge=child(Ie);slot(Ge,c,"default",{}),template_effect((Fe,Se,ve)=>ot=set_attributes(Ie,ot,{class:Fe,"data-module":Se,...ve}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(be,Ie)},nt=be=>{var Ie=comment(),ot=first_child(Ie);{var Ge=Se=>{var ve=root_11$2();let We;var je=child(ve);slot(je,c,"default",{}),template_effect((le,ee,me)=>We=set_attributes(ve,We,{class:le,"data-module":ee,...me}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(Se,ve)},Fe=Se=>{var ve=root_12$1();let We;var je=child(ve);slot(je,c,"default",{}),template_effect((le,ee,me)=>We=set_attributes(ve,We,{class:le,"data-module":ee,...me}),[()=>classString(p(),h,"header"),()=>serialize(C()?"popup":null,typeof C()=="boolean"?void 0:C()),()=>otherProps(h)],derived_safe_equal),append(Se,ve)};if_block(ot,Se=>{w()?Se(Ge):Se(Fe,!1)},!0)}append(be,Ie)};if_block(St,be=>{R()?be(_e):be(nt,!1)},!0)}append(mt,Ce)};if_block(de,mt=>{I()?mt(Tt):mt(ze,!1)},!0)}append(ge,Ve)};if_block(q,ge=>{v()?ge(j):ge(ye,!1)},!0)}append(re,he)};if_block(P,re=>{T()?re(z):re(se,!1)},!0)}append(ie,ne)};if_block(D,ie=>{g()?ie(V):ie(B,!1)})}append(n,N),pop()}var root_1$6=template("<i><!></i>"),root_2$7=template("<i><!></i>");function Icon(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","link","id","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"link",8,!1),T=prop(c,"id",8,void 0),v=prop(c,"value",12,void 0),I=prop(c,"popup",8,void 0);const R=createEventDispatcher();function w(B){B.target.attributes["data-value"]?(v(B.target.attributes["data-value"].value),R("click",{id:T(),target:B.target,value:v()})):R("click",{id:T(),target:B.target})}init();var C=comment(),N=first_child(C);{var D=B=>{var ie=root_1$6();let ne;var P=child(ie);slot(P,c,"default",{}),template_effect((z,se,re)=>ne=set_attributes(ie,ne,{id:T(),role:"link",tabindex:0,class:z,"data-value":v(),"data-module":se,...re}),[()=>classString(p(),h,"icon"),()=>serialize(I()?"popup":null,typeof I()=="boolean"?void 0:I()),()=>otherProps(h)],derived_safe_equal),event("click",ie,w),event("keydown",ie,function(z){bubble_event.call(this,c,z)}),event("keypress",ie,function(z){bubble_event.call(this,c,z)}),event("keyup",ie,function(z){bubble_event.call(this,c,z)}),append(B,ie)},V=B=>{var ie=root_2$7();let ne;var P=child(ie);slot(P,c,"default",{}),template_effect((z,se,re)=>ne=set_attributes(ie,ne,{id:T(),class:z,"data-value":v(),"data-module":se,...re}),[()=>classString(p(),h,"icon"),()=>serialize(I()?"popup":null,typeof I()=="boolean"?void 0:I()),()=>otherProps(h)],derived_safe_equal),append(B,ie)};if_block(N,B=>{g()?B(D):B(V,!1)})}append(n,C),pop()}var root_1$5=template("<img>"),root_2$6=template("<div><!></div>");function Image$1(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","alt","src","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"alt",8,void 0),T=prop(c,"src",8,void 0),v=prop(c,"popup",8,void 0),I=mutable_state(!1);init();var R=comment(),w=first_child(R);{var C=D=>{var V=root_1$5();let B;template_effect((ie,ne,P)=>B=set_attributes(V,B,{src:T(),class:ie,alt:g(),"data-module":ne,...P}),[()=>classString(p(),h,"image"),()=>serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),()=>otherProps(h)],derived_safe_equal),handle_lazy_img(V),append(D,V)},N=D=>{var V=root_2$6();let B;var ie=child(V);slot(ie,c,"default",{get mouseover(){return get(I)}}),template_effect((ne,P,z)=>B=set_attributes(V,B,{role:"link",tabindex:0,class:ne,"data-module":P,...z}),[()=>classString(p(),h,"image"),()=>serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),()=>otherProps(h)],derived_safe_equal),event("mouseenter",V,()=>{set$1(I,!0)}),event("mouseleave",V,()=>{set$1(I,!1)}),event("focus",V,function(ne){bubble_event.call(this,c,ne)}),append(D,V)};if_block(w,D=>{T()||!T()&&p()?D(C):D(N,!1)})}append(n,R),pop()}var root$i=template("<a><!></a>");function Link(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"value",12,void 0),v=prop(c,"popup",8,void 0);const I=createEventDispatcher();function R(D){D.target.attributes["data-value"]?(T(D.target.attributes["data-value"].value),I("click",{id:g(),target:D.target,value:T()})):I("click",{id:g(),target:D.target})}init();var w=root$i();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{id:g(),role:"link",tabindex:0,class:D,"data-value":T(),"data-module":V,...B}),[()=>classString(p(),h,""),()=>serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),()=>otherProps(h)],derived_safe_equal),event("click",w,R),event("keydown",w,function(D){bubble_event.call(this,c,D)}),event("keypress",w,function(D){bubble_event.call(this,c,D)}),event("keyup",w,function(D){bubble_event.call(this,c,D)}),append(n,w),pop()}var root$h=template("<div><!></div>");function Segment(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$h();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"segment"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root_1$4=template("<span><!></span>"),root_2$5=template("<div><!></div>");function Text$1(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=comment(),v=first_child(T);{var I=w=>{var C=root_1$4();let N;var D=child(C);slot(D,c,"default",{}),template_effect((V,B,ie)=>N=set_attributes(C,N,{class:V,"data-module":B,...ie}),[()=>classString(p(),h,"text"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(w,C)},R=w=>{var C=root_2$5();let N;var D=child(C);slot(D,c,"default",{}),template_effect((V,B,ie)=>N=set_attributes(C,N,{class:V,"data-module":B,...ie}),[()=>classString(p(),h,"text"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(w,C)};if_block(v,w=>{p()?w(I):w(R,!1)})}append(n,T),pop()}var root_1$3=template('<div role="checkbox"><input type="checkbox" tabindex="0"> <!></div>'),root_2$4=template('<div><input type="checkbox" tabindex="0"> <label class="ui checkbox"> </label></div>');function Checkbox(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","group","value","label","name","checked","slider","toggle","disabled","indeterminate","settings","popup"]);push(c,!1);const p=[];let g=prop(c,"ui",8,!1),T=prop(c,"id",12,null),v=prop(c,"group",28,()=>[]),I=prop(c,"value",8,null),R=prop(c,"label",8,null),w=prop(c,"name",8,null),C=prop(c,"checked",12,!1),N=prop(c,"slider",8,!1),D=prop(c,"toggle",8,!1),V=prop(c,"disabled",8,!1),B=prop(c,"indeterminate",8,!1),ie=prop(c,"settings",8,void 0),ne=prop(c,"popup",8,void 0);T(T()?T():Math.random().toString(36).substring(2,6));let P=mutable_state();onMount(()=>{mutate(P,get(P).indeterminate=B())}),afterUpdate(()=>{mutate(P,get(P).indeterminate=B())}),init();var z=comment(),se=first_child(z);{var re=q=>{var j=root_1$3();set_attribute(j,"tabindex",0);var ye=child(j),ge;bind_this(ye,de=>set$1(P,de),()=>get(P));var Ve=sibling(ye,2);slot(Ve,c,"default",{}),template_effect((de,Tt)=>{set_attribute(j,"aria-checked",C()),set_attribute(j,"id",T()+"_div"),set_class(j,clsx(de)),set_attribute(j,"data-value",I()),set_attribute(j,"data-module",Tt),set_attribute(ye,"id",T()),set_attribute(ye,"name",w()),ge!==(ge=I())&&(ye.value=(ye.__value=I())==null?"":I()),ye.disabled=V()},[()=>classString(g(),h,(D()?" toggle":N()?" slider":"")+" checkbox"),()=>rationalize([serialize(ne()?"popup":null,typeof ne()=="boolean"?void 0:ne()),serialize("checkbox",ie())])],derived_safe_equal),bind_group(p,[],ye,()=>(I(),v()),v),bind_checked(ye,C),event("click",j,function(de){bubble_event.call(this,c,de)}),event("keydown",j,function(de){bubble_event.call(this,c,de)}),event("keypress",j,function(de){bubble_event.call(this,c,de)}),event("keyup",j,function(de){bubble_event.call(this,c,de)}),append(q,j)},he=q=>{var j=root_2$4();let ye;var ge=child(j),Ve;bind_this(ge,ze=>set$1(P,ze),()=>get(P));var de=sibling(ge,2),Tt=child(de);template_effect((ze,mt,Ce)=>{ye=set_attributes(j,ye,{role:"checkbox","aria-checked":C(),tabindex:0,id:T()+"_div",class:ze,"data-value":I(),"data-module":mt,...Ce}),set_attribute(ge,"id",T()),set_attribute(ge,"name",w()),Ve!==(Ve=I())&&(ge.value=(ge.__value=I())==null?"":I()),ge.disabled=V(),set_attribute(de,"for",T()),set_text(Tt,R())},[()=>classString(g(),h,(V()?"disabled ":"")+(D()?" toggle":N()?" slider":"")+" checkbox"),()=>rationalize([serialize(ne()?"popup":null,typeof ne()=="boolean"?void 0:ne()),serialize("checkbox",ie())]),()=>otherProps(h)],derived_safe_equal),bind_group(p,[],ge,()=>(I(),v()),v),bind_checked(ge,C),event("click",j,function(ze){bubble_event.call(this,c,ze)}),event("keydown",j,function(ze){bubble_event.call(this,c,ze)}),event("keypress",j,function(ze){bubble_event.call(this,c,ze)}),event("keyup",j,function(ze){bubble_event.call(this,c,ze)}),append(q,j)};if_block(se,q=>{R()?q(he,!1):q(re)})}append(n,z),pop()}var root_1$2=template("<div><!></div>"),root_3$2=template("<div><!></div>"),root_5$2=template("<input> <!>",1),root_7$1=template("<input> <!>",1),root_9$1=template("<input> <!>",1),root_11$1=template("<input> <!>",1),root_13$1=template("<input> <!>",1),root_15$2=template("<input> <!>",1),root_17$1=template("<input> <!>",1),root_19=template("<input> <!>",1),root_21$1=template("<input> <!>",1),root_23=template("<input> <!>",1),root_25$1=template("<input> <!>",1),root_27$1=template("<input> <!>",1),root_29=template("<input> <!>",1),root_31=template("<input> <!>",1),root_33=template("<input> <!>",1),root_35=template("<input> <!>",1),root_37=template("<input> <!>",1),root_39$1=template("<div><!></div>"),root_40=template("<input> <!>",1);function Input$2(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["value","checked","group","id","settings","ui","text","password","hidden","number","email","tel","checkbox","radio","date","time","color","file","search","range","week","month","year","popup","callbacks"]);push(c,!1);const p=[];let g=prop(c,"value",12,""),T=prop(c,"checked",12,!1),v=prop(c,"group",12,""),I=prop(c,"id",8,void 0),R=prop(c,"settings",8,void 0),w=prop(c,"ui",8,!1),C=prop(c,"text",8,!1),N=prop(c,"password",8,!1),D=prop(c,"hidden",8,!1),V=prop(c,"number",8,!1),B=prop(c,"email",8,!1),ie=prop(c,"tel",8,!1),ne=prop(c,"checkbox",8,!1),P=prop(c,"radio",8,!1),z=prop(c,"date",8,!1),se=prop(c,"time",8,!1),re=prop(c,"color",8,!1),he=prop(c,"file",8,!1),q=prop(c,"search",8,!1),j=prop(c,"range",8,!1),ye=prop(c,"week",8,!1),ge=prop(c,"month",8,!1),Ve=prop(c,"year",8,!1),de=prop(c,"popup",8,void 0),Tt=prop(c,"callbacks",8,void 0);const ze=initialize(I(),Tt());onDestroy(()=>{decommission(ze,I(),Tt())});const mt=createEventDispatcher();function Ce(Ie){ne()?mt("click",{id:I(),target:Ie.target,checked:T(),value:g()}):P()?mt("click",{id:I(),target:Ie.target,group:v(),value:g()}):mt("click",{id:I(),target:Ie.target,value:g()})}init();var St=comment(),_e=first_child(St);{var nt=Ie=>{var ot=root_1$2();let Ge;var Fe=child(ot);slot(Fe,c,"default",{}),template_effect((Se,ve,We)=>Ge=set_attributes(ot,Ge,{class:Se,"data-module":ve,...We}),[()=>classString(w(),h,"file input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),append(Ie,ot)},be=Ie=>{var ot=comment(),Ge=first_child(ot);{var Fe=ve=>{var We=root_3$2();let je;var le=child(We);slot(le,c,"default",{}),template_effect((ee,me,Ee)=>je=set_attributes(We,je,{class:ee,"data-module":me,...Ee}),[()=>classString(w(),h,"search input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),append(ve,We)},Se=ve=>{var We=comment(),je=first_child(We);{var le=me=>{var Ee=root_5$2(),Oe=first_child(Ee);let Be;var Ye=sibling(Oe,2);slot(Ye,c,"default",{}),template_effect((Ke,it,Ue)=>Be=set_attributes(Oe,Be,{type:"text",id:I(),class:Ke,"data-module":it,...Ue}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Oe,g),event("click",Oe,Ce),event("change",Oe,function(Ke){bubble_event.call(this,c,Ke)}),event("keydown",Oe,function(Ke){bubble_event.call(this,c,Ke)}),event("keypress",Oe,function(Ke){bubble_event.call(this,c,Ke)}),event("keyup",Oe,function(Ke){bubble_event.call(this,c,Ke)}),append(me,Ee)},ee=me=>{var Ee=comment(),Oe=first_child(Ee);{var Be=Ke=>{var it=root_7$1(),Ue=first_child(it);let Et;var J=sibling(Ue,2);slot(J,c,"default",{}),template_effect(($e,Qe,ke)=>Et=set_attributes(Ue,Et,{type:"password",id:I(),class:$e,"data-module":Qe,...ke}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Ue,g),event("click",Ue,Ce),event("change",Ue,function($e){bubble_event.call(this,c,$e)}),event("keydown",Ue,function($e){bubble_event.call(this,c,$e)}),event("keypress",Ue,function($e){bubble_event.call(this,c,$e)}),event("keyup",Ue,function($e){bubble_event.call(this,c,$e)}),append(Ke,it)},Ye=Ke=>{var it=comment(),Ue=first_child(it);{var Et=$e=>{var Qe=root_9$1(),ke=first_child(Qe);let yt;var M=sibling(ke,2);slot(M,c,"default",{}),template_effect((st,gt,Je)=>yt=set_attributes(ke,yt,{type:"hidden",id:I(),class:st,"data-module":gt,...Je}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(ke,g),event("click",ke,Ce),event("change",ke,function(st){bubble_event.call(this,c,st)}),event("keydown",ke,function(st){bubble_event.call(this,c,st)}),event("keypress",ke,function(st){bubble_event.call(this,c,st)}),event("keyup",ke,function(st){bubble_event.call(this,c,st)}),append($e,Qe)},J=$e=>{var Qe=comment(),ke=first_child(Qe);{var yt=st=>{var gt=root_11$1(),Je=first_child(gt);let ut;var dt=sibling(Je,2);slot(dt,c,"default",{}),template_effect((Xe,pt,E)=>ut=set_attributes(Je,ut,{type:"number",id:I(),class:Xe,"data-module":pt,...E}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Je,g),event("click",Je,Ce),event("change",Je,function(Xe){bubble_event.call(this,c,Xe)}),event("keydown",Je,function(Xe){bubble_event.call(this,c,Xe)}),event("keypress",Je,function(Xe){bubble_event.call(this,c,Xe)}),event("keyup",Je,function(Xe){bubble_event.call(this,c,Xe)}),append(st,gt)},M=st=>{var gt=comment(),Je=first_child(gt);{var ut=Xe=>{var pt=root_13$1(),E=first_child(pt);let A;var W=sibling(E,2);slot(W,c,"default",{}),template_effect((H,ae,xe)=>A=set_attributes(E,A,{type:"email",id:I(),class:H,"data-module":ae,...xe}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(E,g),event("click",E,Ce),event("change",E,function(H){bubble_event.call(this,c,H)}),event("keydown",E,function(H){bubble_event.call(this,c,H)}),event("keypress",E,function(H){bubble_event.call(this,c,H)}),event("keyup",E,function(H){bubble_event.call(this,c,H)}),append(Xe,pt)},dt=Xe=>{var pt=comment(),E=first_child(pt);{var A=H=>{var ae=root_15$2(),xe=first_child(ae);let Ct;var Qt=sibling(xe,2);slot(Qt,c,"default",{}),template_effect((rt,b,k)=>Ct=set_attributes(xe,Ct,{type:"tel",id:I(),class:rt,"data-module":b,...k}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(xe,g),event("click",xe,Ce),event("change",xe,function(rt){bubble_event.call(this,c,rt)}),event("keydown",xe,function(rt){bubble_event.call(this,c,rt)}),event("keypress",xe,function(rt){bubble_event.call(this,c,rt)}),event("keyup",xe,function(rt){bubble_event.call(this,c,rt)}),append(H,ae)},W=H=>{var ae=comment(),xe=first_child(ae);{var Ct=rt=>{var b=root_17$1(),k=first_child(b);let F;var X=sibling(k,2);slot(X,c,"default",{}),template_effect((oe,Re,Pe)=>F=set_attributes(k,F,{type:"date",id:I(),class:oe,"data-module":Re,...Pe}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(k,g),event("click",k,Ce),event("change",k,function(oe){bubble_event.call(this,c,oe)}),event("keydown",k,function(oe){bubble_event.call(this,c,oe)}),event("keypress",k,function(oe){bubble_event.call(this,c,oe)}),event("keyup",k,function(oe){bubble_event.call(this,c,oe)}),append(rt,b)},Qt=rt=>{var b=comment(),k=first_child(b);{var F=oe=>{var Re=root_19(),Pe=first_child(Re);let Ht;var fi=sibling(Pe,2);slot(fi,c,"default",{}),template_effect((Ft,Kt,gi)=>Ht=set_attributes(Pe,Ht,{type:"time",id:I(),class:Ft,"data-module":Kt,...gi}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Pe,g),event("click",Pe,Ce),event("change",Pe,function(Ft){bubble_event.call(this,c,Ft)}),event("keydown",Pe,function(Ft){bubble_event.call(this,c,Ft)}),event("keypress",Pe,function(Ft){bubble_event.call(this,c,Ft)}),event("keyup",Pe,function(Ft){bubble_event.call(this,c,Ft)}),append(oe,Re)},X=oe=>{var Re=comment(),Pe=first_child(Re);{var Ht=Ft=>{var Kt=root_21$1(),gi=first_child(Kt);let ei;var De=sibling(gi,2);slot(De,c,"default",{}),template_effect((Jt,Ci,Ii)=>ei=set_attributes(gi,ei,{type:"color",id:I(),class:Jt,"data-module":Ci,...Ii}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(gi,g),event("click",gi,Ce),event("change",gi,function(Jt){bubble_event.call(this,c,Jt)}),event("keydown",gi,function(Jt){bubble_event.call(this,c,Jt)}),event("keypress",gi,function(Jt){bubble_event.call(this,c,Jt)}),event("keyup",gi,function(Jt){bubble_event.call(this,c,Jt)}),append(Ft,Kt)},fi=Ft=>{var Kt=comment(),gi=first_child(Kt);{var ei=Jt=>{var Ci=root_23(),Ii=first_child(Ci);let Es;var Ds=sibling(Ii,2);slot(Ds,c,"default",{}),template_effect((Zt,mi,hi)=>Es=set_attributes(Ii,Es,{type:"file",id:I(),class:Zt,"data-module":mi,...hi}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Ii,g),event("click",Ii,Ce),event("change",Ii,function(Zt){bubble_event.call(this,c,Zt)}),event("keydown",Ii,function(Zt){bubble_event.call(this,c,Zt)}),event("keypress",Ii,function(Zt){bubble_event.call(this,c,Zt)}),event("keyup",Ii,function(Zt){bubble_event.call(this,c,Zt)}),append(Jt,Ci)},De=Jt=>{var Ci=comment(),Ii=first_child(Ci);{var Es=Zt=>{var mi=root_25$1(),hi=first_child(mi);let Bs;var Fs=sibling(hi,2);slot(Fs,c,"default",{}),template_effect((li,ji,Si)=>Bs=set_attributes(hi,Bs,{type:"search",id:I(),class:li,"data-module":ji,...Si}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(hi,g),event("click",hi,Ce),event("change",hi,function(li){bubble_event.call(this,c,li)}),event("keydown",hi,function(li){bubble_event.call(this,c,li)}),event("keypress",hi,function(li){bubble_event.call(this,c,li)}),event("keyup",hi,function(li){bubble_event.call(this,c,li)}),append(Zt,mi)},Ds=Zt=>{var mi=comment(),hi=first_child(mi);{var Bs=li=>{var ji=root_27$1(),Si=first_child(ji);let Tn;var os=sibling(Si,2);slot(os,c,"default",{}),template_effect((ai,rs,ci)=>Tn=set_attributes(Si,Tn,{type:"range",id:I(),class:ai,"data-module":rs,...ci}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Si,g),event("click",Si,Ce),event("change",Si,function(ai){bubble_event.call(this,c,ai)}),event("keydown",Si,function(ai){bubble_event.call(this,c,ai)}),event("keypress",Si,function(ai){bubble_event.call(this,c,ai)}),event("keyup",Si,function(ai){bubble_event.call(this,c,ai)}),append(li,ji)},Fs=li=>{var ji=comment(),Si=first_child(ji);{var Tn=ai=>{var rs=root_29(),ci=first_child(rs);let En;var tn=sibling(ci,2);slot(tn,c,"default",{}),template_effect((Vt,Ri,Oi)=>En=set_attributes(ci,En,{type:"week",id:I(),class:Vt,"data-module":Ri,...Oi}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(ci,g),event("click",ci,Ce),event("change",ci,function(Vt){bubble_event.call(this,c,Vt)}),event("keydown",ci,function(Vt){bubble_event.call(this,c,Vt)}),event("keypress",ci,function(Vt){bubble_event.call(this,c,Vt)}),event("keyup",ci,function(Vt){bubble_event.call(this,c,Vt)}),append(ai,rs)},os=ai=>{var rs=comment(),ci=first_child(rs);{var En=Vt=>{var Ri=root_31(),Oi=first_child(Ri);let bs;var Ni=sibling(Oi,2);slot(Ni,c,"default",{}),template_effect((et,It,ui)=>bs=set_attributes(Oi,bs,{type:"month",id:I(),class:et,"data-module":It,...ui}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Oi,g),event("click",Oi,Ce),event("change",Oi,function(et){bubble_event.call(this,c,et)}),event("keydown",Oi,function(et){bubble_event.call(this,c,et)}),event("keypress",Oi,function(et){bubble_event.call(this,c,et)}),event("keyup",Oi,function(et){bubble_event.call(this,c,et)}),append(Vt,Ri)},tn=Vt=>{var Ri=comment(),Oi=first_child(Ri);{var bs=et=>{var It=root_33(),ui=first_child(It);let Di;var ls=sibling(ui,2);slot(ls,c,"default",{}),template_effect((qt,Ze,ft)=>Di=set_attributes(ui,Di,{type:"year",id:I(),class:qt,"data-module":Ze,...ft}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(ui,g),event("click",ui,Ce),event("change",ui,function(qt){bubble_event.call(this,c,qt)}),event("keydown",ui,function(qt){bubble_event.call(this,c,qt)}),event("keypress",ui,function(qt){bubble_event.call(this,c,qt)}),event("keyup",ui,function(qt){bubble_event.call(this,c,qt)}),append(et,It)},Ni=et=>{var It=comment(),ui=first_child(It);{var Di=qt=>{var Ze=root_35(),ft=first_child(Ze);let Ki;var vs=sibling(ft,2);slot(vs,c,"default",{}),template_effect((_t,$i,ti)=>Ki=set_attributes(ft,Ki,{type:"checkbox",id:I(),class:_t,"data-module":$i,...ti,...ti}),[()=>classString(w(),h,"input"),()=>rationalize([serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),serialize("checkbox",R())]),()=>otherProps(h)],derived_safe_equal),bind_group(p,[],ft,v,v),bind_checked(ft,T),bind_value(ft,g),event("click",ft,Ce),event("change",ft,function(_t){bubble_event.call(this,c,_t)}),event("keydown",ft,function(_t){bubble_event.call(this,c,_t)}),event("keypress",ft,function(_t){bubble_event.call(this,c,_t)}),event("keyup",ft,function(_t){bubble_event.call(this,c,_t)}),append(qt,Ze)},ls=qt=>{var Ze=comment(),ft=first_child(Ze);{var Ki=_t=>{var $i=root_37(),ti=first_child($i);let Mi;var At=sibling(ti,2);slot(At,c,"default",{}),template_effect((xt,wi,Wt)=>Mi=set_attributes(ti,Mi,{type:"radio",id:I(),class:xt,"data-module":wi,...Wt,...Wt}),[()=>classString(w(),h,"input"),()=>rationalize([serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),serialize("checkbox",R())]),()=>otherProps(h)],derived_safe_equal),bind_group(p,[],ti,v,v),bind_value(ti,g),event("click",ti,Ce),event("change",ti,function(xt){bubble_event.call(this,c,xt)}),event("keydown",ti,function(xt){bubble_event.call(this,c,xt)}),event("keypress",ti,function(xt){bubble_event.call(this,c,xt)}),event("keyup",ti,function(xt){bubble_event.call(this,c,xt)}),append(_t,$i)},vs=_t=>{var $i=comment(),ti=first_child($i);{var Mi=xt=>{var wi=root_39$1();let Wt;var Ji=child(wi);slot(Ji,c,"default",{}),template_effect((ys,ii,as)=>Wt=set_attributes(wi,Wt,{class:ys,"data-module":ii,...as}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),append(xt,wi)},At=xt=>{var wi=root_40(),Wt=first_child(wi);let Ji;var ys=sibling(Wt,2);slot(ys,c,"default",{}),template_effect((ii,as,Us)=>Ji=set_attributes(Wt,Ji,{id:I(),type:"text",class:ii,"data-module":as,...Us}),[()=>classString(w(),h,"input"),()=>serialize(de()?"popup":null,typeof de()=="boolean"?void 0:de()),()=>otherProps(h)],derived_safe_equal),bind_value(Wt,g),event("click",Wt,Ce),event("change",Wt,function(ii){bubble_event.call(this,c,ii)}),event("keydown",Wt,function(ii){bubble_event.call(this,c,ii)}),event("keypress",Wt,function(ii){bubble_event.call(this,c,ii)}),event("keyup",Wt,function(ii){bubble_event.call(this,c,ii)}),append(xt,wi)};if_block(ti,xt=>{w()?xt(Mi):xt(At,!1)},!0)}append(_t,$i)};if_block(ft,_t=>{P()?_t(Ki):_t(vs,!1)},!0)}append(qt,Ze)};if_block(ui,qt=>{ne()?qt(Di):qt(ls,!1)},!0)}append(et,It)};if_block(Oi,et=>{Ve()?et(bs):et(Ni,!1)},!0)}append(Vt,Ri)};if_block(ci,Vt=>{ge()?Vt(En):Vt(tn,!1)},!0)}append(ai,rs)};if_block(Si,ai=>{ye()?ai(Tn):ai(os,!1)},!0)}append(li,ji)};if_block(hi,li=>{j()?li(Bs):li(Fs,!1)},!0)}append(Zt,mi)};if_block(Ii,Zt=>{q()?Zt(Es):Zt(Ds,!1)},!0)}append(Jt,Ci)};if_block(gi,Jt=>{he()?Jt(ei):Jt(De,!1)},!0)}append(Ft,Kt)};if_block(Pe,Ft=>{re()?Ft(Ht):Ft(fi,!1)},!0)}append(oe,Re)};if_block(k,oe=>{se()?oe(F):oe(X,!1)},!0)}append(rt,b)};if_block(xe,rt=>{z()?rt(Ct):rt(Qt,!1)},!0)}append(H,ae)};if_block(E,H=>{ie()?H(A):H(W,!1)},!0)}append(Xe,pt)};if_block(Je,Xe=>{B()?Xe(ut):Xe(dt,!1)},!0)}append(st,gt)};if_block(ke,st=>{V()?st(yt):st(M,!1)},!0)}append($e,Qe)};if_block(Ue,$e=>{D()?$e(Et):$e(J,!1)},!0)}append(Ke,it)};if_block(Oe,Ke=>{N()?Ke(Be):Ke(Ye,!1)},!0)}append(me,Ee)};if_block(je,me=>{C()?me(le):me(ee,!1)},!0)}append(ve,We)};if_block(Ge,ve=>{w()&&q()?ve(Fe):ve(Se,!1)},!0)}append(Ie,ot)};if_block(_e,Ie=>{w()&&he()?Ie(nt):Ie(be,!1)})}append(n,St),pop()}var root_1$1=template("<div><!></div>"),root_2$3=template("<div><!></div>");function Dropdown(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","settings","selected","value","popup","multiple","values","callbacks"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"settings",8,void 0),v=prop(c,"selected",12,void 0),I=prop(c,"value",12,void 0),R=prop(c,"popup",8,void 0),w=prop(c,"multiple",8,!1),C=prop(c,"values",8,!1),N=prop(c,"callbacks",24,()=>({}));const D=createEventDispatcher(),V={onChange:{value:null,text:null,$choice:null,_:q=>{console.log(q),v(q.value),I(v())}}};let B=w()?{...N(),...V}:N();const ie=initialize(g(),B);onDestroy(()=>{decommission(ie,g(),B)});function ne(q){(q.target.attributes.hasOwnProperty("data-value")||q.target.attributes.hasOwnProperty("value")||!C()&&q.target.innerText)&&(I(q.target.attributes.hasOwnProperty("data-value")?q.target.attributes["data-value"].value:q.target.attributes.hasOwnProperty("value").value?q.target.attributes.value.value:C()?void 0:q.target.innerText.trim()),v(I()),g()?D("change",{id:g(),target:q.target,value:I()}):D("change",{target:q.target,value:I()}))}function P(q){v(q.target.value),I(v()),g()?D("change",{id:g(),target:q.target,value:I()}):D("change",{target:q.target,value:I()})}init();var z=comment(),se=first_child(z);{var re=q=>{var j=root_1$1();let ye;var ge=child(j);slot(ge,c,"default",{}),template_effect((Ve,de,Tt)=>ye=set_attributes(j,ye,{id:g(),class:Ve,"data-selected":v(),"data-module":de,...Tt}),[()=>classString(p(),h,"multiple dropdown"),()=>rationalize([serialize("dropdown",{...functionize(ie,g(),B),...T()}),serialize(R()?"popup":null,typeof R()=="boolean"?void 0:R())]),()=>otherProps(h)],derived_safe_equal),event("change",j,P),append(q,j)},he=q=>{var j=root_2$3();let ye;var ge=child(j);slot(ge,c,"default",{}),template_effect((Ve,de,Tt)=>ye=set_attributes(j,ye,{role:"link",tabindex:0,id:g(),class:Ve,"data-module":de,...Tt}),[()=>classString(p(),h,"dropdown"),()=>rationalize([serialize("dropdown",{...functionize(ie,g(),B),...T()}),serialize(R()?"popup":null,typeof R()=="boolean"?void 0:R())]),()=>otherProps(h)],derived_safe_equal),event("click",j,ne),append(q,j)};if_block(se,q=>{w()?q(re):q(he,!1)})}append(n,z),pop()}var root$g=template("<div><!></div>");function Menu$2(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","selected","value","settings","popup","values","callbacks"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",12,void 0),T=prop(c,"selected",12,void 0),v=prop(c,"value",12,void 0),I=prop(c,"settings",8,void 0),R=prop(c,"popup",8,void 0),w=prop(c,"values",8,!1),C=prop(c,"callbacks",8,void 0);g(g()?g():Math.random().toString(36).substring(2,6));const N=initialize(g(),C());onDestroy(()=>{decommission(N,g(),C())});function D(ne){(ne.target.attributes.hasOwnProperty("data-value")||ne.target.attributes.hasOwnProperty("value")||!w()&&ne.target.innerText)&&(v(ne.target.attributes.hasOwnProperty("data-value")?ne.target.attributes["data-value"].value:ne.target.attributes.hasOwnProperty("value").value?ne.target.attributes.value.value:w()?void 0:ne.target.innerText.trim()),T(v()))}init();var V=root$g();let B;var ie=child(V);slot(ie,c,"default",{}),template_effect((ne,P,z)=>B=set_attributes(V,B,{role:"link",tabindex:0,id:g(),class:ne,"data-module":P,...z}),[()=>classString(p(),h,"menu"),()=>rationalize([serialize(R()?"popup":null,typeof R()=="boolean"?void 0:R()),serialize("menu",{...functionize(N,g(),C()),...I()})]),()=>otherProps(h)],derived_safe_equal),event("click",V,D),event("change",V,function(ne){bubble_event.call(this,c,ne)}),append(n,V),pop()}const linear=n=>n;function fade(n,{delay:c=0,duration:l=400,easing:h=linear}={}){const p=+getComputedStyle(n).opacity;return{delay:c,duration:l,easing:h,css:g=>`opacity: ${g*p}`}}var root$f=template("<div><!></div>");function Message(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$f();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"message"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),transition(3,T,()=>fade),append(n,T),pop()}var root$e=template("<table><!></table>");function Table(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","sortable","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"sortable",8,!1),T=prop(c,"popup",8,void 0);init();var v=root$e();let I;var R=child(v);slot(R,c,"default",{}),template_effect((w,C,N)=>I=set_attributes(v,I,{class:w,"data-module":C,...N}),[()=>classString(p(),h,"table"),()=>rationalize([serialize(T()?"popup":null,typeof T()=="boolean"?void 0:T()),serialize(g()?"tablesort":null)]),()=>otherProps(h)],derived_safe_equal),append(n,v),pop()}var root$d=template("<tbody><!></tbody>");function Table_Body(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$d();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,""),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root$c=template("<thead><!></thead>");function Table_Head(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$c();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,""),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root$b=template("<tr><!></tr>");function Table_Row(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$b();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,""),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root_1=template("<th><!></th>"),root_2$2=template("<td><!></td>");function Table_Col(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","head","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"head",8,!1),T=prop(c,"popup",8,void 0);init();var v=comment(),I=first_child(v);{var R=C=>{var N=root_1();let D;var V=child(N);slot(V,c,"default",{}),template_effect((B,ie,ne)=>D=set_attributes(N,D,{class:B,"data-module":ie,...ne}),[()=>classString(p(),h,""),()=>serialize(T()?"popup":null,typeof T()=="boolean"?void 0:T()),()=>otherProps(h)],derived_safe_equal),append(C,N)},w=C=>{var N=root_2$2();let D;var V=child(N);slot(V,c,"default",{}),template_effect((B,ie,ne)=>D=set_attributes(N,D,{class:B,"data-module":ie,...ne}),[()=>classString(p(),h,""),()=>serialize(T()?"popup":null,typeof T()=="boolean"?void 0:T()),()=>otherProps(h)],derived_safe_equal),append(C,N)};if_block(I,C=>{g()?C(R):C(w,!1)})}append(n,v),pop()}var root$a=template("<div><!></div>");function Actions(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$a();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"actions"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root$9=template("<div><!></div>");function Flyout$2(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","settings","popup","callbacks"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"settings",8,void 0),v=prop(c,"popup",8,void 0),I=prop(c,"callbacks",8,void 0);const R=initialize(g(),I());onDestroy(()=>{decommission(R,g(),I())}),init();var w=root$9();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{id:g(),class:D,"data-module":V,...B}),[()=>classString(p(),h,"flyout"),()=>rationalize([serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),serialize("flyout",{...functionize(R,g(),I()),...T()})]),()=>otherProps(h)],derived_safe_equal),append(n,w),pop()}var root$8=template("<div><!></div>");function Modal(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","settings","popup","callbacks"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"settings",8,void 0),v=prop(c,"popup",8,void 0),I=prop(c,"callbacks",8,void 0);const R=initialize(g(),I());onDestroy(()=>{decommission(R,g(),I())}),init();var w=root$8();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{id:g(),class:D,"data-module":V,...B}),[()=>classString(p(),h,"modal"),()=>rationalize([serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),serialize("modal",{...functionize(R,g(),I()),...T()})]),()=>otherProps(h)],derived_safe_equal),append(n,w),pop()}var root$7=template("<div><!></div>");function Pusher(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup","clientWidth","clientHeight","offsetWidth","offsetHeight"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0),T=prop(c,"clientWidth",12,0),v=prop(c,"clientHeight",12,0),I=prop(c,"offsetWidth",12,0),R=prop(c,"offsetHeight",12,0);init();var w=root$7();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{class:D,"data-module":V,...B}),[()=>classString(p(),h,"pusher"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),bind_element_size(w,"clientWidth",T),bind_element_size(w,"clientHeight",v),bind_element_size(w,"offsetWidth",I),bind_element_size(w,"offsetHeight",R),append(n,w),pop()}var root$6=template("<div><!></div>");function Card(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$6();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"card"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root$5=template("<div><!></div>");function Cards(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"popup",8,void 0);init();var T=root$5();let v;var I=child(T);slot(I,c,"default",{}),template_effect((R,w,C)=>v=set_attributes(T,v,{class:R,"data-module":w,...C}),[()=>classString(p(),h,"cards"),()=>serialize(g()?"popup":null,typeof g()=="boolean"?void 0:g()),()=>otherProps(h)],derived_safe_equal),append(n,T),pop()}var root$4=template("<div><!></div>");function Item(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["ui","id","value","popup"]);push(c,!1);let p=prop(c,"ui",8,!1),g=prop(c,"id",8,void 0),T=prop(c,"value",12,void 0),v=prop(c,"popup",8,void 0);const I=createEventDispatcher();function R(D){D.target.attributes["data-value"]?(T(D.target.attributes["data-value"].value),I("click",{id:g(),target:D.target,value:T()})):I("click",{id:g(),target:D.target})}init();var w=root$4();let C;var N=child(w);slot(N,c,"default",{}),template_effect((D,V,B)=>C=set_attributes(w,C,{role:"link",tabindex:0,class:D,"data-value":T(),"data-module":V,...B}),[()=>classString(p(),h,"item"),()=>serialize(v()?"popup":null,typeof v()=="boolean"?void 0:v()),()=>otherProps(h)],derived_safe_equal),event("click",w,R),event("keydown",w,function(D){bubble_event.call(this,c,D)}),event("keypress",w,function(D){bubble_event.call(this,c,D)}),event("keyup",w,function(D){bubble_event.call(this,c,D)}),append(n,w),pop()}var root$3=template("<div><!></div>");function Div(n,c){const l=legacy_rest_props(c,["children","$$slots","$$events","$$legacy"]),h=legacy_rest_props(l,["value","ui","popup","name"]);push(c,!1);let p=prop(c,"value",8,null),g=prop(c,"ui",8,!1),T=prop(c,"popup",8,void 0),v=prop(c,"name",8,"");init();var I=root$3();let R;var w=child(I);slot(w,c,"default",{}),template_effect((C,N,D)=>R=set_attributes(I,R,{"data-value":p(),class:C,"data-module":N,...D}),[()=>classString(g(),h,v()),()=>serialize(T()?"popup":null,typeof T()=="boolean"?void 0:T()),()=>otherProps(h)],derived_safe_equal),append(n,I),pop()}class R2{constructor(c,l,h=!0){ml(this,"_secure",!1);ml(this,"_graphql_http_url","https://localhost:4005/reality2");ml(this,"_graphql_webs_url","wss://localhost:4005/reality2/websocket");ml(this,"_sockets",{});this._secure=h,h?(this._graphql_http_url="https://"+c+":"+l+"/reality2",this._graphql_webs_url="wss://"+c+":"+l+"/reality2/websocket"):(this._graphql_http_url="http://"+c+":"+l+"/reality2",this._graphql_webs_url="ws://"+c+":"+l+"/reality2/websocket")}sentantAll(c={},l="id name"){return new Promise((h,p)=>{this._graphql_post(this._sentantAll(l),{}).then(g=>{h({...c,...g})},g=>{p(g)})})}sentantGet(c,l={},h="id name"){return new Promise((p,g)=>{this._graphql_post(this._sentantGet(h),{id:c}).then(T=>{p({...l,...T})},T=>{g(T)})})}sentantGetByName(c,l={},h="id name"){return new Promise((p,g)=>{this._graphql_post(this._sentantGetByName(h),{name:c}).then(T=>{p({...l,...T})},T=>{g(T)})})}sentantLoad(c,l={},h="id name"){return new Promise((p,g)=>{this._graphql_post(this._sentantLoad(h),{definition:c}).then(T=>{p({...l,...T})},T=>{g(T)})})}sentantUnload(c,l={},h="id name"){return new Promise((p,g)=>{this._graphql_post(this._sentantUnload(h),{id:c}).then(T=>{p({...l,...T})},T=>{g(T)})})}swarmLoad(c,l={},h="id name"){return new Promise((p,g)=>{this._graphql_post(this._swarmLoad(h),{definition:c}).then(T=>{p({...l,...T})},T=>{g(T)})})}sentantSend(c,l,h,p={},g="id name"){return this._graphql_post(this._sentandSend(g),{id:c,event:l,parameters:JSON.stringify(h),passthrough:JSON.stringify(p)})}awaitSignal(c,l,h=()=>{}){this._subscribe(c,l,h)}monitor(c=()=>{}){this._set_up_node_monitoring(c)}static JSONPath(c,l){let h=l.split("."),p=c;for(let g=0;g<h.length;g++){let T=parseInt(h[g]);if(isNaN(T))if(p.hasOwnProperty(h[g]))p=p[h[g]];else return null;else if(Array.isArray(p))p=p[T];else return null}return p}static ToSimple(c){return this.convert(c,!0)}static ToJSON(c){return this.convert(c,!1)}static convert(c,l=!0){if(c==null)return null;if(typeof c=="number"||typeof c=="boolean")return c;if(typeof c=="string"){if(c=c.replace(/^['"]+|['"]+$/g,""),c.toLowerCase()==="true")return!0;if(c.toLowerCase()==="false")return!1;const h=Number(c);if(!isNaN(h))return h;try{const p=JSON.parse(c);if(typeof p=="object"&&p!==null)return l?JSON.stringify(p):p}catch{}return c}return Array.isArray(c)||typeof c=="object"&&c!==null?l?JSON.stringify(c):c:String(c)}_set_up_node_monitoring(c=()=>{}){let l={sentant:{name:"monitor",automations:[{name:"Monitor",transitions:[{event:"__internal",actions:[{command:"signal",parameters:{public:!0,event:"internal"}}]}]}]}};this.sentantGetByName("monitor").then(h=>{h.data.sentantGet==null?this.sentantLoad(JSON.stringify(l)).then(p=>{this.awaitSignal(p.data.sentantLoad.id,"internal",g=>{c(g)}),console.log("Monitor Sentant Loaded")}):(this.awaitSignal(h.data.sentantGet.id,"internal",p=>{c(p)}),console.log("Monitor Sentant Loaded"))})}_graphql_post(c,l){let h={query:c,variables:JSON.stringify(l)},p={method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(h)};return fetch(this._graphql_http_url,p).then(g=>g.json()).then(g=>g)}_subscribe(c,l,h){let p={topic:"__absinthe__:control",event:"phx_join",payload:{},ref:0},g={topic:"__absinthe__:control",event:"doc",payload:{query:this._awaitSignal("event parameters"),variables:{id:c,signal:l}},ref:0},T={topic:"phoenix",event:"heartbeat",payload:{},ref:0};this._sockets[c+"|"+l]={ws:new WebSocket(this._graphql_webs_url),connected:!1,timer:null},this._sockets[c+"|"+l].ws.onopen=()=>{setTimeout(()=>{this._sockets[c+"|"+l].ws.send(JSON.stringify(p))},100)},this._sockets[c+"|"+l].ws.onmessage=v=>{let I=JSON.parse(v.data),R=I.payload;if(this._sockets[c+"|"+l].connected){if(R.result){let w=R.result;if(w.hasOwnProperty("data")){let C=w.data.awaitSignal;h(C)}}}else I.event=="phx_reply"&&I.payload.status=="ok"&&(console.log("Websocket connected"),this._sockets[c+"|"+l].ws.send(JSON.stringify(g)),this._sockets[c+"|"+l].connected=!0,this._sockets[c+"|"+l].timer=setInterval(()=>{console.log("heartbeat"),this._sockets[c+"|"+l].ws.send(JSON.stringify(T))},3e4),h({status:"connected"}))}}_sentantAll(c){return`{
            sentantAll {
                ${c}
            }
        }`}_sentantGet(c){return`query SentantGet($id: UUID4!) {
            sentantGet(id: $id) {
                ${c}
            }
        }`}_sentantGetByName(c){return`query SentantGet($name: String!) {
            sentantGet(name: $name) {
                ${c}
            }
        }`}_sentantLoad(c){return`mutation SentantLoad($definition: String!) {
            sentantLoad(definition: $definition) {
                ${c}
            }
        }`}_sentantUnload(c){return`mutation SentantUnload($id: UUID4!) {
            sentantUnload(id: $id) {
                ${c}
            }
        }`}_swarmLoad(c){return`mutation SwarmLoad($definition: String!) {
            swarmLoad(definition: $definition) {
                description
                name
                sentants {
                    ${c}
                }
            }
        }`}_sentandSend(c){return`mutation SentantSend($id: UUID4!, $event: String!, $parameters: Json, $passthrough: Json) {
            sentantSend(id: $id, event: $event, parameters: $parameters, passthrough: $passthrough) {
                ${c}
            }
        }`}_awaitSignal(c="id name"){return`subscription AwaitSignal($id: UUID4!, $signal: String!) {
            awaitSignal(id: $id, signal: $signal) {
                ${c}
            }
        }`}}var root_4=template("<!> <p><!></p> <p><!></p>",1),root_9=template("<!><!><!>",1),root_14$1=template("<pre> </pre>"),root_15$1=template("<!> <!>",1),root_3$1=template("<!> <!> <!> <!> <!> <!>",1),root_22=template("<!> <p><!></p> <p> </p>",1),root_28$1=template("<!> <!> <br>",1),root_36=template("<!> <!> <!>",1),root_41=template("<!> <!>",1),root_32$1=template("<!> <!> <!>",1),root_20=template("<!> <!> <!> <!> <!>",1);function SentantCard(n,c){push(c,!1);let l=prop(c,"sentant",24,()=>({name:"",id:"",description:"",events:[],signals:[]})),h=prop(c,"r2_node",8),p=prop(c,"mini",8,!1),g=prop(c,"height",8,"1000px"),T=prop(c,"variables",24,()=>({})),v=mutable_state(["|","|","|","|","|"]),I=mutable_state({}),R=5,w=mutable_state(!1),C=mutable_state(!1),N=mutable_state("");async function D(re){try{await navigator.clipboard.writeText(re),console.log("Copied!")}catch(he){console.error("Failed to copy:",he)}}function V(re){if(re===""||re===null)return"";const he=parseFloat(re);if(!isNaN(he))return he;switch(re.toLowerCase()){case"true":return!0;case"false":return!1}try{return JSON.parse(re)}catch{return re}}function B(re,he){let q={};for(let j=0;j<l().events.length;j++)if(l().events[j].event==he)for(let ye in l().events[j].parameters)q[ye]=V(get(I)[he+ye]);h().sentantSend(re,he,q)}function ie(){h().sentantUnload(l().id)}async function ne(re){await tick(),reload(re)}onMount(()=>{if(l().name!="monitor")for(let re=0;re<l().signals.length;re++)h().awaitSignal(l().id,l().signals[re],he=>{if(he.hasOwnProperty("event")){let q=new Date;set$1(v,[...get(v),q.toLocaleString("en-NZ")+" : "+he.event+"|"+JSON.stringify(he.parameters)]),get(v).length>R&&get(v).splice(0,get(v).length-R),ne(l().id)}})}),init();var P=comment(),z=first_child(P);{var se=re=>{var he=comment(),q=first_child(he);{var j=ge=>{Card(ge,{get style(){return`height: ${g()??""};`},get id(){return l().id},children:(Ve,de)=>{var Tt=root_3$1(),ze=first_child(Tt);const mt=derived_safe_equal(()=>p()?"text-align: center;":"height:150px; text-align: center; padding-top: 10px; padding-left: 10px; padding-right:10px;");Div(ze,{get style(){return get(mt)},children:(Ie,ot)=>{var Ge=root_4(),Fe=first_child(Ge);Header(Fe,{ui:!0,children:(le,ee)=>{var me=text();template_effect(()=>set_text(me,l().name)),append(le,me)},$$slots:{default:!0}});var Se=sibling(Fe,2),ve=child(Se);Text$1(ve,{ui:!0,small:!0,blue:!0,children:(le,ee)=>{var me=text();template_effect(()=>set_text(me,l().id)),append(le,me)},$$slots:{default:!0}});var We=sibling(Se,2),je=child(We);Text$1(je,{ui:!0,children:(le,ee)=>{var me=text();template_effect(Ee=>set_text(me,Ee),[()=>get(N).split("|")[0].split(", ")[1]],derived_safe_equal),append(le,me)},$$slots:{default:!0}}),append(Ie,Ge)},$$slots:{default:!0}});var Ce=sibling(ze,2);Divider(Ce,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,blue:!0,children:(Ie,ot)=>{var Ge=text("message");append(Ie,Ge)},$$slots:{default:!0}});var St=sibling(Ce,2);Div(St,{style:"text-align: center;",children:(Ie,ot)=>{var Ge=root_9(),Fe=first_child(Ge);Text$1(Fe,{ui:!0,children:(We,je)=>{var le=text("narrow  ");append(We,le)},$$slots:{default:!0}});var Se=sibling(Fe);Checkbox(Se,{ui:!0,toggle:!0,label:" ",grey:!0,get checked(){return get(w)},set checked(We){set$1(w,We)},$$legacy:!0});var ve=sibling(Se);Text$1(ve,{ui:!0,children:(We,je)=>{var le=text("wide");append(We,le)},$$slots:{default:!0}}),append(Ie,Ge)},$$slots:{default:!0}});var _e=sibling(St,2);Divider(_e,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,blue:!0,children:(Ie,ot)=>{var Ge=text("message");append(Ie,Ge)},$$slots:{default:!0}});var nt=sibling(_e,2);Div(nt,{style:"overflow:auto; height: 620px; padding-left: 10px; padding-right:10px;",children:(Ie,ot)=>{Text$1(Ie,{ui:!0,children:(Ge,Fe)=>{var Se=root_14$1(),ve=child(Se);template_effect(We=>{set_attribute(Se,"style",`text-align: left; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; width: ${(get(w)?"100ch":"30ch")??""};`),set_text(ve,We)},[()=>JSON.stringify(V(get(N).split("|")[1]),null,4)],derived_safe_equal),append(Ge,Se)},$$slots:{default:!0}})},$$slots:{default:!0}});var be=sibling(nt,2);Div(be,{style:"height:80px; position: absolute; bottom: 0px; left: 0px; right: 0px;",children:(Ie,ot)=>{var Ge=root_15$1(),Fe=first_child(Ge);Divider(Fe,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,blue:!0,children:(ve,We)=>{var je=text("actions");append(ve,je)},$$slots:{default:!0}});var Se=sibling(Fe,2);Div(Se,{style:"padding-left: 10px; padding-right:10px;",children:(ve,We)=>{Button(ve,{ui:!0,teal:!0,fluid:!0,$$events:{click:()=>set$1(C,!1)},children:(je,le)=>{var ee=text("done");append(je,ee)},$$slots:{default:!0}})},$$slots:{default:!0}}),append(Ie,Ge)},$$slots:{default:!0}}),append(Ve,Tt)},$$slots:{default:!0}})},ye=ge=>{Card(ge,{get style(){return`height: ${g()??""};`},get id(){return l().id},children:(Ve,de)=>{var Tt=root_20(),ze=first_child(Tt);const mt=derived_safe_equal(()=>"/?name="+l().name+"&variables="+encodeURIComponent(JSON.stringify(T())));Link(ze,{ui:!0,image:!0,get href(){return get(mt)},children:(Ge,Fe)=>{Image$1(Ge,{ui:!0,large:!0,src:"/images/bee_blue.png"})},$$slots:{default:!0}});var Ce=sibling(ze,2);const St=derived_safe_equal(()=>p()?"text-align: center;":"height:130px; text-align: center; padding-top:10px; padding-left: 10px; padding-right:10px;");Div(Ce,{get style(){return get(St)},children:(Ge,Fe)=>{var Se=root_22(),ve=first_child(Se);Header(ve,{ui:!0,children:(me,Ee)=>{var Oe=text();template_effect(()=>set_text(Oe,l().name)),append(me,Oe)},$$slots:{default:!0}});var We=sibling(ve,2),je=child(We);Text$1(je,{ui:!0,small:!0,blue:!0,children:(me,Ee)=>{var Oe=text();template_effect(()=>set_text(Oe,l().id)),append(me,Oe)},$$slots:{default:!0}});var le=sibling(We,2),ee=child(le);template_effect(()=>set_text(ee,l().description)),append(Ge,Se)},$$slots:{default:!0}});var _e=sibling(Ce,2);Divider(_e,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,blue:!0,children:(Ge,Fe)=>{var Se=text("messages");append(Ge,Se)},$$slots:{default:!0}});var nt=sibling(_e,2);const be=derived_safe_equal(()=>p()?"text-align: center;":"height:150px; text-align: center; padding-left: 10px; padding-right:10px;");Div(nt,{get style(){return get(be)},children:(Ge,Fe)=>{var Se=comment(),ve=first_child(Se);each(ve,1,()=>get(v),index,(We,je,le)=>{var ee=comment(),me=first_child(ee);{var Ee=Oe=>{var Be=root_28$1(),Ye=first_child(Be);Button(Ye,{ui:!0,icon:!0,small:!0,basic:!0,popup:!0,style:"box-shadow: 0 0 0 0;","data-tooltip":"click to see message",$$events:{click:()=>{set$1(N,get(je)),set$1(C,!0)}},children:(it,Ue)=>{const Et=derived_safe_equal(()=>le==get(v).length-1?"teal":"grey");Text$1(it,{ui:!0,get _(){return get(Et)},children:(J,$e)=>{var Qe=text();template_effect(ke=>set_text(Qe,ke),[()=>get(je).split("|")[0].split(", ")[1]],derived_safe_equal),append(J,Qe)},$$slots:{default:!0}})},$$slots:{default:!0}});var Ke=sibling(Ye,2);Button(Ke,{ui:!0,icon:!0,small:!0,basic:!0,popup:!0,style:"box-shadow: 0 0 0 0;","data-tooltip":"copy to clipboard",$$events:{click:()=>D(JSON.stringify(V(get(je).split("|")[1]),null,4))},children:(it,Ue)=>{Icon(it,{ui:!0,clipboard:!0})},$$slots:{default:!0}}),append(Oe,Be)};if_block(me,Oe=>{get(je).split("|")[0]!=""&&Oe(Ee)})}append(We,ee)}),append(Ge,Se)},$$slots:{default:!0}});var Ie=sibling(nt,2);{var ot=Ge=>{var Fe=root_32$1(),Se=first_child(Fe);Divider(Se,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,blue:!0,children:(le,ee)=>{var me=text("actions");append(le,me)},$$slots:{default:!0}});var ve=sibling(Se,2);{var We=le=>{Div(le,{style:"overflow-y:auto; overflow-x: hidden; height:230px; text-align: center; padding-left: 10px; padding-right:10px;",children:(ee,me)=>{var Ee=comment(),Oe=first_child(Ee);each(Oe,1,()=>l().events,index,(Be,Ye,Ke)=>{var it=root_36(),Ue=first_child(it);each(Ue,1,()=>Object.keys(get(Ye).parameters),index,(Qe,ke)=>{Input$2(Qe,{ui:!0,labeled:!0,fluid:!0,style:"margin-bottom:5px;",children:(yt,M)=>{Input$2(yt,{text:!0,large:!0,get placeholder(){return get(ke)},get value(){return get(I)[get(Ye).event+get(ke)]},set value(st){mutate(I,get(I)[get(Ye).event+get(ke)]=st)},$$legacy:!0})},$$slots:{default:!0}})});var Et=sibling(Ue,2);Button(Et,{ui:!0,teal:!0,fluid:!0,style:"margin-bottom:20px;",$$events:{click:()=>B(l().id,get(Ye).event)},children:(Qe,ke)=>{var yt=text();template_effect(()=>set_text(yt,get(Ye).event)),append(Qe,yt)},$$slots:{default:!0}});var J=sibling(Et,2);{var $e=Qe=>{Divider(Qe,{ui:!0,teal:!0})};if_block(J,Qe=>{Ke<l().events.length-1&&Qe($e)})}append(Be,it)}),append(ee,Ee)},$$slots:{default:!0}})};if_block(ve,le=>{l().events.length>0&&le(We)})}var je=sibling(ve,2);Div(je,{style:"height:80px; position: absolute; bottom: 0px; left: 0px; right: 0px;",children:(le,ee)=>{var me=root_41(),Ee=first_child(me);Divider(Ee,{ui:!0,small:!0,horizontal:!0,center:!0,aligned:!0,header:!0,orange:!0,children:(Be,Ye)=>{var Ke=text("danger zone");append(Be,Ke)},$$slots:{default:!0}});var Oe=sibling(Ee,2);Div(Oe,{style:"padding-left: 10px; padding-right:10px;",children:(Be,Ye)=>{Button(Be,{ui:!0,orange:!0,fluid:!0,basic:!0,$$events:{click:ie},children:(Ke,it)=>{var Ue=text("Unload");append(Ke,Ue)},$$slots:{default:!0}})},$$slots:{default:!0}}),append(le,me)},$$slots:{default:!0}}),append(Ge,Fe)};if_block(Ie,Ge=>{p()||Ge(ot)})}append(Ve,Tt)},$$slots:{default:!0}})};if_block(q,ge=>{get(C)?ge(j):ge(ye,!1)})}append(re,he)};if_block(z,re=>{l().name!="monitor"&&re(se)})}append(n,P),pop()}function SentantCards(n,c){push(c,!1);let l=prop(c,"r2_node",8),h=prop(c,"sentantData",24,()=>[]),p=prop(c,"variables",24,()=>({})),g=mutable_state("400px");onMount(()=>{T(),window.addEventListener("resize",T)}),onDestroy(()=>{window.removeEventListener("resize",T)});function T(){set$1(g,`${window.innerHeight-80}px`)}init(),Cards(n,{ui:!0,centered:!0,get style(){return`width: 100%; height: ${get(g)??""}; overflow-y:scroll; margin-top: 10px;`},children:(v,I)=>{var R=comment(),w=first_child(R);each(w,1,h,index,(C,N)=>{var D=comment(),V=first_child(D);{var B=ie=>{SentantCard(ie,{get sentant(){return get(N)},get r2_node(){return l()},get variables(){return p()}})};if_block(V,ie=>{get(N).name!=="monitor"&&get(N).name!==".deleted"&&get(N).name!=="view"&&ie(B)})}append(C,D)}),append(v,R)},$$slots:{default:!0}}),pop()}function Login(n){var c=text("Login");append(n,c)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var blockly$1={exports:{}},blockly_compressed$1={exports:{}},blockly_compressed=blockly_compressed$1.exports,hasRequiredBlockly_compressed;function requireBlockly_compressed(){return hasRequiredBlockly_compressed||(hasRequiredBlockly_compressed=1,function(n,c){(function(l,h){n.exports=h()})(blockly_compressed,function(){var l={},h,p,g,T,v,I,R,w,C,N,D,V,B,ie,ne,P,z,se,re,he,q,j,ye,ge,Ve,de,Tt,ze,mt,Ce,St,_e,nt,be,Ie,ot,Ge,Fe,Se,ve,We,je,le,ee,me,Ee,Oe,Be,Ye,Ke,it,Ue,Et,J,$e,Qe,ke,yt,M,st,gt,Je,ut,dt,Xe,pt,E,A,W,H,ae,xe,Ct,Qt,rt,b,k,F,X,oe,Re,Pe,Ht,fi,Ft,Kt,gi,ei,De,Jt,Ci,Ii,Es,Ds,Zt,mi,hi,Bs,Fs,li,ji,Si,Tn,os,ai,rs,ci,En,tn,Vt,Ri,Oi,bs,Ni,et,It,ui,Di,ls,qt,Ze,ft,Ki,vs,_t,$i,ti,Mi,At,xt,wi,Wt,Ji,ys,ii,as,Us,ar,cr,Eo,Hs,si,bo,qe,cs,Lt,Tl,ur,hr,dr,sn,vo,Bi,zt,Gs,El,bl,Pa,vl,_r,Da,yl,$t,Ba,Fi,Kn,bn,pr,fr,Jn,gr,Il,Sl,Zn,mr,Zi,Fa,$r,Is,Tr,Er,yo,Ol,br,kl,Io,Cl,qn,vr,us,yr,Qn,hs,Rl,vn,Ui,So,Ir,Ua,Sr,Or,Ha,Ga,yn,wl,Hi,ds,kr,Ss,Va,nn,Al,Gi,Cr,eo,Wa,Vs,Oo,za,ko,Xa,_s,Ya,qi,Co,Qi,In,on,Ro,Sn,wo,Dt,On,Ws,rn,Ll,Nl,kn,to,Rr,Cn,io,Ml,es,Ao,ja,Lo,xl,Pl,Dl,zs,Ka,Rn,Bl,Fl,No,ps,Ul,so,wn,Mo,xo,no,Xs,wr,Os,Hl,Gl,Ar,Vl,ln,Wl,zl,Xl,Ja,o,u,_,m,y,O,U,K,Q,fe,Ae,tt,at,Ti,Gt,di,Xt,Vi,Lr,ks,Za,Yl,qa,jl,Yt,Po,Kl,Nr,Qa,Mr,Jl,Zl,ec,lu,tc,Ld,Nd,Md,xd,oo,He,ts,Ei,Ut,an,xr,Ne,ni,au,Pd,ic,cu,Dd,uu,sc,hu,du,Bd,_u,Fd,nc,Ud,Hd,Gd,Vd,Wd,pu,zd,ql,Ql,Xd,fu,gu,mu,$u,oc,Tu,Yd,jd,Kd,Pr,Eu,Jd,rc,Cs,Zd,ro,bu,qd,ea,vu,yu,Iu,Su,Ou,ku,Cu,Ru,wu,Au,Qd,e_,t_,i_,s_,n_,o_,r_,l_,Lu,Nu,Mu,xu,Pu,Du,Bu,lc,ta,Fu,a_,Uu,Hu,Gu,Vu,Wu,zu,Xu,Yu,ju,Ku,c_,u_,h_,Ju,d_,__,p_,f_,g_,ue;h=function(e,t,s,a){if(!(e instanceof pe)&&typeof e!="string"||`${e}`.trim()==="")throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),typeof t!="string"||t.trim()==="")throw Error('Invalid name "'+t+'". The name must be a non-empty string.');const d=t.toLowerCase();if(!s)throw Error("Can not register a null value");let f=lo[e],S=ac[e];if(f||(f=lo[e]=Object.create(null),S=ac[e]=Object.create(null)),p(e,s),!a&&f[d]&&f[d]!==s)throw Error('Name "'+d+'" with type "'+e+'" already registered.');f[d]=s,S[d]=t},p=function(e,t){switch(e){case String(pe.FIELD):if(typeof t.fromJson!="function")throw Error('Type "'+e+'" must have a fromJson function')}},g=function(e,t){e=`${e}`.toLowerCase(),t=t.toLowerCase();const s=lo[e];s&&s[t]?(delete lo[e][t],delete ac[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},T=function(e,t,s){e=`${e}`.toLowerCase(),t=t.toLowerCase();const a=lo[e];if(!a||!a[t]){if(t="Unable to find ["+t+"]["+e+"] in the registry.",s)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null}return a[t]},v=function(e,t){return e=`${e}`.toLowerCase(),t=t.toLowerCase(),(e=lo[e])?!!e[t]:!1},I=function(e,t,s){return T(e,t,s)},R=function(e,t,s){return T(e,t,s)},w=function(e,t,s){e=`${e}`.toLowerCase();var a=lo[e];if(!a){if(a=`Unable to find [${e}] in the registry.`,s)throw Error(`${a} You must require or register a ${e} plugin.`);return console.warn(a),null}if(!t)return a;e=ac[e],s=Object.create(null);for(const d of Object.keys(a))s[e[d]]=a[d];return s},C=function(e,t,s){return t=t.plugins[String(e)]||cn,typeof t=="function"?t:I(e,t,s)},N=function(){return"blockly-"+(Lf++).toString(36)},D=function(){return $_.genUid()},l.setRecordUndo$$module$build$src$core$events$utils=function(e){Dr=e},V=function(){return Dr},B=function(e){_c.fireInternal(e)},ie=function(e){if(se()){if(!Ho.length)try{requestAnimationFrame(()=>{setTimeout(ne,0)})}catch{setTimeout(ne,0)}Ho.push(e)}},ne=function(){var e=P(Ho,!0);Ho.length=0;for(let s=0,a;a=e[s];s++)if(a.workspaceId){var t=ge(a.workspaceId);t&&t.fireChangeListener(a)}e=new Set(e.map(s=>s.workspaceId));for(const s of e){if(!s||(e=ge(s),!e))continue;e=e.getUndoStack();let a;for(t=e.length;0<t;t--){const d=e[t-1];if(d.group==="")break;if(a===void 0)a=d.group;else if(d.group!==a)break}a&&t!=e.length-1&&(t=e.splice(t,e.length-t),t=P(t,!0),e.push(...t))}},P=function(e,t){e=e.slice(),t||e.reverse();const s=[],a=Object.create(null);for(let S=0,x;x=e[S];S++)if(!x.isNull()){var d=[x.isUiEvent?uc:x.type,x.blockId,x.workspaceId].join(" "),f=a[d];const Z=f?f.event:null;f?x.type===l.MOVE$$module$build$src$core$events$utils&&f.index===S-1?(d=x,Z.newParentId=d.newParentId,Z.newInputName=d.newInputName,Z.newCoordinate=d.newCoordinate,d.reason&&(Z.reason?(d=new Set(d.reason.concat(Z.reason)),Z.reason=Array.from(d)):Z.reason=d.reason),f.index=S):x.type===l.CHANGE$$module$build$src$core$events$utils&&x.element===Z.element&&x.name===Z.name?Z.newValue=x.newValue:x.type===ao?(f=x,Z.viewTop=f.viewTop,Z.viewLeft=f.viewLeft,Z.scale=f.scale,Z.oldScale=f.oldScale):(x.type!==Nn||Z.type!==un)&&(a[d]={event:x,index:S},s.push(x)):(a[d]={event:x,index:S},s.push(x))}e=s.filter(function(S){return!S.isNull()}),t||e.reverse();for(let S=1,x;x=e[S];S++)x.type===l.CHANGE$$module$build$src$core$events$utils&&x.element==="mutation"&&e.unshift(e.splice(S,1)[0]);return e},z=function(){for(let e=0,t;t=Ho[e];e++)t.recordUndo=!1},l.disable$$module$build$src$core$events$utils=function(){cc++},l.enable$$module$build$src$core$events$utils=function(){cc--},se=function(){return cc===0},l.getGroup$$module$build$src$core$events$utils=function(){return qu},l.setGroup$$module$build$src$core$events$utils=function(e){_c.setGroupInternal(e)},re=function(e){qu=typeof e=="boolean"?e?D():"":e},he=function(e){const t=[];e=e.getDescendants(!1);for(let s=0,a;a=e[s];s++)t[s]=a.id;return t},q=function(e,t){const s=j(e.type);if(!s)throw Error("Unknown event type.");return s.fromJson(e,t)},j=function(e){const t=I(pe.EVENT,e);if(!t)throw Error(`Event type ${e} not found in registry.`);return t},ye=function(e){if((e.type===l.MOVE$$module$build$src$core$events$utils||e.type===l.CREATE$$module$build$src$core$events$utils)&&e.workspaceId){var t=ge(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){const s=Dr;try{Dr=!1;const a=e.getParent();if(a&&!a.hasDisabledReason(hc)){const d=e.getDescendants(!1);for(let f=0,S;S=d[f];f++)S.setDisabledReason(!1,hc)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())do e.setDisabledReason(!0,hc),e=e.getNextBlock();while(e)}finally{Dr=s}}}},ge=function(e){return sa[e]||null},Ve=function(){const e=[];for(const t in sa)e.push(sa[t]);return e},de=function(e){sa[e.id]=e},Tt=function(e){delete sa[e.id]},ze=function(){return T_},mt=function(e){T_=e},Ce=function(){return Go},l.setSelected$$module$build$src$core$common=function(e){if(Go!==e){var t,s,a,d,f,S,x=new(j(Fr))((a=(t=Go)==null?void 0:t.id)!=null?a:null,(d=e==null?void 0:e.id)!=null?d:null,(S=(f=e==null?void 0:e.workspace.id)!=null?f:(s=Go)==null?void 0:s.workspace.id)!=null?S:"");B(x);var Z;(Z=Go)==null||Z.unselect(),Go=e;var we;(we=Go)==null||we.select()}},St=function(){return E_},_e=function(e){E_=e},nt=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const t=e.getParentSvg(),s=e.getCachedParentSvgSize();var a=t.parentElement;if(a instanceof HTMLElement){var d=a.offsetWidth;a=a.offsetHeight,s.width!==d&&(t.setAttribute("width",d+"px"),e.setCachedParentSvgSize(d,null)),s.height!==a&&(t.setAttribute("height",a+"px"),e.setCachedParentSvgSize(null,a)),e.resize()}},be=function(e,t){const s=Object.create(null),a=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=a.indexOf(e),a.splice(e,a.length-e));for(let d=0,f;f=a[d];d++)s[f.type]?s[f.type]++:s[f.type]=1;return s},Ie=function(e){return function(){this.jsonInit(e)}},ot=function(e){b_.defineBlocksWithJsonArrayInternal(e)},Ge=function(e){l.defineBlocks$$module$build$src$core$common(l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const t={};for(let s=0;s<e.length;s++){const a=e[s];if(!a){console.warn(`Block definition #${s} in JSON array is ${a}. Skipping`);continue}const d=a.type;d?t[d]={init:Ie(a)}:console.warn(`Block definition #${s} in JSON array is missing a type attribute. Skipping.`)}return t},l.defineBlocks$$module$build$src$core$common=function(e){for(const t of Object.keys(e)){const s=e[t];t in ss&&console.warn(`Block definition "${t}" overwrites previous definition.`),ss[t]=s}},Fe=function(e,t){Se(),fc=setTimeout(function(){t&&t.handleRightClick(e)},Nf)},Se=function(){fc&&(clearTimeout(fc),fc=0)},ve=function(){pc=null},We=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&le(e)},je=function(e){return`${e.pointerId}`},le=function(e){const t=je(e);return pc?pc===t:e.type==="pointerdown"?(pc=t,!0):!1},ee=function(e,t,s,a,d){function f(x){(d||We(x))&&(s?a.call(s,x):a(x))}const S=[];if(t in Vo)for(let x=0;x<Vo[t].length;x++){const Z=Vo[t][x];e.addEventListener(Z,f,!1),S.push([e,Z,f])}else e.addEventListener(t,f,!1),S.push([e,t,f]);return S},me=function(e,t,s,a){function d(S){s?a.call(s,S):a(S)}const f=[];if(t in Vo)for(let S=0;S<Vo[t].length;S++){const x=Vo[t][S];e.addEventListener(x,d,!1),f.push([e,x,d])}else e.addEventListener(t,d,!1),f.push([e,t,d]);return f},Ee=function(e){const t=e[e.length-1][2];for(;e.length;){const[s,a,d]=e.pop();s.removeEventListener(a,d,!1)}return t},Oe=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||e.target.getAttribute("data-is-text-input")==="true")return!0;if(e.target instanceof HTMLInputElement)return e=e.target,e.type==="text"||e.type==="number"||e.type==="email"||e.type==="password"||e.type==="search"||e.type==="tel"||e.type==="url";if(e.target instanceof HTMLTextAreaElement)return!0}return!1},Be=function(e){return e.ctrlKey&&nh?!0:e.button===2},Ye=function(e,t,s){const a=t.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,s||(s=t.getScreenCTM().inverse()),a.matrixTransform(s)},Ke=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*N_,y:e.deltaY*N_};case 2:return{x:e.deltaX*M_,y:e.deltaY*M_}}},it=function(e,t){return t=e.indexOf(t),t===-1?!1:(e.splice(t,1),!0)},Ue=function(e){if(oh)throw Error("CSS already injected");rh+=`
`+e},Et=function(e,t){oh||(oh=!0,e&&(e=t.replace(/[\\/]$/,""),t=rh.replace(/<<<PATH>>>/g,e),rh="",e=document.createElement("style"),e.id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},J=function(e,t,s){e=document.createElementNS(ra,`${e}`);for(const a in t)e.setAttribute(a,`${t[a]}`);return s&&s.appendChild(e),e},$e=function(e,t){return t=t.split(" "),t.every(s=>e.classList.contains(s))?!1:(e.classList.add(...t),!0)},Qe=function(e,t){e.classList.remove(...t.split(" "))},ke=function(e,t){return t=t.split(" "),t.every(s=>!e.classList.contains(s))?!1:(e.classList.remove(...t),!0)},yt=function(e,t){return e.classList.contains(t)},M=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},st=function(e,t){const s=t.nextSibling;if(t=t.parentNode,!t)throw Error("Reference node has no parent.");s?t.insertBefore(e,s):t.appendChild(e)},gt=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},Je=function(){ah++,Ys||(Ys=Object.create(null))},ut=function(){ah--,ah||(Ys=null)},dt=function(e){const t=e.textContent+`
`+e.className.baseVal;let s;if(Ys&&(s=Ys[t]))return s;try{s=e.getComputedTextLength()}catch{return 8*e.textContent.length}return Ys&&(Ys[t]=s),s},Xe=function(e,t,s,a){return pt(e,t+"pt",s,a)},pt=function(e,t,s,a){const d=e.textContent;e=d+`
`+e.className.baseVal;var f;return Ys&&(f=Ys[e])||($c||(f=document.createElement("canvas"),f.className="blocklyComputeCanvas",document.body.appendChild(f),$c=f.getContext("2d")),$c.font=s+" "+t+" "+a,f=d?$c.measureText(d).width:0,Ys&&(Ys[e]=f)),f},E=function(e,t,s,a){const d=document.createElement("span");d.style.font=s+" "+t+" "+a,d.textContent=e,e=document.createElement("div"),e.style.width="1px",e.style.height="0",t=document.createElement("div"),t.style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(d),t.appendChild(e),document.body.appendChild(t),s={height:0,baseline:0};try{t.style.alignItems="baseline",s.baseline=e.offsetTop-d.offsetTop,t.style.alignItems="flex-end",s.height=e.offsetTop-d.offsetTop}finally{document.body.removeChild(t)}return s},A=function(e){return P_.getSizeInternal(e)},W=function(e){if(ae(e,"display")!=="none")return H(e);const t=e.style,s=t.display,a=t.visibility,d=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";const f=e.offsetWidth;return e=e.offsetHeight,t.display=s,t.position=d,t.visibility=a,new bt(f,e)},H=function(e){return new bt(e.offsetWidth,e.offsetHeight)},ae=function(e,t){return e=window.getComputedStyle(e),e[t]||e.getPropertyValue(t)},xe=function(e){const t=new Te(0,0);e=e.getBoundingClientRect();var s=document.documentElement;return s=new Te(window.pageXOffset||s.scrollLeft,window.pageYOffset||s.scrollTop),t.x=e.left+s.x,t.y=e.top+s.y,t},Ct=function(){const e=document.body,t=document.documentElement;return new Te(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},Qt=function(e){const t=parseFloat(ae(e,"borderLeftWidth")),s=parseFloat(ae(e,"borderRightWidth")),a=parseFloat(ae(e,"borderTopWidth"));return e=parseFloat(ae(e,"borderBottomWidth")),new Nt(a,e,t,s)},rt=function(e,t,s){e=b(e,t,s),t.scrollLeft=e.x,t.scrollTop=e.y},b=function(e,t,s){var a=xe(e),d=xe(t),f=Qt(t);const S=a.x-d.x-f.left;return a=a.y-d.y-f.top,d=H(e),e=t.clientWidth-d.width,d=t.clientHeight-d.height,f=t.scrollLeft,t=t.scrollTop,s?(f+=S-e/2,t+=a-d/2):(f+=Math.min(S,Math.max(S-e,0)),t+=Math.min(a,Math.max(a-d,0))),new Te(f,t)},k=function(e){const t=new Te(0,0);var s=e.x&&e.getAttribute("x");const a=e.y&&e.getAttribute("y");return s&&(t.x=parseInt(s)),a&&(t.y=parseInt(a)),(s=(s=e.getAttribute("transform"))&&s.match(D_))&&(t.x+=Number(s[1]),s[3]&&(t.y+=Number(s[3]))),(e=e.getAttribute("style"))&&e.includes("translate")&&(e=e.match(B_))&&(t.x+=Number(e[1]),e[3]&&(t.y+=Number(e[3]))),t},F=function(e){let t=0,s=0;for(;e;){const a=k(e);if(t+=a.x,s+=a.y,(" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;e=e.parentNode}return new Te(t,s)},X=function(){const e=Ct();return new Nt(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},oe=function(){const e=document.documentElement,t=window;return new Te(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},Re=function(e,t){var s=t.x;t=t.y;const a=e.getInjectionDiv().getBoundingClientRect();return s=new Te(s-a.left,t-a.top),t=e.getOriginOffsetInPixels(),Te.difference(s,t).scale(1/e.scale)},Pe=function(e,t){var s=t.scale(e.scale);t=s.x,s=s.y;const a=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new Te(t+a.left+e.x,s+a.top+e.y)},Ht=function(e){({document:Ec=Ec,DOMParser:la=la,XMLSerializer:aa=aa}=e),Tc=new la,ch=new aa},l.createElement$$module$build$src$core$utils$xml=function(e){return Ec.createElementNS(F_,e)},l.createTextNode$$module$build$src$core$utils$xml=function(e){return Ec.createTextNode(e)},l.textToDom$$module$build$src$core$utils$xml=function(e){let t=Tc.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=Tc.parseFromString(e,"text/html"))&&t.body.firstChild&&t.body.firstChild.nodeName.toLowerCase()==="xml")return t.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},fi=function(e){return Ft(ch.serializeToString(e))},Ft=function(e){return e.replace(Df,t=>`&#${t.charCodeAt(0)};`)},Kt=function(e){return e?((e instanceof Element||typeof e=="string")&&(e=Zt(e),e=Ii(e)),gi(e),e):null},gi=function(e){const t=e.kind;if(e=e.contents,t&&t!==U_&&t!==uh)throw Error("Invalid toolbox kind "+t+". Please supply either "+U_+" or "+uh);if(!e)throw Error("Toolbox must have a contents attribute.")},ei=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:Es(e):[]},De=function(e){return H_.hasCategoriesInternal(e)},Jt=function(e){if(!e)return!1;const t=e.kind;return t?t===uh:!!e.contents.filter(function(s){return s.kind.toUpperCase()==="CATEGORY"}).length},Ci=function(e){return e&&e.contents?!!e.contents.filter(function(t){return t.kind.toUpperCase()==="CATEGORY"}).length:!1},Ii=function(e){const t={contents:Es(e)};return e instanceof Node&&Ds(e,t),t},Es=function(e){const t=[];let s=e.childNodes;s||(s=e);for(let a=0,d;d=s[a];a++){if(!d.tagName)continue;e={};const f=d.tagName.toUpperCase();e.kind=f,f==="BLOCK"?e.blockxml=d:d.childNodes&&0<d.childNodes.length&&(e.contents=Es(d)),Ds(d,e),t.push(e)}return t},Ds=function(e,t){for(let s=0;s<e.attributes.length;s++){const a=e.attributes[s];a.nodeName.includes("css-")?(t.cssconfig=t.cssconfig||{},t.cssconfig[a.nodeName.replace("css-","")]=a.value):t[a.nodeName]=a.value}},Zt=function(e){let t=null;if(e)if(typeof e=="string"){if(t=l.textToDom$$module$build$src$core$utils$xml(e),t.nodeName.toLowerCase()!=="xml")throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},mi=function(e,t,s,a,d,f){const S=f.scrollbar&&f.scrollbar.canScrollVertically();return e.horizontal===jr.LEFT?(s=d.absoluteMetrics.left+s,S&&f.RTL&&(s+=oi.scrollbarThickness)):(s=d.absoluteMetrics.left+d.viewMetrics.width-t.width-s,S&&!f.RTL&&(s-=oi.scrollbarThickness)),e.vertical===Fn.TOP?e=d.absoluteMetrics.top+a:(e=d.absoluteMetrics.top+d.viewMetrics.height-t.height-a,f.scrollbar&&f.scrollbar.canScrollHorizontally()&&(e-=oi.scrollbarThickness)),new Nt(e,e+t.height,s,s+t.width)},hi=function(e,t){return{horizontal:t.toolboxMetrics.position===lt.LEFT||e.horizontalLayout&&!e.RTL?jr.RIGHT:jr.LEFT,vertical:t.toolboxMetrics.position===lt.BOTTOM?Fn.TOP:Fn.BOTTOM}},Bs=function(e,t,s,a){const d=e.left,f=e.right-e.left,S=e.bottom-e.top;for(let x=0;x<a.length;x++){const Z=a[x];e.intersects(Z)&&(e=s===ho.UP?Z.top-S-t:Z.bottom+t,e=new Nt(e,e+S,d,d+f),x=-1)}return e},Fs=function(e,t){V_(e,t)},li=function(e){V_=e},ji=function(e,t){X_.confirmInternal(e,t)},Si=function(e,t){W_(e,t)},Tn=function(e){W_=e},os=function(e,t,s){z_(e,t,s)},ai=function(e){z_=e},rs=function(e){return e.getVariableModel!==void 0},ci=function(e){return e.getProcedureDef!==void 0},En=function(e){return e.getProcedureCall!==void 0&&e.renameProcedure!==void 0},l.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let s=0;s<e.length;s++){const a=e[s].getVarModels();if(a)for(let d=0;d<a.length;d++){const f=a[d];f.getId()&&t.add(f)}}return Array.from(t.values())},l.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let a=0,d;d=e[a];a++){var s=d.getDeveloperVariables;if(s){s=s();for(let f=0;f<s.length;f++)t.add(s[f])}}return Array.from(t.values())},tn=function(e){let t=[];const s=document.createElement("button");return s.setAttribute("text","%{BKY_NEW_VARIABLE}"),s.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",function(a){Ni(a.getTargetWorkspace())}),t.push(s),e=Vt(e),t=t.concat(e)},Vt=function(e){e=e.getVariablesOfType("");const t=[];if(0<e.length){var s=e[e.length-1];if(ss.variables_set){var a=l.createElement$$module$build$src$core$utils$xml("block");a.setAttribute("type","variables_set"),a.setAttribute("gap",ss.math_change?"8":"24"),a.appendChild(Ze(s)),t.push(a)}if(ss.math_change&&(a=l.createElement$$module$build$src$core$utils$xml("block"),a.setAttribute("type","math_change"),a.setAttribute("gap",ss.variables_get?"20":"8"),a.appendChild(Ze(s)),s=l.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),a.appendChild(s),t.push(a)),ss.variables_get){e.sort(ha.compareByName);for(let d=0,f;f=e[d];d++)s=l.createElement$$module$build$src$core$utils$xml("block"),s.setAttribute("type","variables_get"),s.setAttribute("gap","8"),s.appendChild(Ze(f)),t.push(s)}}return t},Ri=function(e){return j_.generateUniqueNameInternal(e)},Oi=function(e){return bs(ph.charAt(0),e.getAllVariableNames())},bs=function(e,t){if(!t.length)return e;const s=ph;let a="",d=s.indexOf(e);for(;;){let f=!1;for(let S=0;S<t.length;S++)if(t[S].toLowerCase()===e){f=!0;break}if(!f)break;d++,d===s.length&&(d=0,a=`${Number(a)+1}`),e=s.charAt(d)+a}return e},Ni=function(e,t,s){function a(f){et(l.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,f,function(S){if(S){var x=ui(S,e);if(x){if(x.type===d)var Z=l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",x.name);else Z=l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,Z=Z.replace("%1",x.name).replace("%2",x.type);Fs(Z,function(){a(S)})}else e.createVariable(S,d),t&&t(S)}else t&&t(null)})}const d=s||"";a("")},l.renameVariable$$module$build$src$core$variables=function(e,t,s){function a(d){const f=l.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",t.name);et(f,d,function(S){if(S){var x=It(S,t.type,e),Z=Di(t.name,S,e);if(x||Z){var we="";x?we=l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",x.name).replace("%2",x.type):Z&&(we=l.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",S).replace("%2",Z)),Fs(we,function(){a(S)})}else e.renameVariableById(t.getId(),S),s&&s(S)}else s&&s(null)})}a("")},et=function(e,t,s){os(e,t,function(a){a&&(a=a.replace(/[\s\xa0]+/g," ").trim(),a===l.Msg$$module$build$src$core$msg.RENAME_VARIABLE||a===l.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(a=null),s(a)})},It=function(e,t,s){s=s.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let a=0,d;d=s[a];a++)if(d.name.toLowerCase()===e&&d.type!==t)return d;return null},ui=function(e,t){t=t.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let s=0,a;a=t[s];s++)if(a.name.toLowerCase()===e)return a;return null},Di=function(e,t,s){return s.getProcedureMap().getProcedures().length?ls(e,t,s):qt(e,t,s)},ls=function(e,t,s){e=e.toLowerCase(),t=t.toLowerCase(),s=s.getProcedureMap().getProcedures();for(const d of s){var a=d.getParameters().filter(rs).map(f=>f.getVariableModel().name);if(a&&(s=a.some(f=>f.toLowerCase()===e),a=a.some(f=>f.toLowerCase()===t),s&&a))return d.getName()}return null},qt=function(e,t,s){e=e.toLowerCase(),t=t.toLowerCase(),s=s.getAllBlocks(!1);for(const d of s){if(!ci(d))continue;s=d.getProcedureDef();var a=s[1];const f=a.some(S=>S.toLowerCase()===e);if(a=a.some(S=>S.toLowerCase()===t),f&&a)return s[0]}return null},Ze=function(e){const t=l.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.type),e=l.createTextNode$$module$build$src$core$utils$xml(e.name),t.appendChild(e),t},l.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,s,a){let d=l.getVariable$$module$build$src$core$variables(e,t,s,a);return d||(d=ft(e,t,s,a)),d},l.getVariable$$module$build$src$core$variables=function(e,t,s,a){const d=e.getPotentialVariableMap();let f=null;if(t&&(f=e.getVariableById(t),!f&&d&&(f=d.getVariableById(t)),f))return f;if(s){if(a===void 0)throw Error("Tried to look up a variable by name without a type");f=e.getVariable(s,a),!f&&d&&(f=d.getVariable(s,a))}return f},ft=function(e,t,s,a){const d=e.getPotentialVariableMap();return s||(s=Ri(e.isFlyout?e.targetWorkspace:e)),d?d.createVariable(s,a,t):e.createVariable(s,a,t)},Ki=function(e,t){e=e.getAllVariables();const s=[];if(t.length!==e.length)for(let a=0;a<e.length;a++){const d=e[a];t.includes(d)||s.push(d)}return s},vs=function(e){return Mi(e),ti()?(At(),Promise.resolve()):(Kr||(Kr=new Promise(t=>{mh=t,K_=window.requestAnimationFrame(()=>{At(),t()})})),Kr)},_t=function(){return Kr||Promise.resolve()},$i=function(e){e||window.cancelAnimationFrame(K_),At(e),!e&&mh&&mh()},ti=function(){return R_},Mi=function(e){fh.add(e),gh.set(e,l.getGroup$$module$build$src$core$events$utils());const t=e.getParent();t?Mi(t):vc.add(e)},At=function(e){const t=e?new Set([e]):new Set([...vc].map(f=>f.workspace)),s=[...vc].filter(wi).filter(f=>t.has(f.workspace));for(var a of s)Wt(a);for(const f of t)f.resizeContents();for(var d of s)a=d.getRelativeToSurfaceXY(),d.updateComponentLocations(a);for(const f of s)d=l.getGroup$$module$build$src$core$events$utils(),(a=gh.get(f))&&l.setGroup$$module$build$src$core$events$utils(a),f.bumpNeighbours(),l.setGroup$$module$build$src$core$events$utils(d);for(const f of s)xt(f);e||(Kr=null)},xt=function(e){vc.delete(e),fh.delete(e),gh.delete(e);for(const t of e.getChildren(!1))xt(t)},wi=function(e){return!e.isDisposed()&&!e.getParent()},Wt=function(e){if(fh.has(e)&&e.initialized){for(const t of e.getChildren(!1))Wt(t);e.renderEfficiently()}},Ji=function(e,t){h(pe.SERIALIZER,e,t)},ys=function(e){g(pe.SERIALIZER,e)},ii=function(e,{addCoordinates:t=!1,saveIds:s=!0}={}){const a=e.workspace,d=Object.create(null);return d.height=e.getSize().height,d.width=e.getSize().width,s&&(d.id=e.id),t&&(t=e.getRelativeToSurfaceXY(),d.x=a.RTL?a.getWidth()-t.x:t.x,d.y=t.y),e.getText()&&(d.text=e.getText()),e.isCollapsed()&&(d.collapsed=!0),e.isOwnEditable()||(d.editable=!1),e.isOwnMovable()||(d.movable=!1),e.isOwnDeletable()||(d.deletable=!1),d},as=function(e,t,{recordUndo:s=!1}={}){const a=V();if(l.setRecordUndo$$module$build$src$core$events$utils(s),s=t.newComment(e.id),e.text!==void 0&&s.setText(e.text),e.x!==void 0||e.y!==void 0){const f=s.getRelativeToSurfaceXY();let S,x=(S=e.x)!=null?S:f.x;x=t.RTL?t.getWidth()-x:x;var d;t=(d=e.y)!=null?d:f.y,s.moveTo(new Te(x,t))}if(e.width!==void 0||e.height){d=s.getSize();let f,S;s.setSize(new bt((f=e.width)!=null?f:d.width,(S=e.height)!=null?S:d.height))}return e.collapsed!==void 0&&s.setCollapsed(e.collapsed),e.editable!==void 0&&s.setEditable(e.editable),e.movable!==void 0&&s.setMovable(e.movable),e.deletable!==void 0&&s.setDeletable(e.deletable),l.setRecordUndo$$module$build$src$core$events$utils(a),s},Us=function(e,t){h(pe.PASTER,e,t)},ar=function(e){g(pe.PASTER,e)},cr=function(e){const t=e.workspace,s=e.getRelativeToSurfaceXY(),a=new Te(0,0),d=t.getTopComments(!1).filter(f=>f.id!==e.id).map(f=>f.getRelativeToSurfaceXY());for(;Eo(Te.sum(s,a),d);)a.translate(t.RTL?-30:30,30);e.moveTo(Te.sum(s,a))},Eo=function(e,t){return t.some(s=>1>=Math.abs(s.x-e.x)&&1>=Math.abs(s.y-e.y))},Hs=function(e,t){e.setAttribute(Hf,t)},si=function(e,t,s){Array.isArray(s)&&(s=s.join(" ")),e.setAttribute(Uf+t,`${s}`)},bo=function(e){return e.saveState!==void 0&&e.loadState!==void 0},qe=function(e,{addCoordinates:t=!1,addInputBlocks:s=!0,addNextBlocks:a=!0,doFullSerialization:d=!0,saveIds:f=!0}={}){if(e.isInsertionMarker())return null;const S={type:e.type,id:f?e.id:void 0};return t&&Lt(e,S),cs(e,S),Tl(e,S,d),ur(e,S,d),hr(e,S,d),s&&dr(e,S,d,f),a&&sn(e,S,d,f),S},cs=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.disabledReasons=Array.from(e.getDisabledReasons())),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),e.inputsInline!==void 0&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},Lt=function(e,t){const s=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(s.RTL?s.getWidth()-e.x:e.x),t.y=Math.round(e.y)},Tl=function(e,t,s){e.saveExtraState?(e=e.saveExtraState(s),e!==null&&(t.extraState=e)):e.mutationToDom&&(e=e.mutationToDom(),e!==null&&(t.extraState=Os(e).replace(' xmlns="https://developers.google.com/blockly/xml"',"")))},ur=function(e,t,s){const a=Object.create(null);for(const d of e.getIcons())bo(d)&&(e=d.saveState(s))&&(a[d.getType().toString()]=e);Object.keys(a).length&&(t.icons=a)},hr=function(e,t,s){const a=Object.create(null);for(let d=0;d<e.inputList.length;d++){const f=e.inputList[d];for(let S=0;S<f.fieldRow.length;S++){const x=f.fieldRow[S];x.isSerializable()&&(a[x.name]=x.saveState(s))}}Object.keys(a).length&&(t.fields=a)},dr=function(e,t,s,a){const d=Object.create(null);for(let f=0;f<e.inputList.length;f++){const S=e.inputList[f];if(!S.connection)continue;const x=vo(S.connection,s,a);x&&(d[S.name]=x)}Object.keys(d).length&&(t.inputs=d)},sn=function(e,t,s,a){e.nextConnection&&(e=vo(e.nextConnection,s,a))&&(t.next=e)},vo=function(e,t,s){const a=e.getShadowState(!0);if(e=e.targetBlock(),!a&&!e)return null;const d=Object.create(null);return a&&(d.shadow=a),e&&!e.isShadow()&&(d.block=qe(e,{doFullSerialization:t,saveIds:s})),d},Bi=function(e,t,{recordUndo:s=!1}={}){return e=zt(e,t,{recordUndo:s}),t.rendered&&$i(),e},zt=function(e,t,{parentConnection:s,isShadow:a=!1,recordUndo:d=!1}={}){const f=V();l.setRecordUndo$$module$build$src$core$events$utils(d),(d=l.getGroup$$module$build$src$core$events$utils())||l.setGroup$$module$build$src$core$events$utils(!0),l.disable$$module$build$src$core$events$utils();const S=t.getAllVariables();let x;try{x=Gs(e,t,{parentConnection:s,isShadow:a})}finally{l.enable$$module$build$src$core$events$utils()}if(El(t,S),se()&&B(new(j(l.CREATE$$module$build$src$core$events$utils))(x)),l.setGroup$$module$build$src$core$events$utils(d),l.setRecordUndo$$module$build$src$core$events$utils(f),t.rendered){const Z=x;setTimeout(()=>{Z.disposed||Z.setConnectionTracking(!0)},1)}return x},Gs=function(e,t,{parentConnection:s,isShadow:a=!1}={}){if(!e.type)throw new sp(e);const d=t.newBlock(e.type,e.id);return d.setShadow(a),bl(d,e),Pa(d,e),vl(d,e),_r(s,d,e),Da(d,e),yl(d,e),$t(d,e),Ba(d,e),Kn(d,t.rendered),d},El=function(e,t){if(se())for(e=Ki(e,t),t=0;t<e.length;t++){const s=e[t];B(new(j(Ln))(s))}},bl=function(e,t){let s=t.x===void 0?0:t.x;t=t.y===void 0?0:t.y;const a=e.workspace;s=a.RTL?a.getWidth()-s:s,e.moveBy(s,t)},Pa=function(e,t){if(t.collapsed&&e.setCollapsed(!0),t.deletable===!1&&e.setDeletable(!1),t.movable===!1&&e.setMovable(!1),t.editable===!1&&e.setEditable(!1),t.enabled===!1&&e.setDisabledReason(!0,Rs),Array.isArray(t.disabledReasons))for(const s of t.disabledReasons)e.setDisabledReason(!0,s);t.inline!==void 0&&e.setInputsInline(t.inline),t.data!==void 0&&(e.data=t.data)},vl=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation(l.textToDom$$module$build$src$core$utils$xml(t.extraState)))},_r=function(e,t,s){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new op(s);if(e.type===l.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var a=t.outputConnection;if(!a)throw new _a("output",t,s)}else if(a=t.previousConnection,!a)throw new _a("previous",t,s);if(!e.connect(a)){const d=t.workspace.connectionChecker;throw new np(d.getErrorMessage(d.canConnectWithReason(a,e,!1),a,e),e.type===l.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,s)}}},Da=function(e,t){if(t.icons){var s=Object.keys(t.icons);for(const d of s){s=t.icons[d];var a=e.getIcon(d);if(!a){if(a=I(pe.ICON,d,!1),!a)throw new rp(d,e,t);a=new a(e),e.addIcon(a)}bo(a)&&a.loadState(s)}}},yl=function(e,t){if(t.fields){var s=Object.keys(t.fields);for(let a=0;a<s.length;a++){const d=s[a],f=t.fields[d],S=e.getField(d);S?S.loadState(f):console.warn(`Ignoring non-existant field ${d} in block ${e.type}`)}}},$t=function(e,t){if(t.inputs){var s=Object.keys(t.inputs);for(let a=0;a<s.length;a++){const d=s[a],f=e.getInput(d);if(!f||!f.connection)throw new _a(d,e,t);Fi(f.connection,t.inputs[d])}}},Ba=function(e,t){if(t.next){if(!e.nextConnection)throw new _a("next",e,t);Fi(e.nextConnection,t.next)}},Fi=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&Gs(t.block,e.getSourceBlock().workspace,{parentConnection:e})},Kn=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const s of e.getIcons())s.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},bn=function(e){return e.bubbleIsVisible!==void 0&&e.setBubbleVisible!==void 0},pr=function(e){return e*Math.PI/180},fr=function(e){return 180*e/Math.PI},Jn=function(e,t,s){if(s<e){const a=s;s=e,e=a}return Math.max(e,Math.min(t,s))},gr=function(){document.querySelector(".blocklyDropDownDiv")||(Ot=document.createElement("div"),Ot.className="blocklyDropDownDiv",(St()||document.body).appendChild(Ot),el=document.createElement("div"),el.className="blocklyDropDownContent",Ot.appendChild(el),qo=document.createElement("div"),qo.className="blocklyDropDownArrow",Ot.appendChild(qo),Ot.style.opacity="0",Ot.style.transition="transform "+Rc+"s, opacity "+Rc+"s",Ot.addEventListener("focusin",function(){$e(Ot,"blocklyFocused")}),Ot.addEventListener("focusout",function(){ke(Ot,"blocklyFocused")}))},Il=function(e){Oh=e},Sl=function(){return _o},Zn=function(){return el},mr=function(){el.textContent="",el.style.width=""},Zi=function(e,t){Ot.style.backgroundColor=e,Ot.style.borderColor=t},Fa=function(e,t,s,a){return Er(Is(t),e,s,a)},$r=function(e,t,s){return up=!0,Er(Tr(e),e,t,s)},Is=function(e){var t=e.getSvgRoot();const s=e.workspace.scale,a=e.height*s;return e=e.width*s,t=xe(t),new Nt(t.y,t.y+a,t.x,t.x+e)},Tr=function(e){return e=e.getScaledBBox(),new Nt(e.top,e.bottom,e.left,e.right)},Er=function(e,t,s,a){const d=e.left+(e.right-e.left)/2,f=e.bottom;e=e.top,a&&(e+=a),a=t.getSourceBlock();let S=a.workspace;for(;S.options.parentWorkspace;)S=S.options.parentWorkspace;return Il(S.getParentSvg().parentNode),yo(t,a.RTL,d,f,d,e,s)},yo=function(e,t,s,a,d,f,S){return _o=e,Zo=S||null,Ot.style.direction=t?"rtl":"ltr",e=ze(),qr=e.getRenderer().getClassName(),Qr=e.getTheme().getClassName(),qr&&$e(Ot,qr),Qr&&$e(Ot,Qr),yr(s,a,d,f)},Ol=function(e,t,s,a){return e=Io(e,s.left,s.right,a.width),{initialX:e.divX,initialY:t,finalX:e.divX,finalY:t+Ih,arrowX:e.arrowX,arrowY:-9,arrowAtTop:!0,arrowVisible:!0}},br=function(e,t,s,a){return e=Io(e,s.left,s.right,a.width),{initialX:e.divX,initialY:t-a.height,finalX:e.divX,finalY:t-a.height-Ih,arrowX:e.arrowX,arrowY:a.height-2*ap-Cc/2,arrowAtTop:!1,arrowVisible:!0}},kl=function(e,t,s){return e=Io(e,t.left,t.right,s.width),{initialX:e.divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Io=function(e,t,s,a){return t=Jn(t,e-a/2,s-a),e=e-Cc/2-t,s=cp,e=Jn(s,e,a-s-Cc),{arrowX:e,divX:t}},Cl=function(){return!!_o},qn=function(e,t){return _o===e?(t?us():vr(),!0):!1},vr=function(){Ot.style.transform="translate(0, 0)",Ot.style.opacity="0",Sh=setTimeout(function(){us()},1e3*Rc),Zo&&(Zo(),Zo=null)},us=function(){Cl()&&(Sh&&clearTimeout(Sh),Ot.style.transform="",Ot.style.left="",Ot.style.top="",Ot.style.opacity="0",Ot.style.display="none",Ot.style.backgroundColor="",Ot.style.borderColor="",Zo&&(Zo(),Zo=null),mr(),_o=null,qr&&(ke(Ot,qr),qr=""),Qr&&(ke(Ot,Qr),Qr=""),ze().markFocused())},yr=function(e,t,s,a){e=kh.getPositionMetrics(e,t,s,a),e.arrowVisible?(qo.style.display="",qo.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",qo.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):qo.style.display="none",t=Math.floor(e.initialX),s=Math.floor(e.initialY),a=Math.floor(e.finalX);const d=Math.floor(e.finalY);return Ot.style.left=t+"px",Ot.style.top=s+"px",Ot.style.display="block",Ot.style.opacity="1",Ot.style.transform="translate("+(a-t)+"px,"+(d-s)+"px)",!!e.arrowAtTop},Qn=function(){if(_o){var e=_o.getSourceBlock();e=up?Tr(_o):Is(e);const t=e.left+(e.right-e.left)/2;yr(t,e.bottom,t,e.top)}else vr()},hs=function(e){return e.length?e.reduce(function(t,s){return t.length<s.length?t:s}).length:0},Rl=function(e,t){if(!e.length)return 0;if(e.length===1)return e[0].length;let s=0;t=t||hs(e);let a;for(a=0;a<t;a++){for(var d=e[0][a],f=1;f<e.length;f++)if(d!==e[f][a])return s;d===" "&&(s=a+1)}for(d=1;d<e.length;d++)if((f=e[d][a])&&f!==" ")return s;return t},vn=function(e,t){if(!e.length)return 0;if(e.length===1)return e[0].length;let s=0;t=t||hs(e);let a;for(a=0;a<t;a++){for(var d=e[0].substr(-a-1,1),f=1;f<e.length;f++)if(d!==e[f].substr(-a-1,1))return s;d===" "&&(s=a+1)}for(d=1;d<e.length;d++)if((f=e[d].charAt(e[d].length-a-1))&&f!==" ")return s;return t},l.wrap$$module$build$src$core$utils$string=function(e,t){e=e.split(`
`);for(let s=0;s<e.length;s++)e[s]=Ui(e[s],t);return e.join(`
`)},Ui=function(e,t){if(e.length<=t)return e;const s=e.trim().split(/\s+/);for(var a=0;a<s.length;a++)s[a].length>t&&(t=s[a].length);var d=-1/0;let f,S=1;do{a=d,f=e,e=[],d=s.length/S;let x=1;for(let Z=0;Z<s.length-1;Z++)x<(Z+1.5)/d?(x++,e[Z]=!0):e[Z]=!1;e=Ir(s,e,t),d=So(s,e,t),e=Ua(s,e),S++}while(d>a);return f},So=function(e,t,s){const a=[0],d=[];for(var f=0;f<e.length;f++)a[a.length-1]+=e[f].length,t[f]===!0?(a.push(0),d.push(e[f].charAt(e[f].length-1))):t[f]===!1&&a[a.length-1]++;for(e=Math.max(...a),t=0,f=0;f<a.length;f++)t-=2*Math.pow(Math.abs(s-a[f]),1.5),t-=Math.pow(e-a[f],1.5),".?!".includes(d[f])?t+=s/3:",;)]}".includes(d[f])&&(t+=s/4);return 1<a.length&&a[a.length-1]<=a[a.length-2]&&(t+=.5),t},Ir=function(e,t,s){let a=So(e,t,s),d;for(let f=0;f<t.length-1;f++){if(t[f]===t[f+1])continue;const S=[].concat(t);S[f]=!S[f],S[f+1]=!S[f+1];const x=So(e,S,s);x>a&&(a=x,d=S)}return d?Ir(e,d,s):t},Ua=function(e,t){const s=[];for(let a=0;a<e.length;a++)s.push(e[a]),t[a]!==void 0&&s.push(t[a]?`
`:" ");return s.join("")},l.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},Sr=function(e){wc=e},Or=function(){return wc},Ha=function(){return ga},Ga=function(){return pi},yn=function(e){if(e=wl(e)){for(e=e.tooltip;typeof e=="function";)e=e();if(typeof e!="string")throw Error("Tooltip function must return a string.");return e}return""},wl=function(e){for(;e&&e.tooltip;){if(typeof e.tooltip=="string"||typeof e.tooltip=="function")return e;e=e.tooltip}return null},Hi=function(){document.querySelector(".blocklyTooltipDiv")||(pi=document.createElement("div"),pi.className="blocklyTooltipDiv",(St()||document.body).appendChild(pi))},ds=function(e){e.mouseOverWrapper_=me(e,"pointerover",null,Ss),e.mouseOutWrapper_=me(e,"pointerout",null,Va),e.addEventListener("pointermove",nn,!1)},kr=function(e){e&&(Ee(e.mouseOverWrapper_),Ee(e.mouseOutWrapper_),e.removeEventListener("pointermove",nn))},Ss=function(e){il||(e=wl(e.currentTarget),ws!==e&&(Gi(),ma=null,ws=e),clearTimeout(dp))},Va=function(e){il||(dp=setTimeout(function(){ma=ws=null,Gi()},1),clearTimeout(Qo),Qo=0)},nn=function(e){if(ws&&ws.tooltip&&!il)if(ga){const t=Ch-e.pageX;e=Rh-e.pageY,Math.sqrt(t*t+e*e)>_p&&Gi()}else ma!==ws&&(clearTimeout(Qo),Ch=e.pageX,Rh=e.pageY,Qo=setTimeout(za,pp))},Al=function(){ma=ws=null,Gi()},Gi=function(){ga&&(ga=!1,pi&&(pi.style.display="none")),Qo&&(clearTimeout(Qo),Qo=0)},Cr=function(){Gi(),il=!0},eo=function(){il=!1},Wa=function(){pi&&ws&&(typeof wc=="function"?wc(pi,ws):Vs())},Vs=function(){var e=yn(ws);e=l.wrap$$module$build$src$core$utils$string(e,hp),e=e.split(`
`);for(let t=0;t<e.length;t++){const s=document.createElement("div");s.appendChild(document.createTextNode(e[t])),pi.appendChild(s)}},Oo=function(e){const t=document.documentElement.clientWidth,s=document.documentElement.clientHeight;let a=Ch;a=e?a-(wh+pi.offsetWidth):a+wh;let d=Rh+Ah;return d+pi.offsetHeight>s+window.scrollY&&(d-=pi.offsetHeight+2*Ah),e?a=Math.max(Ac-window.scrollX,a):a+pi.offsetWidth>t+window.scrollX-2*Ac&&(a=t-pi.offsetWidth-2*Ac),{x:a,y:d}},za=function(){if(!il&&(ma=ws,pi)){pi.textContent="",Wa();var e=ws.RTL;pi.style.direction=e?"rtl":"ltr",pi.style.display="block",ga=!0;var{x:t,y:s}=Oo(e);pi.style.left=t+"px",pi.style.top=s+"px"}},ko=function(){return Lh},Xa=function(e){Lh=e},_s=function(){return Nh},Ya=function(e){Nh=e},qi=function(e){e=`${e}`.toLowerCase().trim();var t=fp[e];if(t||(t=e.substring(0,2)==="0x"?"#"+e.substring(2):e,t=t[0]==="#"?t:"#"+t,/^#[0-9a-f]{6}$/.test(t)))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var s=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return s&&(e=Number(s[1]),t=Number(s[2]),s=Number(s[3]),0<=e&&256>e&&0<=t&&256>t&&0<=s&&256>s)?Co(e,t,s):null},Co=function(e,t,s){return t=e<<16|t<<8|s,16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},Qi=function(e){return e=qi(e),e?(e=parseInt(e.substr(1),16),[e>>16,e>>8&255,e&255]):[0,0,0]},In=function(e,t,s){let a=0,d=0,f=0;if(t===0)f=d=a=s;else{const S=Math.floor(e/60),x=e/60-S;e=s*(1-t);const Z=s*(1-t*x);switch(t=s*(1-t*(1-x)),S){case 1:a=Z,d=s,f=e;break;case 2:a=e,d=s,f=t;break;case 3:a=e,d=Z,f=s;break;case 4:a=t,d=e,f=s;break;case 5:a=s,d=e,f=Z;break;case 6:case 0:a=s,d=t,f=e}}return Co(Math.floor(a),Math.floor(d),Math.floor(f))},on=function(e,t,s){return e=qi(e),!e||(t=qi(t),!t)?null:(e=Qi(e),t=Qi(t),Co(Math.round(t[0]+s*(e[0]-t[0])),Math.round(t[1]+s*(e[1]-t[1])),Math.round(t[2]+s*(e[2]-t[2]))))},Ro=function(e){return In(e,Lh,255*Nh)},Sn=function(e,t,s){const a=[];var d=e.split("");d.push("");var f=0;e=[];let S=null;for(let we=0;we<d.length;we++){var x=d[we];if(f===0)if(x==="%")(f=e.join(""))&&a.push(f),e.length=0,f=1;else if(s&&x===`
`){const Bt=e.join("");Bt&&a.push(Bt),e.length=0,a.push(x)}else e.push(x);else if(f===1)x==="%"?(e.push(x),f=0):t&&"0"<=x&&"9">=x?(f=2,S=x,(x=e.join(""))&&a.push(x),e.length=0):x==="{"?f=3:(e.push("%",x),f=0);else if(f===2)if("0"<=x&&"9">=x)S+=x;else{var Z=void 0;a.push(parseInt((Z=S)!=null?Z:"",10)),we--,f=0}else f===3&&(x===""?(e.splice(0,0,"%{"),we--,f=0):x!=="}"?e.push(x):(f=e.join(""),/[A-Z]\w*/i.test(f)?(x=f.toUpperCase(),(x=x.startsWith("BKY_")?x.substring(4):null)&&x in l.Msg$$module$build$src$core$msg?(f=l.Msg$$module$build$src$core$msg[x],typeof f=="string"?Array.prototype.push.apply(a,Sn(f,t,s)):t?a.push(`${f}`):a.push(f)):a.push("%{"+f+"}")):a.push("%{"+f+"}"),f=e.length=0))}for((t=e.join(""))&&a.push(t),Z=[],e.length=0,d=0;d<a.length;d++)typeof a[d]!="string"||s&&a[d]===`
`?((t=e.join(""))&&Z.push(t),e.length=0,Z.push(a[d])):e.push(a[d]);return(t=e.join(""))&&Z.push(t),e.length=0,Z},wo=function(e){return Sn(e,!0,!0)},Dt=function(e){return typeof e!="string"?e:(e=Sn(e,!1,!1),e.length?String(e[0]):"")},On=function(e){let t=!0;const s=l.Msg$$module$build$src$core$msg,a=e.match(/%{BKY_[A-Z]\w*}/gi);if(a)for(let d=0;d<a.length;d++){const f=a[d].toUpperCase();s[f.slice(6,-1)]===void 0&&(console.warn("No message string for "+a[d]+" in "+e),t=!1)}return t},Ws=function(e){const t=typeof e=="string"?Dt(e):e;var s=Number(t);if(!isNaN(s)&&0<=s&&360>=s)return{hue:s,hex:In(s,ko(),255*_s())};if(s=qi(t))return{hue:null,hex:s};throw s='Invalid colour: "'+t+'"',e!==t&&(s+=' (from "'+e+'")'),Error(s)},rn=function(){return Ks},Ll=function(e){if(Ks=e,e===null){let t;(t=document.querySelector("."+Nc))==null||t.remove()}},Nl=function(){const e=St()||document.body;document.querySelector("."+Nc)?Ks=document.querySelector("."+Nc):(Ks=document.createElement("div"),Ks.className=Nc),e.appendChild(Ks)},kn=function(e,t,s,a){if(to(),sl=e,Lc=s,s=Ks){if(s.style.direction=t?"rtl":"ltr",s.style.display="block",!a&&e instanceof Mt){let S;a=(S=e.getSourceBlock())==null?void 0:S.workspace}var d;Mh=(d=a)!=null?d:null;var f;e=(f=a)!=null?f:ze(),nl=e.getRenderer().getClassName(),ol=e.getTheme().getClassName(),nl&&$e(s,nl),ol&&$e(s,ol)}},to=function(){if(Rr()){sl=null;var e=Ks;e&&(e.style.display="none",e.style.left="",e.style.top="",Lc&&Lc(),Lc=null,e.textContent="",nl&&(ke(e,nl),nl=""),ol&&(ke(e,ol),ol=""),ze().markFocused())}},Rr=function(){return!!sl},Cn=function(e){sl===e&&to()},io=function(e){Mh!==null&&Mh!==e||to()},Ml=function(e,t,s){Ks.style.left=e+"px",Ks.style.top=t+"px",Ks.style.height=s+"px"},es=function(e,t,s,a){const d=ja(e,t,s);e=Ao(e,t,s,a),0>d?Ml(e,0,s.height+d):Ml(e,d,s.height)},Ao=function(e,t,s,a){return a?Math.min(Math.max(t.right-s.width,e.left),e.right-s.width):Math.max(Math.min(t.left,e.right-s.width),e.left)},ja=function(e,t,s){return t.bottom+s.height>=e.bottom?t.top-s.height:t.bottom},Lo=function(e){return!(e==null||!e.repositionForWindowResize)},xl=function(){Lo(sl)&&sl.repositionForWindowResize()||to()},Pl=function(){return Mc},Dl=function(e){Mc=e},zs=function(e,t,s,a){if(kn(gp,s,ps,a),t.length){var d=Ka(t,s,e);xc=d,Rn(d,e,s),setTimeout(function(){d.focus()},1),Mc=null}else No()},Ka=function(e,t,s){const a=new vh;a.setRole(js.MENU);for(let d=0;d<e.length;d++){const f=e[d],S=new yh(f.text);S.setRightToLeft(t),S.setRole(js.MENUITEM),a.addChild(S),S.setEnabled(f.enabled),f.enabled&&S.onAction(function(){No(),requestAnimationFrame(()=>{setTimeout(()=>{f.callback(f.scope,s)},0)})},{})}return a},Rn=function(e,t,s){const a=X();t=new Nt(t.clientY+a.top,t.clientY+a.top,t.clientX+a.left,t.clientX+a.left),Bl(e);const d=e.getSize();s&&(t.left+=d.width,t.right+=d.width,a.left+=d.width,a.right+=d.width),es(a,t,d,s),e.focus()},Bl=function(e){var t=rn();if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),$e(t,"blocklyContextMenu"),ee(t,"contextmenu",null,Fl),e.focus()},Fl=function(e){e.preventDefault(),e.stopPropagation()},No=function(){Cn(gp),Mc=null},ps=function(){xc&&(xc.dispose(),xc=null)},l.callbackFactory$$module$build$src$core$contextmenu=function(e,t){return()=>{l.disable$$module$build$src$core$events$utils();let s;try{s=t instanceof Element?ln(t,e.workspace):zt(t,e.workspace);const a=e.getRelativeToSurfaceXY();a.x=e.RTL?a.x-l.config$$module$build$src$core$config.snapRadius:a.x+l.config$$module$build$src$core$config.snapRadius,a.y+=2*l.config$$module$build$src$core$config.snapRadius,s.moveBy(a.x,a.y)}finally{l.enable$$module$build$src$core$events$utils()}return se()&&!s.isShadow()&&B(new(j(l.CREATE$$module$build$src$core$events$utils))(s)),l.setSelected$$module$build$src$core$common(s),s}},Ul=function(e,t=!1){const s=l.createElement$$module$build$src$core$utils$xml("xml");var a=wn(l.allUsedVarModels$$module$build$src$core$variables(e));a.hasChildNodes()&&s.appendChild(a);for(const d of e.getTopComments())s.appendChild(so(d,t));for(e=e.getTopBlocks(!0),a=0;a<e.length;a++)s.appendChild(Mo(e[a],t));return s},so=function(e,t=!1){const s=l.createElement$$module$build$src$core$utils$xml("comment");t||s.setAttribute("id",e.id),t=e.workspace;const a=e.getRelativeToSurfaceXY();return a.x=t.RTL?t.getWidth()-a.x:a.x,s.setAttribute("x",`${a.x}`),s.setAttribute("y",`${a.y}`),s.setAttribute("w",`${e.getSize().width}`),s.setAttribute("h",`${e.getSize().height}`),e.getText()&&(s.textContent=e.getText()),e.isCollapsed()&&s.setAttribute("collapsed","true"),e.isOwnEditable()||s.setAttribute("editable","false"),e.isOwnMovable()||s.setAttribute("movable","false"),e.isOwnDeletable()||s.setAttribute("deletable","false"),s},wn=function(e){const t=l.createElement$$module$build$src$core$utils$xml("variables");for(let s=0;s<e.length;s++){const a=e[s],d=l.createElement$$module$build$src$core$utils$xml("variable");d.appendChild(l.createTextNode$$module$build$src$core$utils$xml(a.name)),a.type&&d.setAttribute("type",a.type),d.id=a.getId(),t.appendChild(d)}return t},Mo=function(e,t){if(e.isInsertionMarker()&&(e=e.getChildren(!1)[0],!e))return new DocumentFragment;let s=0;if(e.workspace.RTL&&(s=e.workspace.getWidth()),t=Xs(e,t),Q(t)){const a=e.getRelativeToSurfaceXY();t.setAttribute("x",String(Math.round(e.workspace.RTL?s-a.x:a.x))),t.setAttribute("y",String(Math.round(a.y)))}return t},xo=function(e){if(e.isSerializable()){const t=l.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name",e.name||""),e.toXml(t)}return null},no=function(e,t){for(let s=0;s<e.inputList.length;s++){const a=e.inputList[s];for(let d=0;d<a.fieldRow.length;d++){const f=xo(a.fieldRow[d]);f&&t.appendChild(f)}}},Xs=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?Xs(t):new DocumentFragment;const s=l.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(s.setAttribute("type",e.type),t||(s.id=e.id),e.mutationToDom){var a=e.mutationToDom();a&&(a.hasChildNodes()||a.hasAttributes())&&s.appendChild(a)}if(no(e,s),a=e.getCommentText()){var d=e.getIcon(_i.COMMENT),f=d.getBubbleSize();d=d.bubbleIsVisible();var S=l.createElement$$module$build$src$core$utils$xml("comment");S.appendChild(l.createTextNode$$module$build$src$core$utils$xml(a)),S.setAttribute("pinned",`${d}`),S.setAttribute("h",String(f.height)),S.setAttribute("w",String(f.width)),s.appendChild(S)}for(e.data&&(a=l.createElement$$module$build$src$core$utils$xml("data"),a.appendChild(l.createTextNode$$module$build$src$core$utils$xml(e.data)),s.appendChild(a)),a=0;a<e.inputList.length;a++){f=e.inputList[a];var x=void 0;if(d=!0,f.type!==l.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&f.type!==l.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){S=f.connection.targetBlock(),f.type===l.inputTypes$$module$build$src$core$inputs$input_types.VALUE?x=l.createElement$$module$build$src$core$utils$xml("value"):f.type===l.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(x=l.createElement$$module$build$src$core$utils$xml("statement"));const we=f.connection.getShadowDom();!we||S&&S.isShadow()||x.appendChild(wr(we,t)),S&&(S=Xs(S,t),S.nodeType===Bn.ELEMENT_NODE&&(x.appendChild(S),d=!1)),x.setAttribute("name",f.name),d||s.appendChild(x)}}e.inputsInline!==void 0&&e.inputsInline!==e.inputsInlineDefault&&s.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&s.setAttribute("collapsed","true"),e.isEnabled()||s.setAttribute("disabled-reasons",Array.from(e.getDisabledReasons()).map(encodeURIComponent).join(",")),e.isOwnDeletable()||s.setAttribute("deletable","false"),e.isOwnMovable()||s.setAttribute("movable","false"),e.isOwnEditable()||s.setAttribute("editable","false"),x=e.getNextBlock();let Z;return x&&(a=Xs(x,t),a.nodeType===Bn.ELEMENT_NODE&&(Z=l.createElement$$module$build$src$core$utils$xml("next"),Z.appendChild(a),s.appendChild(Z))),e=e.nextConnection&&e.nextConnection.getShadowDom(),!e||x&&x.isShadow()||Z.appendChild(wr(e,t)),s},wr=function(e,t){let s=e=e.cloneNode(!0),a;for(;s;)if(t&&s.nodeName==="shadow"&&s.removeAttribute("id"),s.firstChild)s=s.firstChild;else{for(;s&&!s.nextSibling;){a=s,s=s.parentNode;let d;a.nodeType===Bn.TEXT_NODE&&a.data.trim()===""&&((d=s)==null?void 0:d.firstChild)!==a&&M(a)}s&&(a=s,s=s.nextSibling,a.nodeType===Bn.TEXT_NODE&&a.data.trim()===""&&M(a))}return e},Os=function(e){return fi(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Hl=function(e){e=Os(e).split("<");let t="";for(let s=1;s<e.length;s++){const a=e[s];a[0]==="/"&&(t=t.substring(2)),e[s]=t+"<"+a,a[0]!=="/"&&a.slice(-2)!=="/>"&&(t+="  ")}return e=e.join(`
`),e=e.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>"),e.replace(/^\n/,"")},Gl=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=l.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},l.domToWorkspace$$module$build$src$core$xml=function(e,t){let s=0;t.RTL&&(s=t.getWidth());const a=[];Je();const d=l.getGroup$$module$build$src$core$events$utils();d||l.setGroup$$module$build$src$core$events$utils(!0),t.setResizesEnabled&&t.setResizesEnabled(!1);let f=!0;try{for(let S=0,x;x=e.childNodes[S];S++){const Z=x.nodeName.toLowerCase(),we=x;if(Z==="block"||Z==="shadow"&&!V()){const Bt=ln(we,t);a.push(Bt.id);let Pt;const ns=parseInt((Pt=we.getAttribute("x"))!=null?Pt:"10",10);let gl;const Na=parseInt((gl=we.getAttribute("y"))!=null?gl:"10",10);isNaN(ns)||isNaN(Na)||Bt.moveBy(t.RTL?s-ns:ns,Na,["create"]),f=!1}else{if(Z==="shadow")throw TypeError("Shadow block cannot be a top-level block.");if(Z==="comment")Ar(we,t);else if(Z==="variables"){if(f)Wl(we,t);else throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");f=!1}}}}finally{l.setGroup$$module$build$src$core$events$utils(d),t.setResizesEnabled&&t.setResizesEnabled(!0),t.rendered&&$i(),ut()}return B(new(j(Uo))(t)),a},Ar=function(e,t){var s;const a=(s=e.getAttribute("id"))!=null?s:void 0;s=t.rendered?new Pc(t,a):new Ic(t,a);var d;s.setText((d=e.textContent)!=null?d:"");var f;d=parseInt((f=e.getAttribute("x"))!=null?f:"",10);let S;f=parseInt((S=e.getAttribute("y"))!=null?S:"",10),isNaN(d)||isNaN(f)||(d=t.RTL?t.getWidth()-d:d,s.moveTo(new Te(d,f)));var x;t=parseInt((x=e.getAttribute("w"))!=null?x:"",10);let Z;return x=parseInt((Z=e.getAttribute("h"))!=null?Z:"",10),isNaN(t)||isNaN(x)||s.setSize(new bt(t,x)),e.getAttribute("collapsed")==="true"&&s.setCollapsed(!0),e.getAttribute("editable")==="false"&&s.setEditable(!1),e.getAttribute("movable")==="false"&&s.setMovable(!1),e.getAttribute("deletable")==="false"&&s.setDeletable(!1),s},Vl=function(e,t){if(!t.getBlocksBoundingBox)return l.domToWorkspace$$module$build$src$core$xml(e,t);var s=t.getBlocksBoundingBox();if(e=l.domToWorkspace$$module$build$src$core$xml(e,t),s&&s.top!==s.bottom){var a=s.bottom;s=t.RTL?s.right:s.left;var d=1/0;let f=-1/0,S=1/0;for(let x=0;x<e.length;x++){const Z=t.getBlockById(e[x]).getRelativeToSurfaceXY();Z.y<S&&(S=Z.y),Z.x<d&&(d=Z.x),Z.x>f&&(f=Z.x)}for(a=a-S+10,s=t.RTL?s-f:s-d,d=0;d<e.length;d++)t.getBlockById(e[d]).moveBy(s,a,["create"])}return e},l.domToBlock$$module$build$src$core$xml=function(e,t){return e=ln(e,t),t.rendered&&$i(),e},ln=function(e,t){l.disable$$module$build$src$core$events$utils();var s=t.getAllVariables();let a;try{if(a=O(e,t),t.rendered){const d=a,f=a.getDescendants(!1);d.setConnectionTracking(!1);for(let S=f.length-1;0<=S;S--)f[S].initSvg();for(let S=f.length-1;0<=S;S--)f[S].queueRender();setTimeout(function(){d.disposed||d.setConnectionTracking(!0)},1),t.resizeContents()}else{const d=a.getDescendants(!1);for(let f=d.length-1;0<=f;f--)d[f].initModel()}}finally{l.enable$$module$build$src$core$events$utils()}if(se()){for(e=Ki(t,s),t=0;t<e.length;t++)s=e[t],B(new(j(Ln))(s));B(new(j(l.CREATE$$module$build$src$core$events$utils))(a))}return a},Wl=function(e,t){for(let a=0;a<e.children.length;a++){var s=e.children[a];const d=s.getAttribute("type"),f=s.getAttribute("id");if(s=s.textContent,!s)break;t.createVariable(s,d,f)}},zl=function(e){const t={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let s=0;s<e.children.length;s++){const a=e.children[s];if(a.nodeType!==Bn.TEXT_NODE)switch(a.nodeName.toLowerCase()){case"mutation":t.mutation.push(a);break;case"comment":t.comment.push(a);break;case"data":t.data.push(a);break;case"title":case"field":t.field.push(a);break;case"value":case"statement":t.input.push(a);break;case"next":t.next.push(a);break;default:console.warn("Ignoring unknown tag: "+a.nodeName)}}return t},Xl=function(e,t){let s=!1;for(let a=0;a<e.length;a++){const d=e[a];t.domToMutation&&(t.domToMutation(d),t.initSvg&&(s=!0))}return s},Ja=function(e,t){for(let a=0;a<e.length;a++){var s=e[a];const d=s.textContent,f=s.getAttribute("pinned")==="true";let S;const x=parseInt((S=s.getAttribute("w"))!=null?S:"50",10);let Z;s=parseInt((Z=s.getAttribute("h"))!=null?Z:"50",10),t.setCommentText(d);const we=t.getIcon(_i.COMMENT);isNaN(x)||isNaN(s)||we.setBubbleSize(new bt(x,s)),we.setBubbleVisible(f),setTimeout(()=>we.setBubbleVisible(f),1)}},o=function(e,t){for(let s=0;s<e.length;s++)t.data=e[s].textContent},u=function(e,t){for(let s=0;s<e.length;s++){const a=e[s],d=a.getAttribute("name");d?U(t,d,a):console.warn(`Ignoring unnamed field in block ${t.type}`)}},_=function(e){let t=null,s=null;for(let a=0;a<e.childNodes.length;a++){const d=e.childNodes[a];Q(d)&&(d.nodeName.toLowerCase()==="block"?t=d:d.nodeName.toLowerCase()==="shadow"&&(s=d))}return{childBlockElement:t,childShadowElement:s}},m=function(e,t,s,a){for(let f=0;f<e.length;f++){var d=e[f];const S=d.getAttribute("name"),x=S?s.getInput(S):null;if(!x){console.warn("Ignoring non-existent input "+S+" in block "+a);break}if(d=_(d),d.childBlockElement){if(!x.connection)throw TypeError("Input connection does not exist.");O(d.childBlockElement,t,x.connection,!1)}if(d.childShadowElement){let Z;(Z=x.connection)==null||Z.setShadowDom(d.childShadowElement)}}},y=function(e,t,s){for(let a=0;a<e.length;a++){const d=_(e[a]);if(d.childBlockElement){if(!s.nextConnection)throw TypeError("Next statement does not exist.");if(s.nextConnection.isConnected())throw TypeError("Next statement is already connected.");O(d.childBlockElement,t,s.nextConnection,!0)}d.childShadowElement&&s.nextConnection&&s.nextConnection.setShadowDom(d.childShadowElement)}},O=function(e,t,s,a){var d;const f=e.getAttribute("type");if(!f)throw TypeError("Block type unspecified: "+e.outerHTML);var S=(d=e.getAttribute("id"))!=null?d:void 0;d=t.newBlock(f,S),S=zl(e);const x=Xl(S.mutation,d);if(Ja(S.comment,d),o(S.data,d),s)if(a)if(d.previousConnection)s.connect(d.previousConnection);else throw TypeError("Next block does not have previous statement.");else if(d.outputConnection)s.connect(d.outputConnection);else if(d.previousConnection)s.connect(d.previousConnection);else throw TypeError("Child block does not have output or previous statement.");if(u(S.field,d),m(S.input,t,d,f),y(S.next,t,d),x&&d.initSvg(),(t=e.getAttribute("inline"))&&d.setInputsInline(t==="true"),(t=e.getAttribute("disabled"))&&d.setDisabledReason(t==="true"||t==="disabled",Rs),t=e.getAttribute("disabled-reasons"),t!==null)for(var Z of t.split(","))d.setDisabledReason(!0,decodeURIComponent(Z));if((Z=e.getAttribute("deletable"))&&d.setDeletable(Z==="true"),(Z=e.getAttribute("movable"))&&d.setMovable(Z==="true"),(Z=e.getAttribute("editable"))&&d.setEditable(Z==="true"),(Z=e.getAttribute("collapsed"))&&d.setCollapsed(Z==="true"),e.nodeName.toLowerCase()==="shadow"){for(e=d.getChildren(!1),Z=0;Z<e.length;Z++)if(!e[Z].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");d.setShadow(!0)}return d},U=function(e,t,s){const a=e.getField(t);a?a.fromXml(s):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},K=function(e){for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];if(s.nodeName.toLowerCase()==="next"){e.removeChild(s);break}}},Q=function(e){return e.nodeType===Bn.ELEMENT_NODE},fe=function(e){if(!(100<e.getDescendants(!1).length)){var t=e.workspace,s=e.getSvgRoot();t.getAudioManager().play("delete");var a=e.getRelativeToSurfaceXY(),d=s.cloneNode(!0);d.setAttribute("transform","translate("+a.x+","+a.y+")");var f;(f=t.getLayerManager())==null||f.appendToAnimationLayer({getSvgRoot:()=>d}),Ae(d,{x:a.x,y:a.y,width:e.width,height:e.height},t.RTL,new Date)}},Ae=function(e,t,s,a){const d=(new Date().getTime()-a.getTime())/150;1<d?M(e):(e.setAttribute("transform","translate("+(t.x+(s?-1:1)*t.width/2*d)+","+(t.y+t.height/2*d)+") scale("+(1-d)+")"),setTimeout(Ae,10,e,t,s,a))},tt=function(e){var t=e.workspace;const s=t.scale;if(t.getAudioManager().play("click"),!(1>s)){var a=t.getSvgXY(e.getSvgRoot());e.outputConnection?(a.x+=(e.RTL?3:-3)*s,a.y+=13*s):e.previousConnection&&(a.x+=(e.RTL?-23:23)*s,a.y+=3*s);var d=J(Y.CIRCLE,{cx:a.x,cy:a.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());e=J(Y.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*s},d),t=J(Y.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},d),e.beginElement(),t.beginElement(),setTimeout(()=>void M(d),150)}},at=function(e){if(Gt(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),Ta=e,Ti(e,t,new Date)}},Ti=function(e,t,s){const a=(new Date().getTime()-s.getTime())/200;let d="";1>=a&&(d=`skewX(${Math.round(Math.sin(a*Math.PI*3)*(1-a)*t)})`,Dc=setTimeout(Ti,10,e,t,s)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${d}`)},Gt=function(){Ta&&(Dc&&(clearTimeout(Dc),Dc=null),Ta.getSvgRoot().setAttribute("transform",Ta.getTranslation()),Ta=null)},di=function(e){return e.getRelativeToSurfaceXY!==void 0&&e.isMovable!==void 0&&e.startDrag!==void 0&&e.drag!==void 0&&e.endDrag!==void 0&&e.revertDrag!==void 0},Xt=function(e,t){for(const s in t)e[s]=t[s]!==null&&typeof t[s]=="object"?Xt(e[s]||Object.create(null),t[s]):t[s];return e},Vi=function(e){return e.getProcedureModel!==void 0&&e.doProcedureUpdate!==void 0&&e.isProcedureDef!==void 0},Lr=function(e){return e.startPublishing!==void 0&&e.stopPublishing!==void 0},ks=function(e,t){h(pe.FIELD,e,t)},Za=function(e){g(pe.FIELD,e)},l.fromJson$$module$build$src$core$field_registry=function(e){return Ep.fromJsonInternal(e)},Yl=function(e){const t=R(pe.FIELD,e.type);return t?t.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},qa=function(e){let t=!1;const s=e.map(([S,x])=>typeof S=="string"?[Dt(S),x]:(t=!0,[S.alt!==null?Object.assign({},S,{alt:Dt(S.alt)}):Object.assign({},S),x]));if(t||2>e.length)return{options:s};var a=s.map(([S])=>S),d=hs(a);e=Rl(a,d);const f=vn(a,d);return!e&&!f||d<=e+f?{options:s}:(d=e?a[0].substring(0,e-1):void 0,a=f?a[0].substr(1-f):void 0,{options:jl(s,e,f),prefix:d,suffix:a})},jl=function(e,t,s){return e.map(([a,d])=>[a.substring(t,a.length-s),d])},Yt=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let s=0;s<e.length;s++){const a=e[s];Array.isArray(a)?typeof a[1]!="string"?(t=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option id must be a string. Found "+a[1]+" in: ",a)):a[0]&&typeof a[0]!="string"&&typeof a[0].src!="string"&&(t=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option must have a string label or image description. Found"+a[0]+" in: ",a)):(t=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option must be an array. Found: ",a))}if(t)throw TypeError("Found invalid FieldDropdown options.")},l.register$$module$build$src$core$extensions=function(e,t){if(typeof e!="string"||e.trim()==="")throw Error('Error: Invalid extension name "'+e+'"');if(ll[e])throw Error('Error: Extension "'+e+'" is already registered.');if(typeof t!="function")throw Error('Error: Extension "'+e+'" must be a function');ll[e]=t},l.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||typeof t!="object")throw Error('Error: Mixin "'+e+'" must be a object');l.register$$module$build$src$core$extensions(e,function(){this.mixin(t)})},l.registerMutator$$module$build$src$core$extensions=function(e,t,s,a){const d='Error when registering mutator "'+e+'": ';lu(d,t);const f=Zl(t,d);if(s&&typeof s!="function")throw Error(d+'Extension "'+e+'" is not a function');l.register$$module$build$src$core$extensions(e,function(){f&&this.setMutator(new l.MutatorIcon$$module$build$src$core$icons$mutator_icon(a||[],this)),this.mixin(t),s&&s.apply(this)})},Po=function(e){Kl(e)?delete ll[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},Kl=function(e){return!!ll[e]},Nr=function(e,t,s){const a=ll[e];if(typeof a!="function")throw Error('Error: Extension "'+e+'" not found.');let d;if(s?Qa(e,t):d=tc(t),a.apply(t),s)lu('Error after applying mutator "'+e+'": ',t);else if(!Ld(d,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},Qa=function(e,t){if(tc(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},Mr=function(e,t){return ec(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},Jl=function(e,t){return ec(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},Zl=function(e,t){return ec(e.compose,e.decompose,t+" compose/decompose")},ec=function(e,t,s){if(e&&t){if(typeof e!="function"||typeof t!="function")throw Error(s+" must be a function");return!0}if(!e&&!t)return!1;throw Error(s+"Must have both or neither functions")},lu=function(e,t){const s=Mr(t,e),a=Jl(t,e);if(!s&&!a)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");Zl(t,e)},tc=function(e){const t=[];return e.domToMutation!==void 0&&t.push(e.domToMutation),e.mutationToDom!==void 0&&t.push(e.mutationToDom),e.saveExtraState!==void 0&&t.push(e.saveExtraState),e.loadExtraState!==void 0&&t.push(e.loadExtraState),e.compose!==void 0&&t.push(e.compose),e.decompose!==void 0&&t.push(e.decompose),t},Ld=function(e,t){if(t=tc(t),t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(e[s]!==t[s])return!1;return!0},Nd=function(e){if(typeof document!="object")throw Error("runAfterPageLoad() requires browser document.");if(document.readyState==="complete")e();else{const t=setInterval(function(){document.readyState==="complete"&&(clearInterval(t),e())},10)}},l.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,t){const s=[];return function(){s.includes(this.type)||(Md(this,e,t),s.push(this.type)),this.setTooltip((function(){const a=String(this.getFieldValue(e));return Dt(t[a])}).bind(this))}},Md=function(e,t,s){var a=e.getField(t);if(a instanceof _n&&!a.isOptionListDynamic()){a=a.getOptions();for(const[,d]of a)s[d]===void 0&&console.warn(`No tooltip mapping for value ${d} of field ${t} of block type ${e.type}.`)}},l.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,t){return function(){this.setTooltip((function(){const s=this.getField(t);return Dt(e).replace("%1",s?s.getText():"")}).bind(this))}},xd=function(){const e=this.tooltip;this.setTooltip((function(){const t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||e}).bind(this))},oo=function(e,t,s,a){e=e+" was deprecated in "+t+" and will be deleted in "+s+".",a&&(e+=`
Use `+a+" instead."),vp.has(e)||(vp.add(e),console.warn(e))},He=function(e,t){return" "+e+","+t+" "},ts=function(e,t){return" "+e+t.join("")},Ei=function(e,t){return" M "+e+","+t+" "},Ut=function(e,t){return" m "+e+","+t+" "},an=function(e,t){return" l "+e+","+t+" "},xr=function(e){return" l"+e.join("")},Ne=function(e,t){return" "+e+" "+t+" "},ni=function(e,t,s,a){return e+" "+s+" "+s+" "+t+a},au=function(e,t){h(pe.ICON,e.toString(),t)},Pd=function(e){g(pe.ICON,e)},ic=function(e){const t=e.getProcedureMap().getProcedures().filter(a=>!a.getReturnTypes()).map(a=>[a.getName(),a.getParameters().map(d=>d.getName()),!1]);e.getBlocksByType("procedures_defnoreturn",!1).forEach(a=>{!Vi(a)&&ci(a)&&t.push(a.getProcedureDef())});const s=e.getProcedureMap().getProcedures().filter(a=>!!a.getReturnTypes()).map(a=>[a.getName(),a.getParameters().map(d=>d.getName()),!0]);return e.getBlocksByType("procedures_defreturn",!1).forEach(a=>{!Vi(a)&&ci(a)&&s.push(a.getProcedureDef())}),t.sort(cu),s.sort(cu),[t,s]},cu=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},l.findLegalName$$module$build$src$core$procedures=function(e,t){if(t.isInFlyout)return e;for(e=e||l.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!Dd(e,t.workspace,t);){const s=e.match(/^(.*?)(\d+)$/);e=s?s[1]+(parseInt(s[2])+1):e+"2"}return e},Dd=function(e,t,s){return!uu(e,t,s)},uu=function(e,t,s){for(const a of t.getAllBlocks(!1))if(a!==s&&ci(a)&&l.Names$$module$build$src$core$names.equals(a.getProcedureDef()[0],e))return!0;s=s&&Vi(s)?s==null?void 0:s.getProcedureModel():void 0;for(const a of t.getProcedureMap().getProcedures())if(a!==s&&l.Names$$module$build$src$core$names.equals(a.getName(),e))return!0;return!1},l.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new ri;e=e.trim();const s=l.findLegalName$$module$build$src$core$procedures(e,t);Vi(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(s);const a=this.getValue();if(a!==e&&a!==s)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){const d=e[t];d.renameProcedure&&d.renameProcedure(a,s)}return s},sc=function(e){function t(f,S){for(let Z=0;Z<f.length;Z++){var x=f[Z][0];const we=f[Z][1],Bt=l.createElement$$module$build$src$core$utils$xml("block");Bt.setAttribute("type",S),Bt.setAttribute("gap","16");const Pt=l.createElement$$module$build$src$core$utils$xml("mutation");for(Pt.setAttribute("name",x),Bt.appendChild(Pt),x=0;x<we.length;x++){const ns=l.createElement$$module$build$src$core$utils$xml("arg");ns.setAttribute("name",we[x]),Pt.appendChild(ns)}s.push(Bt)}}const s=[];if(ss.procedures_defnoreturn){var a=l.createElement$$module$build$src$core$utils$xml("block");a.setAttribute("type","procedures_defnoreturn"),a.setAttribute("gap","16");var d=l.createElement$$module$build$src$core$utils$xml("field");d.setAttribute("name","NAME"),d.appendChild(l.createTextNode$$module$build$src$core$utils$xml(l.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),a.appendChild(d),s.push(a)}return ss.procedures_defreturn&&(a=l.createElement$$module$build$src$core$utils$xml("block"),a.setAttribute("type","procedures_defreturn"),a.setAttribute("gap","16"),d=l.createElement$$module$build$src$core$utils$xml("field"),d.setAttribute("name","NAME"),d.appendChild(l.createTextNode$$module$build$src$core$utils$xml(l.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),a.appendChild(d),s.push(a)),ss.procedures_ifreturn&&(a=l.createElement$$module$build$src$core$utils$xml("block"),a.setAttribute("type","procedures_ifreturn"),a.setAttribute("gap","16"),s.push(a)),s.length&&s[s.length-1].setAttribute("gap","24"),e=ic(e),t(e[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),s},hu=function(e){var t=[],s=e.getBlocksByType("procedures_mutatorarg",!1);for(let f=0,S;S=s[f];f++)t.push(S.getFieldValue("NAME"));s=l.createElement$$module$build$src$core$utils$xml("xml");const a=l.createElement$$module$build$src$core$utils$xml("block");a.setAttribute("type","procedures_mutatorarg");const d=l.createElement$$module$build$src$core$utils$xml("field");d.setAttribute("name","NAME"),t=bs(l.DEFAULT_ARG$$module$build$src$core$procedures,t),t=l.createTextNode$$module$build$src$core$utils$xml(t),d.appendChild(t),a.appendChild(d),s.appendChild(a),e.updateToolbox(s)},du=function(e){if(e.type===un&&e.bubbleType==="mutator"&&e.isOpen&&e.blockId){e=ge(e.workspaceId).getBlockById(e.blockId);var t=e.type;(t==="procedures_defnoreturn"||t==="procedures_defreturn")&&(e=e.getIcon(l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),hu(e),e.addChangeListener(Bd))}},Bd=function(e){(e.type===l.CREATE$$module$build$src$core$events$utils||e.type===l.DELETE$$module$build$src$core$events$utils||e.type===l.CHANGE$$module$build$src$core$events$utils||e.type===Do)&&(e=ge(e.workspaceId),hu(e))},_u=function(e,t){return t.getAllBlocks(!1).filter(s=>Fd(s,e)||En(s)&&l.Names$$module$build$src$core$names.equals(s.getProcedureCall(),e))},Fd=function(e,t){return Vi(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&l.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},l.mutateCallers$$module$build$src$core$procedures=function(e){const t=V();var s=e.getProcedureDef()[0];const a=e.mutationToDom(!0);e=_u(s,e.workspace);for(let f=0,S;S=e[f];f++){s=(s=S.mutationToDom())&&fi(s),S.domToMutation&&S.domToMutation(a);var d=S.mutationToDom();d=d&&fi(d),s!==d&&(l.setRecordUndo$$module$build$src$core$events$utils(!1),B(new(j(l.CHANGE$$module$build$src$core$events$utils))(S,"mutation",null,s,d)),l.setRecordUndo$$module$build$src$core$events$utils(t))}},l.getDefinition$$module$build$src$core$procedures=function(e,t){for(const s of t.getAllBlocks(!1))if(Vi(s)&&s.isProcedureDef()&&l.Names$$module$build$src$core$names.equals(s.getProcedureModel().getName(),e)||ci(s)&&l.Names$$module$build$src$core$names.equals(s.getProcedureDef()[0],e))return s;return null},nc=function(e){return e.isDynamic},Ud=function(e){return e.pathDown!==void 0&&e.pathUp!==void 0},Hd=function(e){return e.pathLeft!==void 0&&e.pathRight!==void 0},Gd=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t,t.targetConnection=e},Vd=function(e,t){let s=null;t=t.outputConnection;const a=t==null?void 0:t.getConnectionChecker();for(let d=0,f;f=e.inputList[d];d++){const S=f.connection;let x;if(S&&((x=a)!=null&&x.canConnect(t,S,!1))){if(s)return null;s=S}}return s},Wd=function(e,t){let s;for(;s=Vd(e,t);)if(e=s.targetBlock(),!e||e.isShadow())return s;return null},pu=function(e){return e.getType!==void 0&&e.initView!==void 0&&e.dispose!==void 0&&e.getWeight!==void 0&&e.getSize!==void 0&&e.applyColour!==void 0&&e.hideForInsertionMarker!==void 0&&e.updateEditable!==void 0&&e.updateCollapsed!==void 0&&e.isShownWhenCollapsed!==void 0&&e.setOffsetInBlock!==void 0&&e.onLocationChange!==void 0&&e.onClick!==void 0},zd=function(e){return pu(e)&&bn(e)&&bo(e)&&e.setText!==void 0&&e.getText!==void 0&&e.setBubbleSize!==void 0&&e.getBubbleSize!==void 0&&e.getType()===_i.COMMENT},ql=function(e){let t=e.outputConnection;return(!t||e.previousConnection&&e.previousConnection.isConnected())&&(t=e.previousConnection),t},Ql=function(e,t){h(pe.RENDERER,e,t)},Xd=function(e){g(pe.RENDERER,e)},fu=function(e,t,s){return e=new(I(pe.RENDERER,e))(e),e.init(t,s),e},gu=function(e){Ni(e.getTargetWorkspace(),void 0,"String")},mu=function(e){Ni(e.getTargetWorkspace(),void 0,"Number")},$u=function(e){Ni(e.getTargetWorkspace(),void 0,"Colour")},oc=function(e){let t=[],s=document.createElement("button");return s.setAttribute("text",l.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(s),s=document.createElement("button"),s.setAttribute("text",l.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(s),s=document.createElement("button"),s.setAttribute("text",l.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(s),e.registerButtonCallback("CREATE_VARIABLE_STRING",gu),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",mu),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",$u),e=Tu(e),t=t.concat(e)},Tu=function(e){e=e.getAllVariables();const t=[];if(0<e.length){if(ss.variables_set_dynamic){var s=e[e.length-1];const a=l.createElement$$module$build$src$core$utils$xml("block");a.setAttribute("type","variables_set_dynamic"),a.setAttribute("gap","24"),a.appendChild(Ze(s)),t.push(a)}if(ss.variables_get_dynamic){e.sort(ha.compareByName);for(let a=0,d;d=e[a];a++)s=l.createElement$$module$build$src$core$utils$xml("block"),s.setAttribute("type","variables_get_dynamic"),s.setAttribute("gap","8"),s.appendChild(Ze(d)),t.push(s)}}return t},Yd=function(e,t){const s=e.workspace,a=l.config$$module$build$src$core$config.snapRadius,d=Te.difference(t,e.getRelativeToSurfaceXY()),f=new Te(0,0),S=s.getAllBlocks(!1).filter(x=>x.id!=e.id).map(x=>x.getRelativeToSurfaceXY());for(;jd(Te.sum(t,f),S)||Kd(e,Te.sum(d,f),a);)s.RTL?f.translate(-a,2*a):f.translate(a,2*a);e.moveTo(Te.sum(t,f))},jd=function(e,t){return t.some(s=>1>=Math.abs(s.x-e.x)&&1>=Math.abs(s.y-e.y))},Kd=function(e,t,s){return e.getConnections_(!1).some(a=>!!a.closest(s,t).connection)},Pr=function(e,t,s){const a=s.getBoundingRectangle(),d=a.right-a.left,f=Jn(t.top,a.top,t.top+t.height-(a.bottom-a.top))-a.top;let S=t.left;return t=t.left+t.width-d,e.RTL?S=Math.min(t,S):t=Math.max(S,t),(e=Jn(S,a.left,t)-a.left)||f?(s.moveBy(e,f,["inbounds"]),!0):!1},Eu=function(e){return t=>{var s=e.getMetricsManager();if(s.hasFixedEdges()&&!e.isDragging()){var a;if(dc.includes((a=t.type)!=null?a:"")){a=s.getScrollMetrics(!0);const d=Jd(e,t);d&&(s=l.getGroup$$module$build$src$core$events$utils()||!1,l.setGroup$$module$build$src$core$events$utils(t.group),Pr(e,a,d)&&!t.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),l.setGroup$$module$build$src$core$events$utils(s))}else t.type===ao&&t.scale&&t.oldScale&&t.scale>t.oldScale&&rc(e)}}},Jd=function(e,t){let s=null;switch(t.type){case l.CREATE$$module$build$src$core$events$utils:case l.MOVE$$module$build$src$core$events$utils:(s=e.getBlockById(t.blockId))&&(s=s.getRootBlock());break;case Mn:case xn:s=e.getCommentById(t.commentId)}return s},rc=function(e){var t=e.getMetricsManager();if(t.hasFixedEdges()&&!e.isDragging()){t=t.getScrollMetrics(!0);var s=e.getTopBoundedElements();for(let a=0,d;d=s[a];a++)Pr(e,t,d)}},Cs=function(e){return e.isDeletable!==void 0&&e.dispose!==void 0&&e.setDeleteStyle!==void 0},Zd=function(e){const t=e.toCopyData();ad=t;let s;return cd=(s=e.workspace)!=null?s:null,t},ro=function(e,t,s){return e&&t?bu(e,t,s):ad&&cd?bu(ad,cd):null},bu=function(e,t,s){let a;t=(a=t.getRootWorkspace())!=null?a:t;let d,f;return(f=(d=R(pe.PASTER,e.paster,!1))==null?void 0:d.paste(e,t,s))!=null?f:null},qd=function(e){const t=e.toCopyData();return t?ro(t,e.workspace):null},ea=function(e){return e.toCopyData!==void 0},vu=function(){kt.registry.register({name:gn.ESCAPE,preconditionFn(e){return!e.options.readOnly},callback(e){return e.hideChaff(),!0},keyCodes:[ht.ESC]})},yu=function(){kt.registry.register({name:gn.DELETE,preconditionFn(e){const t=Ce();return!e.options.readOnly&&t!=null&&Cs(t)&&t.isDeletable()&&!Un.inProgress()},callback(e,t){return t.preventDefault(),e=Ce(),e instanceof Ps?e.checkAndDelete():Cs(e)&&e.isDeletable()&&(l.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),l.setGroup$$module$build$src$core$events$utils(!1)),!0},keyCodes:[ht.DELETE,ht.BACKSPACE]})},Iu=function(){const e=kt.registry.createSerializedKey(ht.C,[ht.CTRL]),t=kt.registry.createSerializedKey(ht.C,[ht.ALT]),s=kt.registry.createSerializedKey(ht.C,[ht.META]);kt.registry.register({name:gn.COPY,preconditionFn(a){const d=Ce();return!a.options.readOnly&&!Un.inProgress()&&d!=null&&Cs(d)&&d.isDeletable()&&di(d)&&d.isMovable()&&ea(d)},callback(a,d){return d.preventDefault(),a.hideChaff(),d=Ce(),!d||!ea(d)?!1:(go=d.toCopyData(),mo=a,_l=di(d)?d.getRelativeToSurfaceXY():null,!!go)},keyCodes:[e,t,s]})},Su=function(){const e=kt.registry.createSerializedKey(ht.X,[ht.CTRL]),t=kt.registry.createSerializedKey(ht.X,[ht.ALT]),s=kt.registry.createSerializedKey(ht.X,[ht.META]);kt.registry.register({name:gn.CUT,preconditionFn(a){const d=Ce();return!a.options.readOnly&&!Un.inProgress()&&d!=null&&Cs(d)&&d.isDeletable()&&di(d)&&d.isMovable()&&!d.workspace.isFlyout},callback(a){const d=Ce();return d instanceof Ps?(go=d.toCopyData(),mo=a,_l=d.getRelativeToSurfaceXY(),d.checkAndDelete(),!0):Cs(d)&&d.isDeletable()&&ea(d)?(go=d.toCopyData(),mo=a,_l=di(d)?d.getRelativeToSurfaceXY():null,d.dispose(),!0):!1},keyCodes:[e,t,s]})},Ou=function(){const e=kt.registry.createSerializedKey(ht.V,[ht.CTRL]),t=kt.registry.createSerializedKey(ht.V,[ht.ALT]),s=kt.registry.createSerializedKey(ht.V,[ht.META]);kt.registry.register({name:gn.PASTE,preconditionFn(a){return!a.options.readOnly&&!Un.inProgress()},callback(){if(!go||!mo)return!1;if(!_l)return!!ro(go,mo);const{left:a,top:d,width:f,height:S}=mo.getMetricsManager().getViewMetrics(!0);if(new Nt(d,d+S,a,a+f).contains(_l.x,_l.y))return!!ro(go,mo);const x=new Te(a+f/2,d+S/2);return!!ro(go,mo,x)},keyCodes:[e,t,s]})},ku=function(){const e=kt.registry.createSerializedKey(ht.Z,[ht.CTRL]),t=kt.registry.createSerializedKey(ht.Z,[ht.ALT]),s=kt.registry.createSerializedKey(ht.Z,[ht.META]);kt.registry.register({name:gn.UNDO,preconditionFn(a){return!a.options.readOnly&&!Un.inProgress()},callback(a,d){return a.hideChaff(),a.undo(!1),d.preventDefault(),!0},keyCodes:[e,t,s]})},Cu=function(){const e=kt.registry.createSerializedKey(ht.Z,[ht.SHIFT,ht.CTRL]),t=kt.registry.createSerializedKey(ht.Z,[ht.SHIFT,ht.ALT]),s=kt.registry.createSerializedKey(ht.Z,[ht.SHIFT,ht.META]),a=kt.registry.createSerializedKey(ht.Y,[ht.CTRL]);kt.registry.register({name:gn.REDO,preconditionFn(d){return!Un.inProgress()&&!d.options.readOnly},callback(d,f){return d.hideChaff(),d.undo(!0),f.preventDefault(),!0},keyCodes:[e,t,s,a]})},Ru=function(){vu(),yu(),Iu(),Su(),Ou(),ku(),Cu()},wu=function(e){const t=e.saveState();return e.getParameters().length&&(t.parameters=e.getParameters().map(s=>s.saveState())),t},Au=function(e,t,s,a){if(e=e.loadState(s,a),!s.parameters)return e;for(const[d,f]of s.parameters.entries())e.insertParameter(t.loadState(f,a),d);return e},Qd=function(e){const t=Object.create(null),s=w(pe.SERIALIZER,!0);for(const a in s){let d;const f=(d=s[a])==null?void 0:d.save(e);f&&(t[a]=f)}return t},e_=function(e,t,{recordUndo:s=!1}={}){var a=w(pe.SERIALIZER,!0);if(a){a=Object.entries(a).sort((f,S)=>S[1].priority-f[1].priority);var d=V();l.setRecordUndo$$module$build$src$core$events$utils(s),(s=l.getGroup$$module$build$src$core$events$utils())||l.setGroup$$module$build$src$core$events$utils(!0),Je(),t instanceof xs&&t.setResizesEnabled(!1);for(const[,f]of a.reverse()){let S;(S=f)==null||S.clear(t)}for(const[f,S]of a.reverse())if(e[f]){let x;(x=S)==null||x.load(e[f],t)}t instanceof xs&&t.setResizesEnabled(!0),ut(),B(new(j(Uo))(t)),l.setGroup$$module$build$src$core$events$utils(s),l.setRecordUndo$$module$build$src$core$events$utils(d)}},t_=function(e,t){let s=null;s=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;var a;if(!document.contains(s)&&document!==((a=s)==null?void 0:a.ownerDocument))throw Error("Error: container is not in current document");e=new Ls(t||{}),a=document.createElement("div"),$e(a,"injectionDiv"),t!=null&&t.rtl&&$e(a,"blocklyRTL"),a.tabIndex=0,si(a,vi.LABEL,l.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),s.appendChild(a),t=i_(a,e);const d=s_(a,t,e);return n_(d),mt(d),nt(d),a.addEventListener("focusin",function(){mt(d)}),d},i_=function(e,t){e.setAttribute("dir","LTR"),Et(t.hasCss,t.pathToMedia),e=J(Y.SVG,{xmlns:ra,"xmlns:html":dn,"xmlns:xlink":fs,version:"1.1",class:"blocklySvg",tabindex:"0"},e);const s=J(Y.DEFS,{},e),a=String(Math.random()).substring(2);return t.gridPattern=Bh.createDom(a,t.gridOptions,s),e},s_=function(e,t,s){s.parentWorkspace=null,s=new xs(s);const a=s.options;s.scale=a.zoomOptions.startScale,t.appendChild(s.createDom("blocklyMainBackground",e));var d=s.getRenderer().getClassName();return d&&$e(e,d),(d=s.getTheme().getClassName())&&$e(e,d),!a.hasCategories&&a.languageTree&&(e=s.addFlyout(Y.SVG),st(e,t)),a.hasTrashcan&&s.addTrashcan(),a.zoomOptions&&a.zoomOptions.controls&&s.addZoomControls(),s.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),s.translate(0,0),s.addChangeListener(Eu(s)),nt(s),Nl(),gr(),Hi(),s},n_=function(e){const t=e.options;var s=e.getParentSvg();if(ee(s.parentNode,"contextmenu",null,function(a){Oe(a)||a.preventDefault()}),s=ee(window,"resize",null,function(){Gi(),e.hideComponents(!0),Qn(),xl(),nt(e),rc(e)}),e.setResizeHandlerWrapper(s),r_(),t.languageTree){s=e.getToolbox();const a=e.getFlyout(!0);s?s.init():a&&(a.init(e),a.show(t.languageTree),typeof a.scrollToStart=="function"&&a.scrollToStart())}t.hasTrashcan&&e.trashcan.init(),t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(),t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new hd(e,t.moveOptions.scrollbars===!0||!!t.moveOptions.scrollbars.horizontal,t.moveOptions.scrollbars===!0||!!t.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),t.hasSounds&&l_(t.pathToMedia,e)},o_=function(e){const t=ze();t&&!(Oe(e)||t.rendered&&!t.isVisible())&&kt.registry.onKeyDown(t,e)},r_=function(){of||(ee(document,"scroll",null,function(){const e=Ve();for(let t=0,s;s=e[t];t++)s instanceof xs&&s.updateInverseScreenCTM()}),ee(document,"keydown",null,o_),me(document,"touchend",null,Se),me(document,"touchcancel",null,Se),oa&&ee(window,"orientationchange",document,function(){nt(ze())})),of=!0},l_=function(e,t){function s(){for(;d.length;){const f=d.pop();f&&Ee(f)}a.preload()}const a=t.getAudioManager();a.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),a.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),a.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const d=[];d.push(ee(document,"pointermove",null,s,!0)),d.push(ee(document,"touchstart",null,s,!0))},Lu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.UNDO},preconditionFn(e){return 0<e.workspace.getUndoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!1)},scopeType:ct.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},Nu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.REDO},preconditionFn(e){return 0<e.workspace.getRedoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!0)},scopeType:ct.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},Mu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.CLEAN_UP},preconditionFn(e){return e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback(e){e.workspace.cleanUp()},scopeType:ct.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},xu=function(e,t){function s(f){d--,f.setCollapsed(e),d===0&&l.setGroup$$module$build$src$core$events$utils(!1)}let a=0,d=0;l.setGroup$$module$build$src$core$events$utils(!0);for(let f=0;f<t.length;f++){let S=t[f];for(;S;)d++,setTimeout(s.bind(null,S),a),S=S.getNextBlock(),a+=10}},Pu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.COLLAPSE_ALL},preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let s=e[t];for(;s;){if(!s.isCollapsed())return"enabled";s=s.getNextBlock()}}return"disabled"}return"hidden"},callback(e){xu(!0,e.workspace.getTopBlocks(!0))},scopeType:ct.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},Du=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.EXPAND_ALL},preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let s=e[t];for(;s;){if(s.isCollapsed())return"enabled";s=s.getNextBlock()}}return"disabled"}return"hidden"},callback(e){xu(!1,e.workspace.getTopBlocks(!0))},scopeType:ct.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},Bu=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else{e=e.getChildren(!1);for(let s=0;s<e.length;s++)Bu(e[s],t)}},lc=function(e){const t=[];e=e.getTopBlocks(!0);for(let s=0;s<e.length;s++)Bu(e[s],t);return t},ta=function(e,t){t?l.setGroup$$module$build$src$core$events$utils(t):(l.setGroup$$module$build$src$core$events$utils(!0),t=l.getGroup$$module$build$src$core$events$utils());const s=e.shift();s&&(s.isDeadOrDying()?ta(e,t):(s.dispose(!1,!0),setTimeout(ta,10,e,t))),l.setGroup$$module$build$src$core$events$utils(!1)},Fu=function(){ct.registry.register({displayText(e){return e.workspace?(e=lc(e.workspace).length,e===1?l.Msg$$module$build$src$core$msg.DELETE_BLOCK:l.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)):""},preconditionFn(e){return e.workspace&&0<lc(e.workspace).length?"enabled":"disabled"},callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=lc(e.workspace);2>t.length?ta(t):ji(l.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),function(s){s&&ta(t)})}},scopeType:ct.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},a_=function(){Lu(),Nu(),Mu(),Pu(),Du(),Fu()},Uu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden"},callback(e){if(e.block){var t=e.block.toCopyData();t&&ro(t,e.block.workspace)}},scopeType:ct.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},Hu=function(){ct.registry.register({displayText(e){return e.block.hasIcon(Vn.TYPE)?l.Msg$$module$build$src$core$msg.REMOVE_COMMENT:l.Msg$$module$build$src$core$msg.ADD_COMMENT},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden"},callback(e){e=e.block,e.hasIcon(Vn.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:ct.ScopeType.BLOCK,id:"blockComment",weight:2})},Gu=function(){ct.registry.register({displayText(e){return e.block.getInputsInline()?l.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:l.Msg$$module$build$src$core$msg.INLINE_INPUTS},preconditionFn(e){if(e=e.block,!e.isInFlyout&&e.isMovable()&&!e.isCollapsed()){for(let t=1;t<e.inputList.length;t++)if(!(e.inputList[t-1]instanceof iu||e.inputList[t]instanceof iu))return"enabled"}return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:ct.ScopeType.BLOCK,id:"blockInline",weight:3})},Vu=function(){ct.registry.register({displayText(e){return e.block.isCollapsed()?l.Msg$$module$build$src$core$msg.EXPAND_BLOCK:l.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:ct.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},Wu=function(){ct.registry.register({displayText(e){return e.block.hasDisabledReason(Rs)?l.Msg$$module$build$src$core$msg.ENABLE_BLOCK:l.Msg$$module$build$src$core$msg.DISABLE_BLOCK},preconditionFn(e){if(e=e.block,!e.isInFlyout&&e.workspace.options.disable&&e.isEditable()){var t=e.getDisabledReasons();return t=t.size>(t.has(Rs)?1:0),e.getInheritedDisabled()||t?"disabled":"enabled"}return"hidden"},callback(e){e=e.block;const t=l.getGroup$$module$build$src$core$events$utils();t||l.setGroup$$module$build$src$core$events$utils(!0),e.setDisabledReason(!e.hasDisabledReason(Rs),Rs),l.setGroup$$module$build$src$core$events$utils(t)},scopeType:ct.ScopeType.BLOCK,id:"blockDisable",weight:5})},zu=function(){ct.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),e===1?l.Msg$$module$build$src$core$msg.DELETE_BLOCK:l.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn(e){return!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden"},callback(e){e.block&&e.block.checkAndDelete()},scopeType:ct.ScopeType.BLOCK,id:"blockDelete",weight:6})},Xu=function(){ct.registry.register({displayText(){return l.Msg$$module$build$src$core$msg.HELP},preconditionFn(e){return e=e.block,(typeof e.helpUrl=="function"?e.helpUrl():e.helpUrl)?"enabled":"hidden"},callback(e){e.block.showHelp()},scopeType:ct.ScopeType.BLOCK,id:"blockHelp",weight:7})},Yu=function(){ct.registry.register({displayText:()=>l.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(e){let t;return(t=e.comment)!=null&&t.isDeletable()?"enabled":"hidden"},callback(e){l.setGroup$$module$build$src$core$events$utils(!0);let t;(t=e.comment)==null||t.dispose(),l.setGroup$$module$build$src$core$events$utils(!1)},scopeType:ct.ScopeType.COMMENT,id:"commentDelete",weight:6})},ju=function(){ct.registry.register({displayText:()=>l.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(e){let t;return(t=e.comment)!=null&&t.isMovable()?"enabled":"hidden"},callback(e){if(e.comment){var t=e.comment.toCopyData();t&&ro(t,e.comment.workspace)}},scopeType:ct.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},Ku=function(){ct.registry.register({displayText:()=>l.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:()=>"enabled",callback:(e,t)=>{if(e=e.workspace){l.setGroup$$module$build$src$core$events$utils(!0);var s=new Pc(e);s.setText(l.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),s.moveTo(c_(new Te(t.clientX,t.clientY),e)),l.setSelected$$module$build$src$core$common(s),l.setGroup$$module$build$src$core$events$utils(!1)}},scopeType:ct.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},c_=function(e,t){var s=t.getInjectionDiv().getBoundingClientRect();return e=new Te(e.x-s.left,e.y-s.top),s=t.getOriginOffsetInPixels(),e=Te.difference(e,s),e.scale(1/t.scale),e},u_=function(){Uu(),Hu(),Gu(),Vu(),Wu(),zu(),Xu()},h_=function(){ju(),Yu(),Ku()},Ju=function(){a_(),u_()},d_=function(e){return e.paste!==void 0},__=function(e){return e.getSvgRoot!==void 0},p_=function(e){return typeof e.id=="string"&&e.workspace!==void 0&&e.select!==void 0&&e.unselect!==void 0},f_=function(e){return e.isSelectable()},g_=function(e){ze().hideChaff(e)},ue=ue||{},ue.scope={},ue.ASSUME_ES5=!1,ue.ASSUME_NO_NATIVE_MAP=!1,ue.ASSUME_NO_NATIVE_SET=!1,ue.SIMPLE_FROUND_POLYFILL=!1,ue.ISOLATE_POLYFILLS=!1,ue.FORCE_POLYFILL_PROMISE=!1,ue.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,ue.defineProperty=ue.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(e,t,s){return e==Array.prototype||e==Object.prototype||(e[t]=s.value),e},ue.getGlobal=function(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var t=0;t<e.length;++t){var s=e[t];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")},ue.global=ue.getGlobal(this),ue.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",ue.TRUST_ES6_POLYFILLS=!ue.ISOLATE_POLYFILLS||ue.IS_SYMBOL_NATIVE,ue.polyfills={},ue.propertyToPolyfillSymbol={},ue.POLYFILL_PREFIX="$jscp$",ue.polyfill=function(e,t,s,a){t&&(ue.ISOLATE_POLYFILLS?ue.polyfillIsolated(e,t,s,a):ue.polyfillUnisolated(e,t,s,a))},ue.polyfillUnisolated=function(e,t,s,a){for(s=ue.global,e=e.split("."),a=0;a<e.length-1;a++){var d=e[a];if(!(d in s))return;s=s[d]}e=e[e.length-1],a=s[e],t=t(a),t!=a&&t!=null&&ue.defineProperty(s,e,{configurable:!0,writable:!0,value:t})},ue.polyfillIsolated=function(e,t,s,a){var d=e.split(".");e=d.length===1,a=d[0],a=!e&&a in ue.polyfills?ue.polyfills:ue.global;for(var f=0;f<d.length-1;f++){var S=d[f];if(!(S in a))return;a=a[S]}d=d[d.length-1],s=ue.IS_SYMBOL_NATIVE&&s==="es6"?a[d]:null,t=t(s),t!=null&&(e?ue.defineProperty(ue.polyfills,d,{configurable:!0,writable:!0,value:t}):t!==s&&(ue.propertyToPolyfillSymbol[d]===void 0&&(s=1e9*Math.random()>>>0,ue.propertyToPolyfillSymbol[d]=ue.IS_SYMBOL_NATIVE?ue.global.Symbol(d):ue.POLYFILL_PREFIX+s+"$"+d),ue.defineProperty(a,ue.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:t})))},ue.underscoreProtoCanBeSet=function(){var e={a:!0},t={};try{return t.__proto__=e,t.a}catch{}return!1},ue.setPrototypeOf=ue.TRUST_ES6_POLYFILLS&&typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf:ue.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,ue.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},ue.arrayIterator=function(e){return{next:ue.arrayIteratorImpl(e)}},ue.makeIterator=function(e){var t=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];if(t)return t.call(e);if(typeof e.length=="number")return ue.arrayIterator(e);throw Error(String(e)+" is not an iterable or ArrayLike")},ue.generator={},ue.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},ue.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},ue.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},ue.generator.Context.prototype.stop_=function(){this.isRunning_=!1},ue.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},ue.generator.Context.prototype.next_=function(e){this.yieldResult=e},ue.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},ue.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},ue.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},ue.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},ue.generator.Context.prototype.yieldAll=function(e,t){e=ue.makeIterator(e);var s=e.next();if(ue.generator.ensureIteratorResultIsObject_(s),s.done)this.yieldResult=s.value,this.nextAddress=t;else return this.yieldAllIterator_=e,this.yield(s.value,t)},ue.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},ue.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},ue.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,t!=null&&(this.finallyAddress_=t)},ue.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},ue.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},ue.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},ue.generator.Context.prototype.enterFinallyBlock=function(e,t,s){s?this.finallyContexts_[s]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},ue.generator.Context.prototype.leaveFinallyBlock=function(e,t){if(t=this.finallyContexts_.splice(t||0)[0],t=this.abruptCompletion_=this.abruptCompletion_||t){if(t.isException)return this.jumpToErrorHandler_();t.jumpTo!=null&&this.finallyAddress_<t.jumpTo?(this.nextAddress=t.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},ue.generator.Context.prototype.forIn=function(e){return new ue.generator.Context.PropertyIterator(e)},ue.generator.Context.PropertyIterator=function(e){this.object_=e,this.properties_=[];for(var t in e)this.properties_.push(t);this.properties_.reverse()},ue.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},ue.generator.Engine_=function(e){this.context_=new ue.generator.Context,this.program_=e},ue.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},ue.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(s){return{value:s,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},ue.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},ue.generator.Engine_.prototype.yieldAllStep_=function(e,t,s){try{var a=e.call(this.context_.yieldAllIterator_,t);if(ue.generator.ensureIteratorResultIsObject_(a),!a.done)return this.context_.stop_(),a;var d=a.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}return this.context_.yieldAllIterator_=null,s.call(this.context_,d),this.nextStep_()},ue.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(t){this.context_.yieldResult=void 0,this.context_.throw_(t)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},ue.generator.Generator_=function(e){this.next=function(t){return e.next_(t)},this.throw=function(t){return e.throw_(t)},this.return=function(t){return e.return_(t)},this[Symbol.iterator]=function(){return this}},ue.generator.createGenerator=function(e,t){return t=new ue.generator.Generator_(new ue.generator.Engine_(t)),ue.setPrototypeOf&&e.prototype&&ue.setPrototypeOf(t,e.prototype),t},ue.asyncExecutePromiseGenerator=function(e){function t(a){return e.next(a)}function s(a){return e.throw(a)}return new Promise(function(a,d){function f(S){S.done?a(S.value):Promise.resolve(S.value).then(t,s).then(f,d)}f(e.next())})},ue.asyncExecutePromiseGeneratorFunction=function(e){return ue.asyncExecutePromiseGenerator(e())},ue.asyncExecutePromiseGeneratorProgram=function(e){return ue.asyncExecutePromiseGenerator(new ue.generator.Generator_(new ue.generator.Engine_(e)))},ue.polyfill("globalThis",function(e){return e||ue.global},"es_2020","es3"),ue.polyfill("Array.prototype.includes",function(e){return e||function(t,s){var a=this;a instanceof String&&(a=String(a));var d=a.length;for(s=s||0,0>s&&(s=Math.max(s+d,0));s<d;s++){var f=a[s];if(f===t||Object.is(f,t))return!0}return!1}},"es7","es3"),ue.initSymbol=function(){},ue.iteratorPrototype=function(e){return e={next:e},e[Symbol.iterator]=function(){return this},e},ue.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var s=0,a=!1,d={next:function(){if(!a&&s<e.length){var f=s++;return{value:t(f,e[f]),done:!1}}return a=!0,{done:!0,value:void 0}}};return d[Symbol.iterator]=function(){return d},d},ue.polyfill("Array.prototype.values",function(e){return e||function(){return ue.iteratorFromArray(this,function(t,s){return s})}},"es8","es3"),ue.polyfill("Array.prototype.flat",function(e){return e||function(t){t=t===void 0?1:t;var s=[];return Array.prototype.forEach.call(this,function(a){Array.isArray(a)&&0<t?(a=Array.prototype.flat.call(a,t-1),s.push.apply(s,a)):s.push(a)}),s}},"es9","es5"),ue.polyfill("Array.prototype.flatMap",function(e){return e||function(t,s){var a=[];return Array.prototype.forEach.call(this,function(d,f){d=t.call(s,d,f,this),Array.isArray(d)?a.push.apply(a,d):a.push(d)}),a}},"es9","es5"),ue.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},ue.polyfill("Object.entries",function(e){return e||function(t){var s=[],a;for(a in t)ue.owns(t,a)&&s.push([a,t[a]]);return s}},"es8","es3"),ue.polyfill("Object.values",function(e){return e||function(t){var s=[],a;for(a in t)ue.owns(t,a)&&s.push(t[a]);return s}},"es8","es3");var lo=Object.create(null),Af={typeMap:lo},ac=Object.create(null),cn="default",pe=class{constructor(e){this.name=e}toString(){return this.name}};pe.CONNECTION_CHECKER=new pe("connectionChecker"),pe.CONNECTION_PREVIEWER=new pe("connectionPreviewer"),pe.CURSOR=new pe("cursor"),pe.EVENT=new pe("event"),pe.FIELD=new pe("field"),pe.INPUT=new pe("input"),pe.RENDERER=new pe("renderer"),pe.TOOLBOX=new pe("toolbox"),pe.THEME=new pe("theme"),pe.TOOLBOX_ITEM=new pe("toolboxItem"),pe.FLYOUTS_VERTICAL_TOOLBOX=new pe("flyoutsVerticalToolbox"),pe.FLYOUTS_HORIZONTAL_TOOLBOX=new pe("flyoutsHorizontalToolbox"),pe.METRICS_MANAGER=new pe("metricsManager"),pe.BLOCK_DRAGGER=new pe("blockDragger"),pe.SERIALIZER=new pe("serializer"),pe.ICON=new pe("icon"),pe.PASTER=new pe("paster");var An={DEFAULT:cn,TEST_ONLY:Af};An.Type=pe,An.getAllItems=w,An.getClass=I,An.getClassFromOptions=C,An.getObject=R,An.hasItem=v,An.register=h,An.unregister=g;var ss=Object.create(null),m_="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",$_={genUid:()=>{const e=m_.length,t=[];for(let s=0;20>s;s++)t[s]=m_.charAt(Math.random()*e);return t.join("")}},Lf=0,Zu={TEST_ONLY:$_};Zu.genUid=D,Zu.getNextUniqueId=N;var qu,Dr,cc,Do,Ln,Bo,Br,uc,Fo,Fr,Nn,Ur,un,Hr,Gr,Vr,ao,Mn,Wr,zr,xn,ia,Uo,hc,dc,Ho,_c,Wi;qu="",Dr=!0,cc=0,l.CREATE$$module$build$src$core$events$utils="create",l.CREATE$$module$build$src$core$events$utils,l.DELETE$$module$build$src$core$events$utils="delete",l.DELETE$$module$build$src$core$events$utils,l.CHANGE$$module$build$src$core$events$utils="change",l.CHANGE$$module$build$src$core$events$utils,Do="block_field_intermediate_change",l.MOVE$$module$build$src$core$events$utils="move",l.MOVE$$module$build$src$core$events$utils,Ln="var_create",Bo="var_delete",Br="var_rename",uc="ui",Fo="drag",Fr="selected",Nn="click",Ur="marker_move",un="bubble_open",Hr="trashcan_open",Gr="toolbox_item_select",Vr="theme_change",ao="viewport_change",Mn="comment_create",Wr="comment_delete",zr="comment_change",xn="comment_move",ia="comment_collapse",Uo="finished_loading",hc="ORPHANED_BLOCK",dc=[l.CREATE$$module$build$src$core$events$utils,l.MOVE$$module$build$src$core$events$utils,Mn,xn],Ho=[],_c={FIRE_QUEUE:Ho,fireNow:ne,fireInternal:ie,setGroupInternal:re},Wi={BLOCK_CHANGE:l.CHANGE$$module$build$src$core$events$utils,BLOCK_CREATE:l.CREATE$$module$build$src$core$events$utils,BLOCK_DELETE:l.DELETE$$module$build$src$core$events$utils,BLOCK_DRAG:Fo,BLOCK_FIELD_INTERMEDIATE_CHANGE:Do,BLOCK_MOVE:l.MOVE$$module$build$src$core$events$utils,BUBBLE_OPEN:un,BUMP_EVENTS:dc,CHANGE:l.CHANGE$$module$build$src$core$events$utils,CLICK:Nn,COMMENT_CHANGE:zr,COMMENT_COLLAPSE:ia,COMMENT_CREATE:Mn,COMMENT_DELETE:Wr,COMMENT_MOVE:xn,CREATE:l.CREATE$$module$build$src$core$events$utils,DELETE:l.DELETE$$module$build$src$core$events$utils,FINISHED_LOADING:Uo,MARKER_MOVE:Ur,MOVE:l.MOVE$$module$build$src$core$events$utils,SELECTED:Fr,TEST_ONLY:_c,THEME_CHANGE:Vr,TOOLBOX_ITEM_SELECT:Gr,TRASHCAN_OPEN:Hr,UI:uc,VAR_CREATE:Ln,VAR_DELETE:Bo,VAR_RENAME:Br,VIEWPORT_CHANGE:ao},Wi.clearPendingUndo=z,Wi.disable=l.disable$$module$build$src$core$events$utils,Wi.disableOrphans=ye,Wi.enable=l.enable$$module$build$src$core$events$utils,Wi.filter=P,Wi.fire=B,Wi.fromJson=q,Wi.get=j,Wi.getDescendantIds=he,Wi.getGroup=l.getGroup$$module$build$src$core$events$utils,Wi.getRecordUndo=V,Wi.isEnabled=se,Wi.setGroup=l.setGroup$$module$build$src$core$events$utils,Wi.setRecordUndo=l.setRecordUndo$$module$build$src$core$events$utils;var sa=Object.create(null),T_,Go=null,E_,na=[],b_={defineBlocksWithJsonArrayInternal:Ge},Ai={TEST_ONLY:b_};Ai.createBlockDefinitionsFromJsonArray=l.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Ai.defineBlocks=l.defineBlocks$$module$build$src$core$common,Ai.defineBlocksWithJsonArray=ot,Ai.draggingConnections=na,Ai.getAllWorkspaces=Ve,Ai.getBlockTypeCounts=be,Ai.getMainWorkspace=ze,Ai.getParentContainer=St,Ai.getSelected=Ce,Ai.getWorkspaceById=ge,Ai.registerWorkspace=de,Ai.setMainWorkspace=mt,Ai.setParentContainer=_e,Ai.setSelected=l.setSelected$$module$build$src$core$common,Ai.svgResize=nt,Ai.unregisterWorkpace=Tt;var Xr=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=l.getGroup$$module$build$src$core$events$utils(),this.recordUndo=V()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,s){return s.isBlank=!1,s.group=e.group||"",s.workspaceId=t.id,s}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=ge(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},hn=class extends Xr{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=typeof e>"u",this.workspaceId=e||""}},Qu=class extends hn{constructor(e,t,s){t=e?e.workspace.id:t,t===null&&(t=void 0),super(t),this.type=Nn,this.blockId=e?e.id:void 0,this.targetType=s}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Qu),t.targetType=e.targetType,t.blockId=e.blockId,t}},eh;(function(e){e.BLOCK="block",e.WORKSPACE="workspace",e.ZOOM_CONTROLS="zoom_controls"})(eh||(eh={})),h(pe.EVENT,Nn,Qu);var Nf=750,v_="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),pc=null,Vo={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},fc=0,Wo={TOUCH_ENABLED:v_,TOUCH_MAP:Vo};Wo.checkTouchIdentifier=le,Wo.clearTouchIdentifier=ve,Wo.getTouchIdentifierFromEvent=je,Wo.longStart=Fe,Wo.longStop=Se,Wo.shouldHandleEvent=We;var th,y_,I_,S_,gc,mc,ih,O_,k_,C_;(function(e){function t(a){return s.includes(a.toUpperCase())}th=e;const s=th.toUpperCase();y_=t("JavaFX"),I_=t("WebKit"),S_=t("Gecko")&&!I_,gc=t("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,mc=t("iPad")||t("Macintosh")&&0<e,ih=t("iPhone")&&!mc,O_=t("Macintosh"),k_=mc||gc&&!t("Mobile")||t("Silk"),C_=!k_&&(ih||gc)})(globalThis.navigator&&globalThis.navigator.userAgent||"");var Mf=th,R_=y_,w_=S_,sh=gc,oa=mc,A_=ih,nh=O_,L_=C_,xf={ANDROID:sh,GECKO:w_,IPAD:oa,IPHONE:A_,JavaFx:R_,MAC:nh,MOBILE:L_,raw:Mf},N_=40,M_=125,Pn={};Pn.bind=me,Pn.conditionalBind=ee,Pn.getScrollDeltaPixels=Ke,Pn.isRightButton=Be,Pn.isTargetInput=Oe,Pn.mouseToSvg=Ye,Pn.unbind=Ee;var x_={};x_.removeElem=it;var Dn=class{constructor(e){this.name_=e}toString(){return this.name_}};Dn.POSITIONABLE=new Dn("positionable"),Dn.DRAG_TARGET=new Dn("drag_target"),Dn.DELETE_AREA=new Dn("delete_area"),Dn.AUTOHIDEABLE=new Dn("autohideable");var bi=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){const s=e.component.id;if(!t&&this.componentData.has(s)){var a;throw Error('Plugin "'+s+'" with capabilities "'+((a=this.componentData.get(s))==null?void 0:a.capabilities)+'" already added.')}for(this.componentData.set(s,e),t=[],a=0;a<e.capabilities.length;a++){const d=String(e.capabilities[a]).toLowerCase();if(t.push(d),this.capabilityToComponentIds.has(d)){let f;(f=this.capabilityToComponentIds.get(d))==null||f.push(s)}else this.capabilityToComponentIds.set(d,[s])}this.componentData.get(s).capabilities=t}removeComponent(e){const t=this.componentData.get(e);if(t){for(let s=0;s<t.capabilities.length;s++){const a=String(t.capabilities[s]).toLowerCase();it(this.capabilityToComponentIds.get(a),e)}this.componentData.delete(e)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');if(this.hasCapability(e,t))console.warn('Plugin "'+e+'already has capability "'+t+'"');else{t=`${t}`.toLowerCase();var s;(s=this.componentData.get(e))==null||s.capabilities.push(t);var a;(a=this.capabilityToComponentIds.get(t))==null||a.push(e)}}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=`${t}`.toLowerCase(),it(this.componentData.get(e).capabilities,t),it(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+`doesn't have capability "`+t+'" to remove')}hasCapability(e,t){return t=`${t}`.toLowerCase(),this.componentData.has(e)&&this.componentData.get(e).capabilities.includes(t)}getComponent(e){let t;return(t=this.componentData.get(e))==null?void 0:t.component}getComponents(e,t){if(e=`${e}`.toLowerCase(),e=this.capabilityToComponentIds.get(e),!e)return[];const s=[];if(t){const a=[];e.forEach(d=>{a.push(this.componentData.get(d))}),a.sort(function(d,f){return d.weight-f.weight}),a.forEach(function(d){s.push(d.component)})}else e.forEach(a=>{s.push(this.componentData.get(a).component)});return s}};bi.Capability=Dn;var oh=!1,rh=`
.blocklySvg {
  background-color: #fff;
  outline: none;
  overflow: hidden;  /* IE overflows by default. */
  position: absolute;
  display: block;
}

.blocklyWidgetDiv {
  display: none;
  position: absolute;
  z-index: 99999;  /* big value for bootstrap3 compatibility */
}

.injectionDiv {
  height: 100%;
  position: relative;
  overflow: hidden;  /* So blocks in drag surface disappear at edges */
  touch-action: none;
}

.blocklyNonSelectable {
  user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
}

.blocklyBlockCanvas.blocklyCanvasTransitioning,
.blocklyBubbleCanvas.blocklyCanvasTransitioning {
  transition: transform .5s;
}

.blocklyTooltipDiv {
  background-color: #ffffc7;
  border: 1px solid #ddc;
  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);
  color: #000;
  display: none;
  font: 9pt sans-serif;
  opacity: .9;
  padding: 2px;
  position: absolute;
  z-index: 100000;  /* big value for bootstrap3 compatibility */
}

.blocklyDropDownDiv {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1000;
  display: none;
  border: 1px solid;
  border-color: #dadce0;
  background-color: #fff;
  border-radius: 2px;
  padding: 4px;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownContent {
  max-height: 300px;  /* @todo: spec for maximum height. */
  overflow: auto;
  overflow-x: hidden;
  position: relative;
}

.blocklyDropDownArrow {
  position: absolute;
  left: 0;
  top: 0;
  width: 16px;
  height: 16px;
  z-index: -1;
  background-color: inherit;
  border-color: inherit;
}

.blocklyDropDownButton {
  display: inline-block;
  float: left;
  padding: 0;
  margin: 4px;
  border-radius: 4px;
  outline: none;
  border: 1px solid;
  transition: box-shadow .1s;
  cursor: pointer;
}

.blocklyArrowTop {
  border-top: 1px solid;
  border-left: 1px solid;
  border-top-left-radius: 4px;
  border-color: inherit;
}

.blocklyArrowBottom {
  border-bottom: 1px solid;
  border-right: 1px solid;
  border-bottom-right-radius: 4px;
  border-color: inherit;
}

.blocklyResizeSE {
  cursor: se-resize;
  fill: #aaa;
}

.blocklyResizeSW {
  cursor: sw-resize;
  fill: #aaa;
}

.blocklyResizeLine {
  stroke: #515A5A;
  stroke-width: 1;
}

.blocklyHighlightedConnectionPath {
  fill: none;
  stroke: #fc3;
  stroke-width: 4px;
}

.blocklyPathLight {
  fill: none;
  stroke-linecap: round;
  stroke-width: 1;
}

.blocklySelected>.blocklyPathLight {
  display: none;
}

.blocklyDraggable {
  cursor: grab;
  cursor: -webkit-grab;
}

.blocklyDragging {
  cursor: grabbing;
  cursor: -webkit-grabbing;
  /* Drag surface disables events to not block the toolbox, so we have to
   * reenable them here for the cursor values to work. */
  pointer-events: auto;
}

  /* Changes cursor on mouse down. Not effective in Firefox because of
     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */
.blocklyDraggable:active {
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

.blocklyDragging.blocklyDraggingDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyDragging>.blocklyPath,
.blocklyDragging>.blocklyPathLight {
  fill-opacity: .8;
  stroke-opacity: .8;
}

.blocklyDragging>.blocklyPathDark {
  display: none;
}

.blocklyDisabled>.blocklyPath {
  fill-opacity: .5;
  stroke-opacity: .5;
}

.blocklyDisabled>.blocklyPathLight,
.blocklyDisabled>.blocklyPathDark {
  display: none;
}

.blocklyInsertionMarker>.blocklyPath,
.blocklyInsertionMarker>.blocklyPathLight,
.blocklyInsertionMarker>.blocklyPathDark {
  fill-opacity: .2;
  stroke: none;
}

.blocklyMultilineText {
  font-family: monospace;
}

.blocklyNonEditableText>text {
  pointer-events: none;
}

.blocklyFlyout {
  position: absolute;
  z-index: 20;
}

.blocklyText text {
  cursor: default;
}

/*
  Don't allow users to select text.  It gets annoying when trying to
  drag a block and selected text moves instead.
*/
.blocklySvg text {
  user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  cursor: inherit;
}

.blocklyHidden {
  display: none;
}

.blocklyFieldDropdown:not(.blocklyHidden) {
  display: block;
}

.blocklyIconGroup {
  cursor: default;
}

.blocklyIconGroup:not(:hover),
.blocklyIconGroupReadonly {
  opacity: .6;
}

.blocklyIconShape {
  fill: #00f;
  stroke: #fff;
  stroke-width: 1px;
}

.blocklyIconSymbol {
  fill: #fff;
}

.blocklyMinimalBody {
  margin: 0;
  padding: 0;
  height: 100%;
}

.blocklyHtmlInput {
  border: none;
  border-radius: 4px;
  height: 100%;
  margin: 0;
  outline: none;
  padding: 0;
  width: 100%;
  text-align: center;
  display: block;
  box-sizing: border-box;
}

/* Remove the increase and decrease arrows on the field number editor */
input.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,
input.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}

.blocklyMainBackground {
  stroke-width: 1;
  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */
}

.blocklyMutatorBackground {
  fill: #fff;
  stroke: #ddd;
  stroke-width: 1;
}

.blocklyFlyoutBackground {
  fill: #ddd;
  fill-opacity: .8;
}

.blocklyMainWorkspaceScrollbar {
  z-index: 20;
}

.blocklyFlyoutScrollbar {
  z-index: 30;
}

.blocklyScrollbarHorizontal,
.blocklyScrollbarVertical {
  position: absolute;
  outline: none;
}

.blocklyScrollbarBackground {
  opacity: 0;
}

.blocklyScrollbarHandle {
  fill: #ccc;
}

.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyScrollbarHandle:hover {
  fill: #bbb;
}

/* Darken flyout scrollbars due to being on a grey background. */
/* By contrast, workspace scrollbars are on a white background. */
.blocklyFlyout .blocklyScrollbarHandle {
  fill: #bbb;
}

.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyFlyout .blocklyScrollbarHandle:hover {
  fill: #aaa;
}

.blocklyInvalidInput {
  background: #faa;
}

.blocklyVerticalMarker {
  stroke-width: 3px;
  fill: rgba(255,255,255,.5);
  pointer-events: none;
}

.blocklyComputeCanvas {
  position: absolute;
  width: 0;
  height: 0;
}

.blocklyNoPointerEvents {
  pointer-events: none;
}

.blocklyContextMenu {
  border-radius: 4px;
  max-height: 100%;
}

.blocklyDropdownMenu {
  border-radius: 2px;
  padding: 0 !important;
}

.blocklyDropdownMenu .blocklyMenuItem {
  /* 28px on the left for icon or checkbox. */
  padding-left: 28px;
}

/* BiDi override for the resting state. */
.blocklyDropdownMenu .blocklyMenuItemRtl {
  /* Flip left/right padding for BiDi. */
  padding-left: 5px;
  padding-right: 28px;
}

.blocklyWidgetDiv .blocklyMenu {
  background: #fff;
  border: 1px solid transparent;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
  font: normal 13px Arial, sans-serif;
  margin: 0;
  outline: none;
  padding: 4px 0;
  position: absolute;
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 100%;
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

.blocklyWidgetDiv .blocklyMenu.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv .blocklyMenu {
  background: inherit;  /* Compatibility with gapi, reset from goog-menu */
  border: inherit;  /* Compatibility with gapi, reset from goog-menu */
  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;
  outline: none;
  position: relative;  /* Compatibility with gapi, reset from goog-menu */
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

/* State: resting. */
.blocklyMenuItem {
  border: none;
  color: #000;
  cursor: pointer;
  list-style: none;
  margin: 0;
  /* 7em on the right for shortcut. */
  min-width: 7em;
  padding: 6px 15px;
  white-space: nowrap;
}

/* State: disabled. */
.blocklyMenuItemDisabled {
  color: #ccc;
  cursor: inherit;
}

/* State: hover. */
.blocklyMenuItemHighlight {
  background-color: rgba(0,0,0,.1);
}

/* State: selected/checked. */
.blocklyMenuItemCheckbox {
  height: 16px;
  position: absolute;
  width: 16px;
}

.blocklyMenuItemSelected .blocklyMenuItemCheckbox {
  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;
  float: left;
  margin-left: -24px;
  position: static;  /* Scroll with the menu. */
}

.blocklyMenuItemRtl .blocklyMenuItemCheckbox {
  float: right;
  margin-right: -24px;
}

.blocklyBlockDragSurface, .blocklyAnimationLayer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible !important;
  z-index: 80;
  pointer-events: none;
}
`,lh={};lh.inject=Et,lh.register=Ue;var Te=class{constructor(e,t){this.x=e,this.y=t}clone(){return new Te(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t?!0:e&&t?e.x===t.x&&e.y===t.y:!1}static distance(e,t){const s=e.x-t.x;return e=e.y-t.y,Math.sqrt(s*s+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new Te(e.x-t.x,e.y-t.y)}static sum(e,t){return new Te(e.x+t.x,e.y+t.y)}},ra="http://www.w3.org/2000/svg",dn="http://www.w3.org/1999/xhtml",fs="http://www.w3.org/1999/xlink",Bn;(function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"})(Bn||(Bn={}));var Ys=null,ah=0,$c=null,ki={HTML_NS:dn};ki.NodeType=Bn,ki.SVG_NS=ra,ki.XLINK_NS=fs,ki.addClass=$e,ki.createSvgElement=J,ki.getFastTextWidth=Xe,ki.getFastTextWidthWithSizeString=pt,ki.getTextWidth=dt,ki.hasClass=yt,ki.insertAfter=st,ki.measureFontMetrics=E,ki.removeClass=ke,ki.removeClasses=Qe,ki.removeNode=M,ki.setCssTransform=gt,ki.startTextWidthCache=Je,ki.stopTextWidthCache=ut;var Y=class{constructor(e){this.tagName=e}toString(){return this.tagName}};Y.ANIMATE=new Y("animate"),Y.CIRCLE=new Y("circle"),Y.CLIPPATH=new Y("clipPath"),Y.DEFS=new Y("defs"),Y.FECOMPOSITE=new Y("feComposite"),Y.FECOMPONENTTRANSFER=new Y("feComponentTransfer"),Y.FEFLOOD=new Y("feFlood"),Y.FEFUNCA=new Y("feFuncA"),Y.FEGAUSSIANBLUR=new Y("feGaussianBlur"),Y.FEPOINTLIGHT=new Y("fePointLight"),Y.FESPECULARLIGHTING=new Y("feSpecularLighting"),Y.FILTER=new Y("filter"),Y.FOREIGNOBJECT=new Y("foreignObject"),Y.G=new Y("g"),Y.IMAGE=new Y("image"),Y.LINE=new Y("line"),Y.PATH=new Y("path"),Y.PATTERN=new Y("pattern"),Y.POLYGON=new Y("polygon"),Y.RECT=new Y("rect"),Y.SVG=new Y("svg"),Y.TEXT=new Y("text"),Y.TSPAN=new Y("tspan");var Nt=class{constructor(e,t,s,a){this.top=e,this.bottom=t,this.left=s,this.right=a}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)}},bt=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t?!0:e&&t?e.width===t.width&&e.height===t.height:!1}static max(e,t){return new bt(Math.max(e.width,t.width),Math.max(e.height,t.height))}static min(e,t){return new bt(Math.min(e.width,t.width),Math.min(e.height,t.height))}},P_={getSizeInternal:W},co={TEST_ONLY:P_};co.getBorderBox=Qt,co.getComputedStyle=ae,co.getContainerOffsetToScrollInto=b,co.getPageOffset=xe,co.getSize=A,co.getViewportPageOffset=Ct,co.scrollIntoContainerView=rt;var D_=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,B_=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,Pf={XY_REGEX:D_,XY_STYLE_REGEX:B_},zo={TEST_ONLY:Pf};zo.getDocumentScroll=oe,zo.getInjectionDivXY=F,zo.getRelativeXY=k,zo.getViewportBBox=X,zo.screenToWsCoordinates=Re,zo.wsToScreenCoordinates=Pe;var oi=class{constructor(e,t,s,a,d){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new Te(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new Te(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=s||!1,this.margin=d!==void 0?d:oi.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),a&&(e+=" "+a),this.outerSvg=J(Y.SVG,{class:e}),a=J(Y.G,{},this.outerSvg),this.svgBackground=J(Y.RECT,{class:"blocklyScrollbarBackground"},a),e=Math.floor((oi.scrollbarThickness-5)/2),this.svgHandle=J(Y.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},a),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),st(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=ee(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=ee(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=oi.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),Ee(this.onMouseDownBarWrapper_),Ee(this.onMouseDownHandleWrapper_),M(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,gt(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){!e&&(e=this.workspace.getMetrics(),!e)||this.oldHostMetrics&&oi.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics())}requiresViewResize(e){return this.oldHostMetrics?this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop:!0}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=oi.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=oi.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-oi.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewWidth/e.scrollWidth;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth;var s=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/t*s,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=s/t}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=oi.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-oi.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewHeight/e.scrollHeight;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight;var s=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/t*s,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=s/t}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),ve(),this.cleanUp(),Be(e))e.stopPropagation();else{var t=Ye(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());t=this.horizontal?t.x:t.y;var s=F(this.svgHandle);s=this.horizontal?s.x:s.y;var a=this.handlePosition,d=.95*this.handleLength;t<=s?a-=d:t>=s+this.handleLength&&(a+=d),this.setHandlePosition(this.constrainHandlePosition(a)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),Be(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=ee(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=ee(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){ve(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(Ee(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(Ee(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(t||t===void 0)&&this.updateMetrics()}setOrigin(e,t){this.origin=new Te(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}};oi.scrollbarThickness=v_?25:15,oi.DEFAULT_SCROLLBAR_MARGIN=.5;var Tc={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},ch={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:Ec,DOMParser:la,XMLSerializer:aa}=globalThis;la&&(Tc=new la),aa&&(ch=new aa);var F_="https://developers.google.com/blockly/xml",Df=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,Yr={NAME_SPACE:F_};Yr.createElement=l.createElement$$module$build$src$core$utils$xml,Yr.createTextNode=l.createTextNode$$module$build$src$core$utils$xml,Yr.domToText=fi,Yr.injectDependencies=Ht,Yr.textToDom=l.textToDom$$module$build$src$core$utils$xml;var uh="categoryToolbox",U_="flyoutToolbox",lt;(function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"})(lt||(lt={}));var H_={hasCategoriesInternal:Jt},uo={};uo.Position=lt,uo.TEST_ONLY=H_,uo.convertFlyoutDefToJsonArray=ei,uo.convertToolboxDefToJson=Kt,uo.hasCategories=De,uo.isCategoryCollapsible=Ci,uo.parseToolboxTree=Zt;var Fn;(function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"})(Fn||(Fn={}));var jr;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"})(jr||(jr={}));var ho;(function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"})(ho||(ho={}));var Xo={};Xo.bumpDirection=ho,Xo.bumpPositionRect=Bs,Xo.getCornerOppositeToolbox=hi,Xo.getStartPositionRect=mi,Xo.horizontalPosition=jr,Xo.verticalPosition=Fn;var zi={width:96,height:124,url:"sprites.png"},G_=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=J(Y.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[bi.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&M(this.svgGroup);for(const e of this.boundEvents)Ee(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new Nt(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){if(this.initialized){var s=hi(this.workspace,e),a=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(a+=this.LARGE_SPACING+this.HEIGHT),e=mi(s,new bt(this.WIDTH,a),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),s=s.vertical,t=Bs(e,this.MARGIN_VERTICAL,s===Fn.TOP?ho.DOWN:ho.UP,t),s===Fn.TOP){var d=this.SMALL_SPACING+this.HEIGHT,f;(f=this.zoomInGroup)==null||f.setAttribute("transform","translate(0, "+d+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(d+this.LARGE_SPACING+this.HEIGHT)+")")}else{f=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0;let x;(x=this.zoomInGroup)==null||x.setAttribute("transform","translate(0, "+f+")"),f=f+this.SMALL_SPACING+this.HEIGHT,(d=this.zoomOutGroup)==null||d.setAttribute("transform","translate(0, "+f+")")}this.top=t.top,this.left=t.left;var S;(S=this.svgGroup)==null||S.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=J(Y.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const t=J(Y.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);J(Y.RECT,{width:32,height:32},t),J(Y.IMAGE,{width:zi.width,height:zi.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(fs,"xlink:href",this.workspace.options.pathToMedia+zi.url),this.boundEvents.push(ee(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=J(Y.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const t=J(Y.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);J(Y.RECT,{width:32,height:32},t),J(Y.IMAGE,{width:zi.width,height:zi.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(fs,"xlink:href",this.workspace.options.pathToMedia+zi.url),this.boundEvents.push(ee(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),ve(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=J(Y.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const t=J(Y.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);J(Y.RECT,{width:32,height:32},t),J(Y.IMAGE,{width:zi.width,height:zi.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(fs,"xlink:href",this.workspace.options.pathToMedia+zi.url),this.boundEvents.push(ee(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),ve(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(j(Nn))(null,this.workspace.id,"zoom_controls");B(e)}};Ue(`
.blocklyZoom>image, .blocklyZoom>svg>image {
  opacity: .4;
}

.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {
  opacity: .6;
}

.blocklyZoom>image:active, .blocklyZoom>svg>image:active {
  opacity: .8;
}
`);var ca="_TEMP_COLLAPSED_INPUT",bc="_TEMP_COLLAPSED_FIELD",Rs="MANUALLY_DISABLED",Bf={COLLAPSED_FIELD_NAME:bc,COLLAPSED_INPUT_NAME:ca,MANUALLY_DISABLED:Rs},_i=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};_i.MUTATOR=new _i("mutator"),_i.WARNING=new _i("warning"),_i.COMMENT=new _i("comment"),function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"}(l.inputTypes$$module$build$src$core$inputs$input_types||(l.inputTypes$$module$build$src$core$inputs$input_types={})),l.inputTypes$$module$build$src$core$inputs$input_types;var V_=function(e,t){window.alert(e),t&&t()},W_=function(e,t){t(window.confirm(e))},z_=function(e,t,s){s(window.prompt(e,t))},X_={confirmInternal:Si},Yo={TEST_ONLY:X_};Yo.alert=Fs,Yo.confirm=ji,Yo.prompt=os,Yo.setAlert=li,Yo.setConfirm=Tn,Yo.setPrompt=ai;var hh,Y_;l.Msg$$module$build$src$core$msg=Object.create(null),hh=function(e){Object.keys(e).forEach(function(t){l.Msg$$module$build$src$core$msg[t]=e[t]})},Y_={Msg:l.Msg$$module$build$src$core$msg,setLocale:hh};var ua=class extends Xr{constructor(e){super(),this.isBlank=typeof e>"u",e&&(this.varId=e.getId(),this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new ua),t.varId=e.varId,t}},dh=class extends ua{constructor(e){super(e),this.type=Ln,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new dh),t.varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.createVariable(this.varName,this.varType,this.varId):t.deleteVariableById(this.varId)}};h(pe.EVENT,Ln,dh);var ha=class{constructor(e,t,s,a){this.workspace=e,this.name=t,this.type=s||"",this.id_=a||D()}getId(){return this.id_}static compareByName(e,t){return e.name.localeCompare(t.name,void 0,{sensitivity:"base"})}},_h="VARIABLE",ph="ijkmnopqrstuvwxyzabcdefgh",j_={generateUniqueNameInternal:Oi},Li={CATEGORY_NAME:_h,TEST_ONLY:j_,VAR_LETTER_OPTIONS:ph};Li.allDeveloperVariables=l.allDeveloperVariables$$module$build$src$core$variables,Li.allUsedVarModels=l.allUsedVarModels$$module$build$src$core$variables,Li.createVariableButtonHandler=Ni,Li.flyoutCategory=tn,Li.flyoutCategoryBlocks=Vt,Li.generateUniqueName=Ri,Li.generateUniqueNameFromOptions=bs,Li.generateVariableFieldDom=Ze,Li.getAddedVariables=Ki,Li.getOrCreateVariablePackage=l.getOrCreateVariablePackage$$module$build$src$core$variables,Li.getVariable=l.getVariable$$module$build$src$core$variables,Li.nameUsedWithAnyType=ui,Li.nameUsedWithConflictingParam=Di,Li.promptName=et,Li.renameVariable=l.renameVariable$$module$build$src$core$variables;var vc=new Set,fh=new WeakSet,gh=new WeakMap,Kr=null,mh=null,K_=0,yc={};yc.finishQueuedRenders=_t,yc.queueRender=vs,yc.triggerQueuedRenders=$i;var Ic=class{constructor(e,t){this.workspace=e,this.text="",this.size=new bt(120,100),this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new Te(0,0),this.disposing=this.disposed=!1,this.id=t&&!e.getCommentById(t)?t:D(),e.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){se()&&B(new(j(Mn))(this))}fireDeleteEvent(){se()&&B(new(j(Wr))(this))}fireChangeEvent(e,t){se()&&B(new(j(zr))(this,e,t))}fireCollapseEvent(e){se()&&B(new(j(ia))(this,e))}setText(e){const t=this.text;this.text=e,this.fireChangeEvent(t,e)}getText(){return this.text}setSize(e){this.size=e}getSize(){return this.size}setCollapsed(e){this.collapsed=e,this.fireCollapseEvent(e)}isCollapsed(){return this.collapsed}setEditable(e){this.editable=e}isEditable(){return this.isOwnEditable()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable}setMovable(e){this.movable=e}isMovable(){return this.isOwnMovable()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable}setDeletable(e){this.deletable=e}isDeletable(){return this.isOwnDeletable()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable}moveTo(e,t){const s=new(j(xn))(this);t&&s.setReason(t),this.location=e,s.recordNew(),se()&&B(s)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}},Jr=50,$h=100,J_=class{constructor(e){this.workspace=e,this.size=new bt(120,100),this.collapsed=!1,this.editable=!0,this.location=new Te(0,0),this.text="",this.textChangeListeners=[],this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=J(Y.G,{class:"blocklyComment blocklyEditable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),{topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteIcon:this.deleteIcon,foldoutIcon:this.foldoutIcon,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot,e),{foreignObject:this.foreignObject,textArea:this.textArea}=this.createTextArea(this.svgRoot),this.resizeHandle=this.createResizeHandle(this.svgRoot,e);let t;(t=e.getLayerManager())==null||t.append(this,Jr),this.setSize(this.size),this.moveTo(new Te(0,0))}createHighlightRect(e){return J(Y.RECT,{class:"blocklyCommentHighlight"},e)}createTopBar(e,t){e=J(Y.G,{class:"blocklyCommentTopbar"},e);const s=J(Y.RECT,{class:"blocklyCommentTopbarBackground"},e),a=J(Y.IMAGE,{class:"blocklyDeleteIcon",href:`${t.options.pathToMedia}delete-icon.svg`},e);t=J(Y.IMAGE,{class:"blocklyFoldoutIcon",href:`${t.options.pathToMedia}foldout-icon.svg`},e);const d=J(Y.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},e),f=document.createTextNode("");return d.appendChild(f),ee(t,"pointerdown",this,this.onFoldoutDown),ee(a,"pointerdown",this,this.onDeleteDown),{topBarGroup:e,topBarBackground:s,deleteIcon:a,foldoutIcon:t,textPreview:d,textPreviewNode:f}}createTextArea(e){e=J(Y.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"},e);const t=document.createElementNS(dn,"body");t.setAttribute("xmlns",dn),t.className="blocklyMinimalBody";const s=document.createElementNS(dn,"textarea");return $e(s,"blocklyCommentText"),$e(s,"blocklyTextarea"),$e(s,"blocklyText"),t.appendChild(s),e.appendChild(t),ee(s,"change",this,this.onTextChange),{foreignObject:e,textArea:s}}createResizeHandle(e,t){return e=J(Y.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),ee(e,"pointerdown",this,this.onResizePointerDown),e}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSize(e){const t=this.topBarBackground.getBBox(),s=this.deleteIcon.getBBox(),a=this.foldoutIcon.getBBox(),d=this.textPreview.getBBox(),f=this.resizeHandle.getBBox();e=bt.max(e,this.calcMinSize(t,a,s));const S=this.size;this.size=e,this.svgRoot.setAttribute("height",`${e.height}`),this.svgRoot.setAttribute("width",`${e.width}`),this.updateHighlightRect(e),this.updateTopBarSize(e),this.updateTextAreaSize(e,t),this.updateDeleteIconPosition(e,t,s),this.updateFoldoutIconPosition(t,a),this.updateTextPreviewSize(e,t,d,s,f),this.updateResizeHandlePosition(e,f),this.onSizeChange(S,this.size)}calcMinSize(e,t,s){var a;this.updateTextPreview((a=this.textArea.value)!=null?a:""),a=dt(this.textPreview);const d=this.calcFoldoutMargin(e,t),f=this.calcDeleteMargin(e,s);let S=a;return this.foldoutIcon.checkVisibility()?S+=t.width+2*d:a&&(S+=4),this.deleteIcon.checkVisibility()?S+=s.width+2*f:a&&(S+=4),new bt(S,e.height+20)}calcDeleteMargin(e,t){return(e.height-t.height)/2}calcFoldoutMargin(e,t){return(e.height-t.height)/2}updateHighlightRect(e){this.highlightRect.setAttribute("height",`${e.height}`),this.highlightRect.setAttribute("width",`${e.width}`),this.workspace.RTL&&this.highlightRect.setAttribute("x",`${-e.width}`)}updateTopBarSize(e){this.topBarBackground.setAttribute("width",`${e.width}`)}updateTextAreaSize(e,t){this.foreignObject.setAttribute("height",`${e.height-t.height}`),this.foreignObject.setAttribute("width",`${e.width}`),this.foreignObject.setAttribute("y",`${t.height}`),this.workspace.RTL&&this.foreignObject.setAttribute("x",`${-e.width}`)}updateDeleteIconPosition(e,t,s){t=this.calcDeleteMargin(t,s),this.deleteIcon.setAttribute("y",`${t}`),this.deleteIcon.setAttribute("x",`${e.width-s.width-t}`)}updateFoldoutIconPosition(e,t){e=this.calcFoldoutMargin(e,t),this.foldoutIcon.setAttribute("y",`${e}`),this.foldoutIcon.setAttribute("x",`${e}`)}updateTextPreviewSize(e,t,s,a,d){const f=(t.height-s.height)/2,S=this.calcDeleteMargin(t,a);t=this.calcFoldoutMargin(t,d),e=e.width-d.width-2*t-a.width-2*S,this.textPreview.setAttribute("x",`${d.width+2*t*(this.workspace.RTL?-1:1)}`),this.textPreview.setAttribute("y",`${f+s.height/2}`),this.textPreview.setAttribute("width",`${e}`)}updateResizeHandlePosition(e,t){this.resizeHandle.setAttribute("y",`${e.height-t.height}`),this.resizeHandle.setAttribute("x",`${e.width-t.width}`)}onSizeChange(e,t){for(let s=this.sizeChangeListeners.length-1;0<=s;s--)this.sizeChangeListeners[s](e,t)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}removeSizeChangeListener(e){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(e),1)}onResizePointerDown(e){this.isEditable()&&(this.bringToFront(),Be(e)||(this.workspace.startDrag(e,new Te(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=ee(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=ee(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation())}onResizePointerUp(e){ve(),this.resizePointerUpListener&&(Ee(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(Ee(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new bt(this.workspace.RTL?-e.x:e.x,e.y))}isCollapsed(){return this.collapsed}setCollapsed(e){(this.collapsed=e)?$e(this.svgRoot,"blocklyCollapsed"):ke(this.svgRoot,"blocklyCollapsed"),this.setSize(this.size),this.onCollapse()}onCollapse(){for(let e=this.collapseChangeListeners.length-1;0<=e;e--)this.collapseChangeListeners[e](this.collapsed)}addOnCollapseListener(e){this.collapseChangeListeners.push(e)}removeOnCollapseListener(e){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(e),1)}onFoldoutDown(e){this.bringToFront(),Be(e)||(this.setCollapsed(!this.collapsed),this.workspace.hideChaff()),e.stopPropagation()}isEditable(){return this.editable}setEditable(e){(this.editable=e)?($e(this.svgRoot,"blocklyEditable"),ke(this.svgRoot,"blocklyReadonly"),this.textArea.removeAttribute("readonly")):(ke(this.svgRoot,"blocklyEditable"),$e(this.svgRoot,"blocklyReadonly"),this.textArea.setAttribute("readonly","true"))}getRelativeToSurfaceXY(){return this.location}moveTo(e){this.location=e,this.svgRoot.setAttribute("transform",`translate(${e.x}, ${e.y})`)}getText(){return this.text}setText(e){this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}removeTextChangeListener(e){this.textChangeListeners.splice(this.textChangeListeners.indexOf(e),1)}onTextChange(){const e=this.text;this.text=this.textArea.value,this.updateTextPreview(this.text),this.setSize(this.size);for(let t=this.textChangeListeners.length-1;0<=t;t--)this.textChangeListeners[t](e,this.text)}updateTextPreview(e){this.textPreviewNode.textContent=this.truncateText(e)}truncateText(e){return 12<=e.length?`${e.substring(0,9)}...`:e}bringToFront(){const e=this.svgRoot.parentNode,t=e.childNodes;t[t.length-1]!==this.svgRoot&&e.appendChild(this.svgRoot)}onDeleteDown(e){Be(e)||this.dispose(),e.stopPropagation()}dispose(){this.disposing=!0,M(this.svgRoot);for(let e=this.disposeListeners.length-1;0<=e;e--)this.disposeListeners[e]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(e){this.disposeListeners.push(e)}removeDisposeListener(e){this.disposeListeners.splice(this.disposeListeners.indexOf(e),1)}};Ue(`
.injectionDiv {
  --commentFillColour: #FFFCC7;
  --commentBorderColour: #F2E49B;
}

.blocklyComment .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 1px solid var(--commentBorderColour);
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}

.blocklyReadonly.blocklyComment .blocklyTextarea {
  cursor: inherit;
}

.blocklyDeleteIcon {
  width: 20px;
  height: 20px;
  display: none;
  cursor: pointer;
}

.blocklyFoldoutIcon {
  width: 20px;
  height: 20px;
  transform-origin: 12px 12px;
  cursor: pointer;
}
.blocklyResizeHandle {
  width: 12px;
  height: 12px;
  cursor: se-resize;
}
.blocklyReadonly.blocklyComment .blocklyResizeHandle {
  cursor: inherit;
}

.blocklyCommentTopbarBackground {
  cursor: grab;
  fill: var(--commentBorderColour);
  height: 24px;
}

.blocklyComment .blocklyCommentPreview.blocklyText {
  fill: #000;
  dominant-baseline: middle;
  visibility: hidden;
}

.blocklyCollapsed.blocklyComment .blocklyCommentPreview {
  visibility: visible;
}

.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,
.blocklyCollapsed.blocklyComment .blocklyResizeHandle {
  display: none;
}

.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {
  transform: rotate(-90deg);
}

.blocklyRTL .blocklyCommentTopbar {
  transform: scale(-1, 1);
}

.blocklyRTL .blocklyCommentForeignObject {
  direction: rtl;
}

.blocklyRTL .blocklyCommentPreview {
  /* Revert the scale and control RTL using direction instead. */
  transform: scale(-1, 1);
  direction: rtl;
}

.blocklyRTL .blocklyResizeHandle {
  transform: scale(-1, 1);
  cursor: sw-resize;
}

.blocklyCommentHighlight {
  fill: none;
}

.blocklySelected .blocklyCommentHighlight {
  stroke: #fc3;
  stroke-width: 3px;
}

.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {
  stroke: none;
}

.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {
  stroke: #fc3;
  stroke-width: 3px;
}
`);var Z_=class{constructor(e){this.comment=e,this.startLoc=null,this.workspace=e.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.workspace.options.readOnly}startDrag(){l.getGroup$$module$build$src$core$events$utils()||l.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(e){this.comment.moveDuringDrag(e)}endDrag(){this.fireMoveEvent();let e;(e=this.workspace.getLayerManager())==null||e.moveOffDragLayer(this.comment,Jr),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0),l.setGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent(){if(!this.comment.isDeadOrDying()){var e=new(j(xn))(this.comment);e.setReason(["drag"]),e.oldCoordinate_=this.startLoc,e.recordNew(),B(e)}}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},q_=100,Q_=75,ep=50,tp=25,Ff={BLOCKS:ep,PROCEDURES:Q_,VARIABLES:q_,WORKSPACE_COMMENTS:tp},Th={};Th.register=Ji,Th.unregister=ys;var ip=class{constructor(){this.priority=tp}save(e){const t=[];for(const s of e.getTopComments())(e=ii(s,{addCoordinates:!0,saveIds:!0}))&&t.push(e);return t.length?t:null}load(e,t){for(const s of e)as(s,t,{recordUndo:V()})}clear(e){for(const t of e.getTopComments())t.dispose()}};Ji("workspaceComments",new ip);var Sc={};Sc.WorkspaceCommentSerializer=ip,Sc.append=as,Sc.save=ii;var Eh={};Eh.register=Us,Eh.unregister=ar;var Oc=class{paste(e,t,s){e=e.commentState,s&&(e.x=s.x,e.y=s.y),l.disable$$module$build$src$core$events$utils();let a;try{a=as(e,t),cr(a)}finally{l.enable$$module$build$src$core$events$utils()}return a?(se()&&B(new(j(Mn))(a)),l.setSelected$$module$build$src$core$common(a),a):null}};Oc.TYPE="workspace-comment",Us(Oc.TYPE,new Oc);var bh;bh=28,l.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:bh,connectingSnapRadius:bh,currentConnectionPreference:8,bumpDelay:250},l.config$$module$build$src$core$config;var Uf="aria-",Hf="role",js;(function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem"})(js||(js={}));var vi;(function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin"})(vi||(vi={}));var da={};da.Role=js,da.State=vi,da.setRole=Hs,da.setState=si;var vh=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const t=document.createElement("div");t.className="blocklyMenu goog-menu blocklyNonSelectable",t.tabIndex=0,this.roleName&&Hs(t,this.roleName),this.element=t;for(let s=0,a;a=this.menuItems[s];s++)t.appendChild(a.createDom());return this.mouseOverHandler=ee(t,"pointerover",this,this.handleMouseOver,!0),this.clickHandler=ee(t,"pointerup",this,this.handleClick,!0),this.mouseEnterHandler=ee(t,"pointerenter",this,this.handleMouseEnter,!0),this.mouseLeaveHandler=ee(t,"pointerleave",this,this.handleMouseLeave,!0),this.onKeyDownHandler=ee(t,"keydown",this,this.handleKeyEvent),e.appendChild(t),t}getElement(){return this.element}focus(){const e=this.getElement();e&&(e.focus({preventScroll:!0}),$e(e,"blocklyFocused"))}blur(){const e=this.getElement();e&&(e.blur(),ke(e,"blocklyFocused"))}setRole(e){this.roleName=e}dispose(){this.mouseOverHandler&&(Ee(this.mouseOverHandler),this.mouseOverHandler=null),this.clickHandler&&(Ee(this.clickHandler),this.clickHandler=null),this.mouseEnterHandler&&(Ee(this.mouseEnterHandler),this.mouseEnterHandler=null),this.mouseLeaveHandler&&(Ee(this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.onKeyDownHandler&&(Ee(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e=0,t;t=this.menuItems[e];e++)t.dispose();this.element=null}getMenuItem(e){const t=this.getElement();for(;e&&e!==t;){if(e.classList.contains("blocklyMenuItem")){for(let s=0,a;a=this.menuItems[s];s++)if(a.getElement()===e)return a}e=e.parentElement}return null}setHighlighted(e){var t=this.highlightedItem;t&&(t.setHighlighted(!1),this.highlightedItem=null),e&&(e.setHighlighted(!0),this.highlightedItem=e,t=this.getElement(),rt(e.getElement(),t),si(t,vi.ACTIVEDESCENDANT,e.getId()))}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){e+=t;let s;for(;s=this.menuItems[e];){if(s.isEnabled()){this.setHighlighted(s);break}e+=t}}handleMouseOver(e){(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){const t=this.openingCoords;if(this.openingCoords=null,t&&typeof e.clientX=="number"){const s=new Te(e.clientX,e.clientY);if(1>Te.distance(t,s))return}(e=this.getMenuItem(e.target))&&e.performAction()}handleMouseEnter(e){this.focus()}handleMouseLeave(e){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),t=A(e);return t.height=e.scrollHeight,t}},yh=class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=N(),this.element=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const t=document.createElement("div");if(t.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var s=document.createElement("div");s.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",t.appendChild(s)}return s=this.content,typeof this.content=="string"&&(s=document.createTextNode(this.content)),t.appendChild(s),e.appendChild(t),this.roleName&&Hs(e,this.roleName),si(e,vi.SELECTED,this.checkable&&this.checked||!1),si(e,vi.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return(e=this.opt_value)!=null?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const t=this.getElement();t&&this.isEnabled()&&(e?($e(t,"blocklyMenuItemHighlight"),$e(t,"goog-menuitem-highlight")):(ke(t,"blocklyMenuItemHighlight"),ke(t,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(e,t){this.actionHandler=e.bind(t)}},Zr=class extends Error{},sp=class extends Zr{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},_a=class extends Zr{constructor(e,t,s){super(`The block ${t.toDevString()} is missing a(n) ${e}
connection`),this.block=t,this.state=s}},np=class extends Zr{constructor(e,t,s,a){super(`The block ${s.toDevString()} could not connect its
${t} to its parent, because: ${e}`),this.childBlock=s,this.childState=a}},op=class extends Zr{constructor(e){super(`Encountered a real block which is defined as a child of a shadow
block. It is an invariant of Blockly that shadow blocks only have shadow
children`),this.state=e}},rp=class extends Zr{constructor(e,t,s){super(`Cannot add an icon of type '${e}' to the block ${t.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=t,this.state=s}},jo={};jo.BadConnectionCheck=np,jo.DeserializationError=Zr,jo.MissingBlockType=sp,jo.MissingConnection=_a,jo.RealChildOfShadow=op,jo.UnregisteredIcon=rp;var lp=class{constructor(){this.priority=ep}save(e){const t=[];for(const s of e.getTopBlocks(!1))(e=qe(s,{addCoordinates:!0,doFullSerialization:!1}))&&t.push(e);return t.length?{languageVersion:0,blocks:t}:null}load(e,t){e=e.blocks;for(const s of e)Bi(s,t,{recordUndo:V()})}clear(e){for(const t of e.getTopBlocks(!1))t.dispose(!1)}};Ji("blocks",new lp);var pa={};pa.BlockSerializer=lp,pa.append=Bi,pa.appendInternal=zt,pa.save=qe;var Ko=class extends Xr{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Ko),t.blockId=e.blockId,t}},Jo=class extends Ko{constructor(e,t,s,a,d){super(e),this.type=l.CHANGE$$module$build$src$core$events$utils,e&&(this.element=t,this.name=s||void 0,this.oldValue=a,this.newValue=d)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,this.disabledReason&&(e.disabledReason=this.disabledReason),e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Jo),t.element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,e.disabledReason!==void 0&&(t.disabledReason=e.disabledReason),t}setDisabledReason(e){if(this.element!=="disabled")throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=e}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(t=t.getBlockById(this.blockId),!t)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");const s=t.getIcon(_i.MUTATOR);switch(s&&bn(s)&&s.bubbleIsVisible()&&s.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":var a;t.setDisabledReason(!!e,(a=this.disabledReason)!=null?a:Rs);break;case"inline":t.setInputsInline(!!e);break;case"mutation":a=Jo.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation(l.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),B(new Jo(t,"mutation",null,a,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?Os(e):""}};h(pe.EVENT,l.CHANGE$$module$build$src$core$events$utils,Jo);var kc={};kc.clamp=Jn,kc.toDegrees=fr,kc.toRadians=pr;var Cc=16,ap=1,cp=12,Ih=16,Rc=.25,Sh=null,Zo=null,qr="",Qr="",Ot,el,qo,Oh=null,_o=null,up=null,kh={getBoundsInfo:function(){const e=xe(Oh),t=A(Oh);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,s,a){const d=kh.getBoundsInfo(),f=A(Ot);return t+f.height<d.bottom?Ol(e,t,d,f):a-f.height>d.top?br(s,a,d,f):t+f.height<document.documentElement.clientHeight?Ol(e,t,d,f):a-f.height>document.documentElement.clientTop?br(s,a,d,f):kl(e,d,f)}},xi={ANIMATION_TIME:Rc,ARROW_HORIZONTAL_PADDING:cp,ARROW_SIZE:Cc,BORDER_SIZE:ap,PADDING_Y:Ih,TEST_ONLY:kh};xi.clearContent=mr,xi.createDom=gr,xi.getContentDiv=Zn,xi.getOwner=Sl,xi.getPositionX=Io,xi.hide=vr,xi.hideIfOwner=qn,xi.hideWithoutAnimation=us,xi.isVisible=Cl,xi.repositionForWindowResize=Qn,xi.setBoundsElement=Il,xi.setColour=Zi,xi.show=yo,xi.showPositionedByBlock=Fa,xi.showPositionedByField=$r;var fa=class{constructor(e){this.workspace=e,this.cursorSvg_=this.cursor_=null,this.markers=new Map,this.markerSvg_=null}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),t.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,t)),this.setMarkerSvg(t.getDrawer().createDom()),this.markers.set(e,t)}unregisterMarker(e){const t=this.markers.get(e);if(t)t.dispose(),this.markers.delete(e);else throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.")}getCursor(){return this.cursor_}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=e)&&(e=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom()))}setCursorSvg(e){e?(this.workspace.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null}setMarkerSvg(e){e?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(e)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const e=Object.keys(this.markers);for(let t=0,s;s=e[t];t++)this.unregisterMarker(s);this.markers.clear(),this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};fa.LOCAL_MARKER="local_marker_1";var tl={};tl.commonWordPrefix=Rl,tl.commonWordSuffix=vn,tl.isNumber=l.isNumber$$module$build$src$core$utils$string,tl.shortestStringLength=hs,tl.wrap=l.wrap$$module$build$src$core$utils$string;var wc=void 0,ga=!1,il=!1,hp=50,dp=0,Qo=0,Ch=0,Rh=0,ws=null,ma=null,wh=0,Ah=10,_p=10,pp=750,Ac=5,pi=null,gs={HOVER_MS:pp,LIMIT:hp,MARGINS:Ac,OFFSET_X:wh,OFFSET_Y:Ah,RADIUS_OK:_p};gs.bindMouseEvents=ds,gs.block=Cr,gs.createDom=Hi,gs.dispose=Al,gs.getCustomTooltip=Or,gs.getDiv=Ga,gs.getTooltipOfObject=yn,gs.hide=Gi,gs.isVisible=Ha,gs.setCustomTooltip=Sr,gs.unbindMouseEvents=kr,gs.unblock=eo;var Lh=.45,Nh=.65,fp={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},As={};As.blend=on,As.getHsvSaturation=ko,As.getHsvValue=_s,As.hexToRgb=Qi,As.hsvToHex=In,As.hueToHex=Ro,As.names=fp,As.parse=qi,As.rgbToHex=Co,As.setHsvSaturation=Xa,As.setHsvValue=Ya;var $a={};$a.checkMessageReferences=On,$a.parseBlockColour=Ws,$a.replaceMessageReferences=Dt,$a.tokenizeInterpolation=wo;var Mt=class{constructor(e,t,s){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new bt(0,0),e!==Mt.SKIP_SETUP&&(s&&this.configure_(s),this.setValue(e),t&&this.setValidator(t))}configure_(e){e.tooltip&&this.setTooltip(Dt(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=J(Y.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel(),this.applyColour())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=J(Y.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=J(Y.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");ds(e),this.mouseDownWrapper_=ee(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return e=this.saveLegacyState(Mt),e!==null?e:this.getValue()}loadState(e){this.loadLegacyState(Mt,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?(e=l.createElement$$module$build$src$core$utils$xml("field"),e.setAttribute("name",this.name||""),fi(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml?(this.fromXml(l.textToDom$$module$build$src$core$utils$xml(t)),!0):!1}dispose(){qn(this),Cn(this);let e;(e=this.getSourceBlock())!=null&&e.isDeadOrDying()||M(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?($e(e,"blocklyEditableText"),ke(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):($e(e,"blocklyNonEditableText"),ke(e,"blocklyEditableText"),e.style.cursor=""))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==Mt.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var t=this.fieldGroup_;t&&(t.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const t=this.getConstants();e=e!==void 0?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING;let s=2*e,a=t.FIELD_TEXT_HEIGHT,d=0;this.textElement_&&(d=Xe(this.textElement_,t.FIELD_TEXT_FONTSIZE,t.FIELD_TEXT_FONTWEIGHT,t.FIELD_TEXT_FONTFAMILY),s+=d),this.isFullBlockField()||(a=Math.max(a,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=a,this.size_.width=s,this.positionTextElement_(e,d),this.positionBorderRect_()}positionTextElement_(e,t){if(this.textElement_){var s=this.getConstants(),a=this.size_.height/2,d;this.textElement_.setAttribute("x",String((d=this.getSourceBlock())!=null&&d.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(s.FIELD_TEXT_BASELINE_CENTER?a:a-s.FIELD_TEXT_HEIGHT/2+s.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&this.size_.width===0&&(this.render_(),this.size_.width!==0&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new bt(0,0)}getScaledBBox(){let e;var t=this.getSourceBlock();if(!t)throw new ri;if(this.isFullBlockField()){var s=this.sourceBlock_.getHeightWidth();const a=t.workspace.scale;e=this.getAbsoluteXY_(),t=(s.width+1)*a,s=(s.height+1)*a,w_?(e.x+=1.5*a,e.y+=1.5*a):(e.x-=.5*a,e.y-=.5*a)}else s=this.borderRect_.getBoundingClientRect(),e=xe(this.borderRect_),t=s.width,s=s.height;return new Nt(e.y,e.y+s,e.x,e.x+t)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+"…"),e=e.replace(/\s/g,Mt.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="‏"),e):Mt.NBSP}getText(){const e=this.getText_();return String(e!==null?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(e,t=!0){if(e!==null){var s=this.doClassValidation_(e);if(e=this.processValidation_(e,s,t),!(e instanceof Error)){var a;s=(a=this.getValidator())==null?void 0:a.call(this,e),a=this.processValidation_(e,s,t),a instanceof Error||(e=this.sourceBlock_,e&&e.disposed||(s=this.getValue(),s===a?this.doValueUpdate_(a):(this.doValueUpdate_(a),t&&e&&se()&&B(new(j(l.CHANGE$$module$build$src$core$events$utils))(e,"field",this.name||null,s,a)),this.isDirty_&&this.forceRerender())))}}}processValidation_(e,t,s){return t===null?(this.doValueInvalid_(e,s),this.isDirty_&&this.forceRerender(),Error()):t===void 0?e:t}getValue(){return this.value_}doClassValidation_(e){return e??null}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e,t){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||e===""||(e=this.sourceBlock_);const t=this.getClickTarget_();t?t.tooltip=e:this.tooltip_=e}getTooltip(){const e=this.getClickTarget_();return yn(e||{tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return xe(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const t=this.getSourceBlock();if(!t)throw new ri;const s=t.inputList;for(let a=0;a<t.inputList.length;a++){const d=s[a],f=d.fieldRow;for(let S=0;S<f.length;S++)if(f[S]===this){e=d;break}}return e}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(e){return!1}setCursorSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.cursorSvg_=e}else this.cursorSvg_=null}setMarkerSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.markerSvg_=e}else this.markerSvg_=null}updateMarkers_(){var e=this.getSourceBlock();if(!e)throw new ri;e=e.workspace,e.keyboardAccessibilityMode&&this.cursorSvg_&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg_&&e.getMarker(fa.LOCAL_MARKER).draw()}static fromJson(e){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}};Mt.NBSP=" ",Mt.SKIP_SETUP=Symbol("SKIP_SETUP");var ri=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},sl=null,Mh=null,Lc=null,Nc="blocklyWidgetDiv",nl="",ol="",Ks,Js={};Js.createDom=Nl,Js.getDiv=rn,Js.hide=to,Js.hideIfOwner=Cn,Js.hideIfOwnerIsInWorkspace=io,Js.isVisible=Rr,Js.positionWithAnchor=es,Js.repositionForWindowResize=xl,Js.show=kn,Js.testOnly_setDiv=Ll;var Mc=null,gp={},xc=null,er={};er.callbackFactory=l.callbackFactory$$module$build$src$core$contextmenu,er.dispose=ps,er.getCurrentBlock=Pl,er.hide=No,er.setCurrentBlock=Dl,er.show=zs;var ct=class{constructor(){this.registry_=new Map,this.reset()}reset(){this.registry_.clear()}register(e){if(this.registry_.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registry_.set(e.id,e)}unregister(e){if(!this.registry_.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registry_.delete(e)}getItem(e){let t;return(t=this.registry_.get(e))!=null?t:null}getContextMenuOptions(e,t){const s=[];for(const d of this.registry_.values())if(e===d.scopeType){var a=d.preconditionFn(t);a!=="hidden"&&(a={text:typeof d.displayText=="function"?d.displayText(t):d.displayText,enabled:a==="enabled",callback:d.callback,scope:t,weight:d.weight},s.push(a))}return s.sort(function(d,f){return d.weight-f.weight}),s}};(function(e){var t=e.ScopeType||(e.ScopeType={});t.BLOCK="block",t.WORKSPACE="workspace",t.COMMENT="comment",e.registry=new e})(ct||(ct={})),ct.ScopeType;var Pc=class extends Ic{constructor(e,t){super(e,t),this.dragStrategy=new Z_(this),this.workspace=e,this.view=new J_(e),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.addModelUpdateBindings(),ee(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),ee(this.view.getSvgRoot(),"wheel",this,s=>{s.stopPropagation()})}addModelUpdateBindings(){this.view.addTextChangeListener((e,t)=>void super.setText(t)),this.view.addSizeChangeListener((e,t)=>void super.setSize(t)),this.view.addOnCollapseListener(()=>void super.setCollapsed(this.view.isCollapsed())),this.view.addDisposeListener(()=>{this.isDeadOrDying()||this.dispose()})}setText(e){this.view.setText(e)}setSize(e){this.view.setSize(e)}setCollapsed(e){this.view.setCollapsed(e)}setEditable(e){super.setEditable(e),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY();var t,s;const a=(s=(t=this.view)==null?void 0:t.getSize())!=null?s:this.getSize();return this.workspace.RTL?(t=e.x-a.width,s=e.x):(t=e.x,s=e.x+a.width),new Nt(e.y,e.y+a.height,t,s)}moveBy(e,t,s){const a=this.getRelativeToSurfaceXY();e=new Te(a.x+e,a.y+t),this.moveTo(e,s)}moveTo(e,t){super.moveTo(e,t),this.view.moveTo(e)}moveDuringDrag(e){this.location=e,this.view.moveTo(e)}setDragging(e){e?$e(this.getSvgRoot(),"blocklyDragging"):ke(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0,this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(e){const t=this.workspace.getGesture(e);t&&(t.handleCommentStart(e,this),l.setSelected$$module$build$src$core$common(this))}setDeleteStyle(e){e?$e(this.getSvgRoot(),"blocklyDraggingDelete"):ke(this.getSvgRoot(),"blocklyDraggingDelete")}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){$e(this.getSvgRoot(),"blocklySelected")}unselect(){ke(this.getSvgRoot(),"blocklySelected")}toCopyData(){return{paster:Oc.TYPE,commentState:ii(this,{addCoordinates:!0})}}showContextMenu(e){const t=ct.registry.getContextMenuOptions(ct.ScopeType.COMMENT,{comment:this});zs(e,t,this.workspace.RTL,this.workspace)}snapToGrid(){if(!this.isDeadOrDying()){var e=this.workspace.getGrid();if(e!=null&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();e=e.alignXY(t),e!==t&&this.moveTo(e,["snap"])}}}},Pi={};Pi.appendDomToWorkspace=Vl,Pi.blockToDom=Xs,Pi.blockToDomWithXY=Mo,Pi.clearWorkspaceAndLoadFromXml=Gl,Pi.deleteNext=K,Pi.domToBlock=l.domToBlock$$module$build$src$core$xml,Pi.domToBlockInternal=ln,Pi.domToPrettyText=Hl,Pi.domToText=Os,Pi.domToVariables=Wl,Pi.domToWorkspace=l.domToWorkspace$$module$build$src$core$xml,Pi.loadWorkspaceComment=Ar,Pi.saveWorkspaceComment=so,Pi.variablesToDom=wn,Pi.workspaceToDom=Ul;var xh=class extends Ko{constructor(e){super(e),this.type=l.CREATE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Mo(e),this.ids=he(e),this.json=qe(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Os(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new xh),t.xml=l.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,e.recordUndo!==void 0&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!Gf(t,this.ids))if(e)Bi(this.json,t);else for(e=0;e<this.ids.length;e++){const s=this.ids[e],a=t.getBlockById(s);a?a.dispose(!1):s===this.blockId&&console.warn("Can't uncreate non-existent block: "+s)}}},Gf=function(e,t){return t.map(s=>e.getBlockById(s)).filter(s=>s&&s.isShadow()).length===t.length};h(pe.EVENT,l.CREATE$$module$build$src$core$events$utils,xh);var Ph=class extends hn{constructor(e,t){super(t),this.type=Vr,this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Ph),t.themeName=e.themeName,t}};h(pe.EVENT,Vr,Ph);var Dh=class extends hn{constructor(e,t,s,a,d){super(a),this.type=ao,this.viewTop=e,this.viewLeft=t,this.scale=s,this.oldScale=d}toJson(){const e=super.toJson();if(this.viewTop===void 0)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(this.viewLeft===void 0)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(this.scale===void 0)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(this.oldScale===void 0)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Dh),t.viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}};h(pe.EVENT,ao,Dh);var Le;(function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"})(Le||(Le={}));var rl=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(e,t){if(!this.connections.length)return-1;const s=this.calculateIndexForYPos(t);if(s>=this.connections.length)return-1;t=e.y;let a=s;for(;0<=a&&this.connections[a].y===t;){if(this.connections[a]===e)return a;a--}for(a=s;a<this.connections.length&&this.connections[a].y===t;){if(this.connections[a]===e)return a;a++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,s=this.connections.length;for(;t<s;){const a=Math.floor((t+s)/2);if(this.connections[a].y<e)t=a+1;else if(this.connections[a].y>e)s=a;else{t=a;break}}return t}removeConnection(e,t){if(e=this.findIndexOfConnection(e,t),e===-1)throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,t){function s(we){const Bt=d-a[we].x,Pt=f-a[we].y;return Math.sqrt(Bt*Bt+Pt*Pt)<=t&&Z.push(a[we]),Pt<t}const a=this.connections,d=e.x,f=e.y;e=0;let S=a.length-2,x=S;for(;e<x;)a[x].y<f?e=x:S=x,x=Math.floor((e+S)/2);const Z=[];if(S=e=x,a.length){for(;0<=e&&s(e);)e--;do S++;while(S<a.length&&s(S))}return Z}isInYRange(e,t,s){return Math.abs(this.connections[e].y-t)<=s}searchForClosest(e,t,s){if(!this.connections.length)return{connection:null,radius:t};const a=e.y,d=e.x;e.x=d+s.x,e.y=a+s.y;var f=this.calculateIndexForYPos(e.y);s=null;let S=t,x,Z=f-1;for(;0<=Z&&this.isInYRange(Z,e.y,t);)x=this.connections[Z],this.connectionChecker.canConnect(e,x,!0,S)&&(s=x,S=x.distanceFrom(e)),Z--;for(;f<this.connections.length&&this.isInYRange(f,e.y,t);)x=this.connections[f],this.connectionChecker.canConnect(e,x,!0,S)&&(s=x,S=x.distanceFrom(e)),f++;return e.x=d,e.y=a,{connection:s,radius:S}}static init(e){const t=[];return t[Le.INPUT_VALUE]=new rl(e),t[Le.OUTPUT_VALUE]=new rl(e),t[Le.NEXT_STATEMENT]=new rl(e),t[Le.PREVIOUS_STATEMENT]=new rl(e),t}},Dc=null,Ta=null,Ea={};Ea.connectionUiEffect=tt,Ea.disconnectUiEffect=at,Ea.disconnectUiStop=Gt,Ea.disposeUiEffect=fe;var mp=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace.isMovableVertically(),this.startScrollXY_=new Te(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){Ce()&&Ce().unselect()}endDrag(e){this.drag(e)}drag(e){if(e=Te.sum(this.startScrollXY_,e),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(e.x,this.workspace.scrollY);else if(this.verticalScrollEnabled_)this.workspace.scroll(this.workspace.scrollX,e.y);else throw new TypeError("Invalid state.")}},Vf=5,Wf=6,Un=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new Te(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.isMultiTouch_=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new Te(0,0)}dispose(){ve(),eo(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)Ee(e);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const t=new Te(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(e),Se()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=Te.difference(e,this.mouseDownXY),this.hasExceededDragRadius?!1:this.hasExceededDragRadius=Te.magnitude(this.currentDragDeltaXY)>(this.flyout?l.config$$module$build$src$core$config.flyoutDragRadius:l.config$$module$build$src$core$config.dragRadius)}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||(e=this.flyout)==null||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error(`Cannot update dragging from the flyout because the ' +
          'flyout's target workspace is undefined`);return!this.flyout.isScrollable()||this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)?(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),l.getGroup$$module$build$src$core$events$utils()||l.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),l.setSelected$$module$build$src$core$common(this.targetBlock),!0):!1}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new mp(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(e){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();const t=Ce();t&&di(t)&&t.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(t,this.startWorkspace_),this.dragger.onDragStart(e),this.dragger.onDrag(e,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(e,t){return new(C(pe.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(e,t)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,Oe(e)?this.cancel():(this.gestureHasStarted=!0,Gt(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=Sl(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,Cr(),Be(e)?this.handleRightClick(e):(e.type.toLowerCase()==="pointerdown"&&e.pointerType!=="mouse"&&Fe(e,this),this.mouseDownXY=new Te(e.clientX,e.clientY),this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(ee(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(ee(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(ee(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&Se())}handleMove(e){this.isDragging()&&We(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),Se())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!We(e))return;if(this.updateFromEvent(e),Se(),this.isEnding_){console.log("Trying to end a gesture recursively.");return}this.isEnding_=!0,this.dragger?this.dragger.onDragEnd(e,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e))}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=je(e);this.cachedPoints.set(t,this.getTouchPoint(e));var s=Array.from(this.cachedPoints.keys());s.length===2&&(t=this.cachedPoints.get(s[0]),s=this.cachedPoints.get(s[1]),this.startDistance=Te.distance(t,s),this.isMultiTouch_=!0,e.preventDefault())}handleTouchMove(e){const t=je(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&this.cachedPoints.size===2?this.handlePinch(e):this.handleMove(e)}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),s=this.cachedPoints.get(t[0]);if(t=this.cachedPoints.get(t[1]),s=Te.distance(s,t)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(t=s-this.previousScale,t=0<t?t*Vf:t*Wf,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const a=this.startWorkspace_,d=Ye(e,a.getParentSvg(),a.getInverseScreenCTM());a.zoom(d.x,d.y,t)}this.previousScale=s,e.preventDefault()}handleTouchEnd(e){e=je(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new Te(e.pageX,e.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(Se(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(e)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.startBlock||this.startBubble||this.startComment||l.setSelected$$module$build$src$core$common(null),this.doStart(e)}fireWorkspaceClick(e){B(new(j(Nn))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}handleCommentStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(t),this.mostRecentEvent=e}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");if(this.targetBlock.isEnabled()){l.getGroup$$module$build$src$core$events$utils()||l.setGroup$$module$build$src$core$events$utils(!0);var e=this.flyout.createBlock(this.targetBlock);e.snapToGrid(),e.bumpNeighbours()}}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");e=new(j(Nn))(this.startBlock,this.startWorkspace_.id,"block"),B(e)}this.bringBlockToFront(),l.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){e=this.creatorWorkspace,Ce()&&Ce().unselect(),this.fireWorkspaceClick(this.startWorkspace_||e)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartComment(e){this.startComment||(this.startComment=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,l.setSelected$$module$build$src$core$common(this.startBlock),e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):this.targetBlock=e}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!!this.startBlock&&!this.hasExceededDragRadius&&!this.isFieldClick()&&!this.isIconClick()}isFieldClick(){return this.startField?this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose)):!1}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!this.startBlock&&!this.startBubble&&!this.startField&&!this.hasExceededDragRadius}getCurrentDragger(){let e,t;return(t=(e=this.workspaceDragger)!=null?e:this.dragger)!=null?t:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){const e=Ve();for(let t=0,s;s=e[t];t++)if(s.currentGesture_)return!0;return!1}},Bh=class{constructor(e,t){this.pattern=e,this.scale=1;let s;this.spacing=(s=t.spacing)!=null?s:0;let a;this.length=(a=t.length)!=null?a:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling;let d;this.snapToGrid=(d=t.snap)!=null?d:!1}setSpacing(e){this.spacing=e,this.update(this.scale)}getSpacing(){return this.spacing}setLength(e){this.length=e,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e;this.pattern.setAttribute("width",`${t}`),this.pattern.setAttribute("height",`${t}`),t=Math.floor(this.spacing/2)+.5;let s=t-this.length/2,a=t+this.length/2;t*=e,s*=e,a*=e,this.setLineAttributes(this.line1,e,s,a,t,t),this.setLineAttributes(this.line2,e,t,t,s,a)}setLineAttributes(e,t,s,a,d,f){e&&(e.setAttribute("stroke-width",`${t}`),e.setAttribute("x1",`${s}`),e.setAttribute("y1",`${d}`),e.setAttribute("x2",`${a}`),e.setAttribute("y2",`${f}`))}moveTo(e,t){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${t}`)}alignXY(e){var t=this.getSpacing();const s=t/2,a=Math.round(Math.round((e.x-s)/t)*t+s);return t=Math.round(Math.round((e.y-s)/t)*t+s),a===e.x&&t===e.y?e:new Te(a,t)}static createDom(e,t,s){e=J(Y.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},s);let a,d;if(0<((a=t.length)!=null?a:1)&&0<((d=t.spacing)!=null?d:0)){J(Y.LINE,{stroke:t.colour},e);let f;(f=t.length)!=null&&f&&J(Y.LINE,{stroke:t.colour},e)}else J(Y.LINE,{},e);return e}},$p={};$p.deepMerge=Xt;var tr=class{constructor(e,t,s,a){this.name=e,this.startHats=!1,this.blockStyles=t||Object.create(null),this.categoryStyles=s||Object.create(null),this.componentStyles=a||Object.create(null),this.fontStyle=Object.create(null),h(pe.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(e=this.componentStyles[e],!e)return null;if(typeof e=="string"){const t=this.getComponentStyle(e);if(t)return t}return`${e}`}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();const s=new tr(e);let a=t.base;if(a){if(typeof a=="string"){let d;a=(d=R(pe.THEME,a))!=null?d:void 0}a instanceof tr&&(Xt(s,a),s.name=e)}return Xt(s.blockStyles,t.blockStyles),Xt(s.categoryStyles,t.categoryStyles),Xt(s.componentStyles,t.componentStyles),Xt(s.fontStyle,t.fontStyle),t.startHats!==null&&(s.startHats=t.startHats),s}},zf={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},Xf={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}},Bc=new tr("classic",zf,Xf),Ls=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,s=!1;var a=!1,d=!1,f=!1,S=!1,x=!1;const Z=!!e.readOnly;if(!Z){var we;t=Kt((we=e.toolbox)!=null?we:null),s=De(t),a=e.trashcan,a=a===void 0?s:a,d=e.collapse,d=d===void 0?s:d,f=e.comments,f=f===void 0?s:f,S=e.disable,S=S===void 0?s:S,x=e.sounds,x=x===void 0?!0:x}we=e.maxTrashcanContents,a?we===void 0&&(we=32):we=0;const Bt=!!e.rtl;let Pt=e.horizontalLayout;Pt===void 0&&(Pt=!1);var ns=e.toolboxPosition!=="end";ns=Pt?ns?lt.TOP:lt.BOTTOM:ns===Bt?lt.RIGHT:lt.LEFT;let gl=e.css;gl===void 0&&(gl=!0);let Na="https://blockly-demo.appspot.com/static/media/";e.media&&(Na=e.media.endsWith("/")?e.media:e.media+"/");const If=e.oneBasedIndex,kg=e.renderer||"geras",Cg=e.plugins||{};let Rd=e.modalInputs;Rd===void 0&&(Rd=!0),this.RTL=Bt,this.oneBasedIndex=If===void 0?!0:If,this.collapse=d,this.comments=f,this.disable=S,this.readOnly=Z,this.maxBlocks=e.maxBlocks||1/0;let Sf;this.maxInstances=(Sf=e.maxInstances)!=null?Sf:null,this.modalInputs=Rd,this.pathToMedia=Na,this.hasCategories=s,this.moveOptions=Ls.parseMoveOptions_(e,s),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=a,this.maxTrashcanContents=we,this.hasSounds=x,this.hasCss=gl,this.horizontalLayout=Pt,this.languageTree=t,this.gridOptions=Ls.parseGridOptions_(e),this.zoomOptions=Ls.parseZoomOptions_(e),this.toolboxPosition=ns,this.theme=Ls.parseThemeOptions_(e),this.renderer=kg;let Of;this.rendererOverrides=(Of=e.rendererOverrides)!=null?Of:null;let kf;this.parentWorkspace=(kf=e.parentWorkspace)!=null?kf:null,this.plugins=Cg}static parseMoveOptions_(e,t){const s=e.move||{},a={};return s.scrollbars===void 0&&e.scrollbars===void 0?a.scrollbars=t:typeof s.scrollbars=="object"?(a.scrollbars={horizontal:!!s.scrollbars.horizontal,vertical:!!s.scrollbars.vertical},a.scrollbars.horizontal&&a.scrollbars.vertical?a.scrollbars=!0:a.scrollbars.horizontal||a.scrollbars.vertical||(a.scrollbars=!1)):a.scrollbars=!!s.scrollbars||!!e.scrollbars,a.wheel=a.scrollbars&&s.wheel!==void 0?!!s.wheel:typeof a.scrollbars=="object",a.drag=a.scrollbars?s.drag===void 0?!0:!!s.drag:!1,a}static parseZoomOptions_(e){e=e.zoom||{};const t={};return t.controls=e.controls===void 0?!1:!!e.controls,t.wheel=e.wheel===void 0?!1:!!e.wheel,t.startScale=e.startScale===void 0?1:Number(e.startScale),t.maxScale=e.maxScale===void 0?3:Number(e.maxScale),t.minScale=e.minScale===void 0?.3:Number(e.minScale),t.scaleSpeed=e.scaleSpeed===void 0?1.2:Number(e.scaleSpeed),t.pinch=e.pinch===void 0?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions_(e){e=e.grid||{};const t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=e.length===void 0?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions_(e){return e=e.theme||Bc,typeof e=="string"?R(pe.THEME,e):e instanceof tr?e:tr.defineTheme(e.name||"builtin"+N(),e)}};l.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.name:null:(console.warn(`Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:
Blockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());`),null)}populateVariables(e){e=l.allUsedVarModels$$module$build$src$core$variables(e);for(let t=0;t<e.length;t++)this.getName(e[t].getId(),l.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let s=e;t===l.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(s=e),e=s.toLowerCase();const a=t===l.NameType$$module$build$src$core$names.VARIABLE||t===l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(t)||this.db.set(t,new Map);const d=this.db.get(t);return d.has(e)?a+d.get(e):(t=this.getDistinctName(s,t),d.set(e,t.substr(a.length)),t)}getUserNames(e){let t;return(e=(t=this.db.get(e))==null?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let s=null,a,d;for(;this.dbReverse.has(e+((a=s)!=null?a:""))||this.reservedWords.has(e+((d=s)!=null?d:""));)s=s?s+1:2;let f;return e+=(f=s)!=null?f:"",this.dbReverse.add(e),(t===l.NameType$$module$build$src$core$names.VARIABLE||t===l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(e[0])&&(e="my_"+e)):e=l.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},function(e){e=e.NameType||(e.NameType={}),e.DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}(l.Names$$module$build$src$core$names||(l.Names$$module$build$src$core$names={})),l.NameType$$module$build$src$core$names=l.Names$$module$build$src$core$names.NameType,l.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=l.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,l.NameType$$module$build$src$core$names,l.Names$$module$build$src$core$names;var Tp=class extends Map{constructor(){super()}set(e,t){return this.get(e)===t?this:(super.set(e,t),Lr(t)&&t.startPublishing(),this)}delete(e){const t=this.get(e);return e=super.delete(e),e&&(Lr(t)&&t.stopPublishing(),e)}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},Fc=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new Te(0,0),this.workspaceLocation=new Te(0,0),this.svgRoot=null,this.tooltip=e}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var t=this.sourceBlock;this.svgRoot=J(Y.G,{class:"blocklyIconGroup"}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),ee(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,ds(this.svgRoot)}}dispose(){kr(this.svgRoot),M(this.svgRoot)}getWeight(){return-1}getSize(){return new bt(0,0)}setTooltip(e){this.tooltip=e??this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",bn(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;(e=this.svgRoot)==null||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=Te.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}},Ep={fromJsonInternal:Yl},Uc={TEST_ONLY:Ep};Uc.fromJson=l.fromJson$$module$build$src$core$field_registry,Uc.register=ks,Uc.unregister=Za;var _n=class extends Mt{constructor(e,t,s){super(Mt.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==Mt.SKIP_SETUP&&(Array.isArray(e)?(Yt(e),e=qa(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],s&&this.configure_(s),this.setValue(this.selectedOption[1]),t&&this.setValidator(t))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(_n,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=J(Y.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&$e(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!((e=this.getSourceBlock())!=null&&e.isShadow())}createTextArrow_(){this.arrow=J(Y.TSPAN,{},this.textElement_);let e;this.arrow.appendChild(document.createTextNode((e=this.getSourceBlock())!=null&&e.RTL?_n.ARROW_CHAR+" ":" "+_n.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central");let t;(t=this.getSourceBlock())!=null&&t.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=J(Y.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(fs,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new ri;this.dropdownCreate(),this.menu_.openingCoords=e&&typeof e.clientX=="number"?new Te(e.clientX,e.clientY):null,mr(),e=this.menu_.render(Zn()),$e(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),Zi(t,this.sourceBlock_.style.colourTertiary)),$r(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),rt(this.selectedMenuItem.getElement(),Zn(),!0)),this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new ri;const t=new vh;t.setRole(js.LISTBOX),this.menu_=t;const s=this.getOptions(!1);this.selectedMenuItem=null;for(let d=0;d<s.length;d++){const[f,S]=s[d];if(typeof f=="object"){var a=new Image(f.width,f.height);a.src=f.src,a.alt=f.alt||""}else a=f;a=new yh(a,S),a.setRole(js.OPTION),a.setRightToLeft(e.RTL),a.setCheckable(!0),t.addChild(a),a.setChecked(S===this.value_),S===this.value_&&(this.selectedMenuItem=a),a.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){qn(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return typeof this.menuGenerator_=="function"}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:e&&this.generatedOptions?this.generatedOptions:(this.generatedOptions=this.menuGenerator_(),Yt(this.generatedOptions),this.generatedOptions)}doClassValidation_(e){return this.getOptions(!0).some(t=>t[1]===e)?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let t=0,s;s=e[t];t++)s[1]===this.value_&&(this.selectedOption=s)}applyColour(){const e=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",e.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow&&(this.sourceBlock_.isShadow()?this.arrow.style.fill=e.colourSecondary:this.arrow.style.fill=e.colourPrimary)}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];e&&typeof e=="object"?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const t=this.getSourceBlock();if(!t)throw new ri;this.imageElement.style.display="",this.imageElement.setAttributeNS(fs,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const s=Number(e.height);e=Number(e.width);var a=!!this.borderRect_;const d=Math.max(a?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,s+jf);a=a?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let f;f=this.svgArrow?this.positionSVGArrow(e+a,d/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):Xe(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=e+f+2*a,this.size_.height=d;let S=0;t.RTL?this.imageElement.setAttribute("x",`${a+f}`):(S=e+f,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${a}`)),this.imageElement.setAttribute("y",String(d/2-s/2)),this.positionTextElement_(S+a,e+f)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();$e(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var t=!!this.borderRect_;e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const s=Xe(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let a=0;this.svgArrow&&(a=this.positionSVGArrow(s+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=s+a+2*t,this.size_.height=e,this.positionTextElement_(t,s)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const s=this.getSourceBlock();if(!s)throw new ri;const a=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,d=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,f=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(s.RTL?a:e+d)+","+t+")"),f+d}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];return typeof e=="object"?e.alt:e}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}};_n.CHECKMARK_OVERHANG=25,_n.MAX_MENU_HEIGHT_VH=.45,_n.ARROW_CHAR="▾";var Yf=5,jf=2*Yf;ks("field_dropdown",_n);var bp=class{constructor(e,t){this.bubble=e,this.workspace=t,this.startLoc=null}isMovable(){return!0}startDrag(){l.getGroup$$module$build$src$core$events$utils()||l.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(e){this.bubble.moveDuringDrag(e)}endDrag(){this.workspace.setResizesEnabled(!0),l.setGroup$$module$build$src$core$events$utils(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveOffDragLayer(this.bubble,$h),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},ms,wt=class{constructor(e,t,s){this.workspace=e,this.anchor=t,this.ownerRect=s,this.size=new bt(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new bp(this,this.workspace),this.id=N(),this.svgRoot=J(Y.G,{class:"blocklyBubble"},e.getBubbleCanvas()),e=J(Y.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=J(Y.PATH,{class:"blocklyBubbleTail"},e),this.background=J(Y.RECT,{class:"blocklyDraggable",x:0,y:0,rx:ms.BORDER_WIDTH,ry:ms.BORDER_WIDTH},e),this.contentContainer=J(Y.G,{},this.svgRoot),ee(this.background,"pointerdown",this,this.onMouseDown)}dispose(){M(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,ms.MIN_SIZE),e.height=Math.max(e.height,ms.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let t;(t=this.workspace.getGesture(e))==null||t.handleBubbleStart(e,this),l.setSelected$$module$build$src$core$common(this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new Nt(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),s=this.getOptimalRelativeLeft(t),a=this.getOptimalRelativeTop(t);const d={x:s,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},f={x:-this.size.width-30,y:a};a={x:e.getWidth(),y:a};var S={x:s,y:e.getHeight()};s=e.getWidth()<e.getHeight()?a:S,e=e.getWidth()<e.getHeight()?S:a,a=this.getOverlap(d,t),S=this.getOverlap(f,t);const x=this.getOverlap(s,t);t=this.getOverlap(e,t),t=Math.max(a,S,x,t),a===t?(this.relativeLeft=d.x,this.relativeTop=d.y):S===t?(this.relativeLeft=f.x,this.relativeTop=f.y):x===t?(this.relativeLeft=s.x,this.relativeTop=s.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var s=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(s+this.size.width,t.left+t.width)-Math.max(s,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var s=this.anchor.x-t;s-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):s>e.right&&(t=-(e.right-this.anchor.x))}else{s=t+this.anchor.x;const a=s+this.size.width;s<e.left?t=e.left-this.anchor.x:a>e.right&&(t=e.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const s=this.anchor.y+t,a=s+this.size.height;return e=this.getWorkspaceViewRect(e),s<e.top?t=e.top-this.anchor.y:a>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let s=e.top+e.height,a=e.left;return e=e.left+e.width,s-=this.getScrollbarThickness(),this.workspace.RTL?a-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new Nt(t,s,a,e)}getScrollbarThickness(){return oi.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var t=this.size.width/2,s=this.size.height/2,a=-this.relativeLeft,d=-this.relativeTop;if(t===a&&s===d)e.push("M "+t+","+s);else{d-=s,a-=t,this.workspace.RTL&&(a*=-1);var f=Math.sqrt(d*d+a*a),S=Math.acos(a/f);0>d&&(S=2*Math.PI-S);var x=S+Math.PI/2;x>2*Math.PI&&(x-=2*Math.PI);var Z=Math.sin(x);const Bt=Math.cos(x);let Pt=(this.size.width+this.size.height)/ms.TAIL_THICKNESS;Pt=Math.min(Pt,this.size.width,this.size.height)/4,x=1-ms.ANCHOR_RADIUS/f,a=t+x*a,d=s+x*d,x=t+Pt*Bt;const ns=s+Pt*Z;t-=Pt*Bt,s-=Pt*Z,Z=pr(this.workspace.RTL?-ms.TAIL_ANGLE:ms.TAIL_ANGLE),Z=S+Z,Z>2*Math.PI&&(Z-=2*Math.PI),S=Math.sin(Z)*f/ms.TAIL_BEND,f=Math.cos(Z)*f/ms.TAIL_BEND,e.push("M"+x+","+ns),e.push("C"+(x+f)+","+(ns+S)+" "+a+","+d+" "+a+","+d),e.push("C"+a+","+d+" "+(t+f)+","+(s+S)+" "+t+","+s)}e.push("z");let we;(we=this.tail)==null||we.setAttribute("d",e.join(" "))}bringToFront(){let e;const t=(e=this.svgRoot)==null?void 0:e.parentNode;return this.svgRoot&&(t==null?void 0:t.lastChild)!==this.svgRoot?(t==null||t.appendChild(this.svgRoot),!0):!1}getRelativeToSurfaceXY(){return new Te(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){}unselect(){}};ms=wt,wt.BORDER_WIDTH=6,wt.DOUBLE_BORDER=2*ms.BORDER_WIDTH,wt.MIN_SIZE=ms.DOUBLE_BORDER,wt.TAIL_THICKNESS=1,wt.TAIL_ANGLE=20,wt.TAIL_BEND=4,wt.ANCHOR_RADIUS=8;var Hn=class extends wt{constructor(e,t,s,a){super(t,s,a),this.workspace=t,this.anchor=s,this.ownerRect=a,this.autoLayout=!0,t=new Ls(e),this.validateWorkspaceOptions(t),this.svgDialog=J(Y.SVG,{x:wt.BORDER_WIDTH,y:wt.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Ls(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(Y.G),this.miniWorkspace.getCanvas()),e=this.miniWorkspace.getFlyout(),e==null||e.init(this.miniWorkspace),e==null||e.show(t.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));let d,f;(d=this.miniWorkspace.getFlyout())==null||(f=d.getWorkspace())==null||f.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const t=e.getRelativeToSurfaceXY();if(20>t.y&&e.moveBy(0,20-t.y),e.RTL){let s=-20;const a=this.miniWorkspace.getFlyout();a&&(s-=a.getWidth()),t.x>s&&e.moveBy(s-t.x,0)}else 20>t.x&&e.moveBy(20-t.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),t=this.calculateWorkspaceSize();Math.abs(e.width-t.width)<Hn.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<Hn.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${t.width}px`),this.svgDialog.setAttribute("height",`${t.height}px`),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new bt(t.width+wt.DOUBLE_BORDER,t.height+wt.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+Hn.MARGIN;e=e.height+Hn.MARGIN;const s=this.miniWorkspace.getFlyout();if(s){const a=s.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,a.height+20),t+=s.getWidth()}return new bt(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let t;if(e=(t=this.miniWorkspace.getFlyout())==null?void 0:t.getWorkspace())for(const s of e.getAllBlocks(!1))s.setStyle(s.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};Hn.MINIMUM_VIEW_CHANGE=10,Hn.MARGIN=3*wt.DOUBLE_BORDER;var Hc,Gc;Hc=17,Gc=16,l.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends Fc{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),J(Y.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),J(Y.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),J(Y.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),$e(this.svgRoot,"blockly-icon-mutator"))}dispose(){super.dispose();let e;(e=this.miniWorkspaceBubble)==null||e.dispose()}getWeight(){return l.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new bt(Hc,Hc)}applyColour(){super.applyColour();let e;(e=this.miniWorkspaceBubble)==null||e.setColour(this.sourceBlock.style.colourPrimary);let t;(t=this.miniWorkspaceBubble)==null||t.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){super.onLocationChange(e);let t;(t=this.miniWorkspaceBubble)==null||t.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){const t=this;return ue.asyncExecutePromiseGeneratorFunction(function*(){if(t.bubbleIsVisible()!==e){if(yield _t(),e){t.miniWorkspaceBubble=new Hn(t.getMiniWorkspaceConfig(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour(),t.createRootBlock(),t.addSaveConnectionsListener();let s;(s=t.miniWorkspaceBubble)==null||s.addWorkspaceChangeListener(t.createMiniWorkspaceChangeListener())}else{let s;(s=t.miniWorkspaceBubble)==null||s.dispose(),t.miniWorkspaceBubble=null,t.saveConnectionsListener&&t.sourceBlock.workspace.removeChangeListener(t.saveConnectionsListener),t.saveConnectionsListener=null}B(new(j(un))(t.sourceBlock,e,"mutator"))}})}getMiniWorkspaceConfig(){let e;const t={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:(e=this.sourceBlock.workspace.options.rendererOverrides)!=null?e:void 0};return this.flyoutBlockTypes.length&&(t.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map(s=>({kind:"block",type:s}))}),t}getAnchorLocation(){const e=Hc/2;return Te.sum(this.workspaceLocation,new Te(e,e))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Nt(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace());for(var e of this.rootBlock.getDescendants(!1))e.queueRender();this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1);let t,s,a,d;e=(d=(t=this.miniWorkspaceBubble)==null||(s=t.getWorkspace())==null||(a=s.getFlyout())==null?void 0:a.getWidth())!=null?d:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+Gc):Gc,Gc)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{l.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout(()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()},0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||e.type===l.CREATE$$module$build$src$core$events$utils||e.type===l.CHANGE$$module$build$src$core$events$utils&&e.element==="disabled"}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=l.getGroup$$module$build$src$core$events$utils();e||l.setGroup$$module$build$src$core$events$utils(!0);var t=Jo.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var s=Jo.getExtraBlockState_(this.sourceBlock);t!==s&&B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"mutation",null,t,s)),l.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return(e=this.miniWorkspaceBubble)==null?void 0:e.getWorkspace()}},l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=_i.MUTATOR,l.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,l.MutatorIcon$$module$build$src$core$icons$mutator_icon;var ll=Object.create(null),Kf={allExtensions:ll};l.register$$module$build$src$core$extensions("parent_tooltip_when_inline",xd);var Zs={TEST_ONLY:Kf};Zs.apply=Nr,Zs.buildTooltipForDropdown=l.buildTooltipForDropdown$$module$build$src$core$extensions,Zs.buildTooltipWithFieldText=l.buildTooltipWithFieldText$$module$build$src$core$extensions,Zs.isRegistered=Kl,Zs.register=l.register$$module$build$src$core$extensions,Zs.registerMixin=l.registerMixin$$module$build$src$core$extensions,Zs.registerMutator=l.registerMutator$$module$build$src$core$extensions,Zs.runAfterPageLoad=Nd,Zs.unregister=Po;var vp=new Set,yp={};yp.warn=oo;var ht;(function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"})(ht||(ht={}));var Gn={};Gn.arc=ni,Gn.curve=ts,Gn.line=xr,Gn.lineOnAxis=Ne,Gn.lineTo=an,Gn.moveBy=Ut,Gn.moveTo=Ei,Gn.point=He;var jt={};jt.Coordinate=Te,jt.KeyCodes=ht,jt.Rect=Nt,jt.Size=bt,jt.Svg=Y,jt.aria=da,jt.array=x_,jt.browserEvents=Pn,jt.colour=As,jt.deprecation=yp,jt.dom=ki,jt.extensions=Zs,jt.idGenerator=Zu,jt.math=kc,jt.object=$p,jt.parsing=$a,jt.string=tl,jt.style=co,jt.svgMath=zo,jt.svgPaths=Gn,jt.toolbox=uo,jt.userAgent=xf,jt.xml=Yr;var Fh={};Fh.register=au,Fh.unregister=Pd;var Uh=class extends wt{constructor(e,t,s,a){super(t,s,a),this.text=e,this.workspace=t,this.anchor=s,this.ownerRect=a,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(e){this.text=e,M(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createSpans(t,e),this.workspace.RTL&&this.rightAlignSpans(t.getBBox().width,e),t}createParagraph(e){return J(Y.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:wt.BORDER_WIDTH},e)}createSpans(e,t){return t.split(`
`).map(s=>{const a=J(Y.TSPAN,{dy:"1em",x:wt.BORDER_WIDTH},e);return s=document.createTextNode(s),a.appendChild(s),a})}rightAlignSpans(e,t){for(const s of t)s.setAttribute("text-anchor","end"),s.setAttribute("x",`${e+wt.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new bt(e.width+2*wt.BORDER_WIDTH,e.height+2*wt.BORDER_WIDTH),!0)}},Ip=class extends wt{constructor(e,t,s){super(e,t,s),this.workspace=e,this.anchor=t,this.ownerRect=s,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new bt(160+wt.DOUBLE_BORDER,80+wt.DOUBLE_BORDER),this.MIN_SIZE=new bt(45+wt.DOUBLE_BORDER,20+wt.DOUBLE_BORDER),$e(this.svgRoot,"blocklyTextInputBubble"),{inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}createEditor(e){e=J(Y.FOREIGNOBJECT,{x:wt.BORDER_WIDTH,y:wt.BORDER_WIDTH},e);const t=document.createElementNS(dn,"body");t.setAttribute("xmlns",dn),t.className="blocklyMinimalBody";const s=document.createElementNS(dn,"textarea");return s.className="blocklyTextarea blocklyText",s.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),t.appendChild(s),e.appendChild(t),this.bindTextAreaEvents(s),setTimeout(()=>{s.focus()},0),{inputRoot:e,textArea:s}}bindTextAreaEvents(e){ee(e,"wheel",this,t=>{t.stopPropagation()}),ee(e,"focus",this,this.onStartEdit,!0),ee(e,"change",this,this.onTextChange)}createResizeHandle(e,t){return e=J(Y.IMAGE,{class:"blocklyResizeHandle",href:`${t.options.pathToMedia}resize-handle.svg`},e),ee(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const s=e.width-wt.DOUBLE_BORDER,a=e.height-wt.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${s}`),this.inputRoot.setAttribute("height",`${a}`),this.resizeGroup.setAttribute("y",`${a}`),this.workspace.RTL?this.resizeGroup.setAttribute("x",`${-wt.DOUBLE_BORDER}`):this.resizeGroup.setAttribute("x",`${s}`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(e){this.bringToFront(),Be(e)||(this.workspace.startDrag(e,new Te(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=ee(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=ee(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){ve(),this.resizePointerUpListener&&(Ee(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(Ee(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new bt(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}};Ue(`
.blocklyTextInputBubble .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 0;
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}
`);var Hh=17,Sp=160,Op=80,Vn=class extends Fc{constructor(e){super(e),this.sourceBlock=e,this.textBubble=this.textInputBubble=null,this.text="",this.bubbleSize=new bt(Sp,Op),this.bubbleVisiblity=!1}getType(){return Vn.TYPE}initView(e){this.svgRoot||(super.initView(e),J(Y.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),J(Y.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),J(Y.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),$e(this.svgRoot,"blockly-icon-comment"))}dispose(){super.dispose();let e;(e=this.textInputBubble)==null||e.dispose();let t;(t=this.textBubble)==null||t.dispose()}getWeight(){return Vn.WEIGHT}getSize(){return new bt(Hh,Hh)}applyColour(){super.applyColour();const e=this.sourceBlock.style.colourPrimary;let t;(t=this.textInputBubble)==null||t.setColour(e);let s;(s=this.textBubble)==null||s.setColour(e)}updateEditable(){const e=this,t=()=>super.updateEditable;return ue.asyncExecutePromiseGeneratorFunction(function*(){t().call(e),e.bubbleIsVisible()&&(yield e.setBubbleVisible(!1),yield e.setBubbleVisible(!0))})}onLocationChange(e){super.onLocationChange(e),e=this.getAnchorLocation();let t;(t=this.textInputBubble)==null||t.setAnchorLocation(e);let s;(s=this.textBubble)==null||s.setAnchorLocation(e)}setText(e){const t=this.text;B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,t,e)),this.text=e;let s;(s=this.textInputBubble)==null||s.setText(this.text);let a;(a=this.textBubble)==null||a.setText(this.text)}getText(){return this.text}setBubbleSize(e){this.bubbleSize=e;let t;(t=this.textInputBubble)==null||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){let t;this.text=(t=e.text)!=null?t:"";let s,a;this.bubbleSize=new bt((s=e.width)!=null?s:Sp,(a=e.height)!=null?a:Op);let d;this.bubbleVisiblity=(d=e.pinned)!=null?d:!1,this.setBubbleVisible(this.bubbleVisiblity)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){const t=this;return ue.asyncExecutePromiseGeneratorFunction(function*(){t.bubbleVisiblity!==e&&(t.bubbleVisiblity=e,yield _t(),!t.sourceBlock.rendered||t.sourceBlock.isInFlyout||t.sourceBlock.isInsertionMarker()||(e?(t.sourceBlock.isEditable()?t.showEditableBubble():t.showNonEditableBubble(),t.applyColour()):t.hideBubble(),B(new(j(un))(t.sourceBlock,e,"comment"))))})}showEditableBubble(){this.textInputBubble=new Ip(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener(()=>this.onTextChange()),this.textInputBubble.addSizeChangeListener(()=>this.onSizeChange())}showNonEditableBubble(){this.textBubble=new Uh(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect())}hideBubble(){let e;(e=this.textInputBubble)==null||e.dispose(),this.textInputBubble=null;let t;(t=this.textBubble)==null||t.dispose(),this.textBubble=null}getAnchorLocation(){const e=Hh/2;return Te.sum(this.workspaceLocation,new Te(e,e))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Nt(e.y,e.y+e.height,e.x,e.x+e.width)}};Vn.TYPE=_i.COMMENT,Vn.WEIGHT=3,au(Vn.TYPE,Vn);var Gh=17,Wn=class extends Fc{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return Wn.TYPE}initView(e){this.svgRoot||(super.initView(e),J(Y.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),J(Y.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),J(Y.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),$e(this.svgRoot,"blockly-icon-warning"))}dispose(){super.dispose();let e;(e=this.textBubble)==null||e.dispose()}getWeight(){return Wn.WEIGHT}getSize(){return new bt(Gh,Gh)}applyColour(){super.applyColour();let e;(e=this.textBubble)==null||e.setColour(this.sourceBlock.style.colourPrimary)}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){super.onLocationChange(e);let t;(t=this.textBubble)==null||t.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){if(this.textMap.get(t)===e)return this;e?this.textMap.set(t,e):this.textMap.delete(t);let s;return(s=this.textBubble)==null||s.setText(this.getText()),this}getText(){return[...this.textMap.values()].join(`
`)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){const t=this;return ue.asyncExecutePromiseGeneratorFunction(function*(){if(t.bubbleIsVisible()!==e){if(yield _t(),e)t.textBubble=new Uh(t.getText(),t.sourceBlock.workspace,t.getAnchorLocation(),t.getBubbleOwnerRect()),t.applyColour();else{let s;(s=t.textBubble)==null||s.dispose(),t.textBubble=null}B(new(j(un))(t.sourceBlock,e,"warning"))}})}getAnchorLocation(){const e=Gh/2;return Te.sum(this.workspaceLocation,new Te(e,e))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Nt(e.y,e.y+e.height,e.x,e.x+e.width)}};Wn.TYPE=_i.WARNING,Wn.WEIGHT=2;var kp=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},Cp={};Cp.DuplicateIconType=kp;var po={};po.CommentIcon=Vn,po.Icon=Fc,po.IconType=_i,po.MutatorIcon=l.MutatorIcon$$module$build$src$core$icons$mutator_icon,po.WarningIcon=Wn,po.exceptions=Cp,po.registry=Fh;var Vc,Xi;Vc="PROCEDURE",l.DEFAULT_ARG$$module$build$src$core$procedures="x",Xi={CATEGORY_NAME:Vc,DEFAULT_ARG:l.DEFAULT_ARG$$module$build$src$core$procedures},Xi.ObservableProcedureMap=Tp,Xi.allProcedures=ic,Xi.findLegalName=l.findLegalName$$module$build$src$core$procedures,Xi.flyoutCategory=sc,Xi.getCallers=_u,Xi.getDefinition=l.getDefinition$$module$build$src$core$procedures,Xi.isNameUsed=uu,Xi.isProcedureBlock=Vi,Xi.mutateCallers=l.mutateCallers$$module$build$src$core$procedures,Xi.mutatorOpenListener=du,Xi.rename=l.rename$$module$build$src$core$procedures;var Jf=class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return e.type&this.FIELD}isHat(e){return e.type&this.HAT}isIcon(e){return e.type&this.ICON}isSpacer(e){return e.type&this.SPACER}isInRowSpacer(e){return e.type&this.IN_ROW_SPACER}isInput(e){return e.type&this.INPUT}isExternalInput(e){return e.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(e){return e.type&this.INLINE_INPUT}isStatementInput(e){return e.type&this.STATEMENT_INPUT}isPreviousConnection(e){return e.type&this.PREVIOUS_CONNECTION}isNextConnection(e){return e.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(e){return e.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(e){return e.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(e){return e.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(e){return e.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(e){return e.type&this.RIGHT_SQUARE_CORNER}isCorner(e){return e.type&this.CORNER}isJaggedEdge(e){return e.type&this.JAGGED_EDGE}isRow(e){return e.type&this.ROW}isBetweenRowSpacer(e){return e.type&this.BETWEEN_ROW_SPACER}isTopRow(e){return e.type&this.TOP_ROW}isBottomRow(e){return e.type&this.BOTTOM_ROW}isTopOrBottomRow(e){return e.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(e){return e.type&this.INPUT_ROW}},G=new Jf,pn=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=G.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},ba=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=G.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(G.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const t=this.elements[e];if(G.isSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(G.isSpacer(t))return t}return null}},Vh=class extends ba{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=G.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,s=0;for(let a=0;a<this.elements.length;a++){const d=this.elements[a];t+=d.width,G.isSpacer(d)||(G.isNextConnection(d)?s=Math.max(s,d.height):e=Math.max(e,d.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+s,this.descenderHeight=s,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},zn=class extends pn{constructor(e,t){super(e),this.connectionModel=t,this.type|=G.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},fo=class extends zn{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=G.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},Wc=class extends fo{constructor(e,t){super(e,t),this.height=0,this.type|=G.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},al=class extends pn{constructor(e,t,s){super(e),this.field=t,this.parentInput=s,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=G.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},Wh=class extends pn{constructor(e){super(e),this.type|=G.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},Rp=class extends pn{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.type|=G.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},$s=class extends pn{constructor(e,t){super(e),this.type=this.type|G.SPACER|G.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},zh=class extends fo{constructor(e,t){super(e,t),this.type|=G.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},va=class extends fo{constructor(e,t){super(e,t),this.type|=G.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},Xh=class extends ba{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=G.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let t=0;t<this.elements.length;t++){const s=this.elements[t];this.width+=s.width,G.isInput(s)&&s instanceof fo&&(G.isStatementInput(s)&&s instanceof va?e+=s.connectedBlockWidth:G.isExternalInput(s)&&s instanceof Wc&&s.connectedBlockWidth!==0&&(e+=s.connectedBlockWidth-s.connectionWidth)),G.isSpacer(s)||(this.height=Math.max(this.height,s.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},wp=class extends pn{constructor(e){super(e),this.type|=G.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},Ap=class extends zn{constructor(e,t){super(e,t),this.type|=G.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},Lp=class extends zn{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=G.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},Np=class extends zn{constructor(e,t){super(e,t),this.type|=G.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},ya=class extends pn{constructor(e,t){super(e),this.type=(t&&t!=="left"?G.RIGHT_ROUND_CORNER:G.LEFT_ROUND_CORNER)|G.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},Yh=class extends ba{constructor(e,t,s){super(e),this.height=t,this.width=s,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|G.SPACER|G.BETWEEN_ROW_SPACER,this.elements=[new $s(this.constants_,s)]}measure(){}},Ia=class extends pn{constructor(e,t){super(e),this.type=(t&&t!=="left"?G.RIGHT_SQUARE_CORNER:G.LEFT_SQUARE_CORNER)|G.CORNER,this.width=this.height=this.constants_.NO_PADDING}},jh=class extends ba{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=G.TOP_ROW}hasLeftSquareCorner(e){const t=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,s=e.getPreviousBlock();return!!e.outputConnection||t||(s?s.getNextBlock()===e:!1)}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,s=0;for(let a=0;a<this.elements.length;a++){const d=this.elements[a];t+=d.width,G.isSpacer(d)||(G.isHat(d)&&d instanceof Wh?s=Math.max(s,d.ascenderHeight):e=Math.max(e,d.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+s,this.capline=this.ascenderHeight=s,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},zc=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=Ut(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const t=e.blockStyles;for(const s in t)this.blockStyles[s]=this.validatedBlockStyle_(t[s]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=e.startHats!==void 0?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=E("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&e.startsWith("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const t={};return e&&Object.assign(t,e),e=Ws(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?Ws(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?Ws(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return on("#fff",e,.6)||e}generateTertiaryColour_(e){return on("#fff",e,.3)||e}dispose(){this.embossFilter&&M(this.embossFilter),this.disabledPattern&&M(this.disabledPattern),this.debugFilter&&M(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH,s=xr([He(t,e/4),He(2*-t,e/2),He(t,e/4)]);return{height:e,width:t,path:s}}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH,s=ts("c",[He(30,-e),He(70,-e),He(t,0)]);return{height:e,width:t,path:s}}makePuzzleTab(){function e(f){f=f?-1:1;const S=-f;var x=s/2;const Z=x+2.5,we=x+.5,Bt=He(-t,f*x);return x=He(t,f*x),ts("c",[He(0,f*Z),He(-t,S*we),Bt])+ts("s",[He(t,2.5*S),x])}const t=this.TAB_WIDTH,s=this.TAB_HEIGHT,a=e(!0),d=e(!1);return{type:this.SHAPES.PUZZLE,width:t,height:s,pathDown:d,pathUp:a}}makeNotch(){function e(S){return xr([He(S*a,s),He(3*S,0),He(S*a,-s)])}const t=this.NOTCH_WIDTH,s=this.NOTCH_HEIGHT,a=(t-3)/2,d=e(1),f=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:s,pathLeft:d,pathRight:f}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=ni("a","0 0,0",e,He(-e,e)),s=ni("a","0 0,0",e,He(e,e));return{width:e,height:e,pathTop:t,pathBottom:s}}makeOutsideCorners(){const e=this.CORNER_RADIUS,t=Ut(0,e)+ni("a","0 0,1",e,He(e,-e)),s=ni("a","0 0,1",e,He(e,e)),a=ni("a","0 0,1",e,He(-e,-e)),d=ni("a","0 0,1",e,He(-e,e));return{topLeft:t,topRight:s,bottomRight:d,bottomLeft:a,rightHeight:e}}shapeFor(e){switch(e.type){case Le.INPUT_VALUE:case Le.OUTPUT_VALUE:return this.PUZZLE_TAB;case Le.PREVIOUS_STATEMENT:case Le.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,s){this.injectCSS_(t,s),this.defs=J(Y.DEFS,{},e),e=J(Y.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),J(Y.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=J(Y.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),J(Y.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),J(Y.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),J(Y.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=J(Y.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),J(Y.RECT,{width:10,height:10,fill:"#aaa"},e),J(Y.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const e=J(Y.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=J(Y.FECOMPONENTTRANSFER,{result:"outBlur"},e);J(Y.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),J(Y.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),J(Y.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const s=t.join(`
`);this.cssNode?this.cssNode.firstChild.textContent=s:(t=document.createElement("style"),t.id=e,e=document.createTextNode(s),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect,`,`${e} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Xc=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=Ut(e.xPos,this.info_.startY);for(let s=0,a;a=t[s];s++)G.isLeftRoundedCorner(a)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:G.isRightRoundedCorner(a)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:G.isPreviousConnection(a)&&a instanceof zn?this.outlinePath_+=a.shape.pathLeft:G.isHat(a)?this.outlinePath_+=this.constants_.START_HAT.path:G.isSpacer(a)&&(this.outlinePath_+=Ne("h",a.width));this.outlinePath_+=Ne("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+Ne("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const t=e.getLastInput();this.positionExternalValueConnection_(e);const s=nc(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=Ne("H",t.xPos+t.width)+s+Ne("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t=e.getLastInput();if(t){var s=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+Ne("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var a=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=Ne("H",s)+t+Ne("v",a)+this.constants_.INSIDE_CORNERS.pathBottom+Ne("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=Ne("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,t=e.elements;this.positionNextConnection_();let s=0,a="";for(let d=t.length-1,f;f=t[d];d--)G.isNextConnection(f)&&f instanceof zn?a+=f.shape.pathRight:G.isLeftSquareCorner(f)?a+=Ne("H",e.xPos):G.isLeftRoundedCorner(f)?a+=this.constants_.OUTSIDE_CORNERS.bottomLeft:G.isRightRoundedCorner(f)?(a+=this.constants_.OUTSIDE_CORNERS.bottomRight,s=this.constants_.OUTSIDE_CORNERS.rightHeight):G.isSpacer(f)&&(a+=Ne("h",-1*f.width));this.outlinePath_+=Ne("V",e.baseline-s),this.outlinePath_+=a}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const t=e.connectionOffsetY+e.height;e=nc(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=Ne("V",t)+e}this.outlinePath_+="z"}drawInternals_(){for(let e=0,t;t=this.info_.rows[e];e++)for(let s=0,a;a=t.elements[s];s++)G.isInlineInput(a)?this.drawInlineInput_(a):(G.isIcon(a)||G.isField(a))&&this.layoutField_(a)}layoutField_(e){const t=e.centerline-e.height/2;let s=e.xPos;var a="";this.info_.RTL&&(s=-(s+e.width),e.flipRtl&&(s+=e.width,a="scale(-1 1)")),G.isIcon(e)?(a=e.icon,a.setOffsetInBlock(new Te(s,t)),this.info_.isInsertionMarker&&a.hideForInsertionMarker()):(e=e.field.getSvgRoot(),e.setAttribute("transform","translate("+s+","+t+")"+a),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const t=e.width,s=e.height,a=e.connectionOffsetY,d=e.connectionHeight+a;this.inlinePath_+=Ei(e.xPos+e.connectionWidth,e.centerline-s/2)+Ne("v",a)+e.shape.pathDown+Ne("v",s-d)+Ne("h",t-e.connectionWidth)+Ne("v",-s)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let s=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(s*=-1),e.connectionModel.setOffsetInBlock(s,t+e.connectionOffsetY)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(t!=null&&t.connectionModel){let s=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(s*=-1),t.connectionModel.setOffsetInBlock(s,e.yPos)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let s=e.xPos+e.width;this.info_.RTL&&(s*=-1),t.connectionModel.setOffsetInBlock(s,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,s=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-s:s,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const t of e.elements)if(t instanceof zn)if(t.highlighted)this.drawConnectionHighlightPath(t);else{let s,a;(a=(s=this.block_.pathObject).removeConnectionHighlight)==null||a.call(s,t.connectionModel)}}drawConnectionHighlightPath(e){const t=e.connectionModel;e=t.type===Le.INPUT_VALUE||t.type===Le.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const s=t.getSourceBlock();let a,d;(d=(a=s.pathObject).addConnectionHighlight)==null||d.call(a,t,e,t.getOffsetInBlock(),s.RTL)}getExpressionConnectionHighlightPath(e){let t="";return nc(e.shape)?t=e.shape.pathDown(e.height):Ud(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,Ut(0,-e)+Ne("v",e)+t+Ne("v",e)}getStatementConnectionHighlightPath(e){if(!Hd(e.shape))throw Error("Statement connections should have notch shapes");const t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return Ut(-t,0)+Ne("h",t)+e.shape.pathLeft+Ne("h",t)}};(function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"})(l.Align$$module$build$src$core$inputs$align||(l.Align$$module$build$src$core$inputs$align={})),l.Align$$module$build$src$core$inputs$align;var ir=class extends Mt{constructor(e,t,s){super(Mt.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==Mt.SKIP_SETUP&&(s?this.configure_(s):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&$e(this.getTextElement(),this.class)}doClassValidation_(e){return e==null?null:`${e}`}setClass(e){this.textElement_&&(this.class&&ke(this.textElement_,this.class),e&&$e(this.textElement_,e)),this.class=e}static fromJson(e){return new this(Dt(e.text),void 0,e)}};ks("field_label",ir),ir.prototype.DEFAULT_VALUE="";var cl=class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=l.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=l.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,s){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return(t||t===""&&s)&&(typeof t=="string"&&(t=l.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t})),t.setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(t),t.name=s,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered&&this.sourceBlock.queueRender()),e}removeField(e,t){for(let s=0,a;a=this.fieldRow[s];s++)if(a.name===e)return a.dispose(),this.fieldRow.splice(s,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(t)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let t=[];if(this.visible===e)return t;this.visible=e;for(let a=0,d;d=this.fieldRow[a];a++)d.setVisible(e);if(this.connection){var s=this.connection;e?t=s.startTrackingAll():s.stopTrackingAll(),(s=s.targetBlock())&&(s.getSvgRoot().style.display=e?"block":"none")}return t}markDirty(){for(let e=0,t;t=this.fieldRow[e];e++)t.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){for(const e of this.fieldRow)e.init()}initModel(){for(const e of this.fieldRow)e.initModel()}initField(e){this.sourceBlock.rendered?e.init():e.initModel()}dispose(){for(let e=0,t;t=this.fieldRow[e];e++)t.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}},fn=class extends cl{constructor(e,t){super(e,t),this.name=e,this.type=l.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},Xn=class extends cl{constructor(e,t){super(e,t),this.name=e,this.type=l.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},Ts=class extends cl{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=l.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(Le.NEXT_STATEMENT)}},Mp;l.ValueInput$$module$build$src$core$inputs$value_input=class extends cl{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=l.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(Le.INPUT_VALUE)}},Mp={},Mp.ValueInput=l.ValueInput$$module$build$src$core$inputs$value_input;var Sa=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new Lp(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new jh(this.constants_),this.bottomRow=new Vh(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new Xh(this.constants_);this.inputRows.push(e);var t=this.block_.getIcons();for(let s=0,a;a=t[s];s++){const d=new Rp(this.constants_,a);this.isCollapsed&&!a.isShownWhenCollapsed()||e.elements.push(d)}t=void 0;for(let s=0,a;a=this.block_.inputList[s];s++)if(a.isVisible()){this.shouldStartNewRow_(a,t)&&(this.rows.push(e),e=new Xh(this.constants_),this.inputRows.push(e));for(let d=0,f;f=a.fieldRow[d];d++)e.elements.push(new al(this.constants_,f,a));this.addInput_(a,e),t=a}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new wp(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const t=(this.block_.hat?this.block_.hat==="cap":this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let s=this.topRow.hasLeftSquareCorner(this.block_)?Ia:ya;this.topRow.elements.push(new s(this.constants_)),t?(e=new Wh(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new Np(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof Ts&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,s=this.topRow.hasRightSquareCorner(this.block_)?Ia:ya,this.topRow.elements.push(new s(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof Ts?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new Ia(this.constants_)):this.bottomRow.elements.push(new ya(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new Ap(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new Ia(this.constants_,"right")):this.bottomRow.elements.push(new ya(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new zh(this.constants_,e)),t.hasInlineInput=!0):e instanceof Ts?(t.elements.push(new va(this.constants_,e)),t.hasStatement=!0):e instanceof l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Wc(this.constants_,e)),t.hasExternalInput=!0):(e instanceof fn||e instanceof Xn)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),t.align===null&&(t.align=e.align)}shouldStartNewRow_(e,t){return t?t instanceof Xn||e instanceof Ts||t instanceof Ts?!0:e instanceof l.ValueInput$$module$build$src$core$inputs$value_input||e instanceof fn||t instanceof l.ValueInput$$module$build$src$core$inputs$value_input?!this.isInline:!1:!1}addElemSpacing_(){for(let e=0,t;t=this.rows[e];e++){const s=t.elements;if(t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new $s(this.constants_,this.getInRowSpacing_(null,s[0]))),s.length){for(let a=0;a<s.length-1;a++){t.elements.push(s[a]);const d=this.getInRowSpacing_(s[a],s[a+1]);t.elements.push(new $s(this.constants_,d))}t.elements.push(s[s.length-1]),t.endsWithElemSpacer()&&t.elements.push(new $s(this.constants_,this.getInRowSpacing_(s[s.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&G.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&G.isInput(e)&&!t){if(G.isExternalInput(e))return this.constants_.NO_PADDING;if(G.isInlineInput(e))return this.constants_.LARGE_PADDING;if(G.isStatementInput(e))return this.constants_.NO_PADDING}return e&&G.isLeftSquareCorner(e)&&t&&(G.isPreviousConnection(t)||G.isNextConnection(t))?t.notchOffset:e&&G.isLeftRoundedCorner(e)&&t&&(G.isPreviousConnection(t)||G.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,t=0,s=0;for(let d=0,f;f=this.rows[d];d++){if(f.measure(),t=Math.max(t,f.width),f.hasStatement){var a=f.getLastInput();let S,x;a=f.width-((x=(S=a)==null?void 0:S.width)!=null?x:0),e=Math.max(e,a)}s=Math.max(s,f.widthWithConnectedBlocks)}this.statementEdge=e,this.width=t;for(let d=0,f;f=this.rows[d];d++)f.hasStatement&&(f.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(t,s),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let t=0,s;s=this.rows[t];t++)if(s.hasStatement)this.alignStatementRow_(s);else{var e=s.width;e=this.getDesiredRowWidth_(s)-e,0<e&&this.addAlignmentPadding_(s,e),G.isTopOrBottomRow(s)&&(s.widthWithConnectedBlocks=s.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){const s=e.getFirstSpacer(),a=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===l.Align$$module$build$src$core$inputs$align.LEFT&&a)a.width+=t;else if(e.align===l.Align$$module$build$src$core$inputs$align.CENTRE&&s&&a)s.width+=t/2,a.width+=t/2;else if(e.align===l.Align$$module$build$src$core$inputs$align.RIGHT&&s)s.width+=t;else if(a)a.width+=t;else return;e.width+=t}alignStatementRow_(e){const t=e.getLastInput();if(t){var s=e.width-t.width,a=this.statementEdge;s=a-s,0<s&&this.addAlignmentPadding_(e,s),s=e.width,a=this.getDesiredRowWidth_(e),t.width+=a-s,t.height=Math.max(t.height,e.height),e.width+=a-s,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let t=0;t<e.length;t++)this.rows.push(e[t]),t!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}makeSpacerRow_(e,t){var s=this.getSpacerRowHeight_(e,t);const a=this.getSpacerRowWidth_(e,t);return s=new Yh(this.constants_,s,a),e.hasStatement&&(s.followsStatement=!0),t.hasStatement&&(s.precedesStatement=!0),s}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return G.isSpacer(t)?e.yPos+t.height/2:G.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,G.isNextConnection(t)?e+t.height/2:e-t.height/2):G.isTopRow(e)?G.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(e){let t=e.xPos;for(let s=0,a;a=e.elements[s];s++)G.isSpacer(a)&&(a.height=e.height),a.xPos=t,a.centerline=this.getElemCenterline_(e,a),t+=a.width}finalize_(){let e=0,t=0;for(let s=0,a;a=this.rows[s];s++)a.yPos=t,a.xPos=this.startX,t+=a.height,e=Math.max(e,a.widthWithConnectedBlocks),this.recordElemPositions_(a);if(this.outputConnection&&this.block_.nextConnection){const s=this.block_.nextConnection.targetBlock();s&&(e=Math.max(e,s.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline,this.bottomRow.baseline=t-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let t;if(((t=this.outputConnection)==null?void 0:t.connectionModel)===e)return this.outputConnection;for(const s of this.rows)for(const a of s.elements)if(a instanceof zn&&a.connectionModel===e)return a;return null}},Kh=class extends Ko{constructor(e){if(super(e),this.type=l.DELETE$$module$build$src$core$events$utils,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Mo(e),this.ids=he(e),this.wasShadow=e.isShadow(),this.oldJson=qe(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(this.wasShadow===void 0)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=Os(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Kh),t.oldXml=l.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||t.oldXml.tagName.toLowerCase()==="shadow",t.oldJson=e.oldJson,e.recordUndo!==void 0&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const s=this.ids[e],a=t.getBlockById(s);a?a.dispose(!1):s===this.blockId&&console.warn("Can't delete non-existent block: "+s)}else Bi(this.oldJson,t)}};h(pe.EVENT,l.DELETE$$module$build$src$core$events$utils,Kh);var vt=class{constructor(e,t){this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e}connect_(e){const t=Le.INPUT_VALUE,s=this.getSourceBlock();var a=e.getSourceBlock();e.isConnected()&&e.disconnectInternal(!1);let d;if(this.isConnected()){const S=this.stashShadowState(),x=this.targetBlock();x.isShadow()?x.dispose(!1):(this.disconnectInternal(),d=x),this.applyShadowState(S)}let f;se()&&(f=new(j(l.MOVE$$module$build$src$core$events$utils))(a),f.setReason(["connect"])),Gd(this,e),a.setParent(s),f&&(f.recordNew(),B(f)),d&&(e=this.type===t?d.outputConnection:d.previousConnection)&&((a=vt.getConnectionForOrphanedConnection(a,e))?e.connect(a):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.isSuperior()&&this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===Le.INPUT_VALUE||this.type===Le.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const t=l.getGroup$$module$build$src$core$events$utils();t||l.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),l.setGroup$$module$build$src$core$events$utils(t)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:t,childConnection:s}=this.getParentAndChildConnections();if(!t||!s)throw Error("Source connection not connected.");const a=l.getGroup$$module$build$src$core$events$utils();a||l.setGroup$$module$build$src$core$events$utils(!0);let d;se()&&(d=new(j(l.MOVE$$module$build$src$core$events$utils))(s.getSourceBlock()),d.setReason(["disconnect"]));const f=this.targetConnection;f&&(f.targetConnection=null),this.targetConnection=null,e&&s.getSourceBlock().setParent(null),d&&(d.recordNew(),B(d)),s.getSourceBlock().isShadow()||t.respawnShadow_(),l.setGroup$$module$build$src$core$events$utils(a)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){if(this.getSourceBlock().isDeadOrDying())return!1;var s;return t=(s=e.getInput(t))==null?void 0:s.connection,s=this.targetBlock(),s&&s!==e||!t||t.targetConnection===this?!1:(t.isConnected()&&t.disconnect(),t.connect(this),!0)}targetBlock(){if(this.isConnected()){let e,t;return(t=(e=this.targetConnection)==null?void 0:e.getSourceBlock())!=null?t:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Xs(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?qe(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const t=this.sourceBlock_.inputList;for(let s=0;s<t.length;s++)if(t[s].connection===this){e=t[s];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var t="Output Connection of ";else if(e.previousConnection===this)t="Previous Connection of ";else if(e.nextConnection===this)t="Next Connection of ";else{t=null;for(let s=0,a;a=e.inputList[s];s++)if(a.connection===this){t=a;break}if(t)t='Input "'+t.name+'" connection on ';else return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection"}return t+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,this.getSourceBlock().isDeadOrDying()||((e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(e){var t=this.getSourceBlock();const s=this.getShadowState(),a=this.getShadowDom();if(t.isDeadOrDying()||!s&&!a)return null;if(s)return t=zt(s,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(a){if(t=ln(a,t.workspace),e)if(this.type===Le.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else if(this.type===Le.NEXT_STATEMENT){if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}else throw Error("Cannot connect a shadow block to a previous/output connection");return t}return null}serializeShadow(e){e&&(this.shadowDom=Xs(e),this.shadowState=qe(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===Le.OUTPUT_VALUE)return Wd(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);const s=t.getConnectionChecker();return e&&s.canConnect(t,e,!1)?e:null}};vt.CAN_CONNECT=0,vt.REASON_SELF_CONNECTION=1,vt.REASON_WRONG_TYPE=2,vt.REASON_TARGET_NULL=3,vt.REASON_CHECKS_FAILED=4,vt.REASON_DIFFERENT_WORKSPACES=5,vt.REASON_SHADOW_PARENT=6,vt.REASON_DRAG_CHECKS_FAILED=7,vt.REASON_PREVIOUS_AND_OUTPUT=8;var sr=class{constructor(e,t,s){if(this.data=null,this.disposed=!1,this.hue_=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper_=this.helpUrl=null,this.statementInputCount=0,this.workspace=e,this.id=s&&!e.getBlockById(s)?s:D(),e.setBlockById(this.id,this),this.xy_=new Te(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,s=ss[t],!s||typeof s!="object")throw TypeError("Invalid block definition for type: "+t);Object.assign(this,s)}e.addTopBlock(this),e.addTypedBlock(this),new.target===sr&&this.doInit_()}doInit_(){const e=l.getGroup$$module$build$src$core$events$utils();e||l.setGroup$$module$build$src$core$events$utils(!0);const t=V();try{typeof this.init=="function"&&(l.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),l.setRecordUndo$$module$build$src$core$events$utils(t)),se()&&B(new(j(l.CREATE$$module$build$src$core$events$utils))(this))}finally{l.setGroup$$module$build$src$core$events$utils(e),l.setRecordUndo$$module$build$src$core$events$utils(t)}this.inputsInlineDefault=this.inputsInline,typeof this.onchange=="function"&&this.setOnChange(this.onchange)}dispose(e=!1){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(e),se()&&B(new(j(l.DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),typeof this.destroy=="function"&&this.destroy(),this.childBlocks_.forEach(e=>e.disposeInternal()),this.inputList.forEach(e=>e.dispose()),this.inputList.length=0,this.getConnections_(!0).forEach(e=>e.dispose()),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(const e of this.inputList)e.initModel();this.initialized=!0}}unplug(e){this.outputConnection&&this.unplugFromRow_(e),this.previousConnection&&this.unplugFromStack_(e)}unplugFromRow_(e){let t=null,s;(s=this.outputConnection)!=null&&s.isConnected()&&(t=this.outputConnection.targetConnection,this.outputConnection.disconnect()),t&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow()&&(e=e.targetConnection,e==null||e.disconnect(),this.workspace.connectionChecker.canConnect(e,t,!1)?t.connect(e):e==null||e.onFailedConnect(t))}getOnlyValueConnection_(){let e=null;for(let t=0;t<this.inputList.length;t++){const s=this.inputList[t].connection;if(s&&s.type===Le.INPUT_VALUE&&s.targetConnection){if(e)return null;e=s}}return e}unplugFromStack_(e){let t=null;var s;if((s=this.previousConnection)!=null&&s.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),s=this.getNextBlock(),e&&s&&!s.isShadow()){let a,d;e=(d=(a=this.nextConnection)==null?void 0:a.targetConnection)!=null?d:null,e==null||e.disconnect(),t&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let t=0,s;s=this.inputList[t];t++)s.connection&&e.push(s.connection);return e}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){const s=t.targetBlock();if(!s||e&&s.isShadow())return t;t=s.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let t=0,s;s=this.inputList[t];t++)if(s.connection&&s.connection.targetBlock()===e)return s;return null}getSurroundParent(){let e=this,t;do if(t=e,e=e.getParent(),!e)return null;while(e.getNextBlock()===t);return e}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;do e=t,t=e.parentBlock_;while(t);return e}getTopStackBlock(){let e=this,t;do t=e.getPreviousBlock();while(t&&t.getNextBlock()===e&&(e=t));return e}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let s=0,a;a=this.inputList[s];s++)if(a.connection){var t=a.connection.targetBlock();t&&e.push(t)}return(t=this.getNextBlock())&&e.push(t),e}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),s=!!t;if(s&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!s&&e)throw Error("Block not connected to new parent.");if(s&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?it(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const t=[this],s=this.getChildren(e);for(let a,d=0;a=s[d];d++)t.push(...a.getDescendants(e));return t}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable_}setDeletable(e){this.deletable_=e}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable_}setMovable(e){this.movable_=e}isDuplicatable(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(be(this,!0)):!0}isShadow(){return this.isShadow_}setShadow(e){this.isShadow_=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable_}setEditable(e){this.editable_=e;for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)d.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,t){const s=this.getConnections_(!0);if(e=e.getConnections_(!0),s.length!==e.length)throw Error("Connection lists did not match in length.");for(let a=0;a<e.length;a++)if(e[a]===t)return s[a];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return yn(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(e){e=Ws(e),this.hue_=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&typeof e!="function")throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=e,this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)}getField(e){if(typeof e!="string")throw TypeError("Block.prototype.getField expects a string with the field name but received "+(e===void 0?"nothing":e+" of type "+typeof e)+" instead");for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)if(d.name===e)return d;return null}getVars(){const e=[];for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)d.referencesVariables()&&e.push(d.getValue());return e}getVarModels(){const e=[];for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)if(d.referencesVariables()){const f=this.workspace.getVariableById(d.getValue());f&&e.push(f)}return e}updateVarName(e){for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)d.referencesVariables()&&e.getId()===d.getValue()&&d.refreshVariableName()}renameVarById(e,t){for(let s=0,a;a=this.inputList[s];s++)for(let d=0,f;f=a.fieldRow[d];d++)f.referencesVariables()&&e===f.getValue()&&f.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){const s=this.getField(t);if(!s)throw Error('Field "'+t+'" not found.');s.setValue(e)}setPreviousStatement(e,t){if(e)t===void 0&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(Le.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)t===void 0&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(Le.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)t===void 0&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(Le.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(this.inputsInline!==void 0)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof fn&&this.inputList[e]instanceof fn)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof l.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof fn)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof Xn)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return this.disabledReasons.size===0}get disabled(){return oo("disabled","v11","v12","the isEnabled or hasDisabledReason methods of Block"),this.hasDisabledReason(Rs)}set disabled(e){oo("disabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(e,Rs)}setEnabled(e){oo("setEnabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(!e,Rs)}setDisabledReason(e,t){this.disabledReasons.has(t)!==e&&(e?this.disabledReasons.add(t):this.disabledReasons.delete(t),e=new(j(l.CHANGE$$module$build$src$core$events$utils))(this,"disabled",null,!e,e),e.setDisabledReason(t),B(e))}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(!e.isEnabled())return!0;e=e.getSurroundParent()}return!1}hasDisabledReason(e){return this.disabledReasons.has(e)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let a=2;a<t.length;a++)t[a-2]==="("&&t[a]===")"&&(t[a-2]=t[a-1],t.splice(a-1,2));let s="";return t=t.reduce((a,d)=>(a=a+(s==="("||d===")"?"":" ")+d,s=d[d.length-1],a),""),t=t.trim()||"???",e&&t.length>e&&(t=t.substring(0,e-3)+"..."),t}toTokens(e="?"){const t=[];for(const a of this.inputList)if(a.name!=ca){for(const d of a.fieldRow)t.push(d.getText());if(a.connection){const d=a.connection.targetBlock();if(d){var s=a.connection;let f=s.getCheck();!f&&s.targetConnection&&(f=s.targetConnection.getCheck()),(s=!!f&&(f.includes("Boolean")||f.includes("Number")))&&t.push("("),t.push(...d.toTokens(e)),s&&t.push(")")}else t.push(e)}}return t}appendValueInput(e){return this.appendInput(new l.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new Ts(e,this))}appendDummyInput(e=""){return this.appendInput(new fn(e,this))}appendEndRowInput(e=""){return this.appendInput(new Xn(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=I(pe.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var s=0;e["args"+s];){if(e["message"+s]===void 0)throw Error(t+`args${s} must have a corresponding message (message${s}).`);s++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle_(e,t):this.jsonInitColour_(e,t),s=0;e["message"+s]!==void 0;)this.interpolate_(e["message"+s],e["args"+s]||[],e["implicitAlign"+s]||e["lastDummyAlign"+s],t),s++;if(e.inputsInline!==void 0&&(l.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),l.enable$$module$build$src$core$events$utils()),e.output!==void 0&&this.setOutput(!0,e.output),e.outputShape!==void 0&&this.setOutputShape(e.outputShape),e.previousStatement!==void 0&&this.setPreviousStatement(!0,e.previousStatement),e.nextStatement!==void 0&&this.setNextStatement(!0,e.nextStatement),e.tooltip!==void 0&&(s=Dt(e.tooltip),this.setTooltip(s)),e.enableContextMenu!==void 0&&(this.contextMenu=!!e.enableContextMenu),e.suppressPrefixSuffix!==void 0&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),e.helpUrl!==void 0&&(s=Dt(e.helpUrl),this.setHelpUrl(s)),typeof e.extensions=="string"&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),e.mutator!==void 0&&Nr(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)Nr(e[t],this,!1)}jsonInitColour_(e,t){if("colour"in e)if(e.colour===void 0)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch{console.warn(t+"Illegal colour value: ",e)}}}jsonInitStyle_(e,t){e=e.style;try{this.setStyle(e)}catch{console.warn(t+"Style does not exist: ",e)}}mixin(e,t){if(t!==void 0&&typeof t!="boolean")throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(const s in e)this[s]!==void 0&&t.push(s);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate_(e,t,s,a){e=wo(e),this.validateTokens_(e,t.length),t=this.interpolateArguments_(e,t,s),s=[];for(let d=0,f;f=t[d];d++)if(this.isInputKeyword_(f.type)){if(e=this.inputFromJson_(f,a)){for(let S=0,x;x=s[S];S++)e.appendField(x[0],x[1]);s.length=0}}else(e=this.fieldFromJson_(f))&&s.push([e,f.name])}validateTokens_(e,t){const s=[];let a=0;for(let d=0;d<e.length;d++){const f=e[d];if(typeof f=="number"){if(1>f||f>t)throw Error('Block "'+this.type+'": Message index %'+f+" out of range.");if(s[f])throw Error('Block "'+this.type+'": Message index %'+f+" duplicated.");s[f]=!0,a++}}if(a!==t)throw Error('Block "'+this.type+'": Message does not reference all '+t+" arg(s).")}interpolateArguments_(e,t,s){const a=[];for(let f=0;f<e.length;f++){var d=e[f];if(typeof d=="number"&&(d=t[d-1]),typeof d=="string"){if(d===`
`)d={type:"input_end_row"},s&&(d.align=s);else if(d=this.stringToFieldJson_(d),!d)continue}a.push(d)}return(e=a.length)&&!this.isInputKeyword_(a[e-1].type)&&(e={type:"input_dummy"},s&&(e.align=s),a.push(e)),a}fieldFromJson_(e){const t=l.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?typeof e.alt=="string"?(e=this.stringToFieldJson_(e.alt))?this.fieldFromJson_(e):null:this.fieldFromJson_(e.alt):t}inputFromJson_(e,t){var s={LEFT:l.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:l.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:l.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:l.Align$$module$build$src$core$inputs$align.CENTRE};let a;switch(e.type){case"input_value":a=this.appendValueInput(e.name);break;case"input_statement":a=this.appendStatementInput(e.name);break;case"input_dummy":a=this.appendDummyInput(e.name);break;case"input_end_row":a=this.appendEndRowInput(e.name);break;default:a=this.appendInputFromRegistry(e.type,e.name)}return a?(e.check&&a.setCheck(e.check),e.align&&(s=s[e.align.toUpperCase()],s===void 0?console.warn(t+"Illegal align value: ",e.align):a.setAlign(s)),a):null}isInputKeyword_(e){return e==="input_value"||e==="input_statement"||e==="input_dummy"||e==="input_end_row"||v(pe.INPUT,e)}stringToFieldJson_(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,t){if(e!==t){var s=-1,a=t?-1:this.inputList.length;for(let d=0,f;f=this.inputList[d];d++)if(f.name===e){if(s=d,a!==-1)break}else if(t&&f.name===t&&(a=d,s!==-1))break;if(s===-1)throw Error('Named input "'+e+'" not found.');if(a===-1)throw Error('Reference input "'+t+'" not found.');this.moveNumberedInputBefore(s,a)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");const s=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,s)}removeInput(e,t){for(let s=0,a;a=this.inputList[s];s++)if(a.name===e)return a instanceof Ts&&this.statementInputCount--,a.dispose(),this.inputList.splice(s,1),!0;if(t)return!1;throw Error("Input not found: "+e)}getInput(e){for(let t=0,s;s=this.inputList[t];t++)if(s.name===e)return s;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,t;return(t=(e=this.getIcon(_i.COMMENT))==null?void 0:e.getText())!=null?t:null}setCommentText(e){var t;let s;const a=(s=(t=this.getIcon(_i.COMMENT))==null?void 0:t.getText())!=null?s:null;if(a!==e){if(e!==null){if(t=this.getIcon(_i.COMMENT),!t){if(t=I(pe.ICON,_i.COMMENT.toString(),!1),!t)throw Error("No comment icon class is registered, so a comment cannot be set");if(t=new t(this),!zd(t))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");t=this.addIcon(t)}l.disable$$module$build$src$core$events$utils(),t.setText(e),l.enable$$module$build$src$core$events$utils()}else this.removeIcon(_i.COMMENT);B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this,"comment",null,a,e))}}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new kp(e);return this.icons.push(e),this.icons.sort((t,s)=>t.getWeight()-s.getWeight()),e}removeIcon(e){if(!this.hasIcon(e))return!1;let t;return(t=this.getIcon(e))==null||t.dispose(),this.icons=this.icons.filter(s=>!s.getType().equals(e)),!0}hasIcon(e){return this.icons.some(t=>t.getType().equals(e))}getIcon(e){return e instanceof _i?this.icons.find(t=>t.getType().equals(e)):this.icons.find(t=>t.getType().toString()===e)}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy_}moveBy(e,t,s){if(this.parentBlock_)throw Error("Block has parent");const a=new(j(l.MOVE$$module$build$src$core$events$utils))(this);s&&a.setReason(s),this.xy_.translate(e,t),a.recordNew(),B(a)}makeConnection_(e){return new vt(this,e)}allInputsFilled(e){if(e===void 0&&(e=!0),!e&&this.isShadow())return!1;for(let s=0,a;a=this.inputList[s];s++)if(a.connection){var t=a.connection.targetBlock();if(!t||!t.allInputsFilled(e))return!1}return(t=this.getNextBlock())?t.allInputsFilled(e):!0}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};sr.COLLAPSED_INPUT_NAME=ca,sr.COLLAPSED_FIELD_NAME=bc;var Ns=class{constructor(e,t,s,a){this.workspace=e,this.targetWorkspace=t,this.isFlyoutLabel=a,this.onMouseUpWrapper=null,this.height=this.width=0,this.cursorSvg=this.svgText=this.svgGroup=null,this.text=s.text,this.position=new Te(0,0),this.callbackKey=s.callbackKey||s.callbackkey,this.cssClass=s["web-class"]||null,this.info=s}createDom(){var e=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton";this.cssClass&&(e+=" "+this.cssClass),this.svgGroup=J(Y.G,{class:e},this.workspace.getCanvas());let t;this.isFlyoutLabel||(t=J(Y.RECT,{class:"blocklyFlyoutButtonShadow",rx:Ns.BORDER_RADIUS,ry:Ns.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=J(Y.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:Ns.BORDER_RADIUS,ry:Ns.BORDER_RADIUS},this.svgGroup);const s=J(Y.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var a=Dt(this.text);this.workspace.RTL&&(a+="‏"),s.textContent=a,this.isFlyoutLabel&&(this.svgText=s,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const d=ae(s,"fontSize"),f=ae(s,"fontWeight"),S=ae(s,"fontFamily");if(this.width=pt(s,d,f,S),a=E(a,d,f,S),this.height=a.height,!this.isFlyoutLabel){this.width+=2*Ns.TEXT_MARGIN_X,this.height+=2*Ns.TEXT_MARGIN_Y;let x;(x=t)==null||x.setAttribute("width",String(this.width));let Z;(Z=t)==null||Z.setAttribute("height",String(this.height))}return e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),s.setAttribute("x",String(this.width/2)),s.setAttribute("y",String(this.height/2-a.height/2+a.baseline)),this.updateTransform(),this.onMouseUpWrapper=ee(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){this.onMouseUpWrapper&&Ee(this.onMouseUpWrapper),this.svgGroup&&M(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(e){e?this.svgGroup&&(this.svgGroup.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(){throw Error("Attempted to set a marker on a button.")}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};Ns.TEXT_MARGIN_X=5,Ns.TEXT_MARGIN_Y=2,Ns.BORDER_RADIUS=4,Ue(`
.blocklyFlyoutButton {
  fill: #888;
  cursor: default;
}

.blocklyFlyoutButtonShadow {
  fill: #666;
}

.blocklyFlyoutButton:hover {
  fill: #aaa;
}

.blocklyFlyoutLabel {
  cursor: default;
}

.blocklyFlyoutLabelBackground {
  opacity: 0;
}
`);var ce=class{constructor(e,t,s){if(this.wsCoordinate=null,!t)throw Error("Cannot create a node without a location.");this.type=e,this.isConnectionLocation=ce.isConnectionType(e),this.location=t,this.processParams(s||null)}processParams(e){e&&e.wsCoordinate&&(this.wsCoordinate=e.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var e=this.location.getParentInput();const t=e.getSourceBlock();for(e=t.inputList.indexOf(e),e+=1;e<t.inputList.length;e++){const s=t.inputList[e],a=s.fieldRow;for(let d=0;d<a.length;d++){const f=a[d];if(f.isClickable()||ce.NAVIGATE_ALL_FIELDS)return ce.createFieldNode(f)}if(s.connection)return ce.createInputNode(s)}return null}findNextForField(){var e=this.location,t=e.getParentInput();const s=e.getSourceBlock();if(!s)throw Error("The current AST location is not associated with a block");var a=s.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)+1;a<s.inputList.length;a++){t=s.inputList[a];const d=t.fieldRow;for(;e<d.length;){if(d[e].isClickable()||ce.NAVIGATE_ALL_FIELDS)return ce.createFieldNode(d[e]);e++}if(e=0,t.connection)return ce.createInputNode(t)}return null}findPrevForInput(){const e=this.location.getParentInput(),t=e.getSourceBlock();for(var s=t.inputList.indexOf(e);0<=s;s--){var a=t.inputList[s];if(a.connection&&a!==e)return ce.createInputNode(a);a=a.fieldRow;for(let d=a.length-1;0<=d;d--){const f=a[d];if(f.isClickable()||ce.NAVIGATE_ALL_FIELDS)return ce.createFieldNode(f)}}return null}findPrevForField(){var e=this.location;const t=e.getParentInput(),s=e.getSourceBlock();if(!s)throw Error("The current AST location is not associated with a block");var a=s.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)-1;0<=a;a--){var d=s.inputList[a];if(d.connection&&d!==t)return ce.createInputNode(d);for(d=d.fieldRow;-1<e;){if(d[e].isClickable()||ce.NAVIGATE_ALL_FIELDS)return ce.createFieldNode(d[e]);e--}0<=a-1&&(e=s.inputList[a-1].fieldRow.length-1)}return null}navigateBetweenStacks(e){var t=this.getLocation();if(t.getSourceBlock){var s=t.getSourceBlock();s&&(t=s)}if(!t||t.isDeadOrDying())return null;if(t.workspace.isFlyout)return this.navigateFlyoutContents(e);s=t.getRootBlock(),t=s.workspace.getTopBlocks(!0);for(let a=0;a<t.length;a++)if(s.id===t[a].id)return e=a+(e?1:-1),e===-1||e===t.length?null:ce.createStackNode(t[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")}navigateFlyoutContents(e){let t;switch(this.getType()){case ce.types.STACK:t=this.getLocation();var s=t.workspace.targetWorkspace;break;case ce.types.BUTTON:t=this.getLocation(),s=t.getTargetWorkspace();break;default:return null}return s=s.getFlyout(),s&&(e=this.findNextLocationInFlyout(s.getContents(),t,e))?e.type==="button"&&e.button?ce.createButtonNode(e.button):e.type==="block"&&e.block?ce.createStackNode(e.block):null:null}findNextLocationInFlyout(e,t,s){const a=e.findIndex(d=>t instanceof sr&&d.block===t||t instanceof Ns&&d.button===t);return 0>a?null:(s=s?a+1:a-1,s===-1||s===e.length?null:e[s])}findTopASTNodeForBlock(e){const t=ql(e);return t?ce.createConnectionNode(t):ce.createBlockNode(e)}getOutAstNodeForBlock(e){if(!e)return null;e=e.getTopStackBlock();const t=ql(e);return t&&t.targetConnection&&t.targetConnection.getParentInput()?ce.createInputNode(t.targetConnection.getParentInput()):ce.createStackNode(e)}findFirstFieldOrInput(e){e=e.inputList;for(let t=0;t<e.length;t++){const s=e[t],a=s.fieldRow;for(let d=0;d<a.length;d++){const f=a[d];if(f.isClickable()||ce.NAVIGATE_ALL_FIELDS)return ce.createFieldNode(f)}if(s.connection)return ce.createInputNode(s)}return null}getSourceBlock(){return this.getType()===ce.types.BLOCK?this.getLocation():this.getType()===ce.types.STACK?this.getLocation():this.getType()===ce.types.WORKSPACE||this.getType()===ce.types.BUTTON?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case ce.types.STACK:return this.navigateBetweenStacks(!0);case ce.types.OUTPUT:return ce.createBlockNode(this.location.getSourceBlock());case ce.types.FIELD:return this.findNextForField();case ce.types.INPUT:return this.findNextForInput();case ce.types.BLOCK:const e=this.location.nextConnection;if(!e)break;return ce.createConnectionNode(e);case ce.types.PREVIOUS:return ce.createBlockNode(this.location.getSourceBlock());case ce.types.NEXT:return ce.createConnectionNode(this.location.targetConnection);case ce.types.BUTTON:return this.navigateFlyoutContents(!0)}return null}in(){switch(this.type){case ce.types.WORKSPACE:const e=this.location.getTopBlocks(!0);if(0<e.length)return ce.createStackNode(e[0]);break;case ce.types.STACK:return this.findTopASTNodeForBlock(this.location);case ce.types.BLOCK:return this.findFirstFieldOrInput(this.location);case ce.types.INPUT:return ce.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case ce.types.STACK:return this.navigateBetweenStacks(!1);case ce.types.FIELD:return this.findPrevForField();case ce.types.INPUT:return this.findPrevForInput();case ce.types.BLOCK:var e=ql(this.location);if(!e)break;return ce.createConnectionNode(e);case ce.types.PREVIOUS:if((e=this.location.targetConnection)&&!e.getParentInput())return ce.createConnectionNode(e);break;case ce.types.NEXT:return ce.createBlockNode(this.location.getSourceBlock());case ce.types.BUTTON:return this.navigateFlyoutContents(!1)}return null}out(){switch(this.type){case ce.types.STACK:var e=this.location,t=e.getRelativeToSurfaceXY();return t=new Te(t.x,t.y+ce.DEFAULT_OFFSET_Y),ce.createWorkspaceNode(e.workspace,t);case ce.types.OUTPUT:return e=this.location,(t=e.targetConnection)?ce.createConnectionNode(t):ce.createStackNode(e.getSourceBlock());case ce.types.FIELD:if(e=this.location.getSourceBlock(),!e)throw Error("The current AST location is not associated with a block");return ce.createBlockNode(e);case ce.types.INPUT:return ce.createBlockNode(this.location.getSourceBlock());case ce.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case ce.types.PREVIOUS:return this.getOutAstNodeForBlock(this.location.getSourceBlock());case ce.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(e){switch(e){case ce.types.PREVIOUS:case ce.types.NEXT:case ce.types.INPUT:case ce.types.OUTPUT:return!0}return!1}static createFieldNode(e){return e?new ce(ce.types.FIELD,e):null}static createConnectionNode(e){if(!e)return null;const t=e.type;return t===Le.INPUT_VALUE||t===Le.NEXT_STATEMENT&&e.getParentInput()?ce.createInputNode(e.getParentInput()):t===Le.NEXT_STATEMENT?new ce(ce.types.NEXT,e):t===Le.OUTPUT_VALUE?new ce(ce.types.OUTPUT,e):t===Le.PREVIOUS_STATEMENT?new ce(ce.types.PREVIOUS,e):null}static createInputNode(e){return e&&e.connection?new ce(ce.types.INPUT,e.connection):null}static createBlockNode(e){return e?new ce(ce.types.BLOCK,e):null}static createStackNode(e){return e?new ce(ce.types.STACK,e):null}static createButtonNode(e){return e?new ce(ce.types.BUTTON,e):null}static createWorkspaceNode(e,t){return t&&e?new ce(ce.types.WORKSPACE,e,{wsCoordinate:t}):null}static createTopNode(e){const t=ql(e);return t?ce.createConnectionNode(t):ce.createBlockNode(e)}};ce.NAVIGATE_ALL_FIELDS=!1,ce.DEFAULT_OFFSET_Y=-20,function(e){e=e.types||(e.types={}),e.FIELD="field",e.BLOCK="block",e.INPUT="input",e.OUTPUT="output",e.NEXT="next",e.PREVIOUS="previous",e.STACK="stack",e.WORKSPACE="workspace",e.BUTTON="button"}(ce||(ce={}));var Jh=class extends hn{constructor(e,t,s,a){let d=e?e.workspace.id:void 0;a&&a.getType()===ce.types.WORKSPACE&&(d=a.getLocation().id),super(d),this.type=Ur,this.blockId=e==null?void 0:e.id,this.oldNode=s||void 0,this.newNode=a,this.isCursor=t}toJson(){const e=super.toJson();if(this.isCursor===void 0)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Jh),t.isCursor=e.isCursor,t.blockId=e.blockId,t.oldNode=e.oldNode,t.newNode=e.newNode,t}};h(pe.EVENT,Ur,Jh);var Zf="blocklyCursor",qf="blocklyMarker",Qf=.75,Zh=class{constructor(e,t,s){this.workspace=e,this.marker=s,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=t,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=s.colour||e}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return this.marker.type==="cursor"}createDom(){const e=this.isCursor()?Zf:qf;return this.svgGroup_=J(Y.G,{class:e}),this.createDomInternal_(),this.svgGroup_}setParent_(e){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent=e}draw(e,t){if(t){this.constants_=this.workspace.getRenderer().getConstants();var s=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||s,this.applyColour_(t),this.showAtLocation_(t),this.fireMarkerEvent(e,t),e=this.currentMarkerSvg.childNodes[0],e!==void 0&&e.beginElement&&e.beginElement()}else this.hide()}showAtLocation_(e){const t=e.getLocation().type;e.getType()===ce.types.BLOCK?this.showWithBlock_(e):e.getType()===ce.types.OUTPUT?this.showWithOutput_(e):t===Le.INPUT_VALUE?this.showWithInput_(e):t===Le.NEXT_STATEMENT?this.showWithNext_(e):e.getType()===ce.types.PREVIOUS?this.showWithPrevious_(e):e.getType()===ce.types.FIELD?this.showWithField_(e):e.getType()===ce.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()===ce.types.STACK?this.showWithStack_(e):e.getType()===ce.types.BUTTON&&this.showWithButton_(e)}showWithBlockPrevOutput(e){e=e.getSourceBlock();const t=e.width;var s=e.height,a=s*Qf;const d=this.constants_.CURSOR_BLOCK_PADDING;e.previousConnection?(s=this.constants_.shapeFor(e.previousConnection),this.positionPrevious_(t,d,a,s)):e.outputConnection?(a=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(t,s,a)):this.positionBlock_(t,d,a),this.setParent_(e),this.showCurrent_()}showWithBlock_(e){this.showWithBlockPrevOutput(e)}showWithPrevious_(e){this.showWithBlockPrevOutput(e)}showWithOutput_(e){this.showWithBlockPrevOutput(e)}showWithCoordinates_(e){var t=e.getWsCoordinate();e=t.x,t=t.y,this.workspace.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,t,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(e){e=e.getLocation();const t=e.getSize().width,s=e.getSize().height;this.positionRect_(0,0,t,s),this.setParent_(e),this.showCurrent_()}showWithInput_(e){e=e.getLocation();const t=e.getSourceBlock();this.positionInput_(e),this.setParent_(t),this.showCurrent_()}showWithNext_(e){var t=e.getLocation();e=t.getSourceBlock();let s=0;t=t.getOffsetInBlock().y;const a=e.getHeightWidth().width;this.workspace.RTL&&(s=-a),this.positionLine_(s,t,a),this.setParent_(e),this.showCurrent_()}showWithStack_(e){e=e.getLocation();var t=e.getHeightWidth();const s=t.width+this.constants_.CURSOR_STACK_PADDING;t=t.height+this.constants_.CURSOR_STACK_PADDING;const a=-this.constants_.CURSOR_STACK_PADDING/2,d=-this.constants_.CURSOR_STACK_PADDING/2;let f=a;this.workspace.RTL&&(f=-(s+a)),this.positionRect_(f,d,s,t),this.setParent_(e),this.showCurrent_()}showWithButton_(e){e=e.getLocation();const t=e.width+this.constants_.CURSOR_STACK_PADDING,s=e.height+this.constants_.CURSOR_STACK_PADDING,a=-this.constants_.CURSOR_STACK_PADDING/2,d=-this.constants_.CURSOR_STACK_PADDING/2;let f=a;this.workspace.RTL&&(f=-(t+a)),this.positionRect_(f,d,t,s),this.setParent_(e),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(e,t,s){if(e=Ut(-t,s)+Ne("V",-t)+Ne("H",e+2*t)+Ne("V",s),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(e){const t=e.getOffsetInBlock().x,s=e.getOffsetInBlock().y;e=Ei(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+t+","+s+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(e,t,s){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${e}`),this.markerSvgLine_.setAttribute("y",`${t}`),this.markerSvgLine_.setAttribute("width",`${s}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(e,t,s){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");e=Ut(e,0)+Ne("h",-(e-s.width))+Ne("v",this.constants_.TAB_OFFSET_FROM_TOP)+s.pathDown+Ne("V",t)+Ne("H",e),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(e,t,s,a){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");e=Ut(-t,s)+Ne("V",-t)+Ne("H",this.constants_.NOTCH_OFFSET_LEFT)+a.pathLeft+Ne("H",e+2*t)+Ne("V",s),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(e,t,s,a){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${e}`),this.markerSvgRect_.setAttribute("y",`${t}`),this.markerSvgRect_.setAttribute("width",`${s}`),this.markerSvgRect_.setAttribute("height",`${a}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(e){e.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(e,t){const s=t.getSourceBlock();e=new(j(Ur))(s,this.isCursor(),e,t),B(e)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=J(Y.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=J(Y.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=J(Y.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=J(Y.PATH,{transform:""},this.markerSvg_),this.markerBlock_=J(Y.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();J(Y.ANIMATE,e,this.markerSvgLine_),J(Y.ANIMATE,e,this.markerInput_),J(Y.ANIMATE,Object.assign({},e,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(e){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",e),this.markerInput_.firstElementChild.setAttribute("values",e),this.markerBlock_.firstElementChild.setAttribute("values",e))}dispose(){this.svgGroup_&&M(this.svgGroup_)}},Yc=class{constructor(e,t,s){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=s,this.style=t,this.svgRoot=e,this.svgPath=J(Y.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?$e(this.svgRoot,e):ke(this.svgRoot,e))}updateHighlighted(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,s,a){if(this.connectionHighlights.has(e)){if(this.currentHighlightMatchesNew(e,t,s))return;this.removeConnectionHighlight(e)}t=J(Y.PATH,{class:"blocklyHighlightedConnectionPath",d:t,transform:`translate(${s.x}, ${s.y})`+(a?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(e,t)}currentHighlightMatchesNew(e,t,s){let a;const d=(a=this.connectionHighlights.get(e))==null?void 0:a.getAttribute("d");return e=this.highlightOffsets.get(e),d===t&&Te.equals(e,s)}removeConnectionHighlight(e){const t=this.connectionHighlights.get(e);t&&(M(t),this.connectionHighlights.delete(e))}},Ms=class{constructor(e){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,l.setSelected$$module$build$src$core$common(e),this.topBlock=e,this.workspace=e.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){l.disable$$module$build$src$core$events$utils(),this.hidePreview(),l.enable$$module$build$src$core$events$utils();var{local:e,closest:t}=this.activeCandidate;e.connect(t);var s=e.isSuperior()?t:e,a=this.topBlock.getRootBlock();_t().then(()=>{tt(s.getSourceBlock()),setTimeout(()=>{a.bringToFront()},0)})}}update(e,t){const s=this.getCandidate(e);((this.wouldDeleteBlock=this.shouldDelete(!!s,t))||this.shouldUpdatePreviews(s,e))&&(l.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(s),this.maybeShowPreview(s),l.enable$$module$build$src$core$events$utils())}createMarkerBlock(e){l.disable$$module$build$src$core$events$utils();let t;try{const s=qe(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!s)throw Error(`Failed to serialize source block. ${e.toDevString()}`);t=Bi(s,this.workspace);for(const a of t.getDescendants(!1))a.setInsertionMarker(!0);t.initSvg(),t.getSvgRoot().setAttribute("visibility","hidden")}finally{l.enable$$module$build$src$core$events$utils()}return t}initAvailableConnections(){const e=this.topBlock.getConnections_(!1),t=this.topBlock.lastConnectionInStack(!0);return t&&t!==this.topBlock.nextConnection&&(e.push(t),this.lastOnStack=t),e}shouldUpdatePreviews(e,t){if(!e)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:s,closest:a}=this.activeCandidate;if(a===e.closest&&s===e.local)return!1;const d=s.x+t.x-a.x;return t=s.y+t.y-a.y,e.radius<Math.sqrt(d*d+t*t)-l.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(e){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let t=this.getStartRadius(),s=null;for(let a=0;a<this.availableConnections.length;a++){const d=this.availableConnections[a],f=d.closest(t,e);f.connection&&(s={closest:f.connection,local:d,radius:f.radius},t=f.radius)}return s}getStartRadius(){return this.activeCandidate?l.config$$module$build$src$core$config.connectingSnapRadius:l.config$$module$build$src$core$config.snapRadius}shouldDelete(e,t){return t&&this.workspace.getComponentManager().hasCapability(t.id,bi.Capability.DELETE_AREA)?t.wouldDelete(this.topBlock):!1}maybeShowPreview(e){if(!this.wouldDeleteBlock&&e){var t=e.closest,s;t===((s=this.activeCandidate)==null?void 0:s.closest)||t.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=e,this.showPreview(this.activeCandidate))}}showPreview(e){const t=this.workspace.getRenderer();switch(t.getConnectionPreviewMethod(e.closest,e.local,this.topBlock)){case Ms.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(e);break;case Ms.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(e);break;case Ms.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(e)}t.shouldHighlightConnection(e.closest)&&e.closest.highlight()}maybeHidePreview(e){if(!e)this.hidePreview();else if(this.activeCandidate){const t=this.activeCandidate.local!==e.local;(this.activeCandidate.closest!==e.closest||t||this.wouldDeleteBlock)&&this.hidePreview()}this.activeCandidate=this.markerConnection=null}hidePreview(){let e;const t=(e=this.activeCandidate)==null?void 0:e.closest;t&&t.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(t)&&t.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(e){const{local:t,closest:s}=e;let a=(e=this.lastOnStack&&t===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!a)throw Error("Cannot show the insertion marker because there is no insertion marker block");let d;try{d=a.getMatchingConnection(t.getSourceBlock(),t)}catch{if(e&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),a=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),a=this.firstMarker=this.createMarkerBlock(this.topBlock)),!a)throw Error("Cannot show the insertion marker because there is no insertion marker block");d=a.getMatchingConnection(t.getSourceBlock(),t)}if(!d)throw Error("Cannot show the insertion marker because there is no associated connection");if(d===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");a.queueRender(),$i(),d.connect(s);const f={x:s.x-d.x,y:s.y-d.y},S=d.getOffsetInBlock().clone(),x=d;_t().then(()=>{let Z;(Z=a)==null||Z.positionNearConnection(x,f,S);let we;(we=a)==null||we.getSvgRoot().setAttribute("visibility","visible")}),this.markerConnection=d}hideInsertionMarker(){if(this.markerConnection){var e=this.markerConnection,t=e.getSourceBlock(),s=t.outputConnection,a;if((a=t.previousConnection)!=null&&a.targetConnection||s!=null&&s.targetConnection)t.unplug(!0);else{let d;(d=e.targetBlock())==null||d.unplug(!1)}if(e.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(e=t.getSvgRoot())&&e.setAttribute("visibility","hidden")}}showInsertionInputOutline(e){e=e.closest,this.highlightedBlock=e.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(e,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(e){if(this.fadedBlock=e.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const e=[];return this.firstMarker&&e.push(this.firstMarker),this.lastMarker&&e.push(this.lastMarker),e}disposeInsertionMarker(e){if(e){l.disable$$module$build$src$core$events$utils();try{e.dispose()}finally{l.enable$$module$build$src$core$events$utils()}}}};(function(e){e=e.PREVIEW_TYPE||(e.PREVIEW_TYPE={}),e[e.INSERTION_MARKER=0]="INSERTION_MARKER",e[e.INPUT_OUTLINE=1]="INPUT_OUTLINE",e[e.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"})(Ms||(Ms={})),Ms.PREVIEW_TYPE;var jc=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName())}refreshDom(e,t){const s=this.getConstants();s.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=s.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new zc}makeRenderInfo_(e){return new Sa(this,e)}makeDrawer_(e,t){return new Xc(e,t)}makeMarkerDrawer(e,t){return new Zh(e,this.getConstants(),t)}makePathObject(e,t){return new Yc(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,s){return!!vt.getConnectionForOrphanedConnection(e,s===Le.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}getConnectionPreviewMethod(e,t,s){return oo("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Le.OUTPUT_VALUE||t.type===Le.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(s,e.targetBlock(),t.type)?Ms.PREVIEW_TYPE.INSERTION_MARKER:Ms.PREVIEW_TYPE.REPLACEMENT_FADE:Ms.PREVIEW_TYPE.INSERTION_MARKER}render(e){const t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},Rt={};Rt.BottomRow=Vh,Rt.Connection=zn,Rt.ConstantProvider=zc,Rt.Drawer=Xc,Rt.ExternalValueInput=Wc,Rt.Field=al,Rt.Hat=Wh,Rt.Icon=Rp,Rt.InRowSpacer=$s,Rt.InlineInput=zh,Rt.InputConnection=fo,Rt.InputRow=Xh,Rt.JaggedEdge=wp,Rt.MarkerSvg=Zh,Rt.Measurable=pn,Rt.NextConnection=Ap,Rt.OutputConnection=Lp,Rt.PathObject=Yc,Rt.PreviousConnection=Np,Rt.RenderInfo=Sa,Rt.Renderer=jc,Rt.RoundCorner=ya,Rt.Row=ba,Rt.SpacerRow=Yh,Rt.SquareCorner=Ia,Rt.StatementInput=va,Rt.TopRow=jh,Rt.Types=G,Rt.init=fu,Rt.register=Ql,Rt.unregister=Xd;var xp=class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces_=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(t&&(t=t.getClassName())&&ke(e,t),(t=this.theme.getClassName())&&$e(e,t));for(let s=0,a;a=this.subscribedWorkspaces_[s];s++)a.refreshTheme();for(const[s,a]of this.componentDB)for(const d of a){e=d.element,t=d.propertyName;const f=this.theme&&this.theme.getComponentStyle(s);e.style.setProperty(t,f||"")}for(const s of this.subscribedWorkspaces_)s.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces_.push(e)}unsubscribeWorkspace(e){if(!it(this.subscribedWorkspaces_,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,s){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:s}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(s,t||"")}unsubscribe(e){if(e)for(const[t,s]of this.componentDB){for(let a=s.length-1;0<=a;a--)s[a].element===e&&s.splice(a,1);s.length||this.componentDB.delete(t)}}dispose(){this.subscribedWorkspaces_.length=0,this.componentDB.clear()}},qh="VARIABLE_DYNAMIC",nr={CATEGORY_NAME:qh};nr.flyoutCategory=oc,nr.flyoutCategoryBlocks=Tu,nr.onCreateVariableButtonClick_Colour=$u,nr.onCreateVariableButtonClick_Number=mu,nr.onCreateVariableButtonClick_String=gu;var Pp=30,or=[];or[Le.INPUT_VALUE]=Le.OUTPUT_VALUE,or[Le.OUTPUT_VALUE]=Le.INPUT_VALUE,or[Le.NEXT_STATEMENT]=Le.PREVIOUS_STATEMENT,or[Le.PREVIOUS_STATEMENT]=Le.NEXT_STATEMENT;var Qh="RENAME_VARIABLE_ID",ed="DELETE_VARIABLE_ID",Dp=class{canConnect(e,t,s,a){return this.canConnectWithReason(e,t,s,a)===vt.CAN_CONNECT}canConnectWithReason(e,t,s,a){const d=this.doSafetyChecks(e,t);return d!==vt.CAN_CONNECT?d:this.doTypeChecks(e,t)?s&&!this.doDragChecks(e,t,a||0)?vt.REASON_DRAG_CHECKS_FAILED:vt.CAN_CONNECT:vt.REASON_CHECKS_FAILED}getErrorMessage(e,t,s){switch(e){case vt.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case vt.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case vt.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case vt.REASON_TARGET_NULL:return"Target connection is null.";case vt.REASON_CHECKS_FAILED:return"Connection checks failed. "+(t+" expected "+t.getCheck()+", found "+s.getCheck());case vt.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case vt.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case vt.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return vt.REASON_TARGET_NULL;let s,a,d;return e.isSuperior()?(s=e.getSourceBlock(),a=t.getSourceBlock(),d=t):(a=e.getSourceBlock(),s=t.getSourceBlock(),d=e,e=t),s===a?vt.REASON_SELF_CONNECTION:d.type!==or[e.type]?vt.REASON_WRONG_TYPE:s.workspace!==a.workspace?vt.REASON_DIFFERENT_WORKSPACES:s.isShadow()&&!a.isShadow()?vt.REASON_SHADOW_PARENT:d.type===Le.OUTPUT_VALUE&&a.previousConnection&&a.previousConnection.isConnected()||d.type===Le.PREVIOUS_STATEMENT&&a.outputConnection&&a.outputConnection.isConnected()?vt.REASON_PREVIOUS_AND_OUTPUT:vt.CAN_CONNECT}doTypeChecks(e,t){if(e=e.getCheck(),t=t.getCheck(),!e||!t)return!0;for(let s=0;s<e.length;s++)if(t.includes(e[s]))return!0;return!1}doDragChecks(e,t,s){if(e.distanceFrom(t)>s||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case Le.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case Le.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case Le.INPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;case Le.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return!na.includes(t)}canConnectToPrevious_(e,t){return e.targetConnection||na.includes(t)?!1:t.targetConnection?(e=t.targetBlock(),e.isInsertionMarker()?!e.getPreviousBlock():!1):!0}};h(pe.CONNECTION_CHECKER,cn,Dp);var td=class extends ua{constructor(e){super(e),this.type=Bo,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new td),t.varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.deleteVariableById(this.varId):t.createVariable(this.varName,this.varType,this.varId)}};h(pe.EVENT,Bo,td);var id=class extends ua{constructor(e,t){super(e),this.type=Br,e&&(this.oldName=e.name,this.newName=typeof t>"u"?"":t)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new id),t.oldName=e.oldName,t.newName=e.newName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");e?t.renameVariableById(this.varId,this.newName):t.renameVariableById(this.varId,this.oldName)}};h(pe.EVENT,Br,id);var sd=class{constructor(e){this.workspace=e,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(;0<e.length;)this.deleteVariable(e[0]);if(this.variableMap.size!==0)throw Error("Non-empty variable map")}renameVariable(e,t){if(e.name!==t){var s=this.getVariable(t,e.type),a=this.workspace.getAllBlocks(!1),d=l.getGroup$$module$build$src$core$events$utils();d||l.setGroup$$module$build$src$core$events$utils(!0);try{s&&s.getId()!==e.getId()?this.renameVariableWithConflict_(e,t,s,a):this.renameVariableAndUses_(e,t,a)}finally{l.setGroup$$module$build$src$core$events$utils(d)}}}renameVariableById(e,t){const s=this.getVariableById(e);if(!s)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(s,t)}renameVariableAndUses_(e,t,s){for(B(new(j(Br))(e,t)),e.name=t,t=0;t<s.length;t++)s[t].updateVarName(e)}renameVariableWithConflict_(e,t,s,a){const d=e.type;for(t!==s.name&&this.renameVariableAndUses_(s,t,a),t=0;t<a.length;t++)a[t].renameVarById(e.getId(),s.getId());B(new(j(Bo))(e)),it(this.variableMap.get(d),e)}createVariable(e,t,s){var a=this.getVariable(e,t);if(a){if(s&&a.getId()!==s)throw Error('Variable "'+e+'" is already in use and its id is "'+a.getId()+'" which conflicts with the passed in id, "'+s+'".');return a}if(s&&this.getVariableById(s))throw Error('Variable id, "'+s+'", is already in use.');return a=s||D(),t=t||"",a=new ha(this.workspace,e,t,a),e=this.variableMap.get(t)||[],e.push(a),this.variableMap.delete(t),this.variableMap.set(t,e),B(new(j(Ln))(a)),a}deleteVariable(e){const t=e.getId(),s=this.variableMap.get(e.type);if(s){for(let a=0;a<s.length;a++)if(s[a].getId()===t){s.splice(a,1),B(new(j(Bo))(e)),s.length===0&&this.variableMap.delete(e.type);break}}}deleteVariableById(e){const t=this.getVariableById(e);if(t){var s=t.name;const a=this.getVariableUsesById(e);for(let d=0,f;f=a[d];d++)if(f.type==="procedures_defnoreturn"||f.type==="procedures_defreturn"){e=String(f.getFieldValue("NAME")),s=l.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",s).replace("%2",e),Fs(s);return}1<a.length?(s=l.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(a.length)).replace("%2",s),ji(s,d=>{d&&t&&this.deleteVariableInternal(t,a)})):this.deleteVariableInternal(t,a)}else console.warn("Can't delete non-existent variable: "+e)}deleteVariableInternal(e,t){const s=l.getGroup$$module$build$src$core$events$utils();s||l.setGroup$$module$build$src$core$events$utils(!0);try{for(let a=0;a<t.length;a++)t[a].dispose(!0);this.deleteVariable(e)}finally{l.setGroup$$module$build$src$core$events$utils(s)}}getVariable(e,t){if(t=this.variableMap.get(t||"")){for(let s=0,a;a=t[s];s++)if(l.Names$$module$build$src$core$names.equals(a.name,e))return a}return null}getVariableById(e){for(const t of this.variableMap.values())for(const s of t)if(s.getId()===e)return s;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?e.slice():[]}getVariableTypes(e){const t=new Set(this.variableMap.keys());if(e&&e.getPotentialVariableMap())for(const s of e.getPotentialVariableMap().variableMap.keys())t.add(s);return t.has("")||t.add(""),Array.from(t.values())}getAllVariables(){let e=[];for(const t of this.variableMap.values())e=e.concat(t);return e}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map(e=>e.name)}getVariableUsesById(e){const t=[],s=this.workspace.getAllBlocks(!1);for(let a=0;a<s.length;a++){const d=s[a].getVarModels();if(d)for(let f=0;f<d.length;f++)d[f].getId()===e&&t.push(s[a])}return t}},ul=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new Tp,this.potentialVariableMap=null,this.id=D(),de(this),this.options=e||new Ls({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(C(pe.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new sd(this)}dispose(){this.listeners.length=0,this.clear(),Tt(this)}sortObjects_(e,t){const s=Math.sin(pr(ul.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),t=t.getRelativeToSurfaceXY(),e.y+s*e.x-(t.y+s*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!it(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){it(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects_.bind(this)),e.filter(function(s){return!s.isInsertionMarker()})):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!it(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}getAllBlocks(e=!1){if(e){var t=this.getTopBlocks(!0);e=[];for(let s=0;s<t.length;s++)e.push(...t[s].getDescendants(!0))}else for(e=this.getTopBlocks(!1),t=0;t<e.length;t++)e.push(...e[t].getChildren(!1));return e.filter(function(s){return!s.isInsertionMarker()})}clear(){this.isClearing=!0;try{const e=l.getGroup$$module$build$src$core$events$utils();for(e||l.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();l.setGroup$$module$build$src$core$events$utils(e),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){this.variableMap.renameVariableById(e,t)}createVariable(e,t,s){return this.variableMap.createVariable(e,t,s)}getVariableUsesById(e){return this.variableMap.getVariableUsesById(e)}deleteVariableById(e){this.variableMap.deleteVariableById(e)}getVariable(e,t){return this.variableMap.getVariable(e,t)}getVariableById(e){return this.variableMap.getVariableById(e)}getVariablesOfType(e){return this.variableMap.getVariablesOfType(e)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(this.options.maxInstances[e]!==void 0?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(const s in e){if(e[s]>this.remainingCapacityOfType(s))return!1;t+=e[s]}return!(t>this.remainingCapacity())}hasBlockLimits(){return this.options.maxBlocks!==1/0||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,s=e?this.undoStack_:this.redoStack_;const a=t.pop();if(a){for(var d=[a];t.length&&a.group&&a.group===t[t.length-1].group;){const f=t.pop();f&&d.push(f)}for(t=0;t<d.length;t++)s.push(d[t]);d=P(d,e),l.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(s=0;s<d.length;s++)d[s].run(e)}finally{l.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,z()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){it(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let t=0;t<this.listeners.length;t++)(0,this.listeners[t])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let t;return(t=this.commentDB.get(e))!=null?t:null}allInputsFilled(e){const t=this.getTopBlocks(!1);for(let s=0;s<t.length;s++)if(!t[s].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new sd(this)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return ge(e)}static getAll(){return Ve()}};ul.SCAN_ANGLE=3;var eg=100,Bp=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound_=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,t){if(e.length){try{var s=new globalThis.Audio}catch{return}for(let d=0;d<e.length;d++){const f=e[d],S=f.match(/\.(\w+)$/);if(S&&s.canPlayType("audio/"+S[1])){var a=new globalThis.Audio(f);break}}a&&this.sounds.set(t,a)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const t=e.play();if(t!==void 0?t.then(e.pause).catch(function(){}):e.pause(),oa||A_)break}}play(e,t){if(!this.muted){var s=this.sounds.get(e);s?(e=new Date,this.lastSound_!==null&&e.getTime()-this.lastSound_.getTime()<eg||(this.lastSound_=e,s=oa||sh?s:s.cloneNode(),s.volume=t===void 0?1:t,s.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},tg=class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e),this.animationLayer=this.createAnimationLayer(e)),e=this.createLayer(Jr),$e(e,"blocklyBlockCanvas"),e=this.createLayer($h),$e(e,"blocklyBubbleCanvas")}createDragLayer(e){const t=J(Y.SVG,{class:"blocklyBlockDragSurface",xmlns:ra,"xmlns:html":dn,"xmlns:xlink":fs,version:"1.1"});return e.append(t),J(Y.G,{},t)}createAnimationLayer(e){const t=J(Y.SVG,{class:"blocklyAnimationLayer",xmlns:ra,"xmlns:html":dn,"xmlns:xlink":fs,version:"1.1"});return e.append(t),J(Y.G,{},t)}appendToAnimationLayer(e){let t;const s=(t=this.dragLayer)==null?void 0:t.getAttribute("transform");if(s){let d;(d=this.animationLayer)==null||d.setAttribute("transform",s)}let a;(a=this.animationLayer)==null||a.appendChild(e.getSvgRoot())}translateLayers(e,t){e=`translate(${e.x}, ${e.y}) scale(${t})`;let s;(s=this.dragLayer)==null||s.setAttribute("transform",e);for(const[,a]of this.layers)a.setAttribute("transform",e)}moveToDragLayer(e){let t;(t=this.dragLayer)==null||t.appendChild(e.getSvgRoot())}moveOffDragLayer(e,t){this.append(e,t)}append(e,t){this.layers.has(t)||this.createLayer(t);let s;(s=this.layers.get(t))==null||s.appendChild(e.getSvgRoot())}createLayer(e){const t=this.workspace.getSvgGroup(),s=J(Y.G,{});let a=!1;const d=[...this.layers].sort((f,S)=>f[0]-S[0]);for(const[f,S]of d)if(e<f){t.insertBefore(s,S),a=!0;break}return a||t.appendChild(s),this.layers.set(e,s),s}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(Jr)}getBubbleLayer(){return this.layers.get($h)}},ig=20,xs=class extends ul{constructor(e){super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.isVisible_=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.dragDeltaXY=null,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox_=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(C(pe.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||xs.setTopLevelWorkspaceMetrics_,this.componentManager=new bi,this.connectionDBList=rl.init(this.connectionChecker),this.audioManager=new Bp(e.parentWorkspace),this.grid=this.options.gridPattern?new Bh(this.options.gridPattern,e.gridOptions):null,this.markerManager=new fa(this),Li&&tn&&this.registerToolboxCategoryCallback(_h,tn),nr&&oc&&this.registerToolboxCategoryCallback(qh,oc),Xi&&sc&&(this.registerToolboxCategoryCallback(Vc,sc),this.addChangeListener(du)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new xp(this,this.options.theme||Bc),this.themeManager_.subscribeWorkspace(this);let t;this.renderer=fu(this.options.renderer||"geras",this.getTheme(),(t=this.options.rendererOverrides)!=null?t:void 0),this.cachedParentSvgSize=new bt(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(e){this.markerManager.setCursorSvg(e)}setMarkerSvg(e){this.markerManager.setMarkerSvg(e)}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=Bc),this.themeManager_.setTheme(e)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter(function(t){return!!t.getStyleName()})),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);const e=new(j(Vr))(this.getTheme().name,this.id);B(e)}updateBlockStyles_(e){for(let t=0,s;s=e[t];t++){const a=s.getStyleName();a&&s.setStyle(a)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(e){let t=0,s=0,a=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(a=this.scale);do{const d=k(e);(e===this.getCanvas()||e===this.getBubbleCanvas())&&(a=1),t+=d.x*a,s+=d.y*a,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new Te(t,s)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new bt(e.width,e.height)}getOriginOffsetInPixels(){return F(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if((" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=t??null),this.svgGroup_=J(Y.G,{class:"blocklyWorkspace"}),e&&(this.svgBackground_=J(Y.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),e==="blocklyMainBackground"&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new tg(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(ee(this.svgGroup_,"pointerdown",this,this.onMouseDown_,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),ee(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(C(pe.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=C(pe.CURSOR,this.options))&&this.markerManager.setCursor(new e),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&M(this.svgGroup_),this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&M(e.parentNode)}this.resizeHandlerWrapper&&(Ee(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=xs.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new G_(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}addFlyout(e){const t=new Ls({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(C(pe.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(t):new(C(pe.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position(),this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(bi.Capability.POSITIONABLE,!0),t=this.getMetricsManager().getUiMetrics(),s=[];for(let a=0,d;d=e[a];a++){d.position(t,s);const f=d.getBoundingRectangle();f&&s.push(f)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const e=oe();Te.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations_())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){const s=this.getParentSvg();e!=null&&(this.cachedParentSvgSize.width=e,s.setAttribute("data-cached-width",`${e}`)),t!=null&&(this.cachedParentSvgSize.height=t,s.setAttribute("data-cached-height",`${t}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if(e.tagName==="svg"){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(se()){var e=this.scale,t=-this.scrollY,s=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(t-this.oldTop)&&1>Math.abs(s-this.oldLeft))){var a=new(j(ao))(t,s,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=t,this.oldLeft=s,B(a)}}}translate(e,t){let s;(s=this.layerManager)==null||s.translateLayers(new Te(e,t),this.scale);let a;(a=this.grid)==null||a.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.isVisible_=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox_&&this.toolbox_.setVisible(e),e||this.hideChaff(!0))}render(){const e=this.getAllBlocks(!1);for(let t=e.length-1;0<=t;t--)e[t].queueRender();this.getTopBlocks().flatMap(t=>t.getDescendants(!1)).filter(t=>t.isInsertionMarker()).forEach(t=>t.queueRender()),_t().then(()=>void this.markerManager.updateMarkers())}highlightBlock(e,t){if(t===void 0){for(let s=0,a;a=this.highlightedBlocks[s];s++)a.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=t===void 0||t)?this.highlightedBlocks.includes(e)||this.highlightedBlocks.push(e):it(this.highlightedBlocks,e),e.setHighlighted(t))}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()}renameVariableById(e,t){super.renameVariableById(e,t),this.refreshToolboxSelection()}deleteVariableById(e){super.deleteVariableById(e),this.refreshToolboxSelection()}createVariable(e,t,s){return e=super.createVariable(e,t,s),this.refreshToolboxSelection(),e}recordDragTargets(){const e=this.componentManager.getComponents(bi.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let t=0,s;s=e[t];t++){const a=s.getClientRect();a&&this.dragTargetAreas.push({component:s,clientRect:a})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let t=0,s;s=this.dragTargetAreas[t];t++)if(s.clientRect.contains(e.clientX,e.clientY))return s.component;return null}onMouseDown_(e){const t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){e=Ye(e,this.getParentSvg(),this.getInverseScreenCTM()),e.x/=this.scale,e.y/=this.scale,this.dragDeltaXY=Te.difference(t,e)}moveDrag(e){return e=Ye(e,this.getParentSvg(),this.getInverseScreenCTM()),e.x/=this.scale,e.y/=this.scale,Te.sum(this.dragDeltaXY,e)}isDragging(){return this.currentGesture_!==null&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel_(e){if(Un.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,s=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||s){var a=Ke(e);if(nh)var d=e.metaKey;t&&(e.ctrlKey||d||!s)?(a=-a.y/50,t=Ye(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,a)):(t=this.scrollX-a.x,s=this.scrollY-a.y,e.shiftKey&&!a.x&&(t=this.scrollX-a.y,s=this.scrollY),this.scroll(t,s)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new Nt(0,0,0,0);const t=e[0].getBoundingRectangle();for(let a=1;a<e.length;a++){var s=e[a];s.isInsertionMarker&&s.isInsertionMarker()||(s=s.getBoundingRectangle(),s.top<t.top&&(t.top=s.top),s.bottom>t.bottom&&(t.bottom=s.bottom),s.left<t.left&&(t.left=s.left),s.right>t.right&&(t.right=s.right))}return t}cleanUp(){this.setResizesEnabled(!1),l.setGroup$$module$build$src$core$events$utils(!0);const e=this.getTopBlocks(!0);let t=0;for(let s=0,a;a=e[s];s++){if(!a.isMovable())continue;const d=a.getRelativeToSurfaceXY();a.moveBy(-d.x,t-d.y,["cleanup"]),a.snapToGrid(),t=a.getRelativeToSurfaceXY().y+a.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}l.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.options.readOnly&&!this.isFlyout){var t=ct.registry.getContextMenuOptions(ct.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(t,e),zs(e,t,this.RTL,this)}}updateToolbox(e){if(e=Kt(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(De(e)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox_.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(mt(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,s){s=Math.pow(this.options.zoomOptions.scaleSpeed,s);const a=this.scale*s;if(this.scale!==a){a>this.options.zoomOptions.maxScale?s=this.options.zoomOptions.maxScale/this.scale:a<this.options.zoomOptions.minScale&&(s=this.options.zoomOptions.minScale/this.scale);var d=this.getCanvas().getCTM(),f=this.getParentSvg().createSVGPoint();f.x=e,f.y=t,f=f.matrixTransform(d.inverse()),e=f.x,t=f.y,d=d.translate(e*(1-s),t*(1-s)).scale(s),this.scrollX=d.e,this.scrollY=d.f,this.setScale(a)}}zoomCenter(e){var t=this.getMetrics();let s;this.flyout?(s=t.svgWidth?t.svgWidth/2:0,t=t.svgHeight?t.svgHeight/2:0):(s=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop),this.zoom(s,t,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var s=this.getBlocksBoundingBox(),a=2*ig,d=s.right-s.left+a;if(s=s.bottom-s.top+a,d){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),s+=this.flyout.getHeight()/this.scale):(t+=this.flyout.getWidth(),d+=this.flyout.getWidth()/this.scale)),t/=d,e/=s,l.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(t,e)),this.scrollCenter()}finally{l.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){$e(this.getCanvas(),"blocklyCanvasTransitioning"),$e(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){ke(this.getCanvas(),"blocklyCanvasTransitioning"),ke(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),t=(e.scrollWidth-e.viewWidth)/2,s=(e.scrollHeight-e.viewHeight)/2;t=-t-e.scrollLeft,s=-s-e.scrollTop,this.scroll(t,s)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){if(this.isMovable()){var s=e?this.getBlockById(e):null;if(s){e=s.getRelativeToSurfaceXY(),s=t?{height:s.height,width:s.width}:s.getHeightWidth();var a=this.scale;t=(e.x+(this.RTL?-1:1)*s.width/2)*a,e=(e.y+s.height/2)*a,s=this.getMetrics(),this.scroll(-(t-s.viewWidth/2),-(e-s.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(e,t){this.hideChaff(!0);const s=this.getMetrics();e=Math.min(e,-s.scrollLeft),t=Math.min(t,-s.scrollTop);const a=s.scrollTop+Math.max(0,s.scrollHeight-s.viewHeight);e=Math.max(e,-(s.scrollLeft+Math.max(0,s.scrollWidth-s.viewWidth))),t=Math.max(t,-a),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+s.scrollLeft),-(t+s.scrollTop),!1),e+=s.absoluteLeft,t+=s.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){it(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if(typeof t!="function")throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){let t;return(t=this.flyoutButtonCallbacks.get(e))!=null?t:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if(typeof t!="function")throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){const t=e.type==="pointerdown",s=this.currentGesture_;return s?t&&s.hasStarted()?(console.warn("Tried to start the same gesture twice."),s.cancel(),null):s:t?this.currentGesture_=new Un(e,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){Gi(),io(this),us(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(bi.Capability.AUTOHIDEABLE,!0).forEach(t=>t.autoHide(e))}static setTopLevelWorkspaceMetrics_(e){const t=this.getMetrics();typeof e.x=="number"&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),typeof e.y=="number"&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}},nd=class extends hn{constructor(e,t){super(t),this.type=Hr,this.isOpen=e}toJson(){const e=super.toJson();if(this.isOpen===void 0)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new nd),t.isOpen=e.isOpen,t}};h(pe.EVENT,Hr,nd);var od=class extends hn{constructor(e,t,s){super(s),this.type=Fr,this.oldElementId=e??void 0,this.newElementId=t??void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new od),t.oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}};h(pe.EVENT,Fr,od);var Fp=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(e){this.drawer=e}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(e){const t=this.curNode;this.curNode=e,this.drawer&&this.drawer.draw(t,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},rd=class extends Fp{constructor(){super(),this.type="cursor"}next(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()===ce.types.NEXT||e.getType()===ce.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e}in(){var e=this.getCurNode();if(!e)return null;(e.getType()===ce.types.PREVIOUS||e.getType()===ce.types.OUTPUT)&&(e=e.next());let t,s;return(e=(s=(t=e)==null?void 0:t.in())!=null?s:null)&&this.setCurNode(e),e}prev(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()===ce.types.NEXT||e.getType()===ce.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e}out(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()===ce.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null}};h(pe.CURSOR,cn,rd);var Oa=class extends rd{constructor(){super()}next(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null}in(){return this.next()}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null}out(){return this.prev()}getNextNode_(e,t){if(!e)return null;const s=e.in()||e.next();return t(s)?s:s?this.getNextNode_(s,t):(e=this.findSiblingOrParent(e.out()),t(e)?e:e?this.getNextNode_(e,t):null)}getPreviousNode_(e,t){if(!e)return null;let s=e.prev();return s=s?this.getRightMostChild(s):e.out(),t(s)?s:s?this.getPreviousNode_(s,t):null}validNode_(e){let t=!1;return e=e&&e.getType(),(e===ce.types.OUTPUT||e===ce.types.INPUT||e===ce.types.FIELD||e===ce.types.NEXT||e===ce.types.PREVIOUS||e===ce.types.WORKSPACE)&&(t=!0),t}findSiblingOrParent(e){if(!e)return null;const t=e.next();return t||this.findSiblingOrParent(e.out())}getRightMostChild(e){if(!e.in())return e;for(e=e.in();e&&e.next();)e=e.next();return this.getRightMostChild(e)}};Oa.registrationName="basicCursor",h(pe.CURSOR,Oa.registrationName,Oa);var Up=class extends Oa{validNode_(e){let t=!1;const s=e&&e.getType();return e&&(e=e.getLocation(),s===ce.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(t=!0)),t}},ld=10,Yi=class extends vt{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[or[t]],this.offsetInBlock=new Te(0,0),this.trackedState=Yi.TrackedState.WILL_TRACK}dispose(){super.dispose(),this.trackedState===Yi.TrackedState.TRACKED&&this.db.removeConnection(this,this.y);let e,t;(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)==null||t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e){if(!this.sourceBlock_.workspace.isDragging()){var t=this.sourceBlock_.getRootBlock();if(!t.isInFlyout){var s=!1;if(!t.isMovable()){if(t=e.getSourceBlock().getRootBlock(),!t.isMovable())return;e=this,s=!0}var a=Ce()==t;a||t.addSelect();var d=e.x+l.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*ld)-this.x,f=e.y+l.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*ld)-this.y;s&&(f=-f),t.RTL&&(d=e.x-l.config$$module$build$src$core$config.snapRadius-Math.floor(Math.random()*ld)-this.x),t.moveBy(d,f,["bump"]),a||t.removeSelect()}}}moveTo(e,t){let s=!1;return this.trackedState===Yi.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Yi.TrackedState.TRACKED,s=!0):this.trackedState===Yi.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),s=!0),this.x=e,this.y=t,s}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const t=this.targetBlock();e&&t&&(e=Te.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Yi.TrackedState.TRACKED||!e&&this.trackedState===Yi.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Yi.TrackedState.TRACKED):(this.trackedState===Yi.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Yi.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let t=0;t<e.length;t++){const s=e[t],a=s.getConnections_(!0);for(let d=0;d<a.length;d++)a[d].setTracking(!1);for(const d of s.getIcons())bn(d)&&d.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==Le.INPUT_VALUE&&this.type!==Le.NEXT_STATEMENT)return e;const t=this.targetBlock();if(t){let s;t.isCollapsed()?(s=[],t.outputConnection&&s.push(t.outputConnection),t.nextConnection&&s.push(t.nextConnection),t.previousConnection&&s.push(t.previousConnection)):s=t.getConnections_(!0);for(let a=0;a<s.length;a++)e.push(...s[a].startTrackingAll());e.length||(e=[t])}return e}onFailedConnect(e){const t=this.getSourceBlock();if(V()){const s=l.getGroup$$module$build$src$core$events$utils();setTimeout((function(){t.isDisposed()||t.getParent()||(l.setGroup$$module$build$src$core$events$utils(s),this.bumpAwayFrom(e),l.setGroup$$module$build$src$core$events$utils(!1))}).bind(this),l.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:t,childConnection:s}=this.getParentAndChildConnections();if(t&&s){var a=l.getGroup$$module$build$src$core$events$utils();a||l.setGroup$$module$build$src$core$events$utils(!0);var d=t.getSourceBlock(),f=s.getSourceBlock();super.disconnectInternal(e),d.queueRender(),f.updateDisabled(),f.queueRender(),f.getSvgRoot().style.display="block",l.setGroup$$module$build$src$core$events$utils(a)}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock(),t.updateDisabled(),e.updateDisabled(),e.queueRender(),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return super.setCheck(e),this.sourceBlock_.queueRender(),this}};(function(e){e=e.TrackedState||(e.TrackedState={}),e[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"})(Yi||(Yi={})),Yi.TrackedState;var ka=class{paste(e,t,s){if(!t.isCapacityAvailable(e.typeCounts))return null;s&&(e.blockState.x=s.x,e.blockState.y=s.y),s=s||new Te(e.blockState.x||0,e.blockState.y||0),l.disable$$module$build$src$core$events$utils();let a;try{a=Bi(e.blockState,t),Yd(a,s)}finally{l.enable$$module$build$src$core$events$utils()}return a&&(se()&&!a.isShadow()&&B(new(j(l.CREATE$$module$build$src$core$events$utils))(a)),l.setSelected$$module$build$src$core$common(a),a)}};ka.TYPE="block",Us(ka.TYPE,new ka);var Kc={};Kc.bumpIntoBounds=Pr,Kc.bumpIntoBoundsHandler=Eu,Kc.bumpTopObjectsIntoBounds=rc;var Hp=class{constructor(e){this.block=e,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new Te(0,0),this.workspace=e.workspace}isMovable(){if(this.block.isShadow()){let e,t;return(t=(e=this.block.getParent())==null?void 0:e.isMovable())!=null?t:!1}return this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(e){if(this.block.isShadow())this.startDraggingShadow(e);else{this.dragging=!0,l.getGroup$$module$build$src$core$events$utils()||l.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(C(pe.CONNECTION_PREVIEWER,this.workspace.options))(this.block),Je(),this.workspace.setResizesEnabled(!1),Gt(),e=!!e&&(e.altKey||e.ctrlKey||e.metaKey),this.shouldDisconnect(e)&&this.disconnectBlock(e),this.block.setDragging(!0);var t;(t=this.workspace.getLayerManager())==null||t.moveToDragLayer(this.block)}}startDraggingShadow(e){const t=this.block.getParent();if(!t)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=Te.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){let t,s,a;if(this.startParentConn=(a=(t=this.block.outputConnection)==null?void 0:t.targetConnection)!=null?a:(s=this.block.previousConnection)==null?void 0:s.targetConnection,e){let d;this.startChildConn=(d=this.block.nextConnection)==null?void 0:d.targetConnection}this.block.unplug(e),at(this.block)}fireDragStartEvent(){const e=new(j(Fo))(this.block,!0,this.block.getDescendants(!1));B(e)}fireDragEndEvent(){const e=new(j(Fo))(this.block,!1,this.block.getDescendants(!1));B(e)}fireMoveEvent(){if(!this.block.isDeadOrDying()){var e=new(j(l.MOVE$$module$build$src$core$events$utils))(this.block);e.setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),B(e)}}drag(e){if(this.block.isShadow()){let t;(t=this.block.getParent())==null||t.drag(Te.sum(e,this.dragOffset))}else this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,Te.difference(e,this.startLoc))}updateConnectionPreview(e,t){var s=this.connectionCandidate;const a=this.getConnectionCandidate(e,t);if(a){this.connectionCandidate=t=s&&this.currCandidateIsBetter(s,t,a)?s:a;var{local:d,neighbour:f}=t;t=d.type===Le.OUTPUT_VALUE||d.type===Le.PREVIOUS_STATEMENT,s=f.isConnected()&&!f.targetBlock().isInsertionMarker(),t&&s&&!this.orphanCanConnectAtEnd(e,f.targetBlock(),d.type)?this.connectionPreviewer.previewReplacement(d,f,f.targetBlock()):this.connectionPreviewer.previewConnection(d,f)}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(e,t,s){return!!vt.getConnectionForOrphanedConnection(e,s===Le.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,s){const{local:a,neighbour:d}=e;e=new Te(a.x,a.y);const f=new Te(d.x,d.y);return t=Te.distance(Te.sum(e,t),f),s.distance>t-l.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let s=this.connectionCandidate?l.config$$module$build$src$core$config.connectingSnapRadius:l.config$$module$build$src$core$config.snapRadius,a=null;for(const d of e){const{connection:f,radius:S}=d.closest(s,t);f&&(a={local:d,neighbour:f,distance:S},s=S)}return a}getLocalConnections(e){const t=e.getConnections_(!1),s=e.lastConnectionInStack(!0);return s&&s!==e.nextConnection&&t.push(s),t}endDrag(e){if(this.block.isShadow()){let t;(t=this.block.getParent())==null||t.endDrag(e)}else{if(this.fireDragEndEvent(),this.fireMoveEvent(),ut(),Gt(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging){let t;(t=this.workspace.getLayerManager())==null||t.moveOffDragLayer(this.block,Jr),this.block.setDragging(!1)}this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.block.queueRender(),this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0),l.setGroup$$module$build$src$core$events$utils(!1)}}applyConnections(e){const{local:t,neighbour:s}=e;t.connect(s);const a=t.isSuperior()?s:t,d=this.block.getRootBlock();_t().then(()=>{tt(a.getSourceBlock()),setTimeout(()=>{d.bringToFront()},0)})}revertDrag(){if(this.block.isShadow()){let t;(t=this.block.getParent())==null||t.revertDrag()}else{var e;if((e=this.startChildConn)==null||e.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case Le.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case Le.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else{this.block.moveTo(this.startLoc,["drag"]);let t;(t=this.workspace.getLayerManager())==null||t.moveOffDragLayer(this.block,Jr),Pr(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block)}this.startParentConn=this.startChildConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}},Ps=class extends sr{constructor(e,t,s){if(super(e,t,s),this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.eventsInit_=this.renderIsInProgress_=this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new Te(0,0),this.dragStrategy=new Hp(this),!e.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=e,this.svgGroup_=J(Y.G,{}),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style),e=this.pathObject.svgPath,e.tooltip=this,ds(e),this.svgGroup_.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.initialized){for(var e of this.inputList)e.init();for(const t of this.getIcons())t.initView(this.createIconPointerDownListener(t)),t.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),e=this.getSvgRoot(),!this.workspace.options.readOnly&&e&&ee(e,"pointerdown",this,this.onMouseDown_),e.parentNode||this.workspace.getCanvas().appendChild(e),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()){let e;(e=this.getParent())==null||e.select()}else this.addSelect()}unselect(){if(this.isShadow()){let e;(e=this.getParent())==null||e.unselect()}else this.removeSelect()}setParent(e){const t=this.parentBlock_;if(e!==t){Je(),super.setParent(e),ut();var s=this.getSvgRoot();if(!this.workspace.isClearing&&s){var a=this.getRelativeToSurfaceXY();e?e.getSvgRoot().appendChild(s):t&&((e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(s,e):this.workspace.getCanvas().appendChild(s),this.translate(a.x,a.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,s=0,a=this.getSvgRoot();if(a)do{const d=k(a);t+=d.x,s+=d.y,a=a.parentNode}while(a&&!e.hasLayer(a));return new Te(t,s)}moveBy(e,t,s){if(this.parentBlock_)throw Error("Block has parent");const a=se();let d=null;a&&(d=new(j(l.MOVE$$module$build$src$core$events$utils))(this),s&&d.setReason(s)),e=new Te(e,t),t=this.getRelativeToSurfaceXY(),e=Te.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),a&&d&&(d.recordNew(),B(d)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new Te(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){const s=this.getRelativeToSurfaceXY();this.moveBy(e.x-s.x,e.y-s.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!this.isDeadOrDying()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(e!=null&&e.shouldSnap()){var t=this.getRelativeToSurfaceXY();e=e.alignXY(t),e!==t&&this.moveTo(e,["snap"])}}}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY(),t=this.getHeightWidth();let s,a;return this.RTL?(s=e.x-t.width,a=e.x):(s=e.x,a=e.x+t.width),new Nt(e.y,e.y+t.height,s,a)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e=0,t;t=this.inputList[e];e++)t.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed_())}updateCollapsed_(){var e=this.isCollapsed();const t=ca,s=bc;for(let d=0,f;f=this.inputList[d];d++)f.name!==t&&f.setVisible(!e);for(var a of this.getIcons())a.updateCollapsed();e?(e=this.toString(Pp),(a=this.getField(s))?a.setValue(e):(this.getInput(t)||this.appendDummyInput(t)).appendField(new ir(e),s)):(this.updateDisabled(),this.removeInput(t))}tab(e,t){const s=new Up;s.setCurNode(ce.createFieldNode(e)),e=s.getCurNode(),t?s.next():s.prev(),(t=s.getCurNode())&&t!==e&&(t.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(t))}onMouseDown_(e){const t=this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)}showHelp(){const e=typeof this.helpUrl=="function"?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const e=ct.registry.getContextMenuOptions(ct.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e}showContextMenu(e){const t=this.generateContextMenu();t&&t.length&&(zs(e,t,this.RTL,this.workspace),Dl(this))}updateComponentLocations(e){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const t of this.getChildren(!1))t.updateComponentLocations(Te.sum(e,t.relativeCoords))}updateConnectionLocations(e){for(const t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(const t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(const t of this.inputList)for(const s of t.fieldRow)s.onLocationChange(e)}setDragging(e){(this.dragging=e)?(this.translation="",na.push(...this.getConnections_(!0)),$e(this.svgGroup_,"blocklyDragging")):(na.length=0,ke(this.svgGroup_,"blocklyDragging"));for(let t=0;t<this.childBlocks_.length;t++)this.childBlocks_[t].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e=this.getIcons();for(let t=0;t<e.length;t++)e[t].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(e,t){this.disposing=!0,Al(),No(),t&&(this.unplug(e),fe(this)),super.dispose(!!e),M(this.svgGroup_)}disposeInternal(){this.disposing=!0,super.disposeInternal(),Ce()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach(e=>clearTimeout(e)),this.warningTextDb.clear(),this.getIcons().forEach(e=>e.dispose())}checkAndDelete(){this.workspace.isFlyout||(l.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),l.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:ka.TYPE,blockState:qe(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:be(this,!0)}}applyColour(){this.pathObject.applyColour(this);const e=this.getIcons();for(let t=0;t<e.length;t++)e[t].applyColour();for(let t=0,s;s=this.inputList[t];t++)for(let a=0,d;d=s.fieldRow[a];a++)d.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let t;(t=this.getNextBlock())==null||t.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const t of this.getChildren(!1))t.updateDisabled()}}setWarningText(e,t=""){if(t)this.warningTextDb.has(t)&&(clearTimeout(this.warningTextDb.get(t)),this.warningTextDb.delete(t));else{for(var s of this.warningTextDb.values())clearTimeout(s);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(t,setTimeout(()=>{this.isDeadOrDying()||(this.warningTextDb.delete(t),this.setWarningText(e,t))},100));else if(this.isInFlyout&&(e=null),s=this.getIcon(Wn.TYPE),e){let a=this.getSurroundParent(),d=null;for(;a;)a.isCollapsed()&&(d=a),a=a.getSurroundParent();d&&d.setWarningText(l.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,Ps.COLLAPSED_WARNING_ID),s?s.addMessage(e,t):this.addIcon(new Wn(this).addMessage(e,t))}else s&&(t?(s.addMessage("",t),s.getText()||this.removeIcon(Wn.TYPE)):this.removeIcon(Wn.TYPE))}setMutator(e){this.removeIcon(l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof l.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),e}createIconPointerDownListener(e){return t=>{this.isDeadOrDying()||(t=this.workspace.getGesture(t))&&t.setStartIcon(e)}}removeIcon(e){const t=super.removeIcon(e);return e.equals(l.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),t}setEnabled(e){oo("setEnabled","v11","v12","the setDisabledReason method of BlockSvg");const t=this.isEnabled();super.setEnabled(e),this.isEnabled()===t||this.getInheritedDisabled()||this.updateDisabled()}setDisabledReason(e,t){const s=this.isEnabled();super.setDisabledReason(e,t),this.isEnabled()===s||this.getInheritedDisabled()||this.updateDisabled()}setHighlighted(e){this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const t=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,t)this.hat=t.hat,this.pathObject.setStyle(t),this.colour_=t.colourPrimary,this.style=t,this.applyColour();else throw Error("Invalid style name: "+e)}bringToFront(e=!1){let t=this;if(!t.isDeadOrDying())do{const s=t.getSvgRoot(),a=s.parentNode,d=a.childNodes;if(d[d.length-1]!==s&&a.appendChild(s),e)break;t=t.getParent()}while(t)}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.queueRender()}setNextStatement(e,t){super.setNextStatement(e,t),this.queueRender()}setOutput(e,t){super.setOutput(e,t),this.queueRender()}setInputsInline(e){super.setInputsInline(e),this.queueRender()}removeInput(e,t){return e=super.removeInput(e,t),this.queueRender(),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.queueRender()}appendInput(e){return super.appendInput(e),this.queueRender(),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var s=this.inputList[t].connection;s&&(s.setTracking(e),(s=s.targetBlock())&&s.setConnectionTracking(e))}}getConnections_(e){const t=[];if(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_)for(let s=0,a;a=this.inputList[s];s++)a.connection&&t.push(a.connection);return t}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Yi(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const t of this.getConnections_(!1)){if(t.isSuperior()){let s;(s=t.targetBlock())==null||s.bumpNeighbours()}for(const s of t.neighbours(l.config$$module$build$src$core$config.snapRadius))s.getSourceBlock().getRootBlock()!==e&&(t.isConnected()&&s.isConnected()||(t.isSuperior()?s.bumpAwayFrom(t):t.bumpAwayFrom(s)))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(e,t,s){if(e.type===Le.NEXT_STATEMENT||e.type===Le.INPUT_VALUE){let a=t.x;t=t.y,a+=s.x-e.getOffsetInBlock().x,t+=s.y-e.getOffsetInBlock().y,this.moveBy(a,t)}}getChildren(e){return super.getChildren(e)}queueRender(){return vs(this)}render(){this.queueRender(),$i()}renderEfficiently(){Je(),this.isCollapsed()&&this.updateCollapsed_(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),ut(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const e of this.inputList){const t=e.connection;t&&t.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(fa.LOCAL_MARKER).draw();for(const e of this.inputList)for(const t of e.fieldRow)t.updateMarkers_()}setCursorSvg(e){this.pathObject.setCursorSvg(e)}setMarkerSvg(e){this.pathObject.setMarkerSvg(e)}getHeightWidth(){let e=this.height,t=this.width;var s=this.getNextBlock();if(s){s=s.getHeightWidth();const a=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=s.height-a,t=Math.max(t,s.width)}return{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}setDragStrategy(e){this.dragStrategy=e}isMovable(){return this.dragStrategy.isMovable()}startDrag(e){this.dragStrategy.startDrag(e)}drag(e,t){this.dragStrategy.drag(e,t)}endDrag(e){this.dragStrategy.endDrag(e)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){const e=Object.assign({},{kind:"BLOCK"},qe(this)),t=new Set(["id","height","width","pinned","enabled"]),s=function(a){for(const d in a)t.has(d)?delete a[d]:typeof a[d]=="object"&&s(a[d])};return s(e),[e]}};Ps.INLINE=-1,Ps.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var Gp=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},Jc=class extends Gp{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e){return e instanceof Ps?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e)):this.updateWouldDelete_(Cs(e)&&e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},Vp=class extends Jc{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=new Ls({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===lt.TOP?lt.BOTTOM:lt.TOP,this.flyout=new(C(pe.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===lt.RIGHT?lt.LEFT:lt.RIGHT,this.flyout=new(C(pe.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){this.svgGroup=J(Y.G,{class:"blocklyTrash"});let e;const t=String(Math.random()).substring(2);e=J(Y.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup),J(Y.RECT,{width:hl,height:Zc,y:dl},e);const s=J(Y.IMAGE,{width:zi.width,x:-0,height:zi.height,y:-32,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup);return s.setAttributeNS(fs,"xlink:href",this.workspace.options.pathToMedia+zi.url),e=J(Y.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup),J(Y.RECT,{width:hl,height:dl},e),this.svgLid=J(Y.IMAGE,{width:zi.width,x:-0,height:zi.height,y:-32,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup),this.svgLid.setAttributeNS(fs,"xlink:href",this.workspace.options.pathToMedia+zi.url),me(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),me(this.svgGroup,"pointerup",this,this.click),me(s,"pointerover",this,this.mouseOver),me(s,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(st(this.flyout.createDom(Y.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[bi.Capability.AUTOHIDEABLE,bi.Capability.DELETE_AREA,bi.Capability.DRAG_TARGET,bi.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&M(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map(function(s){return JSON.parse(s)}),t=this.workspace.getParentSvg().style;t.cursor="wait",setTimeout(()=>{let s;(s=this.flyout)==null||s.show(e),t.cursor="";let a;(a=this.workspace.scrollbar)==null||a.setVisible(!1)},10),this.fireUiEvent(!0)}}closeFlyout(){if(this.contentsIsOpen()){var e;(e=this.flyout)==null||e.hide();var t;(t=this.workspace.scrollbar)==null||t.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets()}}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){if(this.initialized){var s=hi(this.workspace,e);e=mi(s,new bt(hl,Zc+dl),sg,Wp,e,this.workspace),t=Bs(e,Wp,s.vertical===Fn.TOP?ho.DOWN:ho.UP,t),this.top=t.top,this.left=t.left;var a;(a=this.svgGroup)==null||a.setAttribute("transform","translate("+this.left+","+this.top+")")}}getBoundingRectangle(){return new Nt(this.top,this.top+Zc+dl,this.left,this.left+hl)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const t=e.top+og-qc;return e=e.left+ng-qc,new Nt(t,t+dl+Zc+2*qc,e,e+hl+2*qc)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=ag;var t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*Xp),t=zp+this.lidOpen*(cg-zp),this.svgGroup&&(this.svgGroup.style.opacity=`${t}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),lg/e))}setLidAngle(e){const t=this.workspace.toolboxPosition===lt.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let s;(s=this.svgLid)==null||s.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:hl-4)+","+(dl-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*Xp)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(j(Hr))(e,this.workspace.id),B(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||e.type!==l.DELETE$$module$build$src$core$events$utils||e.type!==l.DELETE$$module$build$src$core$events$utils||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),!this.contents.includes(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(rg)}}}cleanBlockJson(e){function t(s){if(s){if(delete s.id,delete s.x,delete s.y,delete s.enabled,delete s.disabledReasons,s.icons&&s.icons.comment){var a=s.icons.comment;delete a.height,delete a.width,delete a.pinned}a=s.inputs;for(var d in a){var f=a[d];const S=f.block;f=f.shadow,S&&t(S),f&&t(f)}s.next&&(d=s.next,s=d.block,d=d.shadow,s&&t(s),d&&t(d))}}return e=JSON.parse(JSON.stringify(e)),t(e),Object.assign({},{kind:"BLOCK"},e)}},hl=47,Zc=44,dl=16,Wp=20,sg=20,qc=10,ng=0,og=32,rg=.1,lg=80,ag=4,zp=.4,cg=.8,Xp=45,kt=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),(t=e.keyCodes)&&0<t.length)for(let s=0;s<t.length;s++)this.addKeyMapping(t[s],e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,s){e=`${e}`;const a=this.keyMap.get(e);if(a&&!s)throw Error(`Shortcut named "${t}" collides with shortcuts "${a}"`);a&&s?a.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,s){const a=this.keyMap.get(e);if(!a)return s||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1;const d=a.indexOf(t);return-1<d?(a.splice(d,1),a.length===0&&this.keyMap.delete(e),!0):(s||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){this.keyMap.clear();for(const t in e)this.keyMap.set(t,e[t])}getKeyMap(){const e=Object.create(null);for(const[t,s]of this.keyMap)e[t]=s;return e}getRegistry(){const e=Object.create(null);for(const[t,s]of this.shortcuts)e[t]=s;return Xt(Object.create(null),e)}onKeyDown(e,t){var s=this.serializeKeyEvent_(t);if(s=this.getShortcutNamesByKeyCode(s),!s)return!1;for(let a=0,d;d=s[a];a++){const f=this.shortcuts.get(d);let S,x;if((S=f)==null||!S.preconditionFn||(x=f)!=null&&x.preconditionFn(e)){let Z,we;if((Z=f)!=null&&Z.callback&&((we=f)!=null&&we.callback(e,t,f)))return!0}}return!1}getShortcutNamesByKeyCode(e){return this.keyMap.get(e)||[]}getKeyCodesByShortcutName(e){const t=[];for(const[s,a]of this.keyMap)-1<a.indexOf(e)&&t.push(s);return t}serializeKeyEvent_(e){let t="";for(const s in kt.modifierKeys)e.getModifierState(s)&&(t!==""&&(t+="+"),t+=s);return t!==""&&e.keyCode?t+="+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers_(e){for(let t=0,s;s=e[t];t++)if(!(s in kt.modifierKeys))throw Error(s+" is not a valid modifier key.")}createSerializedKey(e,t){let s="";if(t){this.checkModifiers_(t);for(const a in kt.modifierKeys)t.includes(kt.modifierKeys[a])&&(s!==""&&(s+="+"),s+=a)}return s!==""&&e?s+="+"+e:e&&(s=`${e}`),s}};kt.registry=new kt,function(e){e=e.modifierKeys||(e.modifierKeys={}),e[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(kt||(kt={}));var ad=null,cd=null,ug={duplicateInternal:qd,copyInternal:Zd},Ca={};Ca.BlockPaster=ka,Ca.TEST_ONLY=ug,Ca.paste=ro,Ca.registry=Eh;var gn;(function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"})(gn||(gn={}));var go=null,mo=null,_l=null;Ru();var mn={};mn.names=gn,mn.registerCopy=Iu,mn.registerCut=Su,mn.registerDefaultShortcuts=Ru,mn.registerDelete=yu,mn.registerEscape=vu,mn.registerPaste=Ou,mn.registerRedo=Cu,mn.registerUndo=ku;var hg=class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=Q_}save(e){return e=e.getProcedureMap().getProcedures().map(t=>wu(t)),e.length?e:null}load(e,t){const s=t.getProcedureMap();for(const a of e)s.add(Au(this.procedureModelClass,this.parameterModelClass,a,t))}clear(e){e.getProcedureMap().clear()}},Qc={};Qc.ProcedureSerializer=hg,Qc.loadProcedure=Au,Qc.saveProcedure=wu;var Yp=class{constructor(){this.priority=q_}save(e){const t=[];for(const s of e.getAllVariables())e={name:s.name,id:s.getId()},s.type&&(e.type=s.type),t.push(e);return t.length?t:null}load(e,t){for(const s of e)t.createVariable(s.name,s.type,s.id)}clear(e){e.getVariableMap().clear()}};Ji("variables",new Yp);var jp={};jp.VariableSerializer=Yp;var ud={};ud.load=e_,ud.save=Qd;var dg={blocks:pa,exceptions:jo,priorities:Ff,procedures:Qc,registry:Th,variables:jp,workspaceComments:Sc,workspaces:ud},hd=class{constructor(e,t,s,a,d){this.workspace=e,this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null,t=t===void 0?!0:t,s=s===void 0?!0:s;const f=t&&s;t&&(this.hScroll=new oi(e,!0,f,a,d)),s&&(this.vScroll=new oi(e,!1,f,a,d)),f&&(this.corner_=J(Y.RECT,{height:oi.scrollbarThickness,width:oi.scrollbarThickness,class:"blocklyScrollbarBackground"}),st(this.corner_,e.getBubbleCanvas()))}dispose(){M(this.corner_),this.oldHostMetrics_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var t=!1,s=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===e.viewWidth&&this.oldHostMetrics_.viewHeight===e.viewHeight&&this.oldHostMetrics_.absoluteTop===e.absoluteTop&&this.oldHostMetrics_.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===e.scrollWidth&&this.oldHostMetrics_.viewLeft===e.viewLeft&&this.oldHostMetrics_.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===e.scrollHeight&&this.oldHostMetrics_.viewTop===e.viewTop&&this.oldHostMetrics_.scrollTop===e.scrollTop||(s=!0)):s=t=!0,t||s){try{l.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&s&&this.vScroll.resize(e)}finally{l.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==e.viewWidth||this.oldHostMetrics_.absoluteLeft!==e.absoluteLeft){let a;(a=this.corner_)==null||a.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!==e.viewHeight||this.oldHostMetrics_.absoluteTop!==e.absoluteTop){let a;(a=this.corner_)==null||a.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics_=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,s){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),(s||s===void 0)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},dd=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,s=0;return e&&(t=e.getWidth(),s=e.getHeight()),new bt(t,s)}getFlyoutMetrics(e){return e=this.getDimensionsPx_(this.workspace_.getFlyout(e)),{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;const s=this.getToolboxMetrics(),a=this.getFlyoutMetrics(),d=!!this.workspace_.getToolbox();var f;const S=!((f=this.workspace_.getFlyout())!=null&&f.autoClose);f=d?s.position:a.position;const x=f===lt.TOP;return f===lt.LEFT&&(d&&(e+=s.width),S&&(e+=a.width)),x&&(d&&(t+=s.height),S&&(t+=a.height)),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const t=this.getSvgMetrics(),s=this.getToolboxMetrics(),a=this.getFlyoutMetrics(),d=!!this.workspace_.getToolbox();var f;const S=!((f=this.workspace_.getFlyout())!=null&&f.autoClose);f=d?s.position:a.position;const x=f===lt.LEFT||f===lt.RIGHT;return(f===lt.TOP||f===lt.BOTTOM)&&(d&&(t.height-=s.height),S&&(t.height-=a.height)),x&&(d&&(t.width-=s.width),S&&(t.width-=a.width)),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const t=this.workspace_.isMovableHorizontally(),s=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const a={};return s||(a.top=e.top,a.bottom=e.top+e.height),t||(a.left=e.left,a.right=e.left+e.width),a}getPaddedContent_(e,t){const s=t.top+t.height,a=t.left+t.width,d=e.width;e=e.height;const f=d/2,S=e/2;return{top:Math.min(t.top-S,s-e),bottom:Math.max(s+S,t.top+e),left:Math.min(t.left-f,a-d),right:Math.max(a+f,t.left+d)}}getScrollMetrics(e,t,s){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var a=s||this.getContentMetrics();s=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,a),a=s.top!==void 0?s.top:t.top;const d=s.left!==void 0?s.left:t.left;return{top:a/e,left:d/e,width:((s.right!==void 0?s.right:t.right)-d)/e,height:((s.bottom!==void 0?s.bottom:t.bottom)-a)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),s=this.getSvgMetrics(),a=this.getAbsoluteMetrics(),d=this.getViewMetrics(),f=this.getContentMetrics(),S=this.getScrollMetrics(!1,d,f);return{contentHeight:f.height,contentWidth:f.width,contentTop:f.top,contentLeft:f.left,scrollHeight:S.height,scrollWidth:S.width,scrollTop:S.top,scrollLeft:S.left,viewHeight:d.height,viewWidth:d.width,viewTop:d.top,viewLeft:d.left,absoluteTop:a.top,absoluteLeft:a.left,svgHeight:s.height,svgWidth:s.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}};h(pe.METRICS_MANAGER,cn,dd),"Blockly"in globalThis||(globalThis.Blockly={Msg:Y_});var Kp=class extends zc{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&M(this.selectedGlowFilter),this.replacementGlowFilter&&M(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH,s=ts("c",[He(25,-e),He(71,-e),He(t,0)]);return{height:e,width:t,path:s}}makeHexagonal(){function e(s,a,d){var f=s/2;return f=f>t?t:f,d=d?-1:1,s=(a?-1:1)*s/2,an(-d*f,s)+an(d*f,s)}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width(s){return s/=2,s>t?t:s},height(s){return s},connectionOffsetY(s){return s/2},connectionOffsetX(s){return-s},pathDown(s){return e(s,!1,!1)},pathUp(s){return e(s,!0,!1)},pathRightDown(s){return e(s,!1,!0)},pathRightUp(s){return e(s,!1,!0)}}}makeRounded(){function e(a,d,f){const S=a>s?a-s:0;a=(a>s?s:a)/2;const x=f===d?"0":"1";return ni("a","0 0,"+x,a,He((f?1:-1)*a,(d?-1:1)*a))+Ne("v",(d?-1:1)*S)+ni("a","0 0,"+x,a,He((f?-1:1)*a,(d?-1:1)*a))}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,s=2*t;return{type:this.SHAPES.ROUND,isDynamic:!0,width(a){return a/=2,a>t?t:a},height(a){return a},connectionOffsetY(a){return a/2},connectionOffsetX(a){return-a},pathDown(a){return e(a,!1,!1)},pathUp(a){return e(a,!0,!1)},pathRightDown(a){return e(a,!1,!0)},pathRightUp(a){return e(a,!1,!0)}}}makeSquared(){function e(s,a,d){s-=2*t;const f=d===a?"0":"1";return ni("a","0 0,"+f,t,He((d?1:-1)*t,(a?-1:1)*t))+Ne("v",(a?-1:1)*s)+ni("a","0 0,"+f,t,He((d?-1:1)*t,(a?-1:1)*t))}const t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width(s){return t},height(s){return s},connectionOffsetY(s){return s/2},connectionOffsetX(s){return-s},pathDown(s){return e(s,!1,!1)},pathUp(s){return e(s,!0,!1)},pathRightDown(s){return e(s,!1,!0)},pathRightUp(s){return e(s,!1,!0)}}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case Le.INPUT_VALUE:case Le.OUTPUT_VALUE:if(e=e.getSourceBlock().getOutputShape(),e!==null)switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&t.includes("Boolean")?this.HEXAGONAL:t&&t.includes("Number")?this.ROUNDED:(t&&t.includes("String"),this.ROUNDED);case Le.PREVIOUS_STATEMENT:case Le.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(we){return ts("c",[He(we*d/2,0),He(we*d*3/4,S/2),He(we*d,S)])+xr([He(we*d,f)])+ts("c",[He(we*d/4,S/2),He(we*d/2,S),He(we*d,S)])+Ne("h",we*a)+ts("c",[He(we*d/2,0),He(we*d*3/4,-(S/2)),He(we*d,-S)])+xr([He(we*d,-f)])+ts("c",[He(we*d/4,-(S/2)),He(we*d/2,-S),He(we*d,-S)])}const t=this.NOTCH_WIDTH,s=this.NOTCH_HEIGHT,a=t/3,d=a/3,f=s/2,S=f/2,x=e(1),Z=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:s,pathLeft:x,pathRight:Z}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=ni("a","0 0,0",e,He(-e,e)),s=ni("a","0 0,1",e,He(-e,e)),a=ni("a","0 0,0",e,He(e,e)),d=ni("a","0 0,1",e,He(e,e));return{width:e,height:e,pathTop:t,pathBottom:a,rightWidth:e,rightHeight:e,pathTopRight:s,pathBottomRight:d}}generateSecondaryColour_(e){return on("#000",e,.15)||e}generateTertiaryColour_(e){return on("#000",e,.25)||e}createDom(e,t,s){super.createDom(e,t,s),e=J(Y.DEFS,{},e),t=J(Y.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),J(Y.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),s=J(Y.FECOMPONENTTRANSFER,{result:"outBlur"},t),J(Y.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},s),J(Y.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),J(Y.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=J(Y.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),J(Y.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=J(Y.FECOMPONENTTRANSFER,{result:"outBlur"},e),J(Y.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),J(Y.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),J(Y.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),J(Y.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyTextInputBubble textarea {`,"font-weight: normal;","}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text,`,`${e} .blocklyNonEditableText>g>text,`,`${e} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .goog-menuitem,`,`${e}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .goog-menuitem-content {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Jp=class extends Xc{constructor(e,t){super(e,t)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(G.isSpacer(e)){const a=e.precedesStatement;var t=e.followsStatement;if(a||t){const d=this.constants_.INSIDE_CORNERS;var s=d.rightHeight;s=e.height-(a?s:0),t=t?d.pathBottomRight:"",e=0<s?Ne("V",e.yPos+s):"",this.outlinePath_+=t+e+(a?d.pathTopRight:"");return}}this.outlinePath_+=Ne("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=Ut(e.xPos,this.info_.startY),this.outlinePath_+=Ne("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=Ne("V",e.baseline),this.outlinePath_+=Ne("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=Ei(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){const t=e.width-2*e.connectionWidth,s=e.height;return Ne("h",t)+e.shape.pathRightDown(s)+Ne("h",-t)+e.shape.pathUp(s)+"z"}drawStatementInput_(e){var t=e.getLastInput();const s=t.xPos+t.notchOffset+t.shape.width,a=this.constants_.INSIDE_CORNERS,d=t.shape.pathRight+Ne("h",-(t.notchOffset-a.width))+a.pathTop,f=e.height-2*a.height;t=a.pathBottom+Ne("h",t.notchOffset-a.width)+(t.connectedBottomNextConnection?"":t.shape.pathLeft),this.outlinePath_+=Ne("H",s)+d+Ne("v",f)+t+Ne("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const t=e.connectionModel;if(t.type===Le.NEXT_STATEMENT||t.type===Le.PREVIOUS_STATEMENT||t.type===Le.OUTPUT_VALUE&&!e.isDynamicShape)super.drawConnectionHighlightPath(e);else{e=t.type===Le.INPUT_VALUE?Ei(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):Ei(e.width,-e.height/2)+e.shape.pathDown(e.height);var s=t.getSourceBlock(),a,d;(d=(a=s.pathObject).addConnectionHighlight)==null||d.call(a,t,e,t.getOffsetInBlock(),s.RTL)}}},rr=class extends Mt{constructor(e,t,s,a,d,f,S){if(super(Mt.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",s=Number(Dt(s)),t=Number(Dt(t)),isNaN(s)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(0>=s||0>=t)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new bt(t,s+rr.Y_PADDING),this.imageHeight=s,typeof d=="function"&&(this.clickHandler=d),e!==Mt.SKIP_SETUP&&(S?this.configure_(S):(this.flipRtl=!!f,this.altText=Dt(a)||""),this.setValue(Dt(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=Dt(e.alt))}initView(){this.imageElement=J(Y.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(fs,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return typeof e!="string"?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(fs,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};rr.Y_PADDING=1,ks("field_image",rr),rr.prototype.DEFAULT_VALUE="";var eu=class extends Mt{constructor(e,t,s){super(Mt.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",e!==Mt.SKIP_SETUP&&(s&&this.configure_(s),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.spellcheck!==void 0&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new ri;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new ri;let t;return this.fullBlockClickTarget_=!((t=this.getConstants())==null||!t.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e,t=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_&&se()&&this.value_!==e&&t&&B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new ri;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.style.colourTertiary)):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return(e=this.getConstants())!=null&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(ke(e,"blocklyInvalidInput"),si(e,vi.INVALID,!1)):($e(e,"blocklyInvalidInput"),si(e,vi.INVALID,!0))}if(e=this.getSourceBlock(),!e)throw new ri;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,t=!1){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(L_||sh||oa)?this.showPromptEditor_():this.showInlineEditor_(t)}showPromptEditor_(){os(l.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),e=>{e!==null&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)})}showInlineEditor_(e){const t=this.getSourceBlock();if(!t)throw new ri;kn(this,t.RTL,this.widgetDispose_.bind(this),this.workspace_),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new ri;l.setGroup$$module$build$src$core$events$utils(!0);const t=rn();var s=this.getClickTarget_();if(!s)throw Error("A click target has not been set.");$e(s,"editing"),s=document.createElement("input"),s.className="blocklyHtmlInput",s.setAttribute("spellcheck",this.spellcheck_);const a=this.workspace_.getScale();var d=this.getConstants().FIELD_TEXT_FONTSIZE*a+"pt";return t.style.fontSize=d,s.style.fontSize=d,d=eu.BORDERRADIUS*a+"px",this.isFullBlockField()&&(d=this.getScaledBBox(),d=(d.bottom-d.top)/2+"px",e=e.getParent()?e.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,s.style.border=1*a+"px solid "+e,t.style.borderRadius=d,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*a+"px")),s.style.borderRadius=d,t.appendChild(s),s.value=s.defaultValue=this.getEditorText_(this.value_),s.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(s),s}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&se()&&this.valueWhenEditorWasOpened_!==null&&this.valueWhenEditorWasOpened_!==this.value_&&(B(new(j(l.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),l.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=rn().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,e=this.getClickTarget_(),!e)throw Error("A click target has not been set.");ke(e,"editing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper_=ee(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=ee(e,"input",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(Ee(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(Ee(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(e){e.key==="Enter"?(Cn(this),us()):e.key==="Escape"?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),Cn(this),us()):e.key==="Tab"&&(Cn(this),us(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())}onHtmlInputChange_(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&se()&&this.value_!==e&&B(new(j(Do))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){var e=this.getSourceBlock();if(!e)throw new ri;const t=rn(),s=this.getScaledBBox();t.style.width=s.right-s.left+"px",t.style.height=s.bottom-s.top+"px",e=new Te(e.RTL?s.right-t.offsetWidth:s.left,s.top),t.style.left=e.x+"px",t.style.top=e.y+"px"}repositionForWindowResize(){const e=this.getSourceBlock();return e instanceof Ps?(Pr(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),e)||this.resizeEditor_(),!0):!1}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};eu.BORDERRADIUS=4;var tu=class extends eu{constructor(e,t,s){super(e,t,s)}doClassValidation_(e){return e===void 0?null:`${e}`}static fromJson(e){return new this(Dt(e.text),void 0,e)}};ks("field_input",tu),tu.prototype.DEFAULT_VALUE="";var Zp=class extends Vh{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},iu=class extends va{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},qp=class extends pn{constructor(e){super(e),this.width=this.height=0,this.type|=G.getType("RIGHT_CONNECTION")}},Qp=class extends jh{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const t=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},ef=class extends Sa{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new Qp(this.constants_),this.bottomRow=new Zp(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new qp(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return t?t instanceof Xn||e instanceof Ts||t instanceof Ts?!0:e instanceof l.ValueInput$$module$build$src$core$inputs$value_input||e instanceof fn||e instanceof Xn?!this.isInline||this.isMultiRow:!1:!1}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&G.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&G.isLeftRoundedCorner(e)&&t&&(G.isPreviousConnection(t)||G.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&G.isLeftSquareCorner(e)&&t&&G.isHat(t)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){if(G.isTopRow(e)&&G.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const s=G.isInputRow(e)&&e.hasStatement,a=G.isInputRow(t)&&t.hasStatement;return a||s?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),a&&s?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):G.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):G.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,t){const s=this.width-this.startX;return G.isInputRow(e)&&e.hasStatement||G.isInputRow(t)&&t.hasStatement?Math.max(s,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):s}getElemCenterline_(e,t){if(e.hasStatement&&!G.isSpacer(t)&&!G.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(G.isInlineInput(t)&&t instanceof fo){const s=t.connectedBlock;if(s&&s.outputConnection&&s.nextConnection)return e.yPos+s.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof fn||e instanceof Xn)&&t.hasDummyInput&&t.align===l.Align$$module$build$src$core$inputs$align.LEFT&&e.align===l.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof Ts){t.elements.push(new iu(this.constants_,e)),t.hasStatement=!0,t.align===null&&(t.align=e.align);return}super.addInput_(e,t)}addAlignmentPadding_(e,t){if(this.rightAlignedDummyInputs.get(e)){let s;for(let a=0;a<e.elements.length;a++){const d=e.elements[a];if(G.isSpacer(d)&&(s=d),G.isField(d)&&d instanceof al&&d.parentInput===this.rightAlignedDummyInputs.get(e))break}if(s){s.width+=t,e.width+=t;return}}super.addAlignmentPadding_(e,t)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let t=e;for(let d=2;d<this.rows.length-1;d+=2){var s=this.rows[d-1];const f=this.rows[d];var a=this.rows[d+1];if(s=d===2?!!this.topRow.hasPreviousConnection:!!s.followsStatement,a=d+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!a.precedesStatement,G.isInputRow(f)&&f.hasStatement){f.measure();let S,x;t=f.width-((x=(S=f.getLastInput())==null?void 0:S.width)!=null?x:0)+e}else if(s&&(d===2||a)&&G.isInputRow(f)&&!f.hasStatement){a=f.xPos,s=null;for(let S=0;S<f.elements.length;S++){const x=f.elements[S];G.isSpacer(x)&&(s=x),s&&(G.isField(x)||G.isInput(x))&&a<t&&!(G.isField(x)&&x instanceof al&&(x.field instanceof ir||x.field instanceof rr))&&(s.width+=t-a),a+=x.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,s=0;s<this.rows.length;s++){const a=this.rows[s];a.yPos=t,t+=a.height}this.height=t,s=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(s),s=e.width(s),this.outputConnection.height=t,this.outputConnection.width=s,this.outputConnection.startX=s,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(s),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=s,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=s,this.width+=s+e,this.widthWithChildren+=s+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,t=0;t<this.rows.length;t++){var s=this.rows[t];if(!G.isInputRow(s))continue;e=s.elements[s.elements.length-2];let a=this.getNegativeSpacing_(s.elements[1]),d=this.getNegativeSpacing_(e);e=a+d;const f=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<f&&(e=this.width-f,a=e/2,d=e/2),s.elements.unshift(new $s(this.constants_,-a)),s.elements.push(new $s(this.constants_,-d))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,t=0;t<this.rows.length;t++)s=this.rows[t],G.isTopOrBottomRow(s)&&(s.elements[1].width-=e),s.width-=e,s.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const t=this.outputConnection.width;var s=this.outputConnection.shape.type;const a=this.constants_;if(1<this.inputRows.length)switch(s){case a.SHAPES.ROUND:return s=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,s=this.height/2>s?s:this.height/2,t-s*(1-Math.sin(Math.acos((s-this.constants_.SMALL_PADDING)/s)));default:return 0}if(G.isInlineInput(e)&&e instanceof fo){const d=e.connectedBlock;return e=d?d.pathObject.outputShapeType:e.shape.type,e==null||d&&d.outputConnection&&(d.statementInputCount||d.nextConnection)||s===a.SHAPES.HEXAGONAL&&s!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[s][e]}return G.isField(e)&&e instanceof al?s===a.SHAPES.ROUND&&e.field instanceof tu?t-2.75*a.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[s][0]:G.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let a=2;a<this.rows.length-1;a+=2){const d=this.rows[a-1],f=this.rows[a],S=this.rows[a+1];var e=a===2,t=a+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!S.precedesStatement;if(e?this.topRow.hasPreviousConnection:d.followsStatement){var s=f.elements[1];if(s=f.elements.length===3&&s instanceof al&&(s.field instanceof ir||s.field instanceof rr),!e&&s)d.height-=this.constants_.SMALL_PADDING,S.height-=this.constants_.SMALL_PADDING,f.height-=this.constants_.MEDIUM_PADDING;else if(!e&&!t)d.height+=this.constants_.SMALL_PADDING;else if(t){for(e=!1,t=0;t<f.elements.length;t++)if(s=f.elements[t],s instanceof fo&&G.isInlineInput(s)&&s.connectedBlock&&!s.connectedBlock.isShadow()&&40<=s.connectedBlock.getHeightWidth().height){e=!0;break}e&&(d.height-=this.constants_.SMALL_PADDING,S.height-=this.constants_.SMALL_PADDING)}}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},tf=class extends Zh{constructor(e,t,s){super(e,t,s),this.markerCircle=null}showWithInputOutput(e){const t=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle(e.x,e.y),this.setParent_(t),this.showCurrent_()}showWithOutput_(e){this.showWithInputOutput(e)}showWithInput_(e){this.showWithInputOutput(e)}showWithBlock_(e){e=e.getLocation();const t=e.getHeightWidth();this.positionRect_(0,0,t.width,t.height),this.setParent_(e),this.showCurrent_()}positionCircle(e,t){let s;(s=this.markerCircle)==null||s.setAttribute("cx",`${e}`);let a;(a=this.markerCircle)==null||a.setAttribute("cy",`${t}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=J(Y.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();J(Y.ANIMATE,e,this.markerCircle)}return this.markerSvg_}applyColour_(e){super.applyColour_(e);let t;(t=this.markerCircle)==null||t.setAttribute("fill",this.colour_);let s;if((s=this.markerCircle)==null||s.setAttribute("stroke",this.colour_),this.isCursor()){e=this.colour_+";transparent;transparent;";let a;(a=this.markerCircle)==null||a.firstElementChild.setAttribute("values",e)}}},sf=class extends Yc{constructor(e,t,s){super(e,t,s),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=s}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const t=e.getParent();e.isShadow()&&t&&this.svgPath.setAttribute("stroke",t.style.colourTertiary);for(const s of this.outlines.values())s.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){e=this.getOutlinePath(e),e.setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,J(Y.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,s;(t=this.outlines.get(e))==null||(s=t.parentNode)==null||s.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},_d=class extends jc{constructor(e){super(e)}makeConstants_(){return new Kp}makeRenderInfo_(e){return new ef(this,e)}makeDrawer_(e,t){return new Jp(e,t)}makeMarkerDrawer(e,t){return new tf(e,this.getConstants(),t)}makePathObject(e,t){return new sf(e,t,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(e,t,s){return oo("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Le.OUTPUT_VALUE?e.isConnected()?Ms.PREVIEW_TYPE.REPLACEMENT_FADE:Ms.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(e,t,s)}};Ql("zelos",_d);var nf=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,s){l.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=s,s.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{l.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){l.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(e,t)&&(this.markerConn=this.previewMarker(e,t)),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.draggedConn=e,this.staticConn=t}finally{l.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(e,t){return t.type===Le.PREVIOUS_STATEMENT||t.type===Le.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof _d)}previewMarker(e,t){const s=e.getSourceBlock(),a=this.createInsertionMarker(s),d=this.getMatchingConnection(s,a,e);if(!d)return null;a.queueRender(),$i(),d.connect(t);const f={x:t.x-d.x,y:t.y-d.y},S=d.getOffsetInBlock().clone();return _t().then(()=>{if(!a.isDeadOrDying()){l.disable$$module$build$src$core$events$utils();try{a==null||a.positionNearConnection(d,f,S),a==null||a.getSvgRoot().setAttribute("visibility","visible")}finally{l.enable$$module$build$src$core$events$utils()}}}),d}createInsertionMarker(e){const t=qe(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!t)throw Error(`Failed to serialize source block. ${e.toDevString()}`);e=Bi(t,this.workspace);for(const s of e.getDescendants(!1))s.setInsertionMarker(!0);return e.initSvg(),e.getSvgRoot().setAttribute("visibility","hidden"),e}getMatchingConnection(e,t,s){if(e=e.getConnections_(!0),t=t.getConnections_(!0),e.length!==t.length)return null;for(let a=0;a<e.length;a++)if(e[a]===s)return t[a];return null}hidePreview(){l.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{l.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const t=e.getSourceBlock(),s=t.outputConnection;let a;if((a=t.previousConnection)!=null&&a.targetConnection||s!=null&&s.targetConnection)t.unplug(!0);else{let d;(d=e.targetBlock())==null||d.unplug(!1)}t.dispose()}dispose(){this.hidePreview()}};h(pe.CONNECTION_PREVIEWER,cn,nf);var $o={};$o.Align=l.Align$$module$build$src$core$inputs$align,$o.DummyInput=fn,$o.EndRowInput=Xn,$o.Input=cl,$o.StatementInput=Ts,$o.ValueInput=l.ValueInput$$module$build$src$core$inputs$value_input,$o.inputTypes=l.inputTypes$$module$build$src$core$inputs$input_types;var of=!1,rf;l.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=ze());var t=[];this.init(e),e=e.getTopBlocks(!0);for(let s=0,a;a=e[s];s++){let d=this.blockToCode(a);Array.isArray(d)&&(d=d[0]),d&&(a.outputConnection&&(d=this.scrubNakedValue(d),this.STATEMENT_PREFIX&&!a.suppressPrefixSuffix&&(d=this.injectId(this.STATEMENT_PREFIX,a)+d),this.STATEMENT_SUFFIX&&!a.suppressPrefixSuffix&&(d+=this.injectId(this.STATEMENT_SUFFIX,a))),t.push(d))}return t=t.join(`
`),t=this.finish(t),t=t.replace(/^\s+\n/,""),t=t.replace(/\n\s+$/,`
`),t=t.replace(/[ \t]+\n/g,`
`)}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,`
`+t)}allNestedComments(e){const t=[];e=e.getDescendants(!0);for(let s=0;s<e.length;s++){const a=e[s].getCommentText();a&&t.push(a)}return t.length&&t.push(""),t.join(`
`)}blockToCode(e,t){if(this.isInitialized===!1&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var s=this.forBlock[e.type];if(typeof s!="function")throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(s=s.call(e,e,this),Array.isArray(s)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,s[0],t),s[1]]}if(typeof s=="string")return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(s=this.injectId(this.STATEMENT_PREFIX,e)+s),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(s+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,s,t);if(s===null)return"";throw SyntaxError("Invalid code generated: "+s)}valueToCode(e,t,s){if(isNaN(s))throw TypeError("Expecting valid order from block: "+e.type);var a=e.getInputTargetBlock(t);if(!a&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if(!a||(t=this.blockToCode(a),t===""))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${a.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+a.type);if(!e)return"";a=!1;var d=Math.floor(s);const f=Math.floor(t);if(d<=f&&(d!==f||d!==0&&d!==99)){for(a=!0,d=0;d<this.ORDER_OVERRIDES.length;d++)if(this.ORDER_OVERRIDES[d][0]===s&&this.ORDER_OVERRIDES[d][1]===t){a=!1;break}}return a&&(e="("+e+")"),e}statementToCode(e,t){const s=e.getInputTargetBlock(t);if(!s&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if(e=this.blockToCode(s),typeof e!="string")throw TypeError("Expecting code from statement block: "+(s&&s.type));return e&&(e=this.prefixLines(e,this.INDENT)),e}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,t){if(!this.definitions_[e]){const s=this.nameDB_.getDistinctName(e,l.NameType$$module$build$src$core$names.PROCEDURE);this.functionNames_[e]=s,Array.isArray(t)&&(t=t.join(`
`)),t=t.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,s);let a;for(;a!==t;)a=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0");t=t.replace(/\0/g,this.INDENT),this.definitions_[e]=t}return this.functionNames_[e]}getVariableName(e){return this.getName(e,l.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,l.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,t)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,s){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},rf={},rf.CodeGenerator=l.CodeGenerator$$module$build$src$core$generator;var lf=class extends dd{constructor(e,t){super(e),this.flyout_=t}getBoundingBox_(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch{e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const t=this.getBoundingBox_();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,s){return t=s||this.getContentMetrics(),s=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*s)/e,width:(t.width+t.left+s)/e,top:0,left:0}}},pl;(function(e){e.BLOCK="block",e.BUTTON="button"})(pl||(pl={}));var _g="WORKSPACE_AT_BLOCK_CAPACITY",su=class extends Jc{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.contents=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.isVisible_=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new xs(e),this.workspace_.setMetricsManager(new lf(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.id=D(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=J(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=J(Y.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new hd(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(ee(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(ee(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:1,capabilities:[bi.Capability.AUTOHIDEABLE,bi.Capability.DELETE_AREA,bi.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)Ee(e);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&M(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.isVisible_}setVisible(e){const t=e!==this.isVisible();this.isVisible_=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}getContents(){return this.contents}setContents(e){this.contents=e}updateDisplay(){let e;e=this.containerVisible?this.isVisible():!1,this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none");let t;(t=this.workspace_.scrollbar)==null||t.setContainerVisible(e)}positionAt_(e,t,s,a){let d;(d=this.svgGroup_)==null||d.setAttribute("width",`${e}`);let f;(f=this.svgGroup_)==null||f.setAttribute("height",`${t}`),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&gt(this.svgGroup_,"translate("+s+"px,"+a+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(s,a),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const e of this.listeners)Ee(e);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),typeof e=="string"&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=ei(e),e=this.createFlyoutInfo(e),$i(this.workspace_),this.setContents(e.contents),this.layout_(e.contents,e.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(e){const t=[],s=[];this.permanentlyDisabled.length=0;const a=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const d of e){if("custom"in d){e=this.getDynamicCategoryContents(d.custom),e=ei(e);const{contents:f,gaps:S}=this.createFlyoutInfo(e);t.push(...f),s.push(...S)}switch(d.kind.toUpperCase()){case"BLOCK":e=d;const f=this.createFlyoutBlock(e);t.push({type:pl.BLOCK,block:f}),this.addBlockGap(e,s,a);break;case"SEP":this.addSeparatorGap(d,s,a);break;case"LABEL":e=this.createButton(d,!0),t.push({type:pl.BUTTON,button:e}),s.push(a);break;case"BUTTON":e=this.createButton(d,!1),t.push({type:pl.BUTTON,button:e}),s.push(a)}}return{contents:t,gaps:s}}getDynamicCategoryContents(e){if(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e),typeof e!="function")throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}createButton(e,t){return new Ns(this.workspace_,this.targetWorkspace,e,t)}createFlyoutBlock(e){let t;return e.blockxml?(e=typeof e.blockxml=="string"?l.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,(t=this.getRecycledBlock(e.getAttribute("type")))||(t=ln(e,this.workspace_))):(t=this.getRecycledBlock(e.type),t||(e.enabled===void 0&&(e.enabled=e.disabled!=="true"&&e.disabled!==!0),e.disabledReasons===void 0&&e.enabled===!1&&(e.disabledReasons=[Rs]),t=zt(e,this.workspace_))),t.isEnabled()||this.permanentlyDisabled.push(t),t}getRecycledBlock(e){let t=-1;for(let s=0;s<this.recycledBlocks.length;s++)if(this.recycledBlocks[s].type===e){t=s;break}return t===-1?void 0:this.recycledBlocks.splice(t,1)[0]}addBlockGap(e,t,s){let a;e.gap?a=parseInt(String(e.gap)):e.blockxml&&(e=typeof e.blockxml=="string"?l.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,a=parseInt(e.getAttribute("gap"))),t.push(!a||isNaN(a)?s:a)}addSeparatorGap(e,t,s){e=parseInt(String(e.gap)),!isNaN(e)&&0<t.length?t[t.length-1]=e:t.push(s)}clearOldBlocks(){var e=this.workspace_.getTopBlocks(!1);for(let s=0,a;a=e[s];s++)this.blockIsRecyclable_(a)?this.recycleBlock(a):a.dispose(!1,!1);for(e=0;e<this.mats.length;e++){const s=this.mats[e];s&&(kr(s),M(s))}this.mats.length=0;for(let s=0,a;a=this.buttons_[s];s++)a.dispose();this.buttons_.length=0;let t;(t=this.workspace_.getPotentialVariableMap())==null||t.clear()}emptyRecycledBlocks(){for(let e=0;e<this.recycledBlocks.length;e++)this.recycledBlocks[e].dispose();this.recycledBlocks=[]}blockIsRecyclable_(e){return!1}recycleBlock(e){const t=e.getRelativeToSurfaceXY();e.moveBy(-t.x,-t.y),this.recycledBlocks.push(e)}addBlockListeners_(e,t,s){this.listeners.push(ee(e,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(ee(s,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(me(e,"pointerenter",t,()=>{this.targetWorkspace.isDragging()||t.addSelect()})),this.listeners.push(me(e,"pointerleave",t,()=>{this.targetWorkspace.isDragging()||t.removeSelect()})),this.listeners.push(me(s,"pointerenter",t,()=>{this.targetWorkspace.isDragging()||t.addSelect()})),this.listeners.push(me(s,"pointerleave",t,()=>{this.targetWorkspace.isDragging()||t.removeSelect()}))}blockMouseDown(e){return t=>{const s=this.targetWorkspace.getGesture(t);s&&(s.setStartBlock(e),s.handleFlyoutStart(t,this))}}onMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()}createBlock(e){let t=null;l.disable$$module$build$src$core$events$utils();var s=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{l.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=Ki(this.targetWorkspace,s),se()){for(l.setGroup$$module$build$src$core$events$utils(!0),s=0;s<e.length;s++){const a=e[s];B(new(j(Ln))(a))}B(new(j(l.CREATE$$module$build$src$core$events$utils))(t))}return this.autoClose?this.hide():this.filterForCapacity(),t}initFlyoutButton_(e,t,s){const a=e.createDom();e.moveTo(t,s),e.show(),this.listeners.push(ee(a,"pointerdown",this,this.onMouseDown)),this.buttons_.push(e)}createRect_(e,t,s,a,d){return t=J(Y.RECT,{"fill-opacity":0,x:t,y:s,height:a.height,width:a.width}),t.tooltip=e,ds(t),this.workspace_.getCanvas().insertBefore(t,e.getSvgRoot()),this.rectMap_.set(e,t),this.mats[d]=t}moveRectToBlock_(e,t){const s=t.getHeightWidth();e.setAttribute("width",String(s.width)),e.setAttribute("height",String(s.height)),t=t.getRelativeToSurfaceXY(),e.setAttribute("y",String(t.y)),e.setAttribute("x",String(this.RTL?t.x-s.width:t.x))}filterForCapacity(){const e=this.workspace_.getTopBlocks(!1);for(let t=0,s;s=e[t];t++)if(!this.permanentlyDisabled.includes(s)){const a=this.targetWorkspace.isCapacityAvailable(be(s));for(;s;)s.setDisabledReason(!a,_g),s=s.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return this.workspace_.scrollbar?this.workspace_.scrollbar.isVisible():!1}placeNewBlock(e){var t=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const s=this.serializeBlock(e);return t.setResizesEnabled(!1),t=Bi(s,t),this.positionNewBlock(e,t),t}serializeBlock(e){return qe(e)}positionNewBlock(e,t){const s=this.targetWorkspace;var a=s.getOriginOffsetInPixels(),d=this.workspace_.getOriginOffsetInPixels();e=e.getRelativeToSurfaceXY(),e.scale(this.workspace_.scale),d=Te.sum(d,e),a=Te.difference(d,a),a.scale(1/s.scale),t.moveTo(new Te(a.x,a.y))}};su.FlyoutItemType=pl;var pd=class extends su{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),s=t.getScrollMetrics(),a=t.getViewMetrics();t=t.getAbsoluteMetrics(),typeof e.y=="number"&&(this.workspace_.scrollY=-(s.top+(s.height-a.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),s=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===lt.LEFT?e.width:s.width-this.width_:this.toolboxPosition_===lt.LEFT?0:s.width:this.toolboxPosition_===lt.LEFT?0:s.width+t.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const s=this.toolboxPosition_===lt.RIGHT;var a=e+this.CORNER_RADIUS;a=["M "+(s?a:0)+",0"],a.push("h",s?-e:e),a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,s?0:1,s?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),a.push("v",Math.max(0,t)),a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,s?0:1,s?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),a.push("h",s?e:-e),a.push("z"),this.svgBackground_.setAttribute("d",a.join(" "))}scrollToStart(){let e;(e=this.workspace_.scrollbar)==null||e.setY(0)}wheel_(e){var t=Ke(e);if(t.y){const s=this.workspace_.getMetricsManager(),a=s.getScrollMetrics();t=s.getViewMetrics().top-a.top+t.y;let d;(d=this.workspace_.scrollbar)==null||d.setY(t),io(this.workspace_),us()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;var s=this.MARGIN;const a=this.RTL?s:s+this.tabWidth_;for(let x=0,Z;Z=e[x];x++)if(Z.type==="block"){var d=Z.block;if(!d)continue;var f=d.getDescendants(!1);for(let Bt=0,Pt;Pt=f[Bt];Bt++)Pt.isInFlyout=!0;f=d.getSvgRoot();const we=d.getHeightWidth();var S=d.outputConnection?a-this.tabWidth_:a;d.moveBy(S,s),S=this.createRect_(d,this.RTL?S-we.width:S,s,we,x),this.addBlockListeners_(f,d,S),s+=we.height+t[x]}else Z.type==="button"&&(d=Z.button,this.initFlyoutButton_(d,a,s),s+=d.height+t[x])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_===lt.LEFT?new Nt(-1e9,1e9,-1e9,t+e.width):new Nt(-1e9,1e9,t,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;var t=this.workspace_.getTopBlocks(!1);for(let a=0,d;d=t[a];a++){var s=d.getHeightWidth().width;d.outputConnection&&(s-=this.tabWidth_),e=Math.max(e,s)}for(let a=0,d;d=this.buttons_[a];a++)e=Math.max(e,d.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=oi.scrollbarThickness,this.width_!==e){for(let a=0,d;d=t[a];a++){if(this.RTL){s=d.getRelativeToSurfaceXY().x;let f=e/this.workspace_.scale-this.MARGIN;d.outputConnection||(f-=this.tabWidth_),d.moveBy(f-s,0)}this.rectMap_.has(d)&&this.moveRectToBlock_(this.rectMap_.get(d),d)}if(this.RTL)for(let a=0,d;d=this.buttons_[a];a++)t=d.getPosition().y,d.moveTo(e/this.workspace_.scale-d.width-this.MARGIN-this.tabWidth_,t);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==lt.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};pd.registryName="verticalFlyout",h(pe.FLYOUTS_VERTICAL_TOOLBOX,cn,pd);var af=class extends su{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),s=t.getScrollMetrics(),a=t.getViewMetrics();t=t.getAbsoluteMetrics(),typeof e.x=="number"&&(this.workspace_.scrollX=-(s.left+(s.width-a.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),s=e.getViewMetrics();e=e.getToolboxMetrics();const a=this.toolboxPosition_===lt.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?a?e.height:s.height-this.height_:a?0:s.height:a?0:s.height+t.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const s=this.toolboxPosition_===lt.TOP,a=["M 0,"+(s?0:this.CORNER_RADIUS)];s?(a.push("h",e+2*this.CORNER_RADIUS),a.push("v",t),a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),a.push("h",-e),a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),a.push("h",e),a.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),a.push("v",t),a.push("h",-e-2*this.CORNER_RADIUS)),a.push("z"),this.svgBackground_.setAttribute("d",a.join(" "))}scrollToStart(){let e;(e=this.workspace_.scrollbar)==null||e.setX(this.RTL?1/0:0)}wheel_(e){var t=Ke(e);if(t=t.x||t.y){const s=this.workspace_.getMetricsManager(),a=s.getScrollMetrics();t=s.getViewMetrics().left-a.left+t;let d;(d=this.workspace_.scrollbar)==null||d.setX(t),io(this.workspace_),us()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;const s=this.MARGIN;let a=s+this.tabWidth_;this.RTL&&(e=e.reverse());for(let x=0,Z;Z=e[x];x++)if(Z.type==="block"){var d=Z.block;if(d==null)continue;var f=d.getDescendants(!1);for(let Bt=0,Pt;Pt=f[Bt];Bt++)Pt.isInFlyout=!0;f=d.getSvgRoot();const we=d.getHeightWidth();var S=d.outputConnection?this.tabWidth_:0;S=this.RTL?a+we.width:a-S,d.moveBy(S,s),S=this.createRect_(d,S,s,we,x),a+=we.width+t[x],this.addBlockListeners_(f,d,S)}else Z.type==="button"&&(d=Z.button,this.initFlyoutButton_(d,a,s),a+=d.width+t[x])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_===lt.TOP?new Nt(-1e9,t+e.height,-1e9,1e9):new Nt(t,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;const t=this.workspace_.getTopBlocks(!1);for(let a=0,d;d=t[a];a++)e=Math.max(e,d.getHeightWidth().height);const s=this.buttons_;for(let a=0,d;d=s[a];a++)e=Math.max(e,d.height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=oi.scrollbarThickness,this.height_!==e){for(let a=0,d;d=t[a];a++)this.rectMap_.has(d)&&this.moveRectToBlock_(this.rectMap_.get(d),d);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==lt.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};h(pe.FLYOUTS_HORIZONTAL_TOOLBOX,cn,af);var Ra=class extends _n{constructor(e,t,s,a,d){super(Mt.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=Ra.dropdownCreate,this.defaultVariableName=typeof e=="string"?e:"",this.size_=new bt(0,0),e!==Mt.SKIP_SETUP&&(d?this.configure_(d):this.setTypes(s,a),t&&this.setValidator(t))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new ri;this.variable||(e=l.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new ri;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||e.type!=="variables_get")}fromXml(e){var t=this.getSourceBlock();if(!t)throw new ri;const s=e.getAttribute("id"),a=e.textContent,d=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(t=l.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,s,a,d),d!==null&&d!==t.type)throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.type+", and does not match variable field that references it: "+Os(e)+".");this.setValue(t.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.name,this.variable.type&&e.setAttribute("variabletype",this.variable.type),e}saveState(e){var t=this.saveLegacyState(Ra);return t!==null||(this.initModel(),t={id:this.variable.getId()},e&&(t.name=this.variable.name,t.type=this.variable.type)),t}loadState(e){const t=this.getSourceBlock();if(!t)throw new ri;this.loadLegacyState(Ra,e)||(e=l.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(e===null)return null;var t=this.getSourceBlock();if(!t)throw new ri;return t=l.getVariable$$module$build$src$core$variables(t.workspace,e),t?(t=t.type,this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const t=this.getSourceBlock();if(!t)throw new ri;this.variable=l.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const t=this.getVariableTypes();if(!t)return!0;for(let s=0;s<t.length;s++)if(e===t[s])return!0;return!1}getVariableTypes(){var e=this.variableTypes;if(e===null&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(e=e||[""],e.length===0)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e}setTypes(e=null,t=""){if(Array.isArray(e)){let s=!1;for(let a=0;a<e.length;a++)e[a]===t&&(s=!0);if(!s)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else if(e!==null)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=t,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(e===Qh){l.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);return}if(e===ed){this.sourceBlock_.workspace.deleteVariableById(this.variable.getId());return}}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(Dt(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let t=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var s=this.getVariableTypes(),a=0;a<s.length;a++){const d=this.sourceBlock_.workspace.getVariablesOfType(s[a]);t=t.concat(d)}for(t.sort(ha.compareByName),s=[],a=0;a<t.length;a++)s[a]=[t[a].name,t[a].getId()];return s.push([l.Msg$$module$build$src$core$msg.RENAME_VARIABLE,Qh]),l.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&s.push([l.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),ed]),s}};ks("field_variable",Ra);var fd=class extends eu{constructor(e,t,s,a,d,f){super(Mt.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==Mt.SKIP_SETUP&&(f?this.configure_(f):this.setConstraints(t,s,a),this.setValue(e),d&&this.setValidator(d))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,s){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(s),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){e==null?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){e==null?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);t.includes("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const s=t.indexOf(".");this.decimalPlaces=s===-1?e?0:null:t.length-s-1}getPrecision(){return this.precision_}doClassValidation_(e){return e===null||(e=`${e}`.replace(/O/gi,"0"),e=e.replace(/,/g,""),e=e.replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e))?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),this.decimalPlaces!==null&&(e=Number(e.toFixed(this.decimalPlaces))),e)}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,si(e,vi.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,si(e,vi.VALUEMAX,this.max_)),e}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};ks("field_number",fd),fd.prototype.DEFAULT_VALUE=0;var cf=class extends ir{constructor(e,t,s){super(String(e??""),t,s),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(Dt(e.text),void 0,e)}};ks("field_label_serializable",cf);var lr=class extends Mt{constructor(e,t,s){super(Mt.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=lr.CHECK_CHAR,e!==Mt.SKIP_SETUP&&(s&&this.configure_(s),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(lr);return e!==null?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();$e(e,"blocklyCheckbox"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||lr.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return e===!0||e==="TRUE"?"TRUE":e===!1||e==="FALSE"?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool_(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(e){return typeof e=="string"?e==="TRUE":!!e}static fromJson(e){return new this(e.checked,void 0,e)}};lr.CHECK_CHAR="✓",ks("field_checkbox",lr),lr.prototype.DEFAULT_VALUE=!1;var uf=class{constructor(e,t){this.draggable=e,this.workspace=t,this.dragTarget=null,this.startLoc=e.getRelativeToSurfaceXY()}onDragStart(e){this.draggable.startDrag(e)}onDrag(e,t){this.moveDraggable(e,t),t=this.getRoot(this.draggable),Cs(t)&&t.setDeleteStyle(this.wouldDeleteDraggable(e,t)),this.updateDragTarget(e)}updateDragTarget(e){e=this.workspace.getDragTarget(e);const t=this.getRoot(this.draggable);if(this.dragTarget!==e){let s;(s=this.dragTarget)==null||s.onDragExit(t),e==null||e.onDragEnter(t)}e==null||e.onDragOver(t),this.dragTarget=e}moveDraggable(e,t){t=this.pixelsToWorkspaceUnits(t),t=Te.sum(this.startLoc,t),this.draggable.drag(t,e)}wouldDeleteDraggable(e,t){return(e=this.workspace.getDragTarget(e))&&this.workspace.getComponentManager().hasCapability(e.id,bi.Capability.DELETE_AREA)?e.wouldDelete(t):!1}onDragEnd(e){const t=l.getGroup$$module$build$src$core$events$utils();var s=this.workspace.getDragTarget(e);const a=this.getRoot(this.draggable);if(s){let d;(d=this.dragTarget)==null||d.onDrop(a)}this.shouldReturnToStart(e,a)&&this.draggable.revertDrag(),(s=Cs(a)&&this.wouldDeleteDraggable(e,a))&&this.draggable instanceof Ps&&fe(this.draggable.getRootBlock()),this.draggable.endDrag(e),s&&Cs(a)&&(e=l.getGroup$$module$build$src$core$events$utils(),l.setGroup$$module$build$src$core$events$utils(t),a.dispose(),l.setGroup$$module$build$src$core$events$utils(e))}getRoot(e){return e instanceof Ps?e.getRootBlock():e}shouldReturnToStart(e,t){return(e=this.workspace.getDragTarget(e))?e.shouldPreventMove(t):!1}pixelsToWorkspaceUnits(e){return e=new Te(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}};h(pe.BLOCK_DRAGGER,cn,uf);var wa={};wa.BlockDragStrategy=Hp,wa.BubbleDragStrategy=bp,wa.CommentDragStrategy=Z_,wa.Dragger=uf;var gd=class extends hn{constructor(e,t,s){super(e?e.workspace.id:void 0),this.type=Fo,e&&(this.blockId=e.id,this.isStart=t,this.blocks=s)}toJson(){const e=super.toJson();if(this.isStart===void 0)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(this.blockId===void 0)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new gd),t.isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}};h(pe.EVENT,Fo,gd);var md=class extends Ko{constructor(e,t,s,a){super(e),this.type=Do,this.recordUndo=!1,e&&(this.name=t,this.oldValue=s,this.newValue=a)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new md),t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(t=t.getBlockById(this.blockId),!t)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};h(pe.EVENT,Do,md);var $d=class extends Ko{constructor(e){super(e),this.type=l.MOVE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new $d),t.oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(s=e.oldCoordinate.split(","),t.oldCoordinate=new Te(Number(s[0]),Number(s[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(s=e.newCoordinate.split(","),t.newCoordinate=new Te(Number(s[0]),Number(s[1]))),e.reason!==void 0&&(t.reason=e.reason),e.recordUndo!==void 0&&(t.recordUndo=e.recordUndo),t}recordNew(){const e=this.currentLocation_();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation_(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t=e.getBlockById(this.blockId);if(!t)throw Error("The block associated with the block move event could not be found");e={};const s=t.getParent();return s?(e.parentId=s.id,(t=s.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&Te.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var s=t.getBlockById(this.blockId);if(s){var a=e?this.newParentId:this.oldParentId,d=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,a){var f=t.getBlockById(a);if(!f){console.warn("Can't connect to non-existent block: "+a);return}}if(s.getParent()&&s.unplug(),e)d=s.getRelativeToSurfaceXY(),s.moveBy(e.x-d.x,e.y-d.y,this.reason);else{t=s.outputConnection,(!t||s.previousConnection&&s.previousConnection.isConnected())&&(t=s.previousConnection);let S,x;s=(x=t)==null?void 0:x.type,d?(s=f.getInput(d))&&(S=s.connection):s===Le.PREVIOUS_STATEMENT&&(S=f.nextConnection),S&&t?t.connect(S):console.warn("Can't connect to non-existent input: "+d)}}else console.warn("Can't move non-existent block: "+this.blockId)}};h(pe.EVENT,l.MOVE$$module$build$src$core$events$utils,$d);var Td=class extends hn{constructor(e,t,s){super(e?e.workspace.id:void 0),this.type=un,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=s)}toJson(){const e=super.toJson();if(this.isOpen===void 0)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Td),t.isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}},Ed;(function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"})(Ed||(Ed={})),h(pe.EVENT,un,Td);var Yn=class extends Xr{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=l.getGroup$$module$build$src$core$events$utils(),this.recordUndo=V())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Yn),t.commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){const s=e.getEventWorkspace_();if(t){if(!e.json)throw Error("Encountered a comment event without proper json");as(e.json,s)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=s.getCommentById(e.commentId))?t.dispose():console.warn("Can't delete non-existent comment: "+e.commentId)}}},bd=class extends Yn{constructor(e,t,s){super(e),this.type=zr,e&&(this.oldContents_=typeof t>"u"?"":t,this.newContents_=typeof s>"u"?"":s)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new bd),t.oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var s=e?this.newContents_:this.oldContents_;if(s===void 0)throw Error(e?"The new contents is undefined. Either pass a value to the constructor, or call fromJson":"The old contents is undefined. Either pass a value to the constructor, or call fromJson");t.setText(s)}else console.warn("Can't change non-existent comment: "+this.commentId)}};h(pe.EVENT,zr,bd);var vd=class extends Yn{constructor(e){super(e),this.type=Mn,e&&(this.xml=so(e),this.json=ii(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Os(this.xml),e.json=this.json,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new vd),t.xml=l.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}run(e){Yn.CommentCreateDeleteHelper(this,e)}};h(pe.EVENT,Mn,vd);var yd=class extends Yn{constructor(e){super(e),this.type=Wr,e&&(this.xml=so(e),this.json=ii(e,{addCoordinates:!0}))}run(e){Yn.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Os(this.xml),e.json=this.json,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new yd),t.xml=l.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}};h(pe.EVENT,Wr,yd);var Id=class extends Yn{constructor(e){super(e),this.type=xn,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(e){this.reason=e}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Id),s=e.oldCoordinate.split(","),t.oldCoordinate_=new Te(Number(s[0]),Number(s[1])),s=e.newCoordinate.split(","),t.newCoordinate_=new Te(Number(s[0]),Number(s[1])),t}isNull(){return Te.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(e=e?this.newCoordinate_:this.oldCoordinate_,!e)throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");t.moveTo(e)}else console.warn("Can't move non-existent comment: "+this.commentId)}};h(pe.EVENT,xn,Id);var Sd=class extends Yn{constructor(e,t){super(e),this.newCollapsed=t,this.type=ia}toJson(){const e=super.toJson();if(this.newCollapsed===void 0)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return e.newCollapsed=this.newCollapsed,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Sd),t.newCollapsed=e.newCollapsed,t}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=t.getCommentById(this.commentId))?t.setCollapsed(e?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}};h(pe.EVENT,ia,Sd);var Od=class extends hn{constructor(e,t,s){super(s),this.type=Gr,this.oldItem=e??void 0,this.newItem=t??void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,s){return t=super.fromJson(e,t,s??new Od),t.oldItem=e.oldItem,t.newItem=e.newItem,t}};h(pe.EVENT,Gr,Od);var hf=class extends Xr{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=Uo,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};h(pe.EVENT,Uo,hf),l.CHANGE$$module$build$src$core$events$utils,l.CREATE$$module$build$src$core$events$utils,l.DELETE$$module$build$src$core$events$utils,l.MOVE$$module$build$src$core$events$utils,l.CHANGE$$module$build$src$core$events$utils,l.CREATE$$module$build$src$core$events$utils,l.DELETE$$module$build$src$core$events$utils,l.MOVE$$module$build$src$core$events$utils,l.disable$$module$build$src$core$events$utils,l.enable$$module$build$src$core$events$utils,l.getGroup$$module$build$src$core$events$utils,l.setGroup$$module$build$src$core$events$utils,l.setRecordUndo$$module$build$src$core$events$utils;var Me={};Me.Abstract=Xr,Me.BLOCK_CHANGE=l.CHANGE$$module$build$src$core$events$utils,Me.BLOCK_CREATE=l.CREATE$$module$build$src$core$events$utils,Me.BLOCK_DELETE=l.DELETE$$module$build$src$core$events$utils,Me.BLOCK_DRAG=Fo,Me.BLOCK_FIELD_INTERMEDIATE_CHANGE=Do,Me.BLOCK_MOVE=l.MOVE$$module$build$src$core$events$utils,Me.BUBBLE_OPEN=un,Me.BUMP_EVENTS=dc,Me.BlockBase=Ko,Me.BlockChange=Jo,Me.BlockCreate=xh,Me.BlockDelete=Kh,Me.BlockDrag=gd,Me.BlockFieldIntermediateChange=md,Me.BlockMove=$d,Me.BubbleOpen=Td,Me.BubbleType=Ed,Me.CHANGE=l.CHANGE$$module$build$src$core$events$utils,Me.CLICK=Nn,Me.COMMENT_CHANGE=zr,Me.COMMENT_CREATE=Mn,Me.COMMENT_DELETE=Wr,Me.COMMENT_MOVE=xn,Me.CREATE=l.CREATE$$module$build$src$core$events$utils,Me.Click=Qu,Me.ClickTarget=eh,Me.CommentBase=Yn,Me.CommentChange=bd,Me.CommentCollapse=Sd,Me.CommentCreate=vd,Me.CommentDelete=yd,Me.CommentMove=Id,Me.DELETE=l.DELETE$$module$build$src$core$events$utils,Me.FINISHED_LOADING=Uo,Me.FinishedLoading=hf,Me.MARKER_MOVE=Ur,Me.MOVE=l.MOVE$$module$build$src$core$events$utils,Me.MarkerMove=Jh,Me.SELECTED=Fr,Me.Selected=od,Me.THEME_CHANGE=Vr,Me.TOOLBOX_ITEM_SELECT=Gr,Me.TRASHCAN_OPEN=Hr,Me.ThemeChange=Ph,Me.ToolboxItemSelect=Od,Me.TrashcanOpen=nd,Me.UI=uc,Me.UiBase=hn,Me.VAR_CREATE=Ln,Me.VAR_DELETE=Bo,Me.VAR_RENAME=Br,Me.VIEWPORT_CHANGE=ao,Me.VarBase=ua,Me.VarCreate=dh,Me.VarDelete=td,Me.VarRename=id,Me.ViewportChange=Dh,Me.clearPendingUndo=z,Me.disable=l.disable$$module$build$src$core$events$utils,Me.disableOrphans=ye,Me.enable=l.enable$$module$build$src$core$events$utils,Me.filter=P,Me.fire=B,Me.fromJson=q,Me.get=j,Me.getDescendantIds=he,Me.getGroup=l.getGroup$$module$build$src$core$events$utils,Me.getRecordUndo=V,Me.isEnabled=se,Me.setGroup=l.setGroup$$module$build$src$core$events$utils,Me.setRecordUndo=l.setRecordUndo$$module$build$src$core$events$utils;var qs={};qs.BottomRow=Zp,qs.ConstantProvider=Kp,qs.Drawer=Jp,qs.MarkerSvg=tf,qs.PathObject=sf,qs.RenderInfo=ef,qs.Renderer=_d,qs.RightConnectionShape=qp,qs.StatementInput=iu,qs.TopRow=Qp,Ju();var yi={};yi.registerCleanup=Mu,yi.registerCollapse=Pu,yi.registerCollapseExpandBlock=Vu,yi.registerComment=Hu,yi.registerCommentCreate=Ku,yi.registerCommentDelete=Yu,yi.registerCommentDuplicate=ju,yi.registerCommentOptions=h_,yi.registerDefaultOptions=Ju,yi.registerDelete=zu,yi.registerDeleteAll=Fu,yi.registerDisable=Wu,yi.registerDuplicate=Uu,yi.registerExpand=Du,yi.registerHelp=Xu,yi.registerInline=Gu,yi.registerRedo=Nu,yi.registerUndo=Lu;var nu={};nu.CommentView=J_,nu.RenderedWorkspaceComment=Pc,nu.WorkspaceComment=Ic;var Aa={};Aa.Bubble=wt,Aa.MiniWorkspaceBubble=Hn,Aa.TextBubble=Uh,Aa.TextInputBubble=Ip;var df=class extends zc{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},_f=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+`
`+this.inlineSteps_}drawTopCorner(e){this.steps_+=Ut(e.xPos,this.info_.startY);for(let t=0,s;s=e.elements[t];t++)G.isLeftSquareCorner(s)?this.steps_+=this.highlightConstants_.START_POINT:G.isLeftRoundedCorner(s)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):G.isPreviousConnection(s)?this.steps_+=this.notchPaths_.pathLeft:G.isHat(s)?this.steps_+=this.startPaths_.path(this.RTL_):G.isSpacer(s)&&s.width!==0&&(this.steps_+=Ne("H",s.xPos+s.width-this.highlightOffset));this.steps_+=Ne("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+Ne("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const t=e.getLastInput();if(this.RTL_){const s=e.height-t.connectionHeight;this.steps_+=Ei(t.xPos+t.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+Ne("v",s)}else this.steps_+=Ei(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const t=e.getLastInput();if(t)if(this.RTL_){const s=e.height-2*this.insideCornerPaths_.height;this.steps_+=Ei(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+Ne("v",s)+this.insideCornerPaths_.pathBottom(this.RTL_)+an(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Ei(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+an(e.width-t.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const t=e.xPos+e.width-this.highlightOffset;e instanceof Yh&&e.followsStatement&&(this.steps_+=Ne("H",t)),this.RTL_&&(this.steps_+=Ne("H",t),e.height>this.highlightOffset&&(this.steps_+=Ne("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=Ne("V",e.baseline-this.highlightOffset);else{const t=this.info_.bottomRow.elements[0];G.isLeftSquareCorner(t)?this.steps_+=Ei(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):G.isLeftRoundedCorner(t)&&(this.steps_+=Ei(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=Ei(this.info_.startX,e):(this.steps_+=Ei(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=Ne("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,G.isLeftRoundedCorner(e.elements[0])?this.steps_+=Ne("V",this.outsideCornerPaths_.height):this.steps_+=Ne("V",e.capline+this.highlightOffset))}drawInlineInput(e){const t=this.highlightOffset,s=e.xPos+e.connectionWidth;var a=e.centerline-e.height/2;const d=e.width-e.connectionWidth,f=a+t;this.RTL_?(a=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=Ei(s-t,f)+Ne("v",a)+this.puzzleTabPaths_.pathDown(this.RTL_)+Ne("v",e)+Ne("h",d)):this.inlineSteps_+=Ei(e.xPos+e.width+t,f)+Ne("v",e.height)+Ne("h",-d)+Ei(s,a+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},pf=class extends Xc{constructor(e,t){super(e,t),this.highlighter_=new _f(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+`
`+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=Ne("H",e.xPos+e.width)+Ne("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let s=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(s*=-1),e.connectionModel.setOffsetInBlock(s,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(t!=null&&t.connectionModel){let s=e.xPos+e.statementEdge+t.notchOffset;s=this.info_.RTL?-1*s:s+this.constants_.DARK_PATH_OFFSET,t.connectionModel.setOffsetInBlock(s,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let s=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(s*=-1),t.connectionModel.setOffsetInBlock(s,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,s=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-s:s)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},ff=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=Ut(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,s=(1-Math.SQRT1_2)*(e+t)-t,a=Ut(s,s)+ni("a","0 0,0",e,He(-s-t,e-s)),d=ni("a","0 0,0",e+t,He(e+t,e+t)),f=Ut(s,-s)+ni("a","0 0,0",e+t,He(e-s,s+t));return{width:e+t,height:e,pathTop(S){return S?a:""},pathBottom(S){return S?d:f}}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,s=(1-Math.SQRT1_2)*(e-t)+t,a=Ut(s,s)+ni("a","0 0,1",e-t,He(e-s,-s+t)),d=Ut(t,e)+ni("a","0 0,1",e-t,He(e,-e+t)),f=-s,S=Ut(s,f)+ni("a","0 0,1",e-t,He(-s+t,-f-e));return{height:e,topLeft(x){return x?a:d},bottomLeft(){return S}}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,s=Ut(-2,-t+3.4)+an(-.45*e,-2.1),a=Ne("v",2.5)+Ut(.97*-e,2.5)+ts("q",[He(.05*-e,10),He(.3*e,9.5)])+Ut(.67*e,-1.9)+Ne("v",2.5),d=Ne("v",-1.5)+Ut(-.92*e,-.5)+ts("q",[He(-.19*e,-5.5),He(0,-11)])+Ut(.92*e,1),f=Ut(-5,t-.7)+an(.46*e,-2.1);return{width:e,height:t,pathUp(S){return S?s:d},pathDown(S){return S?a:f}}}makeNotch(){return{pathLeft:Ne("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:an(5.1,2.6)+Ut(-10.2,6.8)+an(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,t=Ut(25,-8.7)+ts("c",[He(29.7,-6.2),He(57.2,-.5),He(75,8.7)]),s=ts("c",[He(17.8,-9.2),He(45.3,-14.9),He(75,-8.7)])+Ei(100.5,e+.5);return{path(a){return a?t:s}}}},gf=class extends zh{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},mf=class extends va{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},$f=class extends Sa{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof Ts||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new gf(this.constants_,e)),t.hasInlineInput=!0):e instanceof Ts?(t.elements.push(new mf(this.constants_,e)),t.hasStatement=!0):e instanceof l.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Wc(this.constants_,e)),t.hasExternalInput=!0):(e instanceof fn||e instanceof Xn)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||t.align!==null||(t.align=e.align)}addElemSpacing_(){let e=!1;for(let s=0,a;a=this.rows[s];s++)a.hasExternalInput&&(e=!0);for(let s=0,a;a=this.rows[s];s++){var t=a.elements;if(a.elements=[],a.startsWithElemSpacer()&&a.elements.push(new $s(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let d=0;d<t.length-1;d++){a.elements.push(t[d]);const f=this.getInRowSpacing_(t[d],t[d+1]);a.elements.push(new $s(this.constants_,f))}a.elements.push(t[t.length-1]),a.endsWithElemSpacer()&&(t=this.getInRowSpacing_(t[t.length-1],null),e&&a.hasDummyInput&&(t+=this.constants_.TAB_WIDTH),a.elements.push(new $s(this.constants_,t)))}}}getInRowSpacing_(e,t){if(!e)return t&&G.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&G.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&G.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!G.isInput(e)&&(!t||G.isStatementInput(t)))return G.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:G.isIcon(e)?2*this.constants_.LARGE_PADDING+1:G.isHat(e)?this.constants_.NO_PADDING:G.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:G.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:G.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(G.isInput(e)&&!t){if(G.isExternalInput(e))return this.constants_.NO_PADDING;if(G.isInlineInput(e))return this.constants_.LARGE_PADDING;if(G.isStatementInput(e))return this.constants_.NO_PADDING}if(!G.isInput(e)&&t&&G.isInput(t)){if(G.isField(e)&&e.isEditable){if(G.isInlineInput(t)||G.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(G.isInlineInput(t)||G.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(G.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(G.isIcon(e)&&t&&!G.isInput(t))return this.constants_.LARGE_PADDING;if(G.isInlineInput(e)&&t&&G.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(G.isLeftSquareCorner(e)&&t){if(G.isHat(t))return this.constants_.NO_PADDING;if(G.isPreviousConnection(t))return t.notchOffset;if(G.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(G.isLeftRoundedCorner(e)&&t){if(G.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(G.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return G.isField(e)&&t&&G.isField(t)&&e.isEditable===t.isEditable||t&&G.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return G.isTopRow(e)&&G.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:G.isTopRow(e)||G.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(G.isSpacer(t))return e.yPos+t.height/2;if(G.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,G.isNextConnection(t)?e+t.height/2:e-t.height/2;if(G.isTopRow(e))return G.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let s=e.yPos;return G.isField(t)||G.isIcon(t)?(s+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(s+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):s=G.isInlineInput(t)?s+t.height/2:s+e.height/2,s}alignRowElements_(){if(this.isInline){var e=0,t=new WeakMap,s=null;for(let a=this.rows.length-1,d;d=this.rows[a];a--)t.set(d,e),G.isInputRow(d)&&(d.hasStatement&&this.alignStatementRow_(d),s&&s.hasStatement&&d.width<s.width?t.set(d,s.width):e=d.hasStatement?d.width:Math.max(e,d.width),s=d);e=0;for(let a=0,d;d=this.rows[a];a++)d.hasStatement?e=this.getDesiredRowWidth_(d):G.isSpacer(d)?d.width=Math.max(e,t.get(d)):(s=d.width,e=Math.max(e,t.get(d))-s,0<e&&this.addAlignmentPadding_(d,e),e=d.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,t=0;for(let a=0,d;d=this.rows[a];a++){d.yPos=t,d.xPos=this.startX,t+=d.height,e=Math.max(e,d.widthWithConnectedBlocks);var s=t-this.topRow.ascenderHeight;d===this.bottomRow&&s<this.constants_.MIN_BLOCK_HEIGHT&&(s=this.constants_.MIN_BLOCK_HEIGHT-s,this.bottomRow.height+=s,t+=s),this.recordElemPositions_(d)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(s=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,s.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=t+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},Tf=class extends Yc{constructor(e,t,s){super(e,t,s),this.constants=s,this.colourDark="#000000",this.svgPathDark=J(Y.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=J(Y.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=on("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},Ef=class extends jc{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t){super.refreshDom(e,t),this.getHighlightConstants().init()}makeConstants_(){return new df}makeRenderInfo_(e){return new $f(this,e)}makeDrawer_(e,t){return new pf(e,t)}makePathObject(e,t){return new Tf(e,t,this.getConstants())}makeHighlightConstants_(){return new ff(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};Ql("geras",Ef);var $n={};$n.ConstantProvider=df,$n.Drawer=pf,$n.HighlightConstantProvider=ff,$n.Highlighter=_f,$n.InlineInput=gf,$n.PathObject=Tf,$n.RenderInfo=$f,$n.Renderer=Ef,$n.StatementInput=mf;var bf=class extends Sa{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){const a=this.rows[t];var s=a.elements;if(a.elements=[],a.startsWithElemSpacer()&&a.elements.push(new $s(this.constants_,this.getInRowSpacing_(null,s[0]))),s.length){for(let d=0;d<s.length-1;d++){a.elements.push(s[d]);const f=this.getInRowSpacing_(s[d],s[d+1]);a.elements.push(new $s(this.constants_,f))}a.elements.push(s[s.length-1]),a.endsWithElemSpacer()&&(s=this.getInRowSpacing_(s[s.length-1],null),e&&a.hasDummyInput&&(s+=this.constants_.TAB_WIDTH),a.elements.push(new $s(this.constants_,s)))}}}getInRowSpacing_(e,t){if(!e)return t&&G.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&G.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&G.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!G.isInput(e)&&!t)return G.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:G.isIcon(e)?2*this.constants_.LARGE_PADDING+1:G.isHat(e)?this.constants_.NO_PADDING:G.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:G.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:G.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(G.isInput(e)&&!t){if(G.isExternalInput(e))return this.constants_.NO_PADDING;if(G.isInlineInput(e))return this.constants_.LARGE_PADDING;if(G.isStatementInput(e))return this.constants_.NO_PADDING}if(!G.isInput(e)&&t&&G.isInput(t)){if(G.isField(e)&&e.isEditable){if(G.isInlineInput(t)||G.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(G.isInlineInput(t)||G.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(G.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(G.isIcon(e)&&t&&!G.isInput(t))return this.constants_.LARGE_PADDING;if(G.isInlineInput(e)&&t&&G.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(G.isLeftSquareCorner(e)&&t){if(G.isHat(t))return this.constants_.NO_PADDING;if(G.isPreviousConnection(t)||G.isNextConnection(t))return t.notchOffset}return G.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:G.isField(e)&&t&&G.isField(t)&&e.isEditable===t.isEditable||t&&G.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return G.isTopRow(e)&&G.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:G.isTopRow(e)||G.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(G.isSpacer(t))return e.yPos+t.height/2;if(G.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,G.isNextConnection(t)?e+t.height/2:e-t.height/2;if(G.isTopRow(e))return G.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let s=e.yPos;return s=G.isField(t)&&e.hasStatement?s+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):s+e.height/2}finalize_(){let e=0,t=0;for(var s=0;s<this.rows.length;s++){const d=this.rows[s];d.yPos=t,d.xPos=this.startX,t+=d.height,e=Math.max(e,d.widthWithConnectedBlocks);var a=t-this.topRow.ascenderHeight;d===this.bottomRow&&a<this.constants_.MIN_BLOCK_HEIGHT&&(a=this.constants_.MIN_BLOCK_HEIGHT-a,this.bottomRow.height+=a,t+=a),this.recordElemPositions_(d)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(s=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,s.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}},vf=class extends jc{constructor(e){super(e)}makeRenderInfo_(e){return new bf(this,e)}};Ql("thrasos",vf);var kd={};kd.RenderInfo=bf,kd.Renderer=vf;var pg={colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},fg={colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}},gg=new tr("zelos",pg,fg),mg={Classic:Bc,Zelos:gg},Cd=class{constructor(e,t,s){this.id_=e.toolboxitemid||N(),this.level_=(this.parent_=s||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}},Qs=class extends Cd{constructor(e,t,s){super(e,t,s),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),this.toolboxItemDef_.hidden==="true"&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let t=0;t<e.length;t++){const s=e[t];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(s)}}parseCategoryDef_(e){this.name_="name"in e?Dt(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),Hs(this.htmlDiv_,js.TREEITEM),si(this.htmlDiv_,vi.SELECTED,!1),si(this.htmlDiv_,vi.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),Hs(this.iconDom_,js.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&si(this.htmlDiv_,vi.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&$e(e,t),e}createRowContainer_(){const e=document.createElement("div");var t=this.cssConfig_.row;return t&&$e(e,t),t=`${Qs.nestedPadding*this.getLevel()}px`,this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){const e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&$e(e,t),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&$e(e,t)}return e.style.display="inline-block",e}createLabelDom_(e){const t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&$e(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=Qs.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle_(t);if(e)return this.parseColour_(e)}return""}getColourfromStyle_(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour_(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour_(e){if(e=Dt(e),e==null||e==="")return"";var t=Number(e);return isNaN(t)?(t=qi(e))?t:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):Ro(t)}openIcon_(e){if(e){var t=this.cssConfig_.closedicon;t&&Qe(e,t),(t=this.cssConfig_.openicon)&&$e(e,t)}}closeIcon_(e){if(e){var t=this.cssConfig_.openicon;t&&Qe(e,t),(t=this.cssConfig_.closedicon)&&$e(e,t)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(e=e.getParent(),!e.isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var t=this.cssConfig_.selected;if(e){const s=this.parseColour_(Qs.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||s,t&&$e(this.rowDiv_,t)}else this.rowDiv_.style.backgroundColor="",t&&ke(this.rowDiv_,t);si(this.htmlDiv_,vi.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_=typeof e=="string"?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:ei(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){M(this.htmlDiv_)}};Qs.registrationName="category",Qs.nestedPadding=19,Qs.borderWidth=8,Qs.defaultBackgroundColour="#57e",Ue(`
.blocklyTreeRow:not(.blocklyTreeSelected):hover {
  background-color: rgba(255, 255, 255, .2);
}

.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {
  margin: 1px 5px 1px 0;
}

.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {
  margin: 1px 0 1px 5px;
}

.blocklyTreeRow {
  height: 22px;
  line-height: 22px;
  margin-bottom: 3px;
  padding-right: 8px;
  white-space: nowrap;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {
  margin-left: 8px;
  padding-right: 0;
}

.blocklyTreeIcon {
  background-image: url(<<<PATH>>>/sprites.png);
  height: 16px;
  vertical-align: middle;
  visibility: hidden;
  width: 16px;
}

.blocklyTreeIconClosed {
  background-position: -32px -1px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {
  background-position: 0 -1px;
}

.blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: -32px -17px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: 0 -17px;
}

.blocklyTreeIconOpen {
  background-position: -16px -1px;
}

.blocklyTreeSelected>.blocklyTreeIconOpen {
  background-position: -16px -17px;
}

.blocklyTreeLabel {
  cursor: default;
  font: 16px sans-serif;
  padding: 0 3px;
  vertical-align: middle;
}

.blocklyToolboxDelete .blocklyTreeLabel {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyTreeSelected .blocklyTreeLabel {
  color: #fff;
}
`),h(pe.TOOLBOX_ITEM,Qs.registrationName,Qs);var La=class extends Cd{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv_=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&$e(e,t),this.htmlDiv_=e}getDiv(){return this.htmlDiv_}dispose(){M(this.htmlDiv_)}};La.registrationName="sep",Ue(`
.blocklyTreeSeparator {
  border-bottom: solid #e5e5e5 1px;
  height: 0;
  margin: 5px 0;
}

.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {
  border-right: solid #e5e5e5 1px;
  border-bottom: none;
  height: auto;
  margin: 0 5px 0 5px;
  padding: 5px 0;
  width: 0;
}
`),h(pe.TOOLBOX_ITEM,La.registrationName,La);var fl=class extends Qs{constructor(e,t,s){super(e,t,s),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxContents",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const t=e.contents;if(t){this.flyoutItems_=[],e=!0;for(let s=0;s<t.length;s++){const a=t[s];!v(pe.TOOLBOX_ITEM,a.kind)||a.kind.toLowerCase()===La.registrationName&&e?(this.flyoutItems_.push(a),e=!0):(this.createToolboxItem_(a),e=!1)}}}}createToolboxItem_(e){let t=e.kind;t.toUpperCase()==="CATEGORY"&&Ci(e)&&(t=fl.registrationName),e=new(I(pe.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded(this.toolboxItemDef_.expanded==="true"||this.toolboxItemDef_.expanded===!0)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),Hs(this.subcategoriesDiv_,js.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),si(this.htmlDiv_,vi.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&$e(e,t),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const t=document.createElement("div");t.style.display="none";var s=this.cssConfig_.contents;for(s&&$e(t,s),s=0;s<e.length;s++){const a=e[s];a.init();const d=a.getDiv();if(t.appendChild(d),a.getClickTarget){let f;(f=a.getClickTarget())==null||f.setAttribute("id",a.getId())}}return t}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let t;(t=this.parentToolbox_.getFlyout())==null||t.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}si(this.htmlDiv_,vi.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const t=this.getChildToolboxItems();for(let s=0;s<t.length;s++)t[s].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};fl.registrationName="collapsibleCategory",h(pe.TOOLBOX_ITEM,fl.registrationName,fl);var yf=class extends Jc{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout_=e.options.horizontalLayout,this.RTL=e.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const t=e.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),st(this.flyout_.createDom("svg"),t),this.setVisible(!0),this.flyout_.init(e),this.render(this.toolboxDef_),e=e.getThemeManager(),e.subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[bi.Capability.AUTOHIDEABLE,bi.Capability.DELETE_AREA,bi.Capability.DRAG_TARGET]})}createDom_(e){e=e.getParentSvg();const t=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,Hs(this.contentsDiv_,js.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),$e(e,"blocklyToolboxDiv"),$e(e,"blocklyNonSelectable"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return $e(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=ee(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=ee(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){if(Be(e)||e.target===this.HtmlDiv)ze().hideChaff(!1);else{var t=e.target.getAttribute("id");t&&(t=this.getToolboxItemById(t),t.isSelectable()&&(this.setSelectedItem(t),t.onClick(e))),ze().hideChaff(!0)}ve()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext_();break;case"ArrowUp":t=this.selectPrevious_();break;case"ArrowLeft":t=this.selectParent_();break;case"ArrowRight":t=this.selectChild_();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}!t&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(t=this.selectedItem_.onKeyDown(e)),t&&e.preventDefault()}createFlyout_(){const e=this.workspace_,t=new Ls({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?C(pe.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):C(pe.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e;for(let t=0;t<this.contents_.length;t++){const s=this.contents_[t];s&&s.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const t=document.createDocumentFragment();for(let s=0;s<e.length;s++)this.createToolboxItem_(e[s],t);this.contentsDiv_.appendChild(t)}createToolboxItem_(e,t){var s=e.kind;s.toUpperCase()==="CATEGORY"&&Ci(e)&&(s=fl.registrationName),(s=I(pe.TOOLBOX_ITEM,s.toLowerCase()))&&(e=new s(e,this),e.init(),this.addToolboxItem_(e),(s=e.getDiv())&&t.appendChild(s),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible()){e=e.getChildToolboxItems();for(let t=0;t<e.length;t++)this.addToolboxItem_(e[t])}}getToolboxItems(){return this.contents_}addStyle(e){e&&this.HtmlDiv&&$e(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&ke(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const t=e.top,s=t+e.height,a=e.left;return e=a+e.width,this.toolboxPosition===lt.TOP?new Nt(-1e7,s,-1e7,1e7):this.toolboxPosition===lt.BOTTOM?new Nt(t,1e7,-1e7,1e7):this.toolboxPosition===lt.LEFT?new Nt(-1e7,1e7,-1e7,e):new Nt(-1e7,1e7,a,1e7)}wouldDelete(e){return e instanceof Ps?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(Cs(e)&&e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contentMap_[e]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout_?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===lt.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===lt.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const e=this.workspace_,t=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition===lt.LEFT?e.scrollX+t.width:e.scrollX,this.toolboxPosition===lt.TOP?e.scrollY+t.height:e.scrollY),nt(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t.refreshTheme&&t.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(e){const t=this.selectedItem_;!e&&!t||e&&!f_(e)||(this.shouldDeselectItem_(t,e)&&t!==null&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&e!==null&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent_(t,e))}shouldDeselectItem_(e,t){return e!==null&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return t!==null&&t!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),si(this.contentsDiv_,vi.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),si(this.contentsDiv_,vi.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e],e.isSelectable()&&this.setSelectedItem(e))}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout_.show(t.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(e,t){const s=e&&e.getName();let a=t&&t.getName();e===t&&(a=null),e=new(j(Gr))(s,a,this.workspace_.id),B(e)}selectParent_(){return this.selectedItem_?this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),!0):this.selectedItem_.getParent()&&this.selectedItem_.getParent().isSelectable()?(this.setSelectedItem(this.selectedItem_.getParent()),!0):!1:!1}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext_():e.toggleExpanded(),!0}selectNext_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[++e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[--e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout_.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)Ee(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),M(this.HtmlDiv))}};Ue(`
.blocklyToolboxDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyToolboxGrab {
  cursor: url("<<<PATH>>>/handclosed.cur"), auto;
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

/* Category tree in Toolbox. */
.blocklyToolboxDiv {
  background-color: #ddd;
  overflow-x: visible;
  overflow-y: auto;
  padding: 4px 0 4px 0;
  position: absolute;
  z-index: 70;  /* so blocks go under toolbox when dragging */
  -webkit-tap-highlight-color: transparent;  /* issue #1345 */
}

.blocklyToolboxContents {
  display: flex;
  flex-wrap: wrap;
  flex-direction: column;
}

.blocklyToolboxContents:focus {
  outline: none;
}
`),h(pe.TOOLBOX,cn,yf);var $g="11.1.1",Tg=Le.INPUT_VALUE,Eg=Le.OUTPUT_VALUE,bg=Le.NEXT_STATEMENT,vg=Le.PREVIOUS_STATEMENT,yg=lt.TOP,Ig=lt.BOTTOM,Sg=lt.LEFT,Og=lt.RIGHT;ul.prototype.newBlock=function(e,t){return new sr(this,e,t)},xs.prototype.newBlock=function(e,t){return new Ps(this,e,t)},ul.prototype.newComment=function(e){return new Ic(this,e)},xs.prototype.newComment=function(e){return new Pc(this,e)},xs.newTrashcan=function(e){return new Vp(e)},Hn.prototype.newWorkspaceSvg=function(e){return new xs(e)},l.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=ic(e),e=e[0].concat(e[1]);for(let t=0;t<e.length;t++)this.getName(e[t][0],l.Names$$module$build$src$core$names.NameType.PROCEDURE)};var te={};return te.ASTNode=ce,te.BasicCursor=Oa,te.Block=sr,te.BlockSvg=Ps,te.Blocks=ss,te.COLLAPSED_FIELD_NAME=bc,te.COLLAPSED_INPUT_NAME=ca,te.COLLAPSE_CHARS=Pp,te.CodeGenerator=l.CodeGenerator$$module$build$src$core$generator,te.CollapsibleToolboxCategory=fl,te.ComponentManager=bi,te.Connection=vt,te.ConnectionChecker=Dp,te.ConnectionDB=rl,te.ConnectionType=Le,te.ContextMenu=er,te.ContextMenuItems=yi,te.ContextMenuRegistry=ct,te.Css=lh,te.Cursor=rd,te.DELETE_VARIABLE_ID=ed,te.DeleteArea=Jc,te.DragTarget=Gp,te.DropDownDiv=xi,te.Events=Me,te.Extensions=Zs,te.Field=Mt,te.FieldCheckbox=lr,te.FieldDropdown=_n,te.FieldImage=rr,te.FieldLabel=ir,te.FieldLabelSerializable=cf,te.FieldNumber=fd,te.FieldTextInput=tu,te.FieldVariable=Ra,te.Flyout=su,te.FlyoutButton=Ns,te.FlyoutMetricsManager=lf,te.Generator=l.CodeGenerator$$module$build$src$core$generator,te.Gesture=Un,te.Grid=Bh,te.HorizontalFlyout=af,te.INPUT_VALUE=Tg,te.Input=cl,te.InsertionMarkerManager=Ms,te.InsertionMarkerPreviewer=nf,te.Marker=Fp,te.MarkerManager=fa,te.Menu=vh,te.MenuItem=yh,te.MetricsManager=dd,te.Msg=l.Msg$$module$build$src$core$msg,te.NEXT_STATEMENT=bg,te.Names=l.Names$$module$build$src$core$names,te.OPPOSITE_TYPE=or,te.OUTPUT_VALUE=Eg,te.Options=Ls,te.PREVIOUS_STATEMENT=vg,te.PROCEDURE_CATEGORY_NAME=Vc,te.Procedures=Xi,te.RENAME_VARIABLE_ID=Qh,te.RenderedConnection=Yi,te.Scrollbar=oi,te.ScrollbarPair=hd,te.ShortcutItems=mn,te.ShortcutRegistry=kt,te.TOOLBOX_AT_BOTTOM=Ig,te.TOOLBOX_AT_LEFT=Sg,te.TOOLBOX_AT_RIGHT=Og,te.TOOLBOX_AT_TOP=yg,te.TabNavigateCursor=Up,te.Theme=tr,te.ThemeManager=xp,te.Themes=mg,te.Toolbox=yf,te.ToolboxCategory=Qs,te.ToolboxItem=Cd,te.ToolboxSeparator=La,te.Tooltip=gs,te.Touch=Wo,te.Trashcan=Vp,te.UnattachedFieldError=ri,te.VARIABLE_CATEGORY_NAME=_h,te.VARIABLE_DYNAMIC_CATEGORY_NAME=qh,te.VERSION=$g,te.VariableMap=sd,te.VariableModel=ha,te.Variables=Li,te.VariablesDynamic=nr,te.VerticalFlyout=pd,te.WidgetDiv=Js,te.Workspace=ul,te.WorkspaceAudio=Bp,te.WorkspaceDragger=mp,te.WorkspaceSvg=xs,te.Xml=Pi,te.ZoomControls=G_,te.blockAnimations=Ea,te.blockRendering=Rt,te.browserEvents=Pn,te.bubbles=Aa,te.bumpObjects=Kc,te.clipboard=Ca,te.comments=nu,te.common=Ai,te.config=l.config$$module$build$src$core$config,te.constants=Bf,te.defineBlocksWithJsonArray=ot,te.dialog=Yo,te.dragging=wa,te.fieldRegistry=Uc,te.geras=$n,te.getMainWorkspace=ze,te.getSelected=Ce,te.hasBubble=bn,te.hideChaff=g_,te.icons=po,te.inject=t_,te.inputs=$o,te.isCopyable=ea,te.isDeletable=Cs,te.isDraggable=di,te.isIcon=pu,te.isObservable=Lr,te.isPaster=d_,te.isRenderedElement=__,te.isSelectable=p_,te.isSerializable=bo,te.isVariableBackedParameterModel=rs,te.procedures=Xi,te.registry=An,te.renderManagement=yc,te.serialization=dg,te.setLocale=hh,te.setParentContainer=_e,te.svgResize=nt,te.thrasos=kd,te.uiPosition=Xo,te.utils=jt,te.zelos=qs,te.__namespace__=l,te})}(blockly_compressed$1)),blockly_compressed$1.exports}var en$2={exports:{}},en$1=en$2.exports,hasRequiredEn;function requireEn(){return hasRequiredEn||(hasRequiredEn=1,function(n,c){(function(l,h){n.exports=h()})(en$1,function(){var l=l||{Msg:Object.create(null)};return l.Msg.ADD_COMMENT="Add Comment",l.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",l.Msg.CHANGE_VALUE_TITLE="Change value:",l.Msg.CLEAN_UP="Clean up Blocks",l.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",l.Msg.COLLAPSE_ALL="Collapse Blocks",l.Msg.COLLAPSE_BLOCK="Collapse Block",l.Msg.COLOUR_BLEND_COLOUR1="colour 1",l.Msg.COLOUR_BLEND_COLOUR2="colour 2",l.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",l.Msg.COLOUR_BLEND_RATIO="ratio",l.Msg.COLOUR_BLEND_TITLE="blend",l.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",l.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",l.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",l.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",l.Msg.COLOUR_RANDOM_TITLE="random colour",l.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",l.Msg.COLOUR_RGB_BLUE="blue",l.Msg.COLOUR_RGB_GREEN="green",l.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",l.Msg.COLOUR_RGB_RED="red",l.Msg.COLOUR_RGB_TITLE="colour with",l.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",l.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",l.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",l.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",l.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",l.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",l.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",l.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",l.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",l.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",l.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",l.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",l.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",l.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",l.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",l.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",l.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",l.Msg.CONTROLS_IF_MSG_ELSE="else",l.Msg.CONTROLS_IF_MSG_ELSEIF="else if",l.Msg.CONTROLS_IF_MSG_IF="if",l.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",l.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",l.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",l.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",l.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",l.Msg.CONTROLS_REPEAT_INPUT_DO="do",l.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",l.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",l.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",l.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",l.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",l.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",l.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",l.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",l.Msg.DELETE_BLOCK="Delete Block",l.Msg.DELETE_VARIABLE="Delete the '%1' variable",l.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",l.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",l.Msg.DIALOG_CANCEL="Cancel",l.Msg.DIALOG_OK="OK",l.Msg.DISABLE_BLOCK="Disable Block",l.Msg.DUPLICATE_BLOCK="Duplicate",l.Msg.DUPLICATE_COMMENT="Duplicate Comment",l.Msg.ENABLE_BLOCK="Enable Block",l.Msg.EXPAND_ALL="Expand Blocks",l.Msg.EXPAND_BLOCK="Expand Block",l.Msg.EXTERNAL_INPUTS="External Inputs",l.Msg.HELP="Help",l.Msg.INLINE_INPUTS="Inline Inputs",l.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",l.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",l.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",l.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",l.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",l.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",l.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",l.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",l.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",l.Msg.LISTS_GET_INDEX_FIRST="first",l.Msg.LISTS_GET_INDEX_FROM_END="# from end",l.Msg.LISTS_GET_INDEX_FROM_START="#",l.Msg.LISTS_GET_INDEX_GET="get",l.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",l.Msg.LISTS_GET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",l.Msg.LISTS_GET_INDEX_LAST="last",l.Msg.LISTS_GET_INDEX_RANDOM="random",l.Msg.LISTS_GET_INDEX_REMOVE="remove",l.Msg.LISTS_GET_INDEX_TAIL="",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",l.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",l.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",l.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",l.Msg.LISTS_GET_SUBLIST_END_LAST="to last",l.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",l.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",l.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",l.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",l.Msg.LISTS_GET_SUBLIST_TAIL="",l.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",l.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",l.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",l.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",l.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#finding-items-in-a-list",l.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",l.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",l.Msg.LISTS_INLIST="in list",l.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",l.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",l.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",l.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",l.Msg.LISTS_LENGTH_TITLE="length of %1",l.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",l.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",l.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",l.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",l.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",l.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",l.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",l.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",l.Msg.LISTS_SET_INDEX_INPUT_TO="as",l.Msg.LISTS_SET_INDEX_INSERT="insert at",l.Msg.LISTS_SET_INDEX_SET="set",l.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",l.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",l.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",l.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",l.Msg.LISTS_SORT_ORDER_DESCENDING="descending",l.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",l.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",l.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",l.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",l.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",l.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",l.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",l.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",l.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",l.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",l.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",l.Msg.LOGIC_BOOLEAN_FALSE="false",l.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",l.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",l.Msg.LOGIC_BOOLEAN_TRUE="true",l.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",l.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",l.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",l.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",l.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",l.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",l.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",l.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",l.Msg.LOGIC_NEGATE_TITLE="not %1",l.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",l.Msg.LOGIC_NULL="null",l.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",l.Msg.LOGIC_NULL_TOOLTIP="Returns null.",l.Msg.LOGIC_OPERATION_AND="and",l.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",l.Msg.LOGIC_OPERATION_OR="or",l.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",l.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",l.Msg.LOGIC_TERNARY_CONDITION="test",l.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",l.Msg.LOGIC_TERNARY_IF_FALSE="if false",l.Msg.LOGIC_TERNARY_IF_TRUE="if true",l.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",l.Msg.MATH_ADDITION_SYMBOL="+",l.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",l.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",l.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",l.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",l.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",l.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",l.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",l.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",l.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",l.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",l.Msg.MATH_CHANGE_TITLE="change %1 by %2",l.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",l.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",l.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants: π (3.141…), e (2.718…), φ (1.618…), sqrt(2) (1.414…), sqrt(½) (0.707…), or ∞ (infinity).",l.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",l.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",l.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",l.Msg.MATH_DIVISION_SYMBOL="÷",l.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",l.Msg.MATH_IS_EVEN="is even",l.Msg.MATH_IS_NEGATIVE="is negative",l.Msg.MATH_IS_ODD="is odd",l.Msg.MATH_IS_POSITIVE="is positive",l.Msg.MATH_IS_PRIME="is prime",l.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",l.Msg.MATH_IS_WHOLE="is whole",l.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",l.Msg.MATH_MODULO_TITLE="remainder of %1 ÷ %2",l.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",l.Msg.MATH_MULTIPLICATION_SYMBOL="×",l.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",l.Msg.MATH_NUMBER_TOOLTIP="A number.",l.Msg.MATH_ONLIST_HELPURL="",l.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",l.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",l.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",l.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",l.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",l.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",l.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",l.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",l.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",l.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",l.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",l.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",l.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",l.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",l.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",l.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",l.Msg.MATH_POWER_SYMBOL="^",l.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",l.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",l.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",l.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",l.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",l.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",l.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",l.Msg.MATH_ROUND_OPERATOR_ROUND="round",l.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",l.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",l.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",l.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",l.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",l.Msg.MATH_SINGLE_OP_ROOT="square root",l.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",l.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",l.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",l.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",l.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",l.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",l.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",l.Msg.MATH_SUBTRACTION_SYMBOL="-",l.Msg.MATH_TRIG_ACOS="acos",l.Msg.MATH_TRIG_ASIN="asin",l.Msg.MATH_TRIG_ATAN="atan",l.Msg.MATH_TRIG_COS="cos",l.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",l.Msg.MATH_TRIG_SIN="sin",l.Msg.MATH_TRIG_TAN="tan",l.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",l.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",l.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",l.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",l.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",l.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",l.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",l.Msg.NEW_NUMBER_VARIABLE="Create number variable...",l.Msg.NEW_STRING_VARIABLE="Create string variable...",l.Msg.NEW_VARIABLE="Create variable...",l.Msg.NEW_VARIABLE_TITLE="New variable name:",l.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",l.Msg.ORDINAL_NUMBER_SUFFIX="",l.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",l.Msg.PROCEDURES_BEFORE_PARAMS="with:",l.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",l.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",l.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",l.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",l.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",l.Msg.PROCEDURES_CALL_DISABLED_DEF_WARNING="Can't run the user-defined function '%1' because the definition block is disabled.",l.Msg.PROCEDURES_CREATE_DO="Create '%1'",l.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",l.Msg.PROCEDURES_DEFNORETURN_DO="",l.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",l.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",l.Msg.PROCEDURES_DEFNORETURN_TITLE="to",l.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",l.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",l.Msg.PROCEDURES_DEFRETURN_RETURN="return",l.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",l.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",l.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",l.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",l.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",l.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",l.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",l.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",l.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",l.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",l.Msg.REDO="Redo",l.Msg.REMOVE_COMMENT="Remove Comment",l.Msg.RENAME_VARIABLE="Rename variable...",l.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",l.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",l.Msg.TEXT_APPEND_TITLE="to %1 append text %2",l.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",l.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",l.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",l.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",l.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",l.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",l.Msg.TEXT_CHARAT_FIRST="get first letter",l.Msg.TEXT_CHARAT_FROM_END="get letter # from end",l.Msg.TEXT_CHARAT_FROM_START="get letter #",l.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",l.Msg.TEXT_CHARAT_LAST="get last letter",l.Msg.TEXT_CHARAT_RANDOM="get random letter",l.Msg.TEXT_CHARAT_TAIL="",l.Msg.TEXT_CHARAT_TITLE="in text %1 %2",l.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",l.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",l.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",l.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",l.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",l.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",l.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",l.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",l.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",l.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",l.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",l.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",l.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",l.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",l.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",l.Msg.TEXT_GET_SUBSTRING_TAIL="",l.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",l.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",l.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",l.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",l.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",l.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",l.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",l.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",l.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",l.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",l.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",l.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",l.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",l.Msg.TEXT_LENGTH_TITLE="length of %1",l.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",l.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",l.Msg.TEXT_PRINT_TITLE="print %1",l.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",l.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",l.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",l.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",l.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",l.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",l.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",l.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",l.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",l.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",l.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",l.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",l.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",l.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",l.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",l.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",l.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",l.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",l.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",l.Msg.TODAY="Today",l.Msg.UNDO="Undo",l.Msg.UNNAMED_KEY="unnamed",l.Msg.VARIABLES_DEFAULT_NAME="item",l.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",l.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",l.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",l.Msg.VARIABLES_SET="set %1 to %2",l.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",l.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",l.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",l.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",l.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",l.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",l.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",l.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",l.Msg.CONTROLS_FOREACH_INPUT_DO=l.Msg.CONTROLS_REPEAT_INPUT_DO,l.Msg.CONTROLS_FOR_INPUT_DO=l.Msg.CONTROLS_REPEAT_INPUT_DO,l.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=l.Msg.CONTROLS_IF_MSG_ELSEIF,l.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=l.Msg.CONTROLS_IF_MSG_ELSE,l.Msg.CONTROLS_IF_IF_TITLE_IF=l.Msg.CONTROLS_IF_MSG_IF,l.Msg.CONTROLS_IF_MSG_THEN=l.Msg.CONTROLS_REPEAT_INPUT_DO,l.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=l.Msg.CONTROLS_REPEAT_INPUT_DO,l.Msg.LISTS_CREATE_WITH_ITEM_TITLE=l.Msg.VARIABLES_DEFAULT_NAME,l.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=l.Msg.LISTS_INLIST,l.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=l.Msg.LISTS_INLIST,l.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=l.Msg.LISTS_INLIST,l.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=l.Msg.LISTS_INLIST,l.Msg.MATH_CHANGE_TITLE_ITEM=l.Msg.VARIABLES_DEFAULT_NAME,l.Msg.PROCEDURES_DEFRETURN_COMMENT=l.Msg.PROCEDURES_DEFNORETURN_COMMENT,l.Msg.PROCEDURES_DEFRETURN_DO=l.Msg.PROCEDURES_DEFNORETURN_DO,l.Msg.PROCEDURES_DEFRETURN_PROCEDURE=l.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,l.Msg.PROCEDURES_DEFRETURN_TITLE=l.Msg.PROCEDURES_DEFNORETURN_TITLE,l.Msg.TEXT_APPEND_VARIABLE=l.Msg.VARIABLES_DEFAULT_NAME,l.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=l.Msg.VARIABLES_DEFAULT_NAME,l.Msg.COLOUR_HUE="20",l.Msg.LISTS_HUE="260",l.Msg.LOGIC_HUE="210",l.Msg.LOOPS_HUE="120",l.Msg.MATH_HUE="230",l.Msg.PROCEDURES_HUE="290",l.Msg.TEXTS_HUE="160",l.Msg.VARIABLES_DYNAMIC_HUE="310",l.Msg.VARIABLES_HUE="330",l.Msg})}(en$2)),en$2.exports}var blocks_compressed$1={exports:{}},blocks_compressed=blocks_compressed$1.exports,hasRequiredBlocks_compressed;function requireBlocks_compressed(){return hasRequiredBlocks_compressed||(hasRequiredBlocks_compressed=1,function(n,c){(function(l,h){n.exports=h(requireBlockly_compressed())})(blocks_compressed,function(l){var h=l.__namespace__,p=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),g={customContextMenu:function(E){if(this.isInFlyout)(this.type==="variables_get_dynamic"||this.type==="variables_get_reporter_dynamic")&&(W={text:h.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:T(this)},H=this.getField("VAR").getText(),H={text:h.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",H),enabled:!0,callback:v(this)},E.unshift(W),E.unshift(H));else{if(this.type==="variables_get_dynamic")var A="variables_set_dynamic",W=h.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else A="variables_get_dynamic",W=h.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var H=this.getField("VAR");A={type:A,fields:{VAR:H.saveState(!0)}},E.push({enabled:0<this.workspace.remainingCapacity(),text:W.replace("%1",H.getText()),callback:h.callbackFactory$$module$build$src$core$contextmenu(this,A)})}},onchange:function(E){E=this.getFieldValue("VAR"),E=h.getVariable$$module$build$src$core$variables(this.workspace,E),this.type==="variables_get_dynamic"?this.outputConnection.setCheck(E.type):this.getInput("VALUE").connection.setCheck(E.type)}},T=function(E){return function(){const A=E.workspace,W=E.getField("VAR").getVariable();h.renameVariable$$module$build$src$core$variables(A,W)}},v=function(E){return function(){const A=E.workspace,W=E.getField("VAR").getVariable();A.deleteVariableById(W.getId()),A.refreshToolboxSelection()}};h.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",g),h.defineBlocks$$module$build$src$core$common(p);var I={blocks:p},R=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),w={customContextMenu:function(E){if(this.isInFlyout)(this.type==="variables_get"||this.type==="variables_get_reporter")&&(W={text:h.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:C(this)},H=this.getField("VAR").getText(),H={text:h.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",H),enabled:!0,callback:N(this)},E.unshift(W),E.unshift(H));else{if(this.type==="variables_get")var A="variables_set",W=h.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else A="variables_get",W=h.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var H=this.getField("VAR");A={type:A,fields:{VAR:H.saveState(!0)}},E.push({enabled:0<this.workspace.remainingCapacity(),text:W.replace("%1",H.getText()),callback:h.callbackFactory$$module$build$src$core$contextmenu(this,A)})}}},C=function(E){return function(){const A=E.workspace,W=E.getField("VAR").getVariable();h.renameVariable$$module$build$src$core$variables(A,W)}},N=function(E){return function(){const A=E.workspace,W=E.getField("VAR").getVariable();A.deleteVariableById(W.getId()),A.refreshToolboxSelection()}};h.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",w),h.defineBlocks$$module$build$src$core$common(R);var D={blocks:R},V=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),B={init:function(){this.WHERE_OPTIONS_1=[[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");var A=this.getInput("AT1")instanceof h.ValueInput$$module$build$src$core$inputs$value_input;return E.setAttribute("at1",`${A}`),A=this.getInput("AT2")instanceof h.ValueInput$$module$build$src$core$inputs$value_input,E.setAttribute("at2",`${A}`),E},domToMutation:function(E){const A=E.getAttribute("at1")==="true";E=E.getAttribute("at2")==="true",this.updateAt_(1,A),this.updateAt_(2,E)},updateAt_:function(E,A){this.removeInput("AT"+E),this.removeInput("ORDINAL"+E,!0),A?(this.appendValueInput("AT"+E).setCheck("Number"),h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+E).appendField(h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+E),E===2&&h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(h.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL));const W=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+E]});W.setValidator(function(H){const ae=H==="FROM_START"||H==="FROM_END";if(ae!==A){const xe=this.getSourceBlock();return xe.updateAt_(E,ae),xe.setFieldValue(H,"WHERE"+E),null}}),this.getInput("AT"+E).appendField(W,"WHERE"+E),E===1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}};V.text_getSubstring=B,V.text_changeCase={init:function(){const E=[[h.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[h.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[h.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(h.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(h.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},V.text_trim={init:function(){const E=[[h.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[h.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[h.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(h.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(h.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},V.text_print={init:function(){this.jsonInit({message0:h.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:h.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:h.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var ie={updateType_:function(E){this.outputConnection.setCheck(E==="NUMBER"?"Number":"String")},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("type",this.getFieldValue("TYPE")),E},domToMutation:function(E){this.updateType_(E.getAttribute("type"))}};V.text_prompt_ext=Object.assign({},ie,{init:function(){var E=[[h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(h.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),E.setValidator(A=>{this.updateType_(A)}),this.appendValueInput("TEXT").appendField(E,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}});var ne=Object.assign({},ie,{init:function(){this.mixin(P);var E=[[h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(h.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),E.setValidator(A=>{this.updateType_(A)}),this.appendDummyInput().appendField(E,"TYPE").appendField(this.newQuote_(!0)).appendField(h.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:h.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}});V.text_prompt=ne,V.text_count={init:function(){this.jsonInit({message0:h.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:h.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:h.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},V.text_replace={init:function(){this.jsonInit({message0:h.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:h.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:h.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},V.text_reverse={init:function(){this.jsonInit({message0:h.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:h.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:h.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var P={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(E){for(let A=0,W;W=this.inputList[A];A++)for(let H=0,ae;ae=W.fieldRow[H];H++)if(E===ae.name){W.insertFieldAt(H,this.newQuote_(!0)),W.insertFieldAt(H+2,this.newQuote_(!1));return}console.warn('field named "'+E+'" not found in '+this.toDevString())},newQuote_:function(E){return E=this.RTL?!E:E,h.fromJson$$module$build$src$core$field_registry({type:"field_image",src:E?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:E?"“":"”"})}},z=function(){this.mixin(P),this.quoteField_("TEXT")},se={itemCount_:0,mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("items",`${this.itemCount_}`),E},domToMutation:function(E){this.itemCount_=parseInt(E.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(E){this.itemCount_=E.itemCount,this.updateShape_()},decompose:function(E){const A=E.newBlock("text_create_join_container");A.initSvg();let W=A.getInput("STACK").connection;for(let H=0;H<this.itemCount_;H++){const ae=E.newBlock("text_create_join_item");ae.initSvg(),W.connect(ae.previousConnection),W=ae.nextConnection}return A},compose:function(E){var A=E.getInputTargetBlock("STACK");for(E=[];A;)A.isInsertionMarker()||E.push(A.valueConnection_),A=A.getNextBlock();for(A=0;A<this.itemCount_;A++){const W=this.getInput("ADD"+A).connection.targetConnection;W&&!E.includes(W)&&W.disconnect()}for(this.itemCount_=E.length,this.updateShape_(),A=0;A<this.itemCount_;A++){let W;(W=E[A])==null||W.reconnect(this,"ADD"+A)}},saveConnections:function(E){E=E.getInputTargetBlock("STACK");let A=0;for(;E;){if(E.isInsertionMarker()){E=E.getNextBlock();continue}const W=this.getInput("ADD"+A);E.valueConnection_=W&&W.connection.targetConnection,E=E.getNextBlock(),A++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var E=0;E<this.itemCount_;E++)if(!this.getInput("ADD"+E)){const A=this.appendValueInput("ADD"+E).setAlign(h.Align$$module$build$src$core$inputs$align.RIGHT);E===0&&A.appendField(h.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(E=this.itemCount_;this.getInput("ADD"+E);E++)this.removeInput("ADD"+E)}},re=function(){this.mixin(P),this.itemCount_=2,this.updateShape_(),this.setMutator(new h.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))};h.register$$module$build$src$core$extensions("text_append_tooltip",h.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var he=function(){this.setTooltip(()=>h.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))},q={isAt_:!1,mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("at",`${this.isAt_}`),E},domToMutation:function(E){E=E.getAttribute("at")!=="false",this.updateAt_(E)},updateAt_:function(E){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),E&&(this.appendValueInput("AT").setCheck("Number"),h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),h.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(h.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=E}},j=function(){this.getField("WHERE").setValidator(function(E){E=E==="FROM_START"||E==="FROM_END";const A=this.getSourceBlock();E!==A.isAt_&&A.updateAt_(E)}),this.updateAt_(!0),this.setTooltip(()=>{var E=this.getFieldValue("WHERE");let A=h.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return(E==="FROM_START"||E==="FROM_END")&&(E=E==="FROM_START"?h.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:h.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(A+="  "+E.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),A})};h.register$$module$build$src$core$extensions("text_indexOf_tooltip",he),h.register$$module$build$src$core$extensions("text_quotes",z),h.registerMixin$$module$build$src$core$extensions("quote_image_mixin",P),h.registerMutator$$module$build$src$core$extensions("text_join_mutator",se,re),h.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",q,j),h.defineBlocks$$module$build$src$core$common(V);var ye={blocks:V},ge={},Ve={setStatements_:function(E){this.hasStatements_!==E&&(E?(this.appendStatementInput("STACK").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=E)},updateParams_:function(){let E="";this.arguments_.length&&(E=h.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),h.disable$$module$build$src$core$events$utils();try{this.setFieldValue(E,"PARAMS")}finally{h.enable$$module$build$src$core$events$utils()}},mutationToDom:function(E){const A=h.createElement$$module$build$src$core$utils$xml("mutation");E&&A.setAttribute("name",this.getFieldValue("NAME"));for(let W=0;W<this.argumentVarModels_.length;W++){const H=h.createElement$$module$build$src$core$utils$xml("arg"),ae=this.argumentVarModels_[W];H.setAttribute("name",ae.name),H.setAttribute("varid",ae.getId()),E&&this.paramIds_&&H.setAttribute("paramId",this.paramIds_[W]),A.appendChild(H)}return this.hasStatements_||A.setAttribute("statements","false"),A},domToMutation:function(E){this.arguments_=[],this.argumentVarModels_=[];for(let W=0,H;H=E.childNodes[W];W++)if(H.nodeName.toLowerCase()==="arg"){var A=H;const ae=A.getAttribute("name");A=A.getAttribute("varid")||A.getAttribute("varId"),this.arguments_.push(ae),A=h.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,A,ae,""),A!==null?this.argumentVarModels_.push(A):console.log(`Failed to create a variable named "${ae}", ignoring.`)}this.updateParams_(),h.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(E.getAttribute("statements")!=="false")},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const E=Object.create(null);if(this.argumentVarModels_.length){E.params=[];for(let A=0;A<this.argumentVarModels_.length;A++)E.params.push({name:this.argumentVarModels_[A].name,id:this.argumentVarModels_[A].getId()})}return this.hasStatements_||(E.hasStatements=!1),E},loadExtraState:function(E){if(this.arguments_=[],this.argumentVarModels_=[],E.params)for(let W=0;W<E.params.length;W++){var A=E.params[W];A=h.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,A.id,A.name,""),this.arguments_.push(A.name),this.argumentVarModels_.push(A)}this.updateParams_(),h.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(E.hasStatements!==!1)},decompose:function(E){const A=h.createElement$$module$build$src$core$utils$xml("block");A.setAttribute("type","procedures_mutatorcontainer");var W=h.createElement$$module$build$src$core$utils$xml("statement");W.setAttribute("name","STACK"),A.appendChild(W);for(let ae=0;ae<this.arguments_.length;ae++){const xe=h.createElement$$module$build$src$core$utils$xml("block");xe.setAttribute("type","procedures_mutatorarg");var H=h.createElement$$module$build$src$core$utils$xml("field");H.setAttribute("name","NAME");const Ct=h.createTextNode$$module$build$src$core$utils$xml(this.arguments_[ae]);H.appendChild(Ct),xe.appendChild(H),H=h.createElement$$module$build$src$core$utils$xml("next"),xe.appendChild(H),W.appendChild(xe),W=H}return E=h.domToBlock$$module$build$src$core$xml(A,E),this.type==="procedures_defreturn"?E.setFieldValue(this.hasStatements_,"STATEMENTS"):E.removeInput("STATEMENT_INPUT"),h.mutateCallers$$module$build$src$core$procedures(this),E},compose:function(E){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let A=E.getInputTargetBlock("STACK");for(;A&&!A.isInsertionMarker();){var W=A.getFieldValue("NAME");this.arguments_.push(W),W=this.workspace.getVariable(W,""),this.argumentVarModels_.push(W),this.paramIds_.push(A.id),A=A.nextConnection&&A.nextConnection.targetBlock()}if(this.updateParams_(),h.mutateCallers$$module$build$src$core$procedures(this),E=E.getFieldValue("STATEMENTS"),E!==null&&(E=E==="TRUE",this.hasStatements_!==E))if(E){this.setStatements_(!0);var H;(H=this.statementConnection_)==null||H.reconnect(this,"STACK"),this.statementConnection_=null}else H=this.getInput("STACK").connection,(this.statementConnection_=H.targetConnection)&&(H=H.targetBlock(),H.unplug(),H.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(E,A){var W=this.workspace.getVariableById(E);if(W.type===""){W=W.name,A=this.workspace.getVariableById(A);var H=!1;for(let ae=0;ae<this.argumentVarModels_.length;ae++)this.argumentVarModels_[ae].getId()===E&&(this.arguments_[ae]=A.name,this.argumentVarModels_[ae]=A,H=!0);H&&(this.displayRenamedVar_(W,A.name),h.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(E){const A=E.name;let W=!1,H;for(let ae=0;ae<this.argumentVarModels_.length;ae++)this.argumentVarModels_[ae].getId()===E.getId()&&(H=this.arguments_[ae],this.arguments_[ae]=A,W=!0);W&&(this.displayRenamedVar_(H,A),h.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(E,A){this.updateParams_();var W=this.getIcon(h.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(W&&W.bubbleIsVisible()){W=W.getWorkspace().getAllBlocks(!1);for(let H=0,ae;ae=W[H];H++)ae.type==="procedures_mutatorarg"&&h.Names$$module$build$src$core$names.equals(E,ae.getFieldValue("NAME"))&&ae.setFieldValue(A,"NAME")}},customContextMenu:function(E){if(!this.isInFlyout){var A=this.getFieldValue("NAME"),W={type:this.callType_,extraState:{name:A,params:this.arguments_}};if(E.push({enabled:!0,text:h.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",A),callback:h.callbackFactory$$module$build$src$core$contextmenu(this,W)}),!this.isCollapsed())for(A=0;A<this.argumentVarModels_.length;A++){W=this.argumentVarModels_[A];const H={type:"variables_get",fields:{VAR:{name:W.name,id:W.getId(),type:W.type}}};E.push({enabled:!0,text:h.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",W.name),callback:h.callbackFactory$$module$build$src$core$contextmenu(this,H)})}}}};ge.procedures_defnoreturn=Object.assign({},Ve,{init:function(){var E=h.findLegalName$$module$build$src$core$procedures("",this);E=h.fromJson$$module$build$src$core$field_registry({type:"field_input",text:E}),E.setValidator(h.rename$$module$build$src$core$procedures),E.setSpellcheck(!1),this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(E,"NAME").appendField("","PARAMS"),this.setMutator(new h.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),ge.procedures_defreturn=Object.assign({},Ve,{init:function(){var E=h.findLegalName$$module$build$src$core$procedures("",this);E=h.fromJson$$module$build$src$core$field_registry({type:"field_input",text:E}),E.setValidator(h.rename$$module$build$src$core$procedures),E.setSpellcheck(!1),this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(E,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(h.Align$$module$build$src$core$inputs$align.RIGHT).appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new h.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var de={init:function(){this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(h.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(h.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};ge.procedures_mutatorcontainer=de;var Tt={init:function(){const E=h.fromJson$$module$build$src$core$field_registry({type:"field_input",text:h.DEFAULT_ARG$$module$build$src$core$procedures});E.setValidator(this.validator_),E.oldShowEditorFn_=E.showEditor_,E.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(E,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(h.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,E.onFinishEditing_=this.deleteIntermediateVars_,E.createdVariables_=[],E.onFinishEditing_("x")},validator_:function(E){var A=this.getSourceBlock();const W=A.workspace.getRootWorkspace();if(E=E.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),!E)return null;const H=(A.workspace.targetWorkspace||A.workspace).getAllBlocks(!1),ae=E.toLowerCase();for(let xe=0;xe<H.length;xe++){if(H[xe].id===this.getSourceBlock().id)continue;const Ct=H[xe].getFieldValue("NAME");if(Ct&&Ct.toLowerCase()===ae)return null}return A.isInFlyout||((A=W.getVariable(E,""))&&A.name!==E&&W.renameVariableById(A.getId(),E),A||(A=W.createVariable(E,""))&&this.createdVariables_&&this.createdVariables_.push(A)),E},deleteIntermediateVars_:function(E){const A=this.getSourceBlock().workspace.getRootWorkspace();if(A)for(let W=0;W<this.createdVariables_.length;W++){const H=this.createdVariables_[W];H.name!==E&&A.deleteVariableById(H.getId())}}};ge.procedures_mutatorarg=Tt;var ze="DISABLED_PROCEDURE_DEFINITION",mt={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(E,A){h.Names$$module$build$src$core$names.equals(E,this.getProcedureCall())&&(this.setFieldValue(A,"NAME"),this.setTooltip((this.outputConnection?h.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:h.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",A)))},setProcedureParameters_:function(E,A){var W=h.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((W=(W=W&&W.getIcon(h.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&W.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),E.join(`
`)===this.arguments_.join(`
`))this.quarkIds_=A;else{if(A.length!==E.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let ae=0;ae<this.arguments_.length;ae++){var H=this.getInput("ARG"+ae);H&&(H=H.connection.targetConnection,this.quarkConnections_[this.quarkIds_[ae]]=H,W&&H&&!A.includes(this.quarkIds_[ae])&&(H.disconnect(),H.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(E),this.argumentVarModels_=[],E=0;E<this.arguments_.length;E++)W=h.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[E],""),this.argumentVarModels_.push(W);if(this.updateShape_(),this.quarkIds_=A){for(A=0;A<this.arguments_.length;A++)if(E=this.quarkIds_[A],E in this.quarkConnections_){let ae;(ae=this.quarkConnections_[E])!=null&&ae.reconnect(this,"ARG"+A)||delete this.quarkConnections_[E]}}}},updateShape_:function(){for(var E=0;E<this.arguments_.length;E++){var A=this.getField("ARGNAME"+E);if(A){h.disable$$module$build$src$core$events$utils();try{A.setValue(this.arguments_[E])}finally{h.enable$$module$build$src$core$events$utils()}}else A=h.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[E]}),this.appendValueInput("ARG"+E).setAlign(h.Align$$module$build$src$core$inputs$align.RIGHT).appendField(A,"ARGNAME"+E)}for(E=this.arguments_.length;this.getInput("ARG"+E);E++)this.removeInput("ARG"+E);(E=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||E.appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&E.removeField("WITH"))},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");E.setAttribute("name",this.getProcedureCall());for(let A=0;A<this.arguments_.length;A++){const W=h.createElement$$module$build$src$core$utils$xml("arg");W.setAttribute("name",this.arguments_[A]),E.appendChild(W)}return E},domToMutation:function(E){var A=E.getAttribute("name");this.renameProcedure(this.getProcedureCall(),A),A=[];const W=[];for(let H=0,ae;ae=E.childNodes[H];H++)ae.nodeName.toLowerCase()==="arg"&&(A.push(ae.getAttribute("name")),W.push(ae.getAttribute("paramId")));this.setProcedureParameters_(A,W)},saveExtraState:function(){const E=Object.create(null);return E.name=this.getProcedureCall(),this.arguments_.length&&(E.params=this.arguments_),E},loadExtraState:function(E){if(this.renameProcedure(this.getProcedureCall(),E.name),E=E.params){const A=[];A.length=E.length,A.fill(null),this.setProcedureParameters_(E,A)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(E){if(this.workspace&&!this.workspace.isFlyout&&E.recordUndo)if(E.type===h.CREATE$$module$build$src$core$events$utils&&E.ids.includes(this.id)){var A=this.getProcedureCall();if(A=h.getDefinition$$module$build$src$core$procedures(A,this.workspace),!A||A.type===this.defType_&&JSON.stringify(A.getVars())===JSON.stringify(this.arguments_)||(A=null),!A){h.setGroup$$module$build$src$core$events$utils(E.group),E=h.createElement$$module$build$src$core$utils$xml("xml"),A=h.createElement$$module$build$src$core$utils$xml("block"),A.setAttribute("type",this.defType_);var W=this.getRelativeToSurfaceXY(),H=W.y+2*h.config$$module$build$src$core$config.snapRadius;A.setAttribute("x",`${W.x+h.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),A.setAttribute("y",`${H}`),W=this.mutationToDom(),A.appendChild(W),W=h.createElement$$module$build$src$core$utils$xml("field"),W.setAttribute("name","NAME"),H=this.getProcedureCall();const ae=h.findLegalName$$module$build$src$core$procedures(H,this);H!==ae&&this.renameProcedure(H,ae),W.appendChild(h.createTextNode$$module$build$src$core$utils$xml(H)),A.appendChild(W),E.appendChild(A),h.domToWorkspace$$module$build$src$core$xml(E,this.workspace),h.setGroup$$module$build$src$core$events$utils(!1)}}else E.type===h.DELETE$$module$build$src$core$events$utils?(A=this.getProcedureCall(),h.getDefinition$$module$build$src$core$procedures(A,this.workspace)||(h.setGroup$$module$build$src$core$events$utils(E.group),this.dispose(!0),h.setGroup$$module$build$src$core$events$utils(!1))):E.type===h.CHANGE$$module$build$src$core$events$utils&&E.element==="disabled"&&(A=this.getProcedureCall(),(H=h.getDefinition$$module$build$src$core$procedures(A,this.workspace))&&H.id===E.blockId&&((W=h.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),h.setGroup$$module$build$src$core$events$utils(E.group),E=H.isEnabled(),this.setDisabledReason(!E,ze),this.setWarningText(E?null:h.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",A)),h.setGroup$$module$build$src$core$events$utils(W)))},customContextMenu:function(E){if(this.workspace.isMovable()){var A=this.getProcedureCall(),W=this.workspace;E.push({enabled:!0,text:h.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const H=h.getDefinition$$module$build$src$core$procedures(A,W);H&&(W.centerOnBlock(H.id),h.setSelected$$module$build$src$core$common(H))}})}}};ge.procedures_callnoreturn=Object.assign({},mt,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(h.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),ge.procedures_callreturn=Object.assign({},mt,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(h.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"});var Ce="UNPARENTED_IFRETURN",St={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(h.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(h.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(h.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("value",String(Number(this.hasReturnValue_))),E},domToMutation:function(E){this.hasReturnValue_=E.getAttribute("value")==="1",this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(E){if(!(this.workspace.isDragging&&this.workspace.isDragging()||E.type!==h.MOVE$$module$build$src$core$events$utils&&E.type!==h.CREATE$$module$build$src$core$events$utils)){E=!1;var A=this;do{if(this.FUNCTION_TYPES.includes(A.type)){E=!0;break}A=A.getSurroundParent()}while(A);if(E?(A.type==="procedures_defnoreturn"&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):A.type!=="procedures_defreturn"||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(h.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(h.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{h.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!E,Ce)}finally{h.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};ge.procedures_ifreturn=St,h.defineBlocks$$module$build$src$core$common(ge);var _e={blocks:ge},nt=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["π","PI"],["e","E"],["φ","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(½)","SQRT1_2"],["∞","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),be={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"};h.register$$module$build$src$core$extensions("math_op_tooltip",h.buildTooltipForDropdown$$module$build$src$core$extensions("OP",be));var Ie={mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation"),A=this.getFieldValue("PROPERTY")==="DIVISIBLE_BY";return E.setAttribute("divisor_input",String(A)),E},domToMutation:function(E){E=E.getAttribute("divisor_input")==="true",this.updateShape_(E)},updateShape_:function(E){const A=this.getInput("DIVISOR");E?A||this.appendValueInput("DIVISOR").setCheck("Number"):A&&this.removeInput("DIVISOR")}},ot=function(){this.getField("PROPERTY").setValidator(function(E){E=E==="DIVISIBLE_BY",this.getSourceBlock().updateShape_(E)})};h.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",Ie,ot),h.register$$module$build$src$core$extensions("math_change_tooltip",h.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var Ge={updateType_:function(E){E==="MODE"?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("op",this.getFieldValue("OP")),E},domToMutation:function(E){if(E=E.getAttribute("op"),E===null)throw new TypeError("xmlElement had no op attribute");this.updateType_(E)}},Fe=function(){this.getField("OP").setValidator((function(E){this.updateType_(E)}).bind(this))};h.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",Ge,Fe),h.defineBlocks$$module$build$src$core$common(nt);var Se={blocks:nt},ve=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),We={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"};h.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",h.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",We));var je={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"};h.register$$module$build$src$core$extensions("controls_flow_tooltip",h.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",je));var le={customContextMenu:function(E){if(!this.isInFlyout){var A=this.getField("VAR"),W=A.getVariable().name;this.isCollapsed()||W===null||(A={type:"variables_get",fields:{VAR:A.saveState(!0)}},E.push({enabled:!0,text:h.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",W),callback:h.callbackFactory$$module$build$src$core$contextmenu(this,A)}))}}};h.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",le),h.register$$module$build$src$core$extensions("controls_for_tooltip",h.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),h.register$$module$build$src$core$extensions("controls_forEach_tooltip",h.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var ee=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),me="CONTROL_FLOW_NOT_IN_LOOP",Ee={getSurroundLoop:function(){let E=this;do{if(ee.has(E.type))return E;E=E.getSurroundParent()}while(E);return null},onchange:function(E){const A=this.workspace;if(A.isDragging&&!A.isDragging()&&(E.type===h.MOVE$$module$build$src$core$events$utils||E.type===h.CREATE$$module$build$src$core$events$utils)&&(E=!!this.getSurroundLoop(),this.setWarningText(E?null:h.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{h.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!E,me)}finally{h.setRecordUndo$$module$build$src$core$events$utils(!0)}}};h.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",Ee),h.defineBlocks$$module$build$src$core$common(ve);var Oe={blocks:ve,loopTypes:ee},Be=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["≠","NEQ"],["‏<","LT"],["‏≤","LTE"],["‏>","GT"],["‏≥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),Ye={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"};h.register$$module$build$src$core$extensions("logic_op_tooltip",h.buildTooltipForDropdown$$module$build$src$core$extensions("OP",Ye));var Ke={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const E=h.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&E.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&E.setAttribute("else","1"),E},domToMutation:function(E){this.elseifCount_=parseInt(E.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(E.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const E=Object.create(null);return this.elseifCount_&&(E.elseIfCount=this.elseifCount_),this.elseCount_&&(E.hasElse=!0),E},loadExtraState:function(E){this.elseifCount_=E.elseIfCount||0,this.elseCount_=E.hasElse?1:0,this.updateShape_()},decompose:function(E){const A=E.newBlock("controls_if_if");A.initSvg();let W=A.nextConnection;for(let H=1;H<=this.elseifCount_;H++){const ae=E.newBlock("controls_if_elseif");ae.initSvg(),W.connect(ae.previousConnection),W=ae.nextConnection}return this.elseCount_&&(E=E.newBlock("controls_if_else"),E.initSvg(),W.connect(E.previousConnection)),A},compose:function(E){E=E.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const A=[null],W=[null];let H=null;for(;E;){if(!E.isInsertionMarker())switch(E.type){case"controls_if_elseif":this.elseifCount_++,A.push(E.valueConnection_),W.push(E.statementConnection_);break;case"controls_if_else":this.elseCount_++,H=E.statementConnection_;break;default:throw TypeError("Unknown block type: "+E.type)}E=E.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(A,W,H)},saveConnections:function(E){E=E.nextConnection.targetBlock();let A=1;for(;E;){if(!E.isInsertionMarker())switch(E.type){case"controls_if_elseif":var W=this.getInput("IF"+A);const H=this.getInput("DO"+A);E.valueConnection_=W&&W.connection.targetConnection,E.statementConnection_=H&&H.connection.targetConnection,A++;break;case"controls_if_else":W=this.getInput("ELSE"),E.statementConnection_=W&&W.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+E.type)}E=E.getNextBlock()}},rebuildShape_:function(){const E=[null],A=[null];let W=null;this.getInput("ELSE")&&(W=this.getInput("ELSE").connection.targetConnection);for(let H=1;this.getInput("IF"+H);H++){const ae=this.getInput("IF"+H),xe=this.getInput("DO"+H);E.push(ae.connection.targetConnection),A.push(xe.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(E,A,W)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var E=1;this.getInput("IF"+E);E++)this.removeInput("IF"+E),this.removeInput("DO"+E);for(E=1;E<=this.elseifCount_;E++)this.appendValueInput("IF"+E).setCheck("Boolean").appendField(h.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+E).appendField(h.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(h.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(E,A,W){for(let H=1;H<=this.elseifCount_;H++){let ae;(ae=E[H])==null||ae.reconnect(this,"IF"+H);let xe;(xe=A[H])==null||xe.reconnect(this,"DO"+H)}W==null||W.reconnect(this,"ELSE")}};h.registerMutator$$module$build$src$core$extensions("controls_if_mutator",Ke,null,["controls_if_elseif","controls_if_else"]);var it=function(){this.setTooltip((function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&this.elseCount_)return h.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return h.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return h.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4}else return h.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1;return""}).bind(this))};h.register$$module$build$src$core$extensions("controls_if_tooltip",it);var Ue={onchange:function(E){this.prevBlocks_||(this.prevBlocks_=[null,null]);var A=this.getInputTargetBlock("A");const W=this.getInputTargetBlock("B");A&&W&&!this.workspace.connectionChecker.doTypeChecks(A.outputConnection,W.outputConnection)&&(h.setGroup$$module$build$src$core$events$utils(E.group),E=this.prevBlocks_[0],E!==A&&(A.unplug(),!E||E.isDisposed()||E.isShadow()||this.getInput("A").connection.connect(E.outputConnection)),A=this.prevBlocks_[1],A!==W&&(W.unplug(),!A||A.isDisposed()||A.isShadow()||this.getInput("B").connection.connect(A.outputConnection)),this.bumpNeighbours(),h.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},Et=function(){this.mixin(Ue)};h.register$$module$build$src$core$extensions("logic_compare",Et);var J={prevParentConnection_:null,onchange:function(E){const A=this.getInputTargetBlock("THEN"),W=this.getInputTargetBlock("ELSE"),H=this.outputConnection.targetConnection;if((A||W)&&H)for(let ae=0;2>ae;ae++){const xe=ae===1?A:W;xe&&!xe.workspace.connectionChecker.doTypeChecks(xe.outputConnection,H)&&(h.setGroup$$module$build$src$core$events$utils(E.group),H===this.prevParentConnection_?(this.unplug(),H.getSourceBlock().bumpNeighbours()):(xe.unplug(),xe.bumpNeighbours()),h.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=H}};h.registerMixin$$module$build$src$core$extensions("logic_ternary",J),h.defineBlocks$$module$build$src$core$common(Be);var $e={blocks:Be},Qe=h.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),ke={init:function(){this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new h.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("items",String(this.itemCount_)),E},domToMutation:function(E){if(E=E.getAttribute("items"),!E)throw new TypeError("element did not have items");this.itemCount_=parseInt(E,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(E){this.itemCount_=E.itemCount,this.updateShape_()},decompose:function(E){const A=E.newBlock("lists_create_with_container");A.initSvg();let W=A.getInput("STACK").connection;for(let H=0;H<this.itemCount_;H++){const ae=E.newBlock("lists_create_with_item");if(ae.initSvg(),!ae.previousConnection)throw Error("itemBlock has no previousConnection");W.connect(ae.previousConnection),W=ae.nextConnection}return A},compose:function(E){var A=E.getInputTargetBlock("STACK");for(E=[];A;)A.isInsertionMarker()||E.push(A.valueConnection_),A=A.getNextBlock();for(A=0;A<this.itemCount_;A++){const W=this.getInput("ADD"+A).connection.targetConnection;W&&!E.includes(W)&&W.disconnect()}for(this.itemCount_=E.length,this.updateShape_(),A=0;A<this.itemCount_;A++){let W;(W=E[A])==null||W.reconnect(this,"ADD"+A)}},saveConnections:function(E){E=E.getInputTargetBlock("STACK");let A=0;for(;E;){if(E.isInsertionMarker()){E=E.getNextBlock();continue}const W=this.getInput("ADD"+A);let H;E.valueConnection_=(H=W)==null?void 0:H.connection.targetConnection,E=E.getNextBlock(),A++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(h.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var E=0;E<this.itemCount_;E++)if(!this.getInput("ADD"+E)){const A=this.appendValueInput("ADD"+E).setAlign(h.Align$$module$build$src$core$inputs$align.RIGHT);E===0&&A.appendField(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(E=this.itemCount_;this.getInput("ADD"+E);E++)this.removeInput("ADD"+E)}};Qe.lists_create_with=ke;var yt={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};Qe.lists_create_with_container=yt;var M={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(h.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};Qe.lists_create_with_item=M;var st={init:function(){var E=[[h.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[h.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(h.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),!E)throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(E,"END"),this.setInputsInline(!0),this.setTooltip(()=>h.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}};Qe.lists_indexOf=st;var gt={init:function(){var E=[[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),E.setValidator(function(A){A=A==="REMOVE",this.getSourceBlock().updateStatement_(A)}),this.appendValueInput("VALUE").setCheck("Array").appendField(h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(E,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip(()=>{const A=this.getFieldValue("MODE"),W=this.getFieldValue("WHERE");let H="";switch(A+" "+W){case"GET FROM_START":case"GET FROM_END":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":H=h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return(W==="FROM_START"||W==="FROM_END")&&(H+="  "+(W==="FROM_START"?h.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:h.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),H})},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");E.setAttribute("statement",String(!this.outputConnection));const A=this.getInput("AT")instanceof h.ValueInput$$module$build$src$core$inputs$value_input;return E.setAttribute("at",String(A)),E},domToMutation:function(E){const A=E.getAttribute("statement")==="true";this.updateStatement_(A),E=E.getAttribute("at")!=="false",this.updateAt_(E)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(E){E.isStatement?this.updateStatement_(!0):typeof E=="string"&&this.domToMutation(h.textToDom$$module$build$src$core$utils$xml(E))},updateStatement_:function(E){E!==!this.outputConnection&&(this.unplug(!0,!0),E?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(E){this.removeInput("AT"),this.removeInput("ORDINAL",!0),E?(this.appendValueInput("AT").setCheck("Number"),h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const A=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});A.setValidator(function(W){const H=W==="FROM_START"||W==="FROM_END";if(H!==E){const ae=this.getSourceBlock();return ae.updateAt_(H),ae.setFieldValue(W,"WHERE"),null}}),this.getInput("AT").appendField(A,"WHERE"),h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};Qe.lists_getIndex=gt;var Je={init:function(){var E=[[h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[h.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:E}),this.appendDummyInput().appendField(E,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip(()=>{const A=this.getFieldValue("MODE"),W=this.getFieldValue("WHERE");let H="";switch(A+" "+W){case"SET FROM_START":case"SET FROM_END":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":H=h.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return(W==="FROM_START"||W==="FROM_END")&&(H+="  "+h.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),H})},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation"),A=this.getInput("AT")instanceof h.ValueInput$$module$build$src$core$inputs$value_input;return E.setAttribute("at",String(A)),E},domToMutation:function(E){E=E.getAttribute("at")!=="false",this.updateAt_(E)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(E){this.removeInput("AT"),this.removeInput("ORDINAL",!0),E?(this.appendValueInput("AT").setCheck("Number"),h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const A=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});A.setValidator(function(W){const H=W==="FROM_START"||W==="FROM_END";if(H!==E){const ae=this.getSourceBlock();return ae.updateAt_(H),ae.setFieldValue(W,"WHERE"),null}}),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(A,"WHERE")}};Qe.lists_setIndex=Je;var ut={init:function(){this.WHERE_OPTIONS_1=[[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");var A=this.getInput("AT1")instanceof h.ValueInput$$module$build$src$core$inputs$value_input;return E.setAttribute("at1",String(A)),A=this.getInput("AT2")instanceof h.ValueInput$$module$build$src$core$inputs$value_input,E.setAttribute("at2",String(A)),E},domToMutation:function(E){const A=E.getAttribute("at1")==="true";E=E.getAttribute("at2")==="true",this.updateAt_(1,A),this.updateAt_(2,E)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(E,A){this.removeInput("AT"+E),this.removeInput("ORDINAL"+E,!0),A?(this.appendValueInput("AT"+E).setCheck("Number"),h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+E).appendField(h.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+E);const W=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+E]});W.setValidator(function(H){const ae=H==="FROM_START"||H==="FROM_END";if(ae!==A){const xe=this.getSourceBlock();return xe.updateAt_(E,ae),xe.setFieldValue(H,"WHERE"+E),null}}),this.getInput("AT"+E).appendField(W,"WHERE"+E),E===1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),h.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};Qe.lists_getSublist=ut,Qe.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},Qe.lists_split={init:function(){const E=h.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[h.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[h.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!E)throw Error("field_dropdown not found");E.setValidator(A=>{this.updateType_(A)}),this.setHelpUrl(h.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(E,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(h.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(()=>{const A=this.getFieldValue("MODE");if(A==="SPLIT")return h.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if(A==="JOIN")return h.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+A)})},updateType_:function(E){if(this.getFieldValue("MODE")!==E){const A=this.getInput("INPUT").connection;A.setShadowDom(null);const W=A.targetBlock();W&&(A.disconnect(),W.isShadow()?W.dispose(!1):this.bumpNeighbours())}E==="SPLIT"?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const E=h.createElement$$module$build$src$core$utils$xml("mutation");return E.setAttribute("mode",this.getFieldValue("MODE")),E},domToMutation:function(E){this.updateType_(E.getAttribute("mode"))},saveExtraState:function(){return null},loadExtraState:function(){}},h.defineBlocks$$module$build$src$core$common(Qe);var dt={blocks:Qe},Xe=Object.assign({},Qe,Be,ve,nt,ge,V,R,p),pt={blocks:Xe,lists:dt,logic:$e,loops:Oe,math:Se,procedures:_e,texts:ye,variables:D,variablesDynamic:I};return pt.__namespace__=h,pt})}(blocks_compressed$1)),blocks_compressed$1.exports}var blockly=blockly$1.exports,hasRequiredBlockly;function requireBlockly(){return hasRequiredBlockly||(hasRequiredBlockly=1,function(n,c){(function(l,h){n.exports=h(requireBlockly_compressed(),requireEn(),requireBlocks_compressed())})(blockly,function(l,h,p){return l.setLocale(h),l})}(blockly$1)),blockly$1.exports}var blocklyExports=requireBlockly();const Blockly$1=getDefaultExportFromCjs(blocklyExports),{ASTNode:ASTNode$1,BasicCursor:BasicCursor$1,Block:Block$1,BlockSvg:BlockSvg$1,Blocks:Blocks$1,COLLAPSED_FIELD_NAME:COLLAPSED_FIELD_NAME$1,COLLAPSED_INPUT_NAME:COLLAPSED_INPUT_NAME$1,COLLAPSE_CHARS:COLLAPSE_CHARS$1,CodeGenerator:CodeGenerator$1,CollapsibleToolboxCategory:CollapsibleToolboxCategory$1,ComponentManager:ComponentManager$1,Connection:Connection$1,ConnectionChecker:ConnectionChecker$1,ConnectionDB:ConnectionDB$1,ConnectionType:ConnectionType$1,ContextMenu:ContextMenu$1,ContextMenuItems:ContextMenuItems$1,ContextMenuRegistry:ContextMenuRegistry$1,Css:Css$1,Cursor:Cursor$1,DELETE_VARIABLE_ID:DELETE_VARIABLE_ID$1,DeleteArea:DeleteArea$1,DragTarget:DragTarget$1,DropDownDiv:DropDownDiv$1,Events:Events$1,Extensions:Extensions$1,Field:Field$1,FieldCheckbox:FieldCheckbox$1,FieldDropdown:FieldDropdown$1,FieldImage:FieldImage$1,FieldLabel:FieldLabel$1,FieldLabelSerializable:FieldLabelSerializable$1,FieldNumber:FieldNumber$1,FieldTextInput:FieldTextInput$1,FieldVariable:FieldVariable$1,Flyout:Flyout$1,FlyoutButton:FlyoutButton$1,FlyoutMetricsManager:FlyoutMetricsManager$1,Generator:Generator$1,Gesture:Gesture$1,Grid:Grid$1,HorizontalFlyout:HorizontalFlyout$1,INPUT_VALUE:INPUT_VALUE$1,Input:Input$1,InsertionMarkerManager:InsertionMarkerManager$1,InsertionMarkerPreviewer:InsertionMarkerPreviewer$1,Marker:Marker$1,MarkerManager:MarkerManager$1,Menu:Menu$1,MenuItem:MenuItem$1,MetricsManager:MetricsManager$1,Msg:Msg$1,NEXT_STATEMENT:NEXT_STATEMENT$1,Names:Names$1,OPPOSITE_TYPE:OPPOSITE_TYPE$1,OUTPUT_VALUE:OUTPUT_VALUE$1,Options:Options$1,PREVIOUS_STATEMENT:PREVIOUS_STATEMENT$1,PROCEDURE_CATEGORY_NAME:PROCEDURE_CATEGORY_NAME$1,Procedures:Procedures$1,RENAME_VARIABLE_ID:RENAME_VARIABLE_ID$1,RenderedConnection:RenderedConnection$1,Scrollbar:Scrollbar$1,ScrollbarPair:ScrollbarPair$1,ShortcutItems:ShortcutItems$1,ShortcutRegistry:ShortcutRegistry$1,TOOLBOX_AT_BOTTOM:TOOLBOX_AT_BOTTOM$1,TOOLBOX_AT_LEFT:TOOLBOX_AT_LEFT$1,TOOLBOX_AT_RIGHT:TOOLBOX_AT_RIGHT$1,TOOLBOX_AT_TOP:TOOLBOX_AT_TOP$1,TabNavigateCursor:TabNavigateCursor$1,Theme:Theme$2,ThemeManager:ThemeManager$1,Themes:Themes$1,Toolbox:Toolbox$1,ToolboxCategory:ToolboxCategory$1,ToolboxItem:ToolboxItem$1,ToolboxSeparator:ToolboxSeparator$1,Tooltip:Tooltip$1,Touch:Touch$1,Trashcan:Trashcan$1,UnattachedFieldError:UnattachedFieldError$1,VARIABLE_CATEGORY_NAME:VARIABLE_CATEGORY_NAME$1,VARIABLE_DYNAMIC_CATEGORY_NAME:VARIABLE_DYNAMIC_CATEGORY_NAME$1,VERSION:VERSION$1,VariableMap:VariableMap$1,VariableModel:VariableModel$1,Variables:Variables$1,VariablesDynamic:VariablesDynamic$1,VerticalFlyout:VerticalFlyout$1,WidgetDiv:WidgetDiv$1,Workspace:Workspace$1,WorkspaceAudio:WorkspaceAudio$1,WorkspaceDragger:WorkspaceDragger$1,WorkspaceSvg:WorkspaceSvg$1,Xml:Xml$1,ZoomControls:ZoomControls$1,blockAnimations:blockAnimations$1,blockRendering:blockRendering$1,browserEvents:browserEvents$1,bubbles:bubbles$1,bumpObjects:bumpObjects$1,clipboard:clipboard$1,comments:comments$1,common:common$2,config:config$1,constants:constants$1,defineBlocksWithJsonArray:defineBlocksWithJsonArray$1,dialog:dialog$1,dragging:dragging$1,fieldRegistry:fieldRegistry$1,geras:geras$1,getMainWorkspace:getMainWorkspace$1,getSelected:getSelected$1,hasBubble:hasBubble$1,hideChaff:hideChaff$1,icons:icons$1,inject:inject$1,inputs:inputs$1,isCopyable:isCopyable$1,isDeletable:isDeletable$1,isDraggable:isDraggable$1,isIcon:isIcon$1,isObservable:isObservable$1,isPaster:isPaster$1,isRenderedElement:isRenderedElement$1,isSelectable:isSelectable$1,isSerializable:isSerializable$1,isVariableBackedParameterModel:isVariableBackedParameterModel$1,procedures:procedures$2,registry:registry$1,renderManagement:renderManagement$1,serialization:serialization$1,setLocale:setLocale$1,setParentContainer:setParentContainer$1,svgResize:svgResize$1,thrasos:thrasos$1,uiPosition:uiPosition$1,utils:utils$1,zelos:zelos$1}=Blockly$1;var blocks_compressedExports=requireBlocks_compressed();const libraryBlocks=getDefaultExportFromCjs(blocks_compressedExports),{blocks,lists,logic,loops,math,procedures:procedures$1,texts,variables,variablesDynamic}=libraryBlocks;var javascript_compressed$1={exports:{}},javascript_compressed=javascript_compressed$1.exports,hasRequiredJavascript_compressed;function requireJavascript_compressed(){return hasRequiredJavascript_compressed||(hasRequiredJavascript_compressed=1,function(n,c){(function(l,h){n.exports=h(requireBlockly_compressed())})(javascript_compressed,function(l){var h=l.__namespace__,p=function(b,k){return["[]",M.ATOMIC]},g=function(b,k){const F=Array(b.itemCount_);for(let X=0;X<b.itemCount_;X++)F[X]=k.valueToCode(b,"ADD"+X,M.NONE)||"null";return["["+F.join(", ")+"]",M.ATOMIC]},T=function(b,k){const F=k.provideFunction_("listsRepeat",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(value, n) {
  var array = [];
  for (var i = 0; i < n; i++) {
    array[i] = value;
  }
  return array;
}
`),X=k.valueToCode(b,"ITEM",M.NONE)||"null";return b=k.valueToCode(b,"NUM",M.NONE)||"0",[F+"("+X+", "+b+")",M.FUNCTION_CALL]},v=function(b,k){return[(k.valueToCode(b,"VALUE",M.MEMBER)||"[]")+".length",M.MEMBER]},I=function(b,k){return["!"+(k.valueToCode(b,"VALUE",M.MEMBER)||"[]")+".length",M.LOGICAL_NOT]},R=function(b,k){const F=b.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",X=k.valueToCode(b,"FIND",M.NONE)||"''";return k=(k.valueToCode(b,"VALUE",M.MEMBER)||"[]")+"."+F+"("+X+")",b.workspace.options.oneBasedIndex?[k+" + 1",M.ADDITION]:[k,M.FUNCTION_CALL]},w=function(b,k){const F=b.getFieldValue("MODE")||"GET",X=b.getFieldValue("WHERE")||"FROM_START";var oe=k.valueToCode(b,"VALUE",X==="RANDOM"?M.NONE:M.MEMBER)||"[]";switch(X){case"FIRST":if(F==="GET")return[oe+"[0]",M.MEMBER];if(F==="GET_REMOVE")return[oe+".shift()",M.MEMBER];if(F==="REMOVE")return oe+`.shift();
`;break;case"LAST":if(F==="GET")return[oe+".slice(-1)[0]",M.MEMBER];if(F==="GET_REMOVE")return[oe+".pop()",M.MEMBER];if(F==="REMOVE")return oe+`.pop();
`;break;case"FROM_START":if(b=k.getAdjusted(b,"AT"),F==="GET")return[oe+"["+b+"]",M.MEMBER];if(F==="GET_REMOVE")return[oe+".splice("+b+", 1)[0]",M.FUNCTION_CALL];if(F==="REMOVE")return oe+".splice("+b+`, 1);
`;break;case"FROM_END":if(b=k.getAdjusted(b,"AT",1,!0),F==="GET")return[oe+".slice("+b+")[0]",M.FUNCTION_CALL];if(F==="GET_REMOVE")return[oe+".splice("+b+", 1)[0]",M.FUNCTION_CALL];if(F==="REMOVE")return oe+".splice("+b+", 1);";break;case"RANDOM":if(oe=k.provideFunction_("listsGetRandomItem",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {
  var x = Math.floor(Math.random() * list.length);
  if (remove) {
    return list.splice(x, 1)[0];
  } else {
    return list[x];
  }
}
`)+"("+oe+", "+(F!=="GET")+")",F==="GET"||F==="GET_REMOVE")return[oe,M.FUNCTION_CALL];if(F==="REMOVE")return oe+`;
`}throw Error("Unhandled combination (lists_getIndex).")},C=function(b,k){function F(){if(X.match(/^\w+$/))return"";const Ht=k.nameDB_.getDistinctName("tmpList",h.NameType$$module$build$src$core$names.VARIABLE),fi="var "+Ht+" = "+X+`;
`;return X=Ht,fi}let X=k.valueToCode(b,"LIST",M.MEMBER)||"[]";const oe=b.getFieldValue("MODE")||"GET";var Re=b.getFieldValue("WHERE")||"FROM_START";const Pe=k.valueToCode(b,"TO",M.ASSIGNMENT)||"null";switch(Re){case"FIRST":if(oe==="SET")return X+"[0] = "+Pe+`;
`;if(oe==="INSERT")return X+".unshift("+Pe+`);
`;break;case"LAST":if(oe==="SET")return F()+(X+"["+X+".length - 1] = "+Pe+`;
`);if(oe==="INSERT")return X+".push("+Pe+`);
`;break;case"FROM_START":if(b=k.getAdjusted(b,"AT"),oe==="SET")return X+"["+b+"] = "+Pe+`;
`;if(oe==="INSERT")return X+".splice("+b+", 0, "+Pe+`);
`;break;case"FROM_END":if(b=k.getAdjusted(b,"AT",1,!1,M.SUBTRACTION),Re=F(),oe==="SET")return Re+(X+"["+X+".length - "+b+"] = "+Pe+`;
`);if(oe==="INSERT")return Re+(X+".splice("+X+".length - "+b+", 0, "+Pe+`);
`);break;case"RANDOM":if(b=F(),Re=k.nameDB_.getDistinctName("tmpX",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+Re+" = Math.floor(Math.random() * "+X+`.length);
`,oe==="SET")return b+(X+"["+Re+"] = "+Pe+`;
`);if(oe==="INSERT")return b+(X+".splice("+Re+", 0, "+Pe+`);
`)}throw Error("Unhandled combination (lists_setIndex).")},N=function(b,k){var F={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},X=k.valueToCode(b,"LIST",M.MEMBER)||"[]";const oe=b.getFieldValue("WHERE1"),Re=b.getFieldValue("WHERE2");if(oe==="FIRST"&&Re==="LAST")X+=".slice(0)";else if(X.match(/^\w+$/)||oe!=="FROM_END"&&Re==="FROM_START"){switch(oe){case"FROM_START":F=k.getAdjusted(b,"AT1");break;case"FROM_END":F=k.getAdjusted(b,"AT1",1,!1,M.SUBTRACTION),F=X+".length - "+F;break;case"FIRST":F="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(Re){case"FROM_START":k=k.getAdjusted(b,"AT2",1);break;case"FROM_END":k=k.getAdjusted(b,"AT2",0,!1,M.SUBTRACTION),k=X+".length - "+k;break;case"LAST":k=X+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}X=X+".slice("+F+", "+k+")"}else{const Pe=k.getAdjusted(b,"AT1");b=k.getAdjusted(b,"AT2"),X=k.provideFunction_("subsequence"+F[oe]+F[Re],`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(sequence${oe==="FROM_END"||oe==="FROM_START"?", at1":""}${Re==="FROM_END"||Re==="FROM_START"?", at2":""}) {
  var start = ${gt("sequence",oe,"at1")};
  var end = ${gt("sequence",Re,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+X+(oe==="FROM_END"||oe==="FROM_START"?", "+Pe:"")+(Re==="FROM_END"||Re==="FROM_START"?", "+b:"")+")"}return[X,M.FUNCTION_CALL]},D=function(b,k){const F=k.valueToCode(b,"LIST",M.FUNCTION_CALL)||"[]",X=b.getFieldValue("DIRECTION")==="1"?1:-1;return b=b.getFieldValue("TYPE"),k=k.provideFunction_("listsGetSortCompare",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {
  var compareFuncs = {
    'NUMERIC': function(a, b) {
        return Number(a) - Number(b); },
    'TEXT': function(a, b) {
        return String(a) > String(b) ? 1 : -1; },
    'IGNORE_CASE': function(a, b) {
        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },
  };
  var compare = compareFuncs[type];
  return function(a, b) { return compare(a, b) * direction; };
}
      `),[F+".slice().sort("+k+'("'+b+'", '+X+"))",M.FUNCTION_CALL]},V=function(b,k){let F=k.valueToCode(b,"INPUT",M.MEMBER);if(k=k.valueToCode(b,"DELIM",M.NONE)||"''",b=b.getFieldValue("MODE"),b==="SPLIT")F||(F="''"),b="split";else if(b==="JOIN")F||(F="[]"),b="join";else throw Error("Unknown mode: "+b);return[F+"."+b+"("+k+")",M.FUNCTION_CALL]},B=function(b,k){return[(k.valueToCode(b,"LIST",M.FUNCTION_CALL)||"[]")+".slice().reverse()",M.FUNCTION_CALL]},ie=function(b,k){var F=0;let X="";k.STATEMENT_PREFIX&&(X+=k.injectId(k.STATEMENT_PREFIX,b));do{const oe=k.valueToCode(b,"IF"+F,M.NONE)||"false";let Re=k.statementToCode(b,"DO"+F);k.STATEMENT_SUFFIX&&(Re=k.prefixLines(k.injectId(k.STATEMENT_SUFFIX,b),k.INDENT)+Re),X+=(0<F?" else ":"")+"if ("+oe+`) {
`+Re+"}",F++}while(b.getInput("IF"+F));return(b.getInput("ELSE")||k.STATEMENT_SUFFIX)&&(F=k.statementToCode(b,"ELSE"),k.STATEMENT_SUFFIX&&(F=k.prefixLines(k.injectId(k.STATEMENT_SUFFIX,b),k.INDENT)+F),X+=` else {
`+F+"}"),X+`
`},ne=function(b,k){const F={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[b.getFieldValue("OP")],X=F==="=="||F==="!="?M.EQUALITY:M.RELATIONAL,oe=k.valueToCode(b,"A",X)||"0";return b=k.valueToCode(b,"B",X)||"0",[oe+" "+F+" "+b,X]},P=function(b,k){const F=b.getFieldValue("OP")==="AND"?"&&":"||",X=F==="&&"?M.LOGICAL_AND:M.LOGICAL_OR;let oe=k.valueToCode(b,"A",X);return b=k.valueToCode(b,"B",X),oe||b?(k=F==="&&"?"true":"false",oe||(oe=k),b||(b=k)):b=oe="false",[oe+" "+F+" "+b,X]},z=function(b,k){const F=M.LOGICAL_NOT;return["!"+(k.valueToCode(b,"BOOL",F)||"true"),F]},se=function(b,k){return[b.getFieldValue("BOOL")==="TRUE"?"true":"false",M.ATOMIC]},re=function(b,k){return["null",M.ATOMIC]},he=function(b,k){const F=k.valueToCode(b,"IF",M.CONDITIONAL)||"false",X=k.valueToCode(b,"THEN",M.CONDITIONAL)||"null";return b=k.valueToCode(b,"ELSE",M.CONDITIONAL)||"null",[F+" ? "+X+" : "+b,M.CONDITIONAL]},q=function(b,k){let F;F=b.getField("TIMES")?String(Number(b.getFieldValue("TIMES"))):k.valueToCode(b,"TIMES",M.ASSIGNMENT)||"0";let X=k.statementToCode(b,"DO");X=k.addLoopTrap(X,b),b="";const oe=k.nameDB_.getDistinctName("count",h.NameType$$module$build$src$core$names.VARIABLE);let Re=F;return F.match(/^\w+$/)||h.isNumber$$module$build$src$core$utils$string(F)||(Re=k.nameDB_.getDistinctName("repeat_end",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+Re+" = "+F+`;
`),b+("for (var "+oe+" = 0; "+oe+" < "+Re+"; "+oe+`++) {
`+X+`}
`)},j=function(b,k){const F=b.getFieldValue("MODE")==="UNTIL";let X=k.valueToCode(b,"BOOL",F?M.LOGICAL_NOT:M.NONE)||"false",oe=k.statementToCode(b,"DO");return oe=k.addLoopTrap(oe,b),F&&(X="!"+X),"while ("+X+`) {
`+oe+`}
`},ye=function(b,k){var F=k.getVariableName(b.getFieldValue("VAR")),X=k.valueToCode(b,"FROM",M.ASSIGNMENT)||"0",oe=k.valueToCode(b,"TO",M.ASSIGNMENT)||"0";const Re=k.valueToCode(b,"BY",M.ASSIGNMENT)||"1";let Pe=k.statementToCode(b,"DO");if(Pe=k.addLoopTrap(Pe,b),h.isNumber$$module$build$src$core$utils$string(X)&&h.isNumber$$module$build$src$core$utils$string(oe)&&h.isNumber$$module$build$src$core$utils$string(Re))k=Number(X)<=Number(oe),b="for ("+F+" = "+X+"; "+F+(k?" <= ":" >= ")+oe+"; "+F,F=Math.abs(Number(Re)),b=F===1?b+(k?"++":"--"):b+((k?" += ":" -= ")+F),b+=`) {
`+Pe+`}
`;else{b="";let Ht=X;X.match(/^\w+$/)||h.isNumber$$module$build$src$core$utils$string(X)||(Ht=k.nameDB_.getDistinctName(F+"_start",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+Ht+" = "+X+`;
`),X=oe,oe.match(/^\w+$/)||h.isNumber$$module$build$src$core$utils$string(oe)||(X=k.nameDB_.getDistinctName(F+"_end",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+X+" = "+oe+`;
`),oe=k.nameDB_.getDistinctName(F+"_inc",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+oe+" = ",b=h.isNumber$$module$build$src$core$utils$string(Re)?b+(Math.abs(Number(Re))+`;
`):b+("Math.abs("+Re+`);
`),b+="if ("+Ht+" > "+X+`) {
`,b+=k.INDENT+oe+" = -"+oe+`;
`,b=b+`}
for (`+(F+" = "+Ht+"; "+oe+" >= 0 ? "+F+" <= "+X+" : "+F+" >= "+X+"; "+F+" += "+oe+`) {
`+Pe+`}
`)}return b},ge=function(b,k){const F=k.getVariableName(b.getFieldValue("VAR"));var X=k.valueToCode(b,"LIST",M.ASSIGNMENT)||"[]";let oe=k.statementToCode(b,"DO");oe=k.addLoopTrap(oe,b),b="";let Re=X;return X.match(/^\w+$/)||(Re=k.nameDB_.getDistinctName(F+"_list",h.NameType$$module$build$src$core$names.VARIABLE),b+="var "+Re+" = "+X+`;
`),X=k.nameDB_.getDistinctName(F+"_index",h.NameType$$module$build$src$core$names.VARIABLE),oe=k.INDENT+F+" = "+Re+"["+X+`];
`+oe,b+("for (var "+X+" in "+Re+`) {
`+oe+`}
`)},Ve=function(b,k){let F="";if(k.STATEMENT_PREFIX&&(F+=k.injectId(k.STATEMENT_PREFIX,b)),k.STATEMENT_SUFFIX&&(F+=k.injectId(k.STATEMENT_SUFFIX,b)),k.STATEMENT_PREFIX){const X=b.getSurroundLoop();X&&!X.suppressPrefixSuffix&&(F+=k.injectId(k.STATEMENT_PREFIX,X))}switch(b.getFieldValue("FLOW")){case"BREAK":return F+`break;
`;case"CONTINUE":return F+`continue;
`}throw Error("Unknown flow statement.")},de=function(b,k){return b=Number(b.getFieldValue("NUM")),[String(b),0<=b?M.ATOMIC:M.UNARY_NEGATION]},Tt=function(b,k){var F={ADD:[" + ",M.ADDITION],MINUS:[" - ",M.SUBTRACTION],MULTIPLY:[" * ",M.MULTIPLICATION],DIVIDE:[" / ",M.DIVISION],POWER:[null,M.NONE]}[b.getFieldValue("OP")];const X=F[0];F=F[1];const oe=k.valueToCode(b,"A",F)||"0";return b=k.valueToCode(b,"B",F)||"0",X?[oe+X+b,F]:["Math.pow("+oe+", "+b+")",M.FUNCTION_CALL]},ze=function(b,k){const F=b.getFieldValue("OP");let X;if(F==="NEG")return b=k.valueToCode(b,"NUM",M.UNARY_NEGATION)||"0",b[0]==="-"&&(b=" "+b),["-"+b,M.UNARY_NEGATION];switch(b=F==="SIN"||F==="COS"||F==="TAN"?k.valueToCode(b,"NUM",M.DIVISION)||"0":k.valueToCode(b,"NUM",M.NONE)||"0",F){case"ABS":X="Math.abs("+b+")";break;case"ROOT":X="Math.sqrt("+b+")";break;case"LN":X="Math.log("+b+")";break;case"EXP":X="Math.exp("+b+")";break;case"POW10":X="Math.pow(10,"+b+")";break;case"ROUND":X="Math.round("+b+")";break;case"ROUNDUP":X="Math.ceil("+b+")";break;case"ROUNDDOWN":X="Math.floor("+b+")";break;case"SIN":X="Math.sin("+b+" / 180 * Math.PI)";break;case"COS":X="Math.cos("+b+" / 180 * Math.PI)";break;case"TAN":X="Math.tan("+b+" / 180 * Math.PI)"}if(X)return[X,M.FUNCTION_CALL];switch(F){case"LOG10":X="Math.log("+b+") / Math.log(10)";break;case"ASIN":X="Math.asin("+b+") / Math.PI * 180";break;case"ACOS":X="Math.acos("+b+") / Math.PI * 180";break;case"ATAN":X="Math.atan("+b+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+F)}return[X,M.DIVISION]},mt=function(b,k){return{PI:["Math.PI",M.MEMBER],E:["Math.E",M.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",M.DIVISION],SQRT2:["Math.SQRT2",M.MEMBER],SQRT1_2:["Math.SQRT1_2",M.MEMBER],INFINITY:["Infinity",M.ATOMIC]}[b.getFieldValue("CONSTANT")]},Ce=function(b,k){var F={EVEN:[" % 2 === 0",M.MODULUS,M.EQUALITY],ODD:[" % 2 === 1",M.MODULUS,M.EQUALITY],WHOLE:[" % 1 === 0",M.MODULUS,M.EQUALITY],POSITIVE:[" > 0",M.RELATIONAL,M.RELATIONAL],NEGATIVE:[" < 0",M.RELATIONAL,M.RELATIONAL],DIVISIBLE_BY:[null,M.MODULUS,M.EQUALITY],PRIME:[null,M.NONE,M.FUNCTION_CALL]};const X=b.getFieldValue("PROPERTY"),[oe,Re,Pe]=F[X];return F=k.valueToCode(b,"NUMBER_TO_CHECK",Re)||"0",X==="PRIME"?b=k.provideFunction_("mathIsPrime",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(n) {
  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods
  if (n == 2 || n == 3) {
    return true;
  }
  // False if n is NaN, negative, is 1, or not whole.
  // And false if n is divisible by 2 or 3.
  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {
    return false;
  }
  // Check all the numbers of form 6k +/- 1, up to sqrt(n).
  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {
    if (n % (x - 1) === 0 || n % (x + 1) === 0) {
      return false;
    }
  }
  return true;
}
`)+"("+F+")":X==="DIVISIBLE_BY"?(b=k.valueToCode(b,"DIVISOR",M.MODULUS)||"0",b=F+" % "+b+" === 0"):b=F+oe,[b,Pe]},St=function(b,k){const F=k.valueToCode(b,"DELTA",M.ADDITION)||"0";return b=k.getVariableName(b.getFieldValue("VAR")),b+" = (typeof "+b+" === 'number' ? "+b+" : 0) + "+F+`;
`},_e=function(b,k){var F=b.getFieldValue("OP");switch(F){case"SUM":b=k.valueToCode(b,"LIST",M.MEMBER)||"[]",b+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":b=k.valueToCode(b,"LIST",M.NONE)||"[]",b="Math.min.apply(null, "+b+")";break;case"MAX":b=k.valueToCode(b,"LIST",M.NONE)||"[]",b="Math.max.apply(null, "+b+")";break;case"AVERAGE":F=k.provideFunction_("mathMean",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;
}
`),b=k.valueToCode(b,"LIST",M.NONE)||"[]",b=F+"("+b+")";break;case"MEDIAN":F=k.provideFunction_("mathMedian",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  var localList = myList.filter(function (x) {return typeof x === 'number';});
  if (!localList.length) return null;
  localList.sort(function(a, b) {return b - a;});
  if (localList.length % 2 === 0) {
    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;
  } else {
    return localList[(localList.length - 1) / 2];
  }
}
`),b=k.valueToCode(b,"LIST",M.NONE)||"[]",b=F+"("+b+")";break;case"MODE":F=k.provideFunction_("mathModes",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(values) {
  var modes = [];
  var counts = [];
  var maxCount = 0;
  for (var i = 0; i < values.length; i++) {
    var value = values[i];
    var found = false;
    var thisCount;
    for (var j = 0; j < counts.length; j++) {
      if (counts[j][0] === value) {
        thisCount = ++counts[j][1];
        found = true;
        break;
      }
    }
    if (!found) {
      counts.push([value, 1]);
      thisCount = 1;
    }
    maxCount = Math.max(thisCount, maxCount);
  }
  for (var j = 0; j < counts.length; j++) {
    if (counts[j][1] === maxCount) {
      modes.push(counts[j][0]);
    }
  }
  return modes;
}
`),b=k.valueToCode(b,"LIST",M.NONE)||"[]",b=F+"("+b+")";break;case"STD_DEV":F=k.provideFunction_("mathStandardDeviation",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(numbers) {
  var n = numbers.length;
  if (!n) return null;
  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;
  var variance = 0;
  for (var j = 0; j < n; j++) {
    variance += Math.pow(numbers[j] - mean, 2);
  }
  variance /= n;
  return Math.sqrt(variance);
}
`),b=k.valueToCode(b,"LIST",M.NONE)||"[]",b=F+"("+b+")";break;case"RANDOM":F=k.provideFunction_("mathRandomList",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(list) {
  var x = Math.floor(Math.random() * list.length);
  return list[x];
}
`),b=k.valueToCode(b,"LIST",M.NONE)||"[]",b=F+"("+b+")";break;default:throw Error("Unknown operator: "+F)}return[b,M.FUNCTION_CALL]},nt=function(b,k){const F=k.valueToCode(b,"DIVIDEND",M.MODULUS)||"0";return b=k.valueToCode(b,"DIVISOR",M.MODULUS)||"0",[F+" % "+b,M.MODULUS]},be=function(b,k){const F=k.valueToCode(b,"VALUE",M.NONE)||"0",X=k.valueToCode(b,"LOW",M.NONE)||"0";return b=k.valueToCode(b,"HIGH",M.NONE)||"Infinity",["Math.min(Math.max("+F+", "+X+"), "+b+")",M.FUNCTION_CALL]},Ie=function(b,k){const F=k.valueToCode(b,"FROM",M.NONE)||"0";return b=k.valueToCode(b,"TO",M.NONE)||"0",[k.provideFunction_("mathRandomInt",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(a, b) {
  if (a > b) {
    // Swap a and b to ensure a is smaller.
    var c = a;
    a = b;
    b = c;
  }
  return Math.floor(Math.random() * (b - a + 1) + a);
}
`)+"("+F+", "+b+")",M.FUNCTION_CALL]},ot=function(b,k){return["Math.random()",M.FUNCTION_CALL]},Ge=function(b,k){const F=k.valueToCode(b,"X",M.NONE)||"0";return["Math.atan2("+(k.valueToCode(b,"Y",M.NONE)||"0")+", "+F+") / Math.PI * 180",M.DIVISION]},Fe=function(b,k){const F=k.getProcedureName(b.getFieldValue("NAME"));var X="";k.STATEMENT_PREFIX&&(X+=k.injectId(k.STATEMENT_PREFIX,b)),k.STATEMENT_SUFFIX&&(X+=k.injectId(k.STATEMENT_SUFFIX,b)),X&&(X=k.prefixLines(X,k.INDENT));let oe="";k.INFINITE_LOOP_TRAP&&(oe=k.prefixLines(k.injectId(k.INFINITE_LOOP_TRAP,b),k.INDENT));let Re="";b.getInput("STACK")&&(Re=k.statementToCode(b,"STACK"));let Pe="";b.getInput("RETURN")&&(Pe=k.valueToCode(b,"RETURN",M.NONE)||"");let Ht="";Re&&Pe&&(Ht=X),Pe&&(Pe=k.INDENT+"return "+Pe+`;
`);const fi=[],Ft=b.getVars();for(let Kt=0;Kt<Ft.length;Kt++)fi[Kt]=k.getVariableName(Ft[Kt]);return X="function "+F+"("+fi.join(", ")+`) {
`+X+oe+Re+Ht+Pe+"}",X=k.scrub_(b,X),k.definitions_["%"+F]=X,null},Se=function(b,k){const F=k.getProcedureName(b.getFieldValue("NAME")),X=[],oe=b.getVars();for(let Re=0;Re<oe.length;Re++)X[Re]=k.valueToCode(b,"ARG"+Re,M.NONE)||"null";return[F+"("+X.join(", ")+")",M.FUNCTION_CALL]},ve=function(b,k){return k.forBlock.procedures_callreturn(b,k)[0]+`;
`},We=function(b,k){let F="if ("+(k.valueToCode(b,"CONDITION",M.NONE)||"false")+`) {
`;return k.STATEMENT_SUFFIX&&(F+=k.prefixLines(k.injectId(k.STATEMENT_SUFFIX,b),k.INDENT)),b.hasReturnValue_?(b=k.valueToCode(b,"VALUE",M.NONE)||"null",F+=k.INDENT+"return "+b+`;
`):F+=k.INDENT+`return;
`,F+`}
`},je=function(b,k){return[k.quote_(b.getFieldValue("TEXT")),M.ATOMIC]},le=function(b,k){switch(b.itemCount_){case 0:return["''",M.ATOMIC];case 1:return b=k.valueToCode(b,"ADD0",M.NONE)||"''",A(b);case 2:var F=k.valueToCode(b,"ADD0",M.NONE)||"''";return b=k.valueToCode(b,"ADD1",M.NONE)||"''",[A(F)[0]+" + "+A(b)[0],M.ADDITION];default:F=Array(b.itemCount_);for(let X=0;X<b.itemCount_;X++)F[X]=k.valueToCode(b,"ADD"+X,M.NONE)||"''";return["["+F.join(",")+"].join('')",M.FUNCTION_CALL]}},ee=function(b,k){const F=k.getVariableName(b.getFieldValue("VAR"));return b=k.valueToCode(b,"TEXT",M.NONE)||"''",F+" += "+A(b)[0]+`;
`},me=function(b,k){return[(k.valueToCode(b,"VALUE",M.MEMBER)||"''")+".length",M.MEMBER]},Ee=function(b,k){return["!"+(k.valueToCode(b,"VALUE",M.MEMBER)||"''")+".length",M.LOGICAL_NOT]},Oe=function(b,k){const F=b.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",X=k.valueToCode(b,"FIND",M.NONE)||"''";return k=(k.valueToCode(b,"VALUE",M.MEMBER)||"''")+"."+F+"("+X+")",b.workspace.options.oneBasedIndex?[k+" + 1",M.ADDITION]:[k,M.FUNCTION_CALL]},Be=function(b,k){const F=b.getFieldValue("WHERE")||"FROM_START",X=k.valueToCode(b,"VALUE",F==="RANDOM"?M.NONE:M.MEMBER)||"''";switch(F){case"FIRST":return[X+".charAt(0)",M.FUNCTION_CALL];case"LAST":return[X+".slice(-1)",M.FUNCTION_CALL];case"FROM_START":return b=k.getAdjusted(b,"AT"),[X+".charAt("+b+")",M.FUNCTION_CALL];case"FROM_END":return b=k.getAdjusted(b,"AT",1,!0),[X+".slice("+b+").charAt(0)",M.FUNCTION_CALL];case"RANDOM":return[k.provideFunction_("textRandomLetter",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(text) {
  var x = Math.floor(Math.random() * text.length);
  return text[x];
}
`)+"("+X+")",M.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},Ye=function(b,k){var F={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const X=b.getFieldValue("WHERE1"),oe=b.getFieldValue("WHERE2");var Re=X!=="FROM_END"&&X!=="LAST"&&oe!=="FROM_END"&&oe!=="LAST",Pe=k.valueToCode(b,"STRING",Re?M.MEMBER:M.NONE)||"''";if(X==="FIRST"&&oe==="LAST")return[Pe,M.NONE];if(Pe.match(/^'?\w+'?$/)||Re){switch(X){case"FROM_START":F=k.getAdjusted(b,"AT1");break;case"FROM_END":F=k.getAdjusted(b,"AT1",1,!1,M.SUBTRACTION),F=Pe+".length - "+F;break;case"FIRST":F="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(oe){case"FROM_START":k=k.getAdjusted(b,"AT2",1);break;case"FROM_END":k=k.getAdjusted(b,"AT2",0,!1,M.SUBTRACTION),k=Pe+".length - "+k;break;case"LAST":k=Pe+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}Pe=Pe+".slice("+F+", "+k+")"}else Re=k.getAdjusted(b,"AT1"),b=k.getAdjusted(b,"AT2"),Pe=k.provideFunction_("subsequence"+F[X]+F[oe],`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(sequence${X==="FROM_END"||X==="FROM_START"?", at1":""}${oe==="FROM_END"||oe==="FROM_START"?", at2":""}) {
  var start = ${W("sequence",X,"at1")};
  var end = ${W("sequence",oe,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+Pe+(X==="FROM_END"||X==="FROM_START"?", "+Re:"")+(oe==="FROM_END"||oe==="FROM_START"?", "+b:"")+")";return[Pe,M.FUNCTION_CALL]},Ke=function(b,k){const F={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[b.getFieldValue("CASE")];return b=k.valueToCode(b,"TEXT",F?M.MEMBER:M.NONE)||"''",[F?b+F:k.provideFunction_("textToTitleCase",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(str) {
  return str.replace(/\\S+/g,
      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});
}
`)+"("+b+")",M.FUNCTION_CALL]},it=function(b,k){const F={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[b.getFieldValue("MODE")];return[(k.valueToCode(b,"TEXT",M.MEMBER)||"''")+F,M.FUNCTION_CALL]},Ue=function(b,k){return"window.alert("+(k.valueToCode(b,"TEXT",M.NONE)||"''")+`);
`},Et=function(b,k){return k="window.prompt("+(b.getField("TEXT")?k.quote_(b.getFieldValue("TEXT")):k.valueToCode(b,"TEXT",M.NONE)||"''")+")",b.getFieldValue("TYPE")==="NUMBER"&&(k="Number("+k+")"),[k,M.FUNCTION_CALL]},J=function(b,k){const F=k.valueToCode(b,"TEXT",M.NONE)||"''";return b=k.valueToCode(b,"SUB",M.NONE)||"''",[k.provideFunction_("textCount",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {
  if (needle.length === 0) {
    return haystack.length + 1;
  } else {
    return haystack.split(needle).length - 1;
  }
}
`)+"("+F+", "+b+")",M.FUNCTION_CALL]},$e=function(b,k){const F=k.valueToCode(b,"TEXT",M.NONE)||"''",X=k.valueToCode(b,"FROM",M.NONE)||"''";return b=k.valueToCode(b,"TO",M.NONE)||"''",[k.provideFunction_("textReplace",`
function ${k.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {
  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')
                 .replace(/\\x08/g, '\\\\x08');
  return haystack.replace(new RegExp(needle, 'g'), replacement);
}
`)+"("+F+", "+X+", "+b+")",M.FUNCTION_CALL]},Qe=function(b,k){return[(k.valueToCode(b,"TEXT",M.MEMBER)||"''")+".split('').reverse().join('')",M.FUNCTION_CALL]},ke=function(b,k){return[k.getVariableName(b.getFieldValue("VAR")),M.ATOMIC]},yt=function(b,k){const F=k.valueToCode(b,"VALUE",M.ASSIGNMENT)||"0";return k.getVariableName(b.getFieldValue("VAR"))+" = "+F+`;
`},M;(function(b){b[b.ATOMIC=0]="ATOMIC",b[b.NEW=1.1]="NEW",b[b.MEMBER=1.2]="MEMBER",b[b.FUNCTION_CALL=2]="FUNCTION_CALL",b[b.INCREMENT=3]="INCREMENT",b[b.DECREMENT=3]="DECREMENT",b[b.BITWISE_NOT=4.1]="BITWISE_NOT",b[b.UNARY_PLUS=4.2]="UNARY_PLUS",b[b.UNARY_NEGATION=4.3]="UNARY_NEGATION",b[b.LOGICAL_NOT=4.4]="LOGICAL_NOT",b[b.TYPEOF=4.5]="TYPEOF",b[b.VOID=4.6]="VOID",b[b.DELETE=4.7]="DELETE",b[b.AWAIT=4.8]="AWAIT",b[b.EXPONENTIATION=5]="EXPONENTIATION",b[b.MULTIPLICATION=5.1]="MULTIPLICATION",b[b.DIVISION=5.2]="DIVISION",b[b.MODULUS=5.3]="MODULUS",b[b.SUBTRACTION=6.1]="SUBTRACTION",b[b.ADDITION=6.2]="ADDITION",b[b.BITWISE_SHIFT=7]="BITWISE_SHIFT",b[b.RELATIONAL=8]="RELATIONAL",b[b.IN=8]="IN",b[b.INSTANCEOF=8]="INSTANCEOF",b[b.EQUALITY=9]="EQUALITY",b[b.BITWISE_AND=10]="BITWISE_AND",b[b.BITWISE_XOR=11]="BITWISE_XOR",b[b.BITWISE_OR=12]="BITWISE_OR",b[b.LOGICAL_AND=13]="LOGICAL_AND",b[b.LOGICAL_OR=14]="LOGICAL_OR",b[b.CONDITIONAL=15]="CONDITIONAL",b[b.ASSIGNMENT=16]="ASSIGNMENT",b[b.YIELD=17]="YIELD",b[b.COMMA=18]="COMMA",b[b.NONE=99]="NONE"})(M||(M={}));var st=class extends h.CodeGenerator$$module$build$src$core$generator{constructor(b="JavaScript"){super(b),this.ORDER_OVERRIDES=[[M.FUNCTION_CALL,M.MEMBER],[M.FUNCTION_CALL,M.FUNCTION_CALL],[M.MEMBER,M.MEMBER],[M.MEMBER,M.FUNCTION_CALL],[M.LOGICAL_NOT,M.LOGICAL_NOT],[M.MULTIPLICATION,M.MULTIPLICATION],[M.ADDITION,M.ADDITION],[M.LOGICAL_AND,M.LOGICAL_AND],[M.LOGICAL_OR,M.LOGICAL_OR]],this.isInitialized=!1;for(const k in M)b=M[k],typeof b!="string"&&(this["ORDER_"+k]=b);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(b){super.init(b),this.nameDB_?this.nameDB_.reset():this.nameDB_=new h.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(b.getVariableMap()),this.nameDB_.populateVariables(b),this.nameDB_.populateProcedures(b);const k=[];var F=h.allDeveloperVariables$$module$build$src$core$variables(b);for(let X=0;X<F.length;X++)k.push(this.nameDB_.getName(F[X],h.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(b=h.allUsedVarModels$$module$build$src$core$variables(b),F=0;F<b.length;F++)k.push(this.nameDB_.getName(b[F].getId(),h.NameType$$module$build$src$core$names.VARIABLE));k.length&&(this.definitions_.variables="var "+k.join(", ")+";"),this.isInitialized=!0}finish(b){const k=Object.values(this.definitions_);return super.finish(b),this.isInitialized=!1,this.nameDB_.reset(),k.join(`

`)+`


`+b}scrubNakedValue(b){return b+`;
`}quote_(b){return b=b.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`).replace(/'/g,"\\'"),"'"+b+"'"}multiline_quote_(b){return b.split(/\n/g).map(this.quote_).join(` + '\\n' +
`)}scrub_(b,k,F=!1){let X="";if(!b.outputConnection||!b.outputConnection.targetConnection){var oe=b.getCommentText();oe&&(oe=h.wrap$$module$build$src$core$utils$string(oe,this.COMMENT_WRAP-3),X+=this.prefixLines(oe+`
`,"// "));for(let Re=0;Re<b.inputList.length;Re++)b.inputList[Re].type===h.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(oe=b.inputList[Re].connection.targetBlock())&&(oe=this.allNestedComments(oe))&&(X+=this.prefixLines(oe,"// "))}return b=b.nextConnection&&b.nextConnection.targetBlock(),F=F?"":this.blockToCode(b),X+k+F}getAdjusted(b,k,F=0,X=!1,oe=M.NONE){b.workspace.options.oneBasedIndex&&F--;const Re=b.workspace.options.oneBasedIndex?"1":"0";let Pe=oe;return 0<F?Pe=M.ADDITION:0>F?Pe=M.SUBTRACTION:X&&(Pe=M.UNARY_NEGATION),b=this.valueToCode(b,k,Pe)||Re,F===0&&!X?b:h.isNumber$$module$build$src$core$utils$string(b)?(b=String(Number(b)+F),X&&(b=String(-Number(b))),b):(0<F?b=`${b} + ${F}`:0>F&&(b=`${b} - ${-F}`),X&&(b=F?`-(${b})`:`-${b}`),Math.floor(oe)>=Math.floor(Pe)&&(b=`(${b})`),b)}},gt=function(b,k,F){return k==="FIRST"?"0":k==="FROM_END"?b+".length - 1 - "+F:k==="LAST"?b+".length - 1":F},Je={};Je.lists_create_empty=p,Je.lists_create_with=g,Je.lists_getIndex=w,Je.lists_getSublist=N,Je.lists_indexOf=R,Je.lists_isEmpty=I,Je.lists_length=v,Je.lists_repeat=T,Je.lists_reverse=B,Je.lists_setIndex=C,Je.lists_sort=D,Je.lists_split=V;var ut={};ut.controls_if=ie,ut.controls_ifelse=ie,ut.logic_boolean=se,ut.logic_compare=ne,ut.logic_negate=z,ut.logic_null=re,ut.logic_operation=P,ut.logic_ternary=he;var dt={};dt.controls_flow_statements=Ve,dt.controls_for=ye,dt.controls_forEach=ge,dt.controls_repeat=q,dt.controls_repeat_ext=q,dt.controls_whileUntil=j;var Xe={};Xe.math_arithmetic=Tt,Xe.math_atan2=Ge,Xe.math_change=St,Xe.math_constant=mt,Xe.math_constrain=be,Xe.math_modulo=nt,Xe.math_number=de,Xe.math_number_property=Ce,Xe.math_on_list=_e,Xe.math_random_float=ot,Xe.math_random_int=Ie,Xe.math_round=ze,Xe.math_single=ze,Xe.math_trig=ze;var pt={};pt.procedures_callnoreturn=ve,pt.procedures_callreturn=Se,pt.procedures_defnoreturn=Fe,pt.procedures_defreturn=Fe,pt.procedures_ifreturn=We;var E=/^\s*'([^']|\\')*'\s*$/,A=function(b){return E.test(b)?[b,M.ATOMIC]:["String("+b+")",M.FUNCTION_CALL]},W=function(b,k,F){return k==="FIRST"?"0":k==="FROM_END"?b+".length - 1 - "+F:k==="LAST"?b+".length - 1":F},H={};H.text=je,H.text_append=ee,H.text_changeCase=Ke,H.text_charAt=Be,H.text_count=J,H.text_getSubstring=Ye,H.text_indexOf=Oe,H.text_isEmpty=Ee,H.text_join=le,H.text_length=me,H.text_print=Ue,H.text_prompt=Et,H.text_prompt_ext=Et,H.text_replace=$e,H.text_reverse=Qe,H.text_trim=it;var ae={};ae.variables_get=ke,ae.variables_set=yt;var xe={};xe.variables_get_dynamic=ke,xe.variables_set_dynamic=yt;var Ct=new st,Qt=Object.assign({},Je,ut,dt,Xe,pt,H,ae,xe);for(const b in Qt)Ct.forBlock[b]=Qt[b];var rt={};return rt.JavascriptGenerator=st,rt.Order=M,rt.javascriptGenerator=Ct,rt.__namespace__=h,rt})}(javascript_compressed$1)),javascript_compressed$1.exports}var javascript_compressedExports=requireJavascript_compressed();const javascript=getDefaultExportFromCjs(javascript_compressedExports),{JavascriptGenerator,Order,javascriptGenerator}=javascript;var enExports=requireEn();const en=getDefaultExportFromCjs(enExports),{LOGIC_HUE,LOOPS_HUE,MATH_HUE,TEXTS_HUE,LISTS_HUE,COLOUR_HUE,VARIABLES_HUE,VARIABLES_DYNAMIC_HUE,PROCEDURES_HUE,VARIABLES_DEFAULT_NAME,UNNAMED_KEY,TODAY,DUPLICATE_BLOCK,ADD_COMMENT,REMOVE_COMMENT,DUPLICATE_COMMENT,EXTERNAL_INPUTS,INLINE_INPUTS,DELETE_BLOCK,DELETE_X_BLOCKS,DELETE_ALL_BLOCKS,CLEAN_UP,COLLAPSE_BLOCK,COLLAPSE_ALL,EXPAND_BLOCK,EXPAND_ALL,DISABLE_BLOCK,ENABLE_BLOCK,HELP,UNDO,REDO,CHANGE_VALUE_TITLE,RENAME_VARIABLE,RENAME_VARIABLE_TITLE,NEW_VARIABLE,NEW_STRING_VARIABLE,NEW_NUMBER_VARIABLE,NEW_COLOUR_VARIABLE,NEW_VARIABLE_TYPE_TITLE,NEW_VARIABLE_TITLE,VARIABLE_ALREADY_EXISTS,VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER,DELETE_VARIABLE_CONFIRMATION,CANNOT_DELETE_VARIABLE_PROCEDURE,DELETE_VARIABLE,COLOUR_PICKER_HELPURL,COLOUR_PICKER_TOOLTIP,COLOUR_RANDOM_HELPURL,COLOUR_RANDOM_TITLE,COLOUR_RANDOM_TOOLTIP,COLOUR_RGB_HELPURL,COLOUR_RGB_TITLE,COLOUR_RGB_RED,COLOUR_RGB_GREEN,COLOUR_RGB_BLUE,COLOUR_RGB_TOOLTIP,COLOUR_BLEND_HELPURL,COLOUR_BLEND_TITLE,COLOUR_BLEND_COLOUR1,COLOUR_BLEND_COLOUR2,COLOUR_BLEND_RATIO,COLOUR_BLEND_TOOLTIP,CONTROLS_REPEAT_HELPURL,CONTROLS_REPEAT_TITLE,CONTROLS_REPEAT_INPUT_DO,CONTROLS_REPEAT_TOOLTIP,CONTROLS_WHILEUNTIL_HELPURL,CONTROLS_WHILEUNTIL_INPUT_DO,CONTROLS_WHILEUNTIL_OPERATOR_WHILE,CONTROLS_WHILEUNTIL_OPERATOR_UNTIL,CONTROLS_WHILEUNTIL_TOOLTIP_WHILE,CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL,CONTROLS_FOR_HELPURL,CONTROLS_FOR_TOOLTIP,CONTROLS_FOR_TITLE,CONTROLS_FOR_INPUT_DO,CONTROLS_FOREACH_HELPURL,CONTROLS_FOREACH_TITLE,CONTROLS_FOREACH_INPUT_DO,CONTROLS_FOREACH_TOOLTIP,CONTROLS_FLOW_STATEMENTS_HELPURL,CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK,CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE,CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK,CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE,CONTROLS_FLOW_STATEMENTS_WARNING,CONTROLS_IF_HELPURL,CONTROLS_IF_TOOLTIP_1,CONTROLS_IF_TOOLTIP_2,CONTROLS_IF_TOOLTIP_3,CONTROLS_IF_TOOLTIP_4,CONTROLS_IF_MSG_IF,CONTROLS_IF_MSG_ELSEIF,CONTROLS_IF_MSG_ELSE,CONTROLS_IF_MSG_THEN,CONTROLS_IF_IF_TITLE_IF,CONTROLS_IF_IF_TOOLTIP,CONTROLS_IF_ELSEIF_TITLE_ELSEIF,CONTROLS_IF_ELSEIF_TOOLTIP,CONTROLS_IF_ELSE_TITLE_ELSE,CONTROLS_IF_ELSE_TOOLTIP,LOGIC_COMPARE_HELPURL,LOGIC_COMPARE_TOOLTIP_EQ,LOGIC_COMPARE_TOOLTIP_NEQ,LOGIC_COMPARE_TOOLTIP_LT,LOGIC_COMPARE_TOOLTIP_LTE,LOGIC_COMPARE_TOOLTIP_GT,LOGIC_COMPARE_TOOLTIP_GTE,LOGIC_OPERATION_HELPURL,LOGIC_OPERATION_TOOLTIP_AND,LOGIC_OPERATION_AND,LOGIC_OPERATION_TOOLTIP_OR,LOGIC_OPERATION_OR,LOGIC_NEGATE_HELPURL,LOGIC_NEGATE_TITLE,LOGIC_NEGATE_TOOLTIP,LOGIC_BOOLEAN_HELPURL,LOGIC_BOOLEAN_TRUE,LOGIC_BOOLEAN_FALSE,LOGIC_BOOLEAN_TOOLTIP,LOGIC_NULL_HELPURL,LOGIC_NULL,LOGIC_NULL_TOOLTIP,LOGIC_TERNARY_HELPURL,LOGIC_TERNARY_CONDITION,LOGIC_TERNARY_IF_TRUE,LOGIC_TERNARY_IF_FALSE,LOGIC_TERNARY_TOOLTIP,MATH_NUMBER_HELPURL,MATH_NUMBER_TOOLTIP,MATH_ADDITION_SYMBOL,MATH_SUBTRACTION_SYMBOL,MATH_DIVISION_SYMBOL,MATH_MULTIPLICATION_SYMBOL,MATH_POWER_SYMBOL,MATH_TRIG_SIN,MATH_TRIG_COS,MATH_TRIG_TAN,MATH_TRIG_ASIN,MATH_TRIG_ACOS,MATH_TRIG_ATAN,MATH_ARITHMETIC_HELPURL,MATH_ARITHMETIC_TOOLTIP_ADD,MATH_ARITHMETIC_TOOLTIP_MINUS,MATH_ARITHMETIC_TOOLTIP_MULTIPLY,MATH_ARITHMETIC_TOOLTIP_DIVIDE,MATH_ARITHMETIC_TOOLTIP_POWER,MATH_SINGLE_HELPURL,MATH_SINGLE_OP_ROOT,MATH_SINGLE_TOOLTIP_ROOT,MATH_SINGLE_OP_ABSOLUTE,MATH_SINGLE_TOOLTIP_ABS,MATH_SINGLE_TOOLTIP_NEG,MATH_SINGLE_TOOLTIP_LN,MATH_SINGLE_TOOLTIP_LOG10,MATH_SINGLE_TOOLTIP_EXP,MATH_SINGLE_TOOLTIP_POW10,MATH_TRIG_HELPURL,MATH_TRIG_TOOLTIP_SIN,MATH_TRIG_TOOLTIP_COS,MATH_TRIG_TOOLTIP_TAN,MATH_TRIG_TOOLTIP_ASIN,MATH_TRIG_TOOLTIP_ACOS,MATH_TRIG_TOOLTIP_ATAN,MATH_CONSTANT_HELPURL,MATH_CONSTANT_TOOLTIP,MATH_IS_EVEN,MATH_IS_ODD,MATH_IS_PRIME,MATH_IS_WHOLE,MATH_IS_POSITIVE,MATH_IS_NEGATIVE,MATH_IS_DIVISIBLE_BY,MATH_IS_TOOLTIP,MATH_CHANGE_HELPURL,MATH_CHANGE_TITLE,MATH_CHANGE_TITLE_ITEM,MATH_CHANGE_TOOLTIP,MATH_ROUND_HELPURL,MATH_ROUND_TOOLTIP,MATH_ROUND_OPERATOR_ROUND,MATH_ROUND_OPERATOR_ROUNDUP,MATH_ROUND_OPERATOR_ROUNDDOWN,MATH_ONLIST_HELPURL,MATH_ONLIST_OPERATOR_SUM,MATH_ONLIST_TOOLTIP_SUM,MATH_ONLIST_OPERATOR_MIN,MATH_ONLIST_TOOLTIP_MIN,MATH_ONLIST_OPERATOR_MAX,MATH_ONLIST_TOOLTIP_MAX,MATH_ONLIST_OPERATOR_AVERAGE,MATH_ONLIST_TOOLTIP_AVERAGE,MATH_ONLIST_OPERATOR_MEDIAN,MATH_ONLIST_TOOLTIP_MEDIAN,MATH_ONLIST_OPERATOR_MODE,MATH_ONLIST_TOOLTIP_MODE,MATH_ONLIST_OPERATOR_STD_DEV,MATH_ONLIST_TOOLTIP_STD_DEV,MATH_ONLIST_OPERATOR_RANDOM,MATH_ONLIST_TOOLTIP_RANDOM,MATH_MODULO_HELPURL,MATH_MODULO_TITLE,MATH_MODULO_TOOLTIP,MATH_CONSTRAIN_HELPURL,MATH_CONSTRAIN_TITLE,MATH_CONSTRAIN_TOOLTIP,MATH_RANDOM_INT_HELPURL,MATH_RANDOM_INT_TITLE,MATH_RANDOM_INT_TOOLTIP,MATH_RANDOM_FLOAT_HELPURL,MATH_RANDOM_FLOAT_TITLE_RANDOM,MATH_RANDOM_FLOAT_TOOLTIP,MATH_ATAN2_HELPURL,MATH_ATAN2_TITLE,MATH_ATAN2_TOOLTIP,TEXT_TEXT_HELPURL,TEXT_TEXT_TOOLTIP,TEXT_JOIN_HELPURL,TEXT_JOIN_TITLE_CREATEWITH,TEXT_JOIN_TOOLTIP,TEXT_CREATE_JOIN_TITLE_JOIN,TEXT_CREATE_JOIN_TOOLTIP,TEXT_CREATE_JOIN_ITEM_TITLE_ITEM,TEXT_CREATE_JOIN_ITEM_TOOLTIP,TEXT_APPEND_HELPURL,TEXT_APPEND_TITLE,TEXT_APPEND_VARIABLE,TEXT_APPEND_TOOLTIP,TEXT_LENGTH_HELPURL,TEXT_LENGTH_TITLE,TEXT_LENGTH_TOOLTIP,TEXT_ISEMPTY_HELPURL,TEXT_ISEMPTY_TITLE,TEXT_ISEMPTY_TOOLTIP,TEXT_INDEXOF_HELPURL,TEXT_INDEXOF_TOOLTIP,TEXT_INDEXOF_TITLE,TEXT_INDEXOF_OPERATOR_FIRST,TEXT_INDEXOF_OPERATOR_LAST,TEXT_CHARAT_HELPURL,TEXT_CHARAT_TITLE,TEXT_CHARAT_FROM_START,TEXT_CHARAT_FROM_END,TEXT_CHARAT_FIRST,TEXT_CHARAT_LAST,TEXT_CHARAT_RANDOM,TEXT_CHARAT_TAIL,TEXT_CHARAT_TOOLTIP,TEXT_GET_SUBSTRING_TOOLTIP,TEXT_GET_SUBSTRING_HELPURL,TEXT_GET_SUBSTRING_INPUT_IN_TEXT,TEXT_GET_SUBSTRING_START_FROM_START,TEXT_GET_SUBSTRING_START_FROM_END,TEXT_GET_SUBSTRING_START_FIRST,TEXT_GET_SUBSTRING_END_FROM_START,TEXT_GET_SUBSTRING_END_FROM_END,TEXT_GET_SUBSTRING_END_LAST,TEXT_GET_SUBSTRING_TAIL,TEXT_CHANGECASE_HELPURL,TEXT_CHANGECASE_TOOLTIP,TEXT_CHANGECASE_OPERATOR_UPPERCASE,TEXT_CHANGECASE_OPERATOR_LOWERCASE,TEXT_CHANGECASE_OPERATOR_TITLECASE,TEXT_TRIM_HELPURL,TEXT_TRIM_TOOLTIP,TEXT_TRIM_OPERATOR_BOTH,TEXT_TRIM_OPERATOR_LEFT,TEXT_TRIM_OPERATOR_RIGHT,TEXT_PRINT_HELPURL,TEXT_PRINT_TITLE,TEXT_PRINT_TOOLTIP,TEXT_PROMPT_HELPURL,TEXT_PROMPT_TYPE_TEXT,TEXT_PROMPT_TYPE_NUMBER,TEXT_PROMPT_TOOLTIP_NUMBER,TEXT_PROMPT_TOOLTIP_TEXT,TEXT_COUNT_MESSAGE0,TEXT_COUNT_HELPURL,TEXT_COUNT_TOOLTIP,TEXT_REPLACE_MESSAGE0,TEXT_REPLACE_HELPURL,TEXT_REPLACE_TOOLTIP,TEXT_REVERSE_MESSAGE0,TEXT_REVERSE_HELPURL,TEXT_REVERSE_TOOLTIP,LISTS_CREATE_EMPTY_HELPURL,LISTS_CREATE_EMPTY_TITLE,LISTS_CREATE_EMPTY_TOOLTIP,LISTS_CREATE_WITH_HELPURL,LISTS_CREATE_WITH_TOOLTIP,LISTS_CREATE_WITH_INPUT_WITH,LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,LISTS_CREATE_WITH_CONTAINER_TOOLTIP,LISTS_CREATE_WITH_ITEM_TITLE,LISTS_CREATE_WITH_ITEM_TOOLTIP,LISTS_REPEAT_HELPURL,LISTS_REPEAT_TOOLTIP,LISTS_REPEAT_TITLE,LISTS_LENGTH_HELPURL,LISTS_LENGTH_TITLE,LISTS_LENGTH_TOOLTIP,LISTS_ISEMPTY_HELPURL,LISTS_ISEMPTY_TITLE,LISTS_ISEMPTY_TOOLTIP,LISTS_INLIST,LISTS_INDEX_OF_HELPURL,LISTS_INDEX_OF_INPUT_IN_LIST,LISTS_INDEX_OF_FIRST,LISTS_INDEX_OF_LAST,LISTS_INDEX_OF_TOOLTIP,LISTS_GET_INDEX_HELPURL,LISTS_GET_INDEX_GET,LISTS_GET_INDEX_GET_REMOVE,LISTS_GET_INDEX_REMOVE,LISTS_GET_INDEX_FROM_START,LISTS_GET_INDEX_FROM_END,LISTS_GET_INDEX_FIRST,LISTS_GET_INDEX_LAST,LISTS_GET_INDEX_RANDOM,LISTS_GET_INDEX_TAIL,LISTS_GET_INDEX_INPUT_IN_LIST,LISTS_INDEX_FROM_START_TOOLTIP,LISTS_INDEX_FROM_END_TOOLTIP,LISTS_GET_INDEX_TOOLTIP_GET_FROM,LISTS_GET_INDEX_TOOLTIP_GET_FIRST,LISTS_GET_INDEX_TOOLTIP_GET_LAST,LISTS_GET_INDEX_TOOLTIP_GET_RANDOM,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM,LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM,LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST,LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST,LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM,LISTS_SET_INDEX_HELPURL,LISTS_SET_INDEX_INPUT_IN_LIST,LISTS_SET_INDEX_SET,LISTS_SET_INDEX_INSERT,LISTS_SET_INDEX_INPUT_TO,LISTS_SET_INDEX_TOOLTIP_SET_FROM,LISTS_SET_INDEX_TOOLTIP_SET_FIRST,LISTS_SET_INDEX_TOOLTIP_SET_LAST,LISTS_SET_INDEX_TOOLTIP_SET_RANDOM,LISTS_SET_INDEX_TOOLTIP_INSERT_FROM,LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST,LISTS_SET_INDEX_TOOLTIP_INSERT_LAST,LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM,LISTS_GET_SUBLIST_HELPURL,LISTS_GET_SUBLIST_INPUT_IN_LIST,LISTS_GET_SUBLIST_START_FROM_START,LISTS_GET_SUBLIST_START_FROM_END,LISTS_GET_SUBLIST_START_FIRST,LISTS_GET_SUBLIST_END_FROM_START,LISTS_GET_SUBLIST_END_FROM_END,LISTS_GET_SUBLIST_END_LAST,LISTS_GET_SUBLIST_TAIL,LISTS_GET_SUBLIST_TOOLTIP,LISTS_SORT_HELPURL,LISTS_SORT_TITLE,LISTS_SORT_TOOLTIP,LISTS_SORT_ORDER_ASCENDING,LISTS_SORT_ORDER_DESCENDING,LISTS_SORT_TYPE_NUMERIC,LISTS_SORT_TYPE_TEXT,LISTS_SORT_TYPE_IGNORECASE,LISTS_SPLIT_HELPURL,LISTS_SPLIT_LIST_FROM_TEXT,LISTS_SPLIT_TEXT_FROM_LIST,LISTS_SPLIT_WITH_DELIMITER,LISTS_SPLIT_TOOLTIP_SPLIT,LISTS_SPLIT_TOOLTIP_JOIN,LISTS_REVERSE_HELPURL,LISTS_REVERSE_MESSAGE0,LISTS_REVERSE_TOOLTIP,ORDINAL_NUMBER_SUFFIX,VARIABLES_GET_HELPURL,VARIABLES_GET_TOOLTIP,VARIABLES_GET_CREATE_SET,VARIABLES_SET_HELPURL,VARIABLES_SET,VARIABLES_SET_TOOLTIP,VARIABLES_SET_CREATE_GET,PROCEDURES_DEFNORETURN_HELPURL,PROCEDURES_DEFNORETURN_TITLE,PROCEDURES_DEFNORETURN_PROCEDURE,PROCEDURES_BEFORE_PARAMS,PROCEDURES_CALL_BEFORE_PARAMS,PROCEDURES_CALL_DISABLED_DEF_WARNING,PROCEDURES_DEFNORETURN_DO,PROCEDURES_DEFNORETURN_TOOLTIP,PROCEDURES_DEFNORETURN_COMMENT,PROCEDURES_DEFRETURN_HELPURL,PROCEDURES_DEFRETURN_TITLE,PROCEDURES_DEFRETURN_PROCEDURE,PROCEDURES_DEFRETURN_DO,PROCEDURES_DEFRETURN_COMMENT,PROCEDURES_DEFRETURN_RETURN,PROCEDURES_DEFRETURN_TOOLTIP,PROCEDURES_ALLOW_STATEMENTS,PROCEDURES_DEF_DUPLICATE_WARNING,PROCEDURES_CALLNORETURN_HELPURL,PROCEDURES_CALLNORETURN_TOOLTIP,PROCEDURES_CALLRETURN_HELPURL,PROCEDURES_CALLRETURN_TOOLTIP,PROCEDURES_MUTATORCONTAINER_TITLE,PROCEDURES_MUTATORCONTAINER_TOOLTIP,PROCEDURES_MUTATORARG_TITLE,PROCEDURES_MUTATORARG_TOOLTIP,PROCEDURES_HIGHLIGHT_DEF,PROCEDURES_CREATE_DO,PROCEDURES_IFRETURN_TOOLTIP,PROCEDURES_IFRETURN_HELPURL,PROCEDURES_IFRETURN_WARNING,WORKSPACE_COMMENT_DEFAULT_TEXT,WORKSPACE_ARIA_LABEL,COLLAPSED_WARNINGS_WARNING,DIALOG_OK,DIALOG_CANCEL}=en;var blockly_compressedExports=requireBlockly_compressed();const Blockly=getDefaultExportFromCjs(blockly_compressedExports),{ASTNode,BasicCursor,Block,BlockSvg,Blocks,COLLAPSED_FIELD_NAME,COLLAPSED_INPUT_NAME,COLLAPSE_CHARS,CodeGenerator,CollapsibleToolboxCategory,ComponentManager,Connection,ConnectionChecker,ConnectionDB,ConnectionType,ContextMenu,ContextMenuItems,ContextMenuRegistry,Css,Cursor,DELETE_VARIABLE_ID,DeleteArea,DragTarget,DropDownDiv,Events,Extensions,Field,FieldCheckbox,FieldDropdown,FieldImage,FieldLabel,FieldLabelSerializable,FieldNumber,FieldTextInput,FieldVariable,Flyout,FlyoutButton,FlyoutMetricsManager,Generator,Gesture,Grid,HorizontalFlyout,INPUT_VALUE,Input,InsertionMarkerManager,InsertionMarkerPreviewer,Marker,MarkerManager,Menu,MenuItem,MetricsManager,Msg,NEXT_STATEMENT,Names,OPPOSITE_TYPE,OUTPUT_VALUE,Options,PREVIOUS_STATEMENT,PROCEDURE_CATEGORY_NAME,Procedures,RENAME_VARIABLE_ID,RenderedConnection,Scrollbar,ScrollbarPair,ShortcutItems,ShortcutRegistry,TOOLBOX_AT_BOTTOM,TOOLBOX_AT_LEFT,TOOLBOX_AT_RIGHT,TOOLBOX_AT_TOP,TabNavigateCursor,Theme:Theme$1,ThemeManager,Themes,Toolbox,ToolboxCategory,ToolboxItem,ToolboxSeparator,Tooltip,Touch,Trashcan,UnattachedFieldError,VARIABLE_CATEGORY_NAME,VARIABLE_DYNAMIC_CATEGORY_NAME,VERSION,VariableMap,VariableModel,Variables,VariablesDynamic,VerticalFlyout,WidgetDiv,Workspace,WorkspaceAudio,WorkspaceDragger,WorkspaceSvg,Xml,ZoomControls,blockAnimations,blockRendering,browserEvents,bubbles,bumpObjects,clipboard,comments,common:common$1,config,constants,defineBlocksWithJsonArray,dialog,dragging,fieldRegistry,geras,getMainWorkspace,getSelected,hasBubble,hideChaff,icons,inject,inputs,isCopyable,isDeletable,isDraggable,isIcon,isObservable,isPaster,isRenderedElement,isSelectable,isSerializable,isVariableBackedParameterModel,procedures,registry,renderManagement,serialization,setLocale,setParentContainer,svgResize,thrasos,uiPosition,utils,zelos}=Blockly;/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Theme=Theme$1.defineTheme("dark",{base:Themes.Classic,componentStyles:{workspaceBackgroundColour:"#1e1e1e",toolboxBackgroundColour:"blackBackground",toolboxForegroundColour:"#fff",flyoutBackgroundColour:"#252526",flyoutForegroundColour:"#ccc",flyoutOpacity:1,scrollbarColour:"#797979",insertionMarkerColour:"#fff",insertionMarkerOpacity:.3,scrollbarOpacity:.4,cursorColour:"#d0d0d0",blackBackground:"#333"}});/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function isNothing(n){return typeof n>"u"||n===null}function isObject(n){return typeof n=="object"&&n!==null}function toArray(n){return Array.isArray(n)?n:isNothing(n)?[]:[n]}function extend(n,c){var l,h,p,g;if(c)for(g=Object.keys(c),l=0,h=g.length;l<h;l+=1)p=g[l],n[p]=c[p];return n}function repeat(n,c){var l="",h;for(h=0;h<c;h+=1)l+=n;return l}function isNegativeZero(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}var isNothing_1=isNothing,isObject_1=isObject,toArray_1=toArray,repeat_1=repeat,isNegativeZero_1=isNegativeZero,extend_1=extend,common={isNothing:isNothing_1,isObject:isObject_1,toArray:toArray_1,repeat:repeat_1,isNegativeZero:isNegativeZero_1,extend:extend_1};function formatError(n,c){var l="",h=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(l+='in "'+n.mark.name+'" '),l+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!c&&n.mark.snippet&&(l+=`

`+n.mark.snippet),h+" "+l):h}function YAMLException$1(n,c){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=c,this.message=formatError(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}YAMLException$1.prototype=Object.create(Error.prototype);YAMLException$1.prototype.constructor=YAMLException$1;YAMLException$1.prototype.toString=function n(c){return this.name+": "+formatError(this,c)};var exception=YAMLException$1;function getLine(n,c,l,h,p){var g="",T="",v=Math.floor(p/2)-1;return h-c>v&&(g=" ... ",c=h-v+g.length),l-h>v&&(T=" ...",l=h+v-T.length),{str:g+n.slice(c,l).replace(/\t/g,"→")+T,pos:h-c+g.length}}function padStart(n,c){return common.repeat(" ",c-n.length)+n}function makeSnippet(n,c){if(c=Object.create(c||null),!n.buffer)return null;c.maxLength||(c.maxLength=79),typeof c.indent!="number"&&(c.indent=1),typeof c.linesBefore!="number"&&(c.linesBefore=3),typeof c.linesAfter!="number"&&(c.linesAfter=2);for(var l=/\r?\n|\r|\0/g,h=[0],p=[],g,T=-1;g=l.exec(n.buffer);)p.push(g.index),h.push(g.index+g[0].length),n.position<=g.index&&T<0&&(T=h.length-2);T<0&&(T=h.length-1);var v="",I,R,w=Math.min(n.line+c.linesAfter,p.length).toString().length,C=c.maxLength-(c.indent+w+3);for(I=1;I<=c.linesBefore&&!(T-I<0);I++)R=getLine(n.buffer,h[T-I],p[T-I],n.position-(h[T]-h[T-I]),C),v=common.repeat(" ",c.indent)+padStart((n.line-I+1).toString(),w)+" | "+R.str+`
`+v;for(R=getLine(n.buffer,h[T],p[T],n.position,C),v+=common.repeat(" ",c.indent)+padStart((n.line+1).toString(),w)+" | "+R.str+`
`,v+=common.repeat("-",c.indent+w+3+R.pos)+`^
`,I=1;I<=c.linesAfter&&!(T+I>=p.length);I++)R=getLine(n.buffer,h[T+I],p[T+I],n.position-(h[T]-h[T+I]),C),v+=common.repeat(" ",c.indent)+padStart((n.line+I+1).toString(),w)+" | "+R.str+`
`;return v.replace(/\n$/,"")}var snippet=makeSnippet,TYPE_CONSTRUCTOR_OPTIONS=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(n){var c={};return n!==null&&Object.keys(n).forEach(function(l){n[l].forEach(function(h){c[String(h)]=l})}),c}function Type$1(n,c){if(c=c||{},Object.keys(c).forEach(function(l){if(TYPE_CONSTRUCTOR_OPTIONS.indexOf(l)===-1)throw new exception('Unknown option "'+l+'" is met in definition of "'+n+'" YAML type.')}),this.options=c,this.tag=n,this.kind=c.kind||null,this.resolve=c.resolve||function(){return!0},this.construct=c.construct||function(l){return l},this.instanceOf=c.instanceOf||null,this.predicate=c.predicate||null,this.represent=c.represent||null,this.representName=c.representName||null,this.defaultStyle=c.defaultStyle||null,this.multi=c.multi||!1,this.styleAliases=compileStyleAliases(c.styleAliases||null),YAML_NODE_KINDS.indexOf(this.kind)===-1)throw new exception('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}var type=Type$1;function compileList(n,c){var l=[];return n[c].forEach(function(h){var p=l.length;l.forEach(function(g,T){g.tag===h.tag&&g.kind===h.kind&&g.multi===h.multi&&(p=T)}),l[p]=h}),l}function compileMap(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},c,l;function h(p){p.multi?(n.multi[p.kind].push(p),n.multi.fallback.push(p)):n[p.kind][p.tag]=n.fallback[p.tag]=p}for(c=0,l=arguments.length;c<l;c+=1)arguments[c].forEach(h);return n}function Schema$1(n){return this.extend(n)}Schema$1.prototype.extend=function n(c){var l=[],h=[];if(c instanceof type)h.push(c);else if(Array.isArray(c))h=h.concat(c);else if(c&&(Array.isArray(c.implicit)||Array.isArray(c.explicit)))c.implicit&&(l=l.concat(c.implicit)),c.explicit&&(h=h.concat(c.explicit));else throw new exception("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");l.forEach(function(g){if(!(g instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(g.loadKind&&g.loadKind!=="scalar")throw new exception("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(g.multi)throw new exception("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),h.forEach(function(g){if(!(g instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var p=Object.create(Schema$1.prototype);return p.implicit=(this.implicit||[]).concat(l),p.explicit=(this.explicit||[]).concat(h),p.compiledImplicit=compileList(p,"implicit"),p.compiledExplicit=compileList(p,"explicit"),p.compiledTypeMap=compileMap(p.compiledImplicit,p.compiledExplicit),p};var schema=Schema$1,str=new type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(n){return n!==null?n:""}}),seq=new type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(n){return n!==null?n:[]}}),map=new type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(n){return n!==null?n:{}}}),failsafe=new schema({explicit:[str,seq,map]});function resolveYamlNull(n){if(n===null)return!0;var c=n.length;return c===1&&n==="~"||c===4&&(n==="null"||n==="Null"||n==="NULL")}function constructYamlNull(){return null}function isNull(n){return n===null}var _null=new type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function resolveYamlBoolean(n){if(n===null)return!1;var c=n.length;return c===4&&(n==="true"||n==="True"||n==="TRUE")||c===5&&(n==="false"||n==="False"||n==="FALSE")}function constructYamlBoolean(n){return n==="true"||n==="True"||n==="TRUE"}function isBoolean(n){return Object.prototype.toString.call(n)==="[object Boolean]"}var bool=new type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(n){return n?"true":"false"},uppercase:function(n){return n?"TRUE":"FALSE"},camelcase:function(n){return n?"True":"False"}},defaultStyle:"lowercase"});function isHexCode(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}function isOctCode(n){return 48<=n&&n<=55}function isDecCode(n){return 48<=n&&n<=57}function resolveYamlInteger(n){if(n===null)return!1;var c=n.length,l=0,h=!1,p;if(!c)return!1;if(p=n[l],(p==="-"||p==="+")&&(p=n[++l]),p==="0"){if(l+1===c)return!0;if(p=n[++l],p==="b"){for(l++;l<c;l++)if(p=n[l],p!=="_"){if(p!=="0"&&p!=="1")return!1;h=!0}return h&&p!=="_"}if(p==="x"){for(l++;l<c;l++)if(p=n[l],p!=="_"){if(!isHexCode(n.charCodeAt(l)))return!1;h=!0}return h&&p!=="_"}if(p==="o"){for(l++;l<c;l++)if(p=n[l],p!=="_"){if(!isOctCode(n.charCodeAt(l)))return!1;h=!0}return h&&p!=="_"}}if(p==="_")return!1;for(;l<c;l++)if(p=n[l],p!=="_"){if(!isDecCode(n.charCodeAt(l)))return!1;h=!0}return!(!h||p==="_")}function constructYamlInteger(n){var c=n,l=1,h;if(c.indexOf("_")!==-1&&(c=c.replace(/_/g,"")),h=c[0],(h==="-"||h==="+")&&(h==="-"&&(l=-1),c=c.slice(1),h=c[0]),c==="0")return 0;if(h==="0"){if(c[1]==="b")return l*parseInt(c.slice(2),2);if(c[1]==="x")return l*parseInt(c.slice(2),16);if(c[1]==="o")return l*parseInt(c.slice(2),8)}return l*parseInt(c,10)}function isInteger(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!common.isNegativeZero(n)}var int=new type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},octal:function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},decimal:function(n){return n.toString(10)},hexadecimal:function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(n){return!(n===null||!YAML_FLOAT_PATTERN.test(n)||n[n.length-1]==="_")}function constructYamlFloat(n){var c,l;return c=n.replace(/_/g,"").toLowerCase(),l=c[0]==="-"?-1:1,"+-".indexOf(c[0])>=0&&(c=c.slice(1)),c===".inf"?l===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:c===".nan"?NaN:l*parseFloat(c,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(n,c){var l;if(isNaN(n))switch(c){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(c){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(c){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(n))return"-0.0";return l=n.toString(10),SCIENTIFIC_WITHOUT_DOT.test(l)?l.replace("e",".e"):l}function isFloat(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||common.isNegativeZero(n))}var float=new type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),json=failsafe.extend({implicit:[_null,bool,int,float]}),core=json,YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(n){return n===null?!1:YAML_DATE_REGEXP.exec(n)!==null||YAML_TIMESTAMP_REGEXP.exec(n)!==null}function constructYamlTimestamp(n){var c,l,h,p,g,T,v,I=0,R=null,w,C,N;if(c=YAML_DATE_REGEXP.exec(n),c===null&&(c=YAML_TIMESTAMP_REGEXP.exec(n)),c===null)throw new Error("Date resolve error");if(l=+c[1],h=+c[2]-1,p=+c[3],!c[4])return new Date(Date.UTC(l,h,p));if(g=+c[4],T=+c[5],v=+c[6],c[7]){for(I=c[7].slice(0,3);I.length<3;)I+="0";I=+I}return c[9]&&(w=+c[10],C=+(c[11]||0),R=(w*60+C)*6e4,c[9]==="-"&&(R=-R)),N=new Date(Date.UTC(l,h,p,g,T,v,I)),R&&N.setTime(N.getTime()-R),N}function representYamlTimestamp(n){return n.toISOString()}var timestamp=new type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp});function resolveYamlMerge(n){return n==="<<"||n===null}var merge=new type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge}),BASE64_MAP=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function resolveYamlBinary(n){if(n===null)return!1;var c,l,h=0,p=n.length,g=BASE64_MAP;for(l=0;l<p;l++)if(c=g.indexOf(n.charAt(l)),!(c>64)){if(c<0)return!1;h+=6}return h%8===0}function constructYamlBinary(n){var c,l,h=n.replace(/[\r\n=]/g,""),p=h.length,g=BASE64_MAP,T=0,v=[];for(c=0;c<p;c++)c%4===0&&c&&(v.push(T>>16&255),v.push(T>>8&255),v.push(T&255)),T=T<<6|g.indexOf(h.charAt(c));return l=p%4*6,l===0?(v.push(T>>16&255),v.push(T>>8&255),v.push(T&255)):l===18?(v.push(T>>10&255),v.push(T>>2&255)):l===12&&v.push(T>>4&255),new Uint8Array(v)}function representYamlBinary(n){var c="",l=0,h,p,g=n.length,T=BASE64_MAP;for(h=0;h<g;h++)h%3===0&&h&&(c+=T[l>>18&63],c+=T[l>>12&63],c+=T[l>>6&63],c+=T[l&63]),l=(l<<8)+n[h];return p=g%3,p===0?(c+=T[l>>18&63],c+=T[l>>12&63],c+=T[l>>6&63],c+=T[l&63]):p===2?(c+=T[l>>10&63],c+=T[l>>4&63],c+=T[l<<2&63],c+=T[64]):p===1&&(c+=T[l>>2&63],c+=T[l<<4&63],c+=T[64],c+=T[64]),c}function isBinary(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}var binary=new type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),_hasOwnProperty$3=Object.prototype.hasOwnProperty,_toString$2=Object.prototype.toString;function resolveYamlOmap(n){if(n===null)return!0;var c=[],l,h,p,g,T,v=n;for(l=0,h=v.length;l<h;l+=1){if(p=v[l],T=!1,_toString$2.call(p)!=="[object Object]")return!1;for(g in p)if(_hasOwnProperty$3.call(p,g))if(!T)T=!0;else return!1;if(!T)return!1;if(c.indexOf(g)===-1)c.push(g);else return!1}return!0}function constructYamlOmap(n){return n!==null?n:[]}var omap=new type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),_toString$1=Object.prototype.toString;function resolveYamlPairs(n){if(n===null)return!0;var c,l,h,p,g,T=n;for(g=new Array(T.length),c=0,l=T.length;c<l;c+=1){if(h=T[c],_toString$1.call(h)!=="[object Object]"||(p=Object.keys(h),p.length!==1))return!1;g[c]=[p[0],h[p[0]]]}return!0}function constructYamlPairs(n){if(n===null)return[];var c,l,h,p,g,T=n;for(g=new Array(T.length),c=0,l=T.length;c<l;c+=1)h=T[c],p=Object.keys(h),g[c]=[p[0],h[p[0]]];return g}var pairs=new type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),_hasOwnProperty$2=Object.prototype.hasOwnProperty;function resolveYamlSet(n){if(n===null)return!0;var c,l=n;for(c in l)if(_hasOwnProperty$2.call(l,c)&&l[c]!==null)return!1;return!0}function constructYamlSet(n){return n!==null?n:{}}var set=new type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet}),_default=core.extend({implicit:[timestamp,merge],explicit:[binary,omap,pairs,set]}),_hasOwnProperty$1=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function _class(n){return Object.prototype.toString.call(n)}function is_EOL(n){return n===10||n===13}function is_WHITE_SPACE(n){return n===9||n===32}function is_WS_OR_EOL(n){return n===9||n===32||n===10||n===13}function is_FLOW_INDICATOR(n){return n===44||n===91||n===93||n===123||n===125}function fromHexCode(n){var c;return 48<=n&&n<=57?n-48:(c=n|32,97<=c&&c<=102?c-97+10:-1)}function escapedHexLen(n){return n===120?2:n===117?4:n===85?8:0}function fromDecimalCode(n){return 48<=n&&n<=57?n-48:-1}function simpleEscapeSequence(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"":n===95?" ":n===76?"\u2028":n===80?"\u2029":""}function charFromCodepoint(n){return n<=65535?String.fromCharCode(n):String.fromCharCode((n-65536>>10)+55296,(n-65536&1023)+56320)}var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256);for(var i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);function State$1(n,c){this.input=n,this.filename=c.filename||null,this.schema=c.schema||_default,this.onWarning=c.onWarning||null,this.legacy=c.legacy||!1,this.json=c.json||!1,this.listener=c.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function generateError(n,c){var l={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return l.snippet=snippet(l),new exception(c,l)}function throwError(n,c){throw generateError(n,c)}function throwWarning(n,c){n.onWarning&&n.onWarning.call(null,generateError(n,c))}var directiveHandlers={YAML:function n(c,l,h){var p,g,T;c.version!==null&&throwError(c,"duplication of %YAML directive"),h.length!==1&&throwError(c,"YAML directive accepts exactly one argument"),p=/^([0-9]+)\.([0-9]+)$/.exec(h[0]),p===null&&throwError(c,"ill-formed argument of the YAML directive"),g=parseInt(p[1],10),T=parseInt(p[2],10),g!==1&&throwError(c,"unacceptable YAML version of the document"),c.version=h[0],c.checkLineBreaks=T<2,T!==1&&T!==2&&throwWarning(c,"unsupported YAML version of the document")},TAG:function n(c,l,h){var p,g;h.length!==2&&throwError(c,"TAG directive accepts exactly two arguments"),p=h[0],g=h[1],PATTERN_TAG_HANDLE.test(p)||throwError(c,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty$1.call(c.tagMap,p)&&throwError(c,'there is a previously declared suffix for "'+p+'" tag handle'),PATTERN_TAG_URI.test(g)||throwError(c,"ill-formed tag prefix (second argument) of the TAG directive");try{g=decodeURIComponent(g)}catch{throwError(c,"tag prefix is malformed: "+g)}c.tagMap[p]=g}};function captureSegment(n,c,l,h){var p,g,T,v;if(c<l){if(v=n.input.slice(c,l),h)for(p=0,g=v.length;p<g;p+=1)T=v.charCodeAt(p),T===9||32<=T&&T<=1114111||throwError(n,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(v)&&throwError(n,"the stream contains non-printable characters");n.result+=v}}function mergeMappings(n,c,l,h){var p,g,T,v;for(common.isObject(l)||throwError(n,"cannot merge mappings; the provided source object is unacceptable"),p=Object.keys(l),T=0,v=p.length;T<v;T+=1)g=p[T],_hasOwnProperty$1.call(c,g)||(c[g]=l[g],h[g]=!0)}function storeMappingPair(n,c,l,h,p,g,T,v,I){var R,w;if(Array.isArray(p))for(p=Array.prototype.slice.call(p),R=0,w=p.length;R<w;R+=1)Array.isArray(p[R])&&throwError(n,"nested arrays are not supported inside keys"),typeof p=="object"&&_class(p[R])==="[object Object]"&&(p[R]="[object Object]");if(typeof p=="object"&&_class(p)==="[object Object]"&&(p="[object Object]"),p=String(p),c===null&&(c={}),h==="tag:yaml.org,2002:merge")if(Array.isArray(g))for(R=0,w=g.length;R<w;R+=1)mergeMappings(n,c,g[R],l);else mergeMappings(n,c,g,l);else!n.json&&!_hasOwnProperty$1.call(l,p)&&_hasOwnProperty$1.call(c,p)&&(n.line=T||n.line,n.lineStart=v||n.lineStart,n.position=I||n.position,throwError(n,"duplicated mapping key")),p==="__proto__"?Object.defineProperty(c,p,{configurable:!0,enumerable:!0,writable:!0,value:g}):c[p]=g,delete l[p];return c}function readLineBreak(n){var c;c=n.input.charCodeAt(n.position),c===10?n.position++:c===13?(n.position++,n.input.charCodeAt(n.position)===10&&n.position++):throwError(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}function skipSeparationSpace(n,c,l){for(var h=0,p=n.input.charCodeAt(n.position);p!==0;){for(;is_WHITE_SPACE(p);)p===9&&n.firstTabInLine===-1&&(n.firstTabInLine=n.position),p=n.input.charCodeAt(++n.position);if(c&&p===35)do p=n.input.charCodeAt(++n.position);while(p!==10&&p!==13&&p!==0);if(is_EOL(p))for(readLineBreak(n),p=n.input.charCodeAt(n.position),h++,n.lineIndent=0;p===32;)n.lineIndent++,p=n.input.charCodeAt(++n.position);else break}return l!==-1&&h!==0&&n.lineIndent<l&&throwWarning(n,"deficient indentation"),h}function testDocumentSeparator(n){var c=n.position,l;return l=n.input.charCodeAt(c),!!((l===45||l===46)&&l===n.input.charCodeAt(c+1)&&l===n.input.charCodeAt(c+2)&&(c+=3,l=n.input.charCodeAt(c),l===0||is_WS_OR_EOL(l)))}function writeFoldedLines(n,c){c===1?n.result+=" ":c>1&&(n.result+=common.repeat(`
`,c-1))}function readPlainScalar(n,c,l){var h,p,g,T,v,I,R,w,C=n.kind,N=n.result,D;if(D=n.input.charCodeAt(n.position),is_WS_OR_EOL(D)||is_FLOW_INDICATOR(D)||D===35||D===38||D===42||D===33||D===124||D===62||D===39||D===34||D===37||D===64||D===96||(D===63||D===45)&&(p=n.input.charCodeAt(n.position+1),is_WS_OR_EOL(p)||l&&is_FLOW_INDICATOR(p)))return!1;for(n.kind="scalar",n.result="",g=T=n.position,v=!1;D!==0;){if(D===58){if(p=n.input.charCodeAt(n.position+1),is_WS_OR_EOL(p)||l&&is_FLOW_INDICATOR(p))break}else if(D===35){if(h=n.input.charCodeAt(n.position-1),is_WS_OR_EOL(h))break}else{if(n.position===n.lineStart&&testDocumentSeparator(n)||l&&is_FLOW_INDICATOR(D))break;if(is_EOL(D))if(I=n.line,R=n.lineStart,w=n.lineIndent,skipSeparationSpace(n,!1,-1),n.lineIndent>=c){v=!0,D=n.input.charCodeAt(n.position);continue}else{n.position=T,n.line=I,n.lineStart=R,n.lineIndent=w;break}}v&&(captureSegment(n,g,T,!1),writeFoldedLines(n,n.line-I),g=T=n.position,v=!1),is_WHITE_SPACE(D)||(T=n.position+1),D=n.input.charCodeAt(++n.position)}return captureSegment(n,g,T,!1),n.result?!0:(n.kind=C,n.result=N,!1)}function readSingleQuotedScalar(n,c){var l,h,p;if(l=n.input.charCodeAt(n.position),l!==39)return!1;for(n.kind="scalar",n.result="",n.position++,h=p=n.position;(l=n.input.charCodeAt(n.position))!==0;)if(l===39)if(captureSegment(n,h,n.position,!0),l=n.input.charCodeAt(++n.position),l===39)h=n.position,n.position++,p=n.position;else return!0;else is_EOL(l)?(captureSegment(n,h,p,!0),writeFoldedLines(n,skipSeparationSpace(n,!1,c)),h=p=n.position):n.position===n.lineStart&&testDocumentSeparator(n)?throwError(n,"unexpected end of the document within a single quoted scalar"):(n.position++,p=n.position);throwError(n,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(n,c){var l,h,p,g,T,v;if(v=n.input.charCodeAt(n.position),v!==34)return!1;for(n.kind="scalar",n.result="",n.position++,l=h=n.position;(v=n.input.charCodeAt(n.position))!==0;){if(v===34)return captureSegment(n,l,n.position,!0),n.position++,!0;if(v===92){if(captureSegment(n,l,n.position,!0),v=n.input.charCodeAt(++n.position),is_EOL(v))skipSeparationSpace(n,!1,c);else if(v<256&&simpleEscapeCheck[v])n.result+=simpleEscapeMap[v],n.position++;else if((T=escapedHexLen(v))>0){for(p=T,g=0;p>0;p--)v=n.input.charCodeAt(++n.position),(T=fromHexCode(v))>=0?g=(g<<4)+T:throwError(n,"expected hexadecimal character");n.result+=charFromCodepoint(g),n.position++}else throwError(n,"unknown escape sequence");l=h=n.position}else is_EOL(v)?(captureSegment(n,l,h,!0),writeFoldedLines(n,skipSeparationSpace(n,!1,c)),l=h=n.position):n.position===n.lineStart&&testDocumentSeparator(n)?throwError(n,"unexpected end of the document within a double quoted scalar"):(n.position++,h=n.position)}throwError(n,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(n,c){var l=!0,h,p,g,T=n.tag,v,I=n.anchor,R,w,C,N,D,V=Object.create(null),B,ie,ne,P;if(P=n.input.charCodeAt(n.position),P===91)w=93,D=!1,v=[];else if(P===123)w=125,D=!0,v={};else return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=v),P=n.input.charCodeAt(++n.position);P!==0;){if(skipSeparationSpace(n,!0,c),P=n.input.charCodeAt(n.position),P===w)return n.position++,n.tag=T,n.anchor=I,n.kind=D?"mapping":"sequence",n.result=v,!0;l?P===44&&throwError(n,"expected the node content, but found ','"):throwError(n,"missed comma between flow collection entries"),ie=B=ne=null,C=N=!1,P===63&&(R=n.input.charCodeAt(n.position+1),is_WS_OR_EOL(R)&&(C=N=!0,n.position++,skipSeparationSpace(n,!0,c))),h=n.line,p=n.lineStart,g=n.position,composeNode(n,c,CONTEXT_FLOW_IN,!1,!0),ie=n.tag,B=n.result,skipSeparationSpace(n,!0,c),P=n.input.charCodeAt(n.position),(N||n.line===h)&&P===58&&(C=!0,P=n.input.charCodeAt(++n.position),skipSeparationSpace(n,!0,c),composeNode(n,c,CONTEXT_FLOW_IN,!1,!0),ne=n.result),D?storeMappingPair(n,v,V,ie,B,ne,h,p,g):C?v.push(storeMappingPair(n,null,V,ie,B,ne,h,p,g)):v.push(B),skipSeparationSpace(n,!0,c),P=n.input.charCodeAt(n.position),P===44?(l=!0,P=n.input.charCodeAt(++n.position)):l=!1}throwError(n,"unexpected end of the stream within a flow collection")}function readBlockScalar(n,c){var l,h,p=CHOMPING_CLIP,g=!1,T=!1,v=c,I=0,R=!1,w,C;if(C=n.input.charCodeAt(n.position),C===124)h=!1;else if(C===62)h=!0;else return!1;for(n.kind="scalar",n.result="";C!==0;)if(C=n.input.charCodeAt(++n.position),C===43||C===45)CHOMPING_CLIP===p?p=C===43?CHOMPING_KEEP:CHOMPING_STRIP:throwError(n,"repeat of a chomping mode identifier");else if((w=fromDecimalCode(C))>=0)w===0?throwError(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):T?throwError(n,"repeat of an indentation width identifier"):(v=c+w-1,T=!0);else break;if(is_WHITE_SPACE(C)){do C=n.input.charCodeAt(++n.position);while(is_WHITE_SPACE(C));if(C===35)do C=n.input.charCodeAt(++n.position);while(!is_EOL(C)&&C!==0)}for(;C!==0;){for(readLineBreak(n),n.lineIndent=0,C=n.input.charCodeAt(n.position);(!T||n.lineIndent<v)&&C===32;)n.lineIndent++,C=n.input.charCodeAt(++n.position);if(!T&&n.lineIndent>v&&(v=n.lineIndent),is_EOL(C)){I++;continue}if(n.lineIndent<v){p===CHOMPING_KEEP?n.result+=common.repeat(`
`,g?1+I:I):p===CHOMPING_CLIP&&g&&(n.result+=`
`);break}for(h?is_WHITE_SPACE(C)?(R=!0,n.result+=common.repeat(`
`,g?1+I:I)):R?(R=!1,n.result+=common.repeat(`
`,I+1)):I===0?g&&(n.result+=" "):n.result+=common.repeat(`
`,I):n.result+=common.repeat(`
`,g?1+I:I),g=!0,T=!0,I=0,l=n.position;!is_EOL(C)&&C!==0;)C=n.input.charCodeAt(++n.position);captureSegment(n,l,n.position,!1)}return!0}function readBlockSequence(n,c){var l,h=n.tag,p=n.anchor,g=[],T,v=!1,I;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=g),I=n.input.charCodeAt(n.position);I!==0&&(n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,throwError(n,"tab characters must not be used in indentation")),!(I!==45||(T=n.input.charCodeAt(n.position+1),!is_WS_OR_EOL(T))));){if(v=!0,n.position++,skipSeparationSpace(n,!0,-1)&&n.lineIndent<=c){g.push(null),I=n.input.charCodeAt(n.position);continue}if(l=n.line,composeNode(n,c,CONTEXT_BLOCK_IN,!1,!0),g.push(n.result),skipSeparationSpace(n,!0,-1),I=n.input.charCodeAt(n.position),(n.line===l||n.lineIndent>c)&&I!==0)throwError(n,"bad indentation of a sequence entry");else if(n.lineIndent<c)break}return v?(n.tag=h,n.anchor=p,n.kind="sequence",n.result=g,!0):!1}function readBlockMapping(n,c,l){var h,p,g,T,v,I,R=n.tag,w=n.anchor,C={},N=Object.create(null),D=null,V=null,B=null,ie=!1,ne=!1,P;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=C),P=n.input.charCodeAt(n.position);P!==0;){if(!ie&&n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,throwError(n,"tab characters must not be used in indentation")),h=n.input.charCodeAt(n.position+1),g=n.line,(P===63||P===58)&&is_WS_OR_EOL(h))P===63?(ie&&(storeMappingPair(n,C,N,D,V,null,T,v,I),D=V=B=null),ne=!0,ie=!0,p=!0):ie?(ie=!1,p=!0):throwError(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,P=h;else{if(T=n.line,v=n.lineStart,I=n.position,!composeNode(n,l,CONTEXT_FLOW_OUT,!1,!0))break;if(n.line===g){for(P=n.input.charCodeAt(n.position);is_WHITE_SPACE(P);)P=n.input.charCodeAt(++n.position);if(P===58)P=n.input.charCodeAt(++n.position),is_WS_OR_EOL(P)||throwError(n,"a whitespace character is expected after the key-value separator within a block mapping"),ie&&(storeMappingPair(n,C,N,D,V,null,T,v,I),D=V=B=null),ne=!0,ie=!1,p=!1,D=n.tag,V=n.result;else if(ne)throwError(n,"can not read an implicit mapping pair; a colon is missed");else return n.tag=R,n.anchor=w,!0}else if(ne)throwError(n,"can not read a block mapping entry; a multiline key may not be an implicit key");else return n.tag=R,n.anchor=w,!0}if((n.line===g||n.lineIndent>c)&&(ie&&(T=n.line,v=n.lineStart,I=n.position),composeNode(n,c,CONTEXT_BLOCK_OUT,!0,p)&&(ie?V=n.result:B=n.result),ie||(storeMappingPair(n,C,N,D,V,B,T,v,I),D=V=B=null),skipSeparationSpace(n,!0,-1),P=n.input.charCodeAt(n.position)),(n.line===g||n.lineIndent>c)&&P!==0)throwError(n,"bad indentation of a mapping entry");else if(n.lineIndent<c)break}return ie&&storeMappingPair(n,C,N,D,V,null,T,v,I),ne&&(n.tag=R,n.anchor=w,n.kind="mapping",n.result=C),ne}function readTagProperty(n){var c,l=!1,h=!1,p,g,T;if(T=n.input.charCodeAt(n.position),T!==33)return!1;if(n.tag!==null&&throwError(n,"duplication of a tag property"),T=n.input.charCodeAt(++n.position),T===60?(l=!0,T=n.input.charCodeAt(++n.position)):T===33?(h=!0,p="!!",T=n.input.charCodeAt(++n.position)):p="!",c=n.position,l){do T=n.input.charCodeAt(++n.position);while(T!==0&&T!==62);n.position<n.length?(g=n.input.slice(c,n.position),T=n.input.charCodeAt(++n.position)):throwError(n,"unexpected end of the stream within a verbatim tag")}else{for(;T!==0&&!is_WS_OR_EOL(T);)T===33&&(h?throwError(n,"tag suffix cannot contain exclamation marks"):(p=n.input.slice(c-1,n.position+1),PATTERN_TAG_HANDLE.test(p)||throwError(n,"named tag handle cannot contain such characters"),h=!0,c=n.position+1)),T=n.input.charCodeAt(++n.position);g=n.input.slice(c,n.position),PATTERN_FLOW_INDICATORS.test(g)&&throwError(n,"tag suffix cannot contain flow indicator characters")}g&&!PATTERN_TAG_URI.test(g)&&throwError(n,"tag name cannot contain such characters: "+g);try{g=decodeURIComponent(g)}catch{throwError(n,"tag name is malformed: "+g)}return l?n.tag=g:_hasOwnProperty$1.call(n.tagMap,p)?n.tag=n.tagMap[p]+g:p==="!"?n.tag="!"+g:p==="!!"?n.tag="tag:yaml.org,2002:"+g:throwError(n,'undeclared tag handle "'+p+'"'),!0}function readAnchorProperty(n){var c,l;if(l=n.input.charCodeAt(n.position),l!==38)return!1;for(n.anchor!==null&&throwError(n,"duplication of an anchor property"),l=n.input.charCodeAt(++n.position),c=n.position;l!==0&&!is_WS_OR_EOL(l)&&!is_FLOW_INDICATOR(l);)l=n.input.charCodeAt(++n.position);return n.position===c&&throwError(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(c,n.position),!0}function readAlias(n){var c,l,h;if(h=n.input.charCodeAt(n.position),h!==42)return!1;for(h=n.input.charCodeAt(++n.position),c=n.position;h!==0&&!is_WS_OR_EOL(h)&&!is_FLOW_INDICATOR(h);)h=n.input.charCodeAt(++n.position);return n.position===c&&throwError(n,"name of an alias node must contain at least one character"),l=n.input.slice(c,n.position),_hasOwnProperty$1.call(n.anchorMap,l)||throwError(n,'unidentified alias "'+l+'"'),n.result=n.anchorMap[l],skipSeparationSpace(n,!0,-1),!0}function composeNode(n,c,l,h,p){var g,T,v,I=1,R=!1,w=!1,C,N,D,V,B,ie;if(n.listener!==null&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,g=T=v=CONTEXT_BLOCK_OUT===l||CONTEXT_BLOCK_IN===l,h&&skipSeparationSpace(n,!0,-1)&&(R=!0,n.lineIndent>c?I=1:n.lineIndent===c?I=0:n.lineIndent<c&&(I=-1)),I===1)for(;readTagProperty(n)||readAnchorProperty(n);)skipSeparationSpace(n,!0,-1)?(R=!0,v=g,n.lineIndent>c?I=1:n.lineIndent===c?I=0:n.lineIndent<c&&(I=-1)):v=!1;if(v&&(v=R||p),(I===1||CONTEXT_BLOCK_OUT===l)&&(CONTEXT_FLOW_IN===l||CONTEXT_FLOW_OUT===l?B=c:B=c+1,ie=n.position-n.lineStart,I===1?v&&(readBlockSequence(n,ie)||readBlockMapping(n,ie,B))||readFlowCollection(n,B)?w=!0:(T&&readBlockScalar(n,B)||readSingleQuotedScalar(n,B)||readDoubleQuotedScalar(n,B)?w=!0:readAlias(n)?(w=!0,(n.tag!==null||n.anchor!==null)&&throwError(n,"alias node should not have any properties")):readPlainScalar(n,B,CONTEXT_FLOW_IN===l)&&(w=!0,n.tag===null&&(n.tag="?")),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):I===0&&(w=v&&readBlockSequence(n,ie))),n.tag===null)n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);else if(n.tag==="?"){for(n.result!==null&&n.kind!=="scalar"&&throwError(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),C=0,N=n.implicitTypes.length;C<N;C+=1)if(V=n.implicitTypes[C],V.resolve(n.result)){n.result=V.construct(n.result),n.tag=V.tag,n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);break}}else if(n.tag!=="!"){if(_hasOwnProperty$1.call(n.typeMap[n.kind||"fallback"],n.tag))V=n.typeMap[n.kind||"fallback"][n.tag];else for(V=null,D=n.typeMap.multi[n.kind||"fallback"],C=0,N=D.length;C<N;C+=1)if(n.tag.slice(0,D[C].tag.length)===D[C].tag){V=D[C];break}V||throwError(n,"unknown tag !<"+n.tag+">"),n.result!==null&&V.kind!==n.kind&&throwError(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+V.kind+'", not "'+n.kind+'"'),V.resolve(n.result,n.tag)?(n.result=V.construct(n.result,n.tag),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):throwError(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return n.listener!==null&&n.listener("close",n),n.tag!==null||n.anchor!==null||w}function readDocument(n){var c=n.position,l,h,p,g=!1,T;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);(T=n.input.charCodeAt(n.position))!==0&&(skipSeparationSpace(n,!0,-1),T=n.input.charCodeAt(n.position),!(n.lineIndent>0||T!==37));){for(g=!0,T=n.input.charCodeAt(++n.position),l=n.position;T!==0&&!is_WS_OR_EOL(T);)T=n.input.charCodeAt(++n.position);for(h=n.input.slice(l,n.position),p=[],h.length<1&&throwError(n,"directive name must not be less than one character in length");T!==0;){for(;is_WHITE_SPACE(T);)T=n.input.charCodeAt(++n.position);if(T===35){do T=n.input.charCodeAt(++n.position);while(T!==0&&!is_EOL(T));break}if(is_EOL(T))break;for(l=n.position;T!==0&&!is_WS_OR_EOL(T);)T=n.input.charCodeAt(++n.position);p.push(n.input.slice(l,n.position))}T!==0&&readLineBreak(n),_hasOwnProperty$1.call(directiveHandlers,h)?directiveHandlers[h](n,h,p):throwWarning(n,'unknown document directive "'+h+'"')}if(skipSeparationSpace(n,!0,-1),n.lineIndent===0&&n.input.charCodeAt(n.position)===45&&n.input.charCodeAt(n.position+1)===45&&n.input.charCodeAt(n.position+2)===45?(n.position+=3,skipSeparationSpace(n,!0,-1)):g&&throwError(n,"directives end mark is expected"),composeNode(n,n.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(n,!0,-1),n.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(n.input.slice(c,n.position))&&throwWarning(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&testDocumentSeparator(n)){n.input.charCodeAt(n.position)===46&&(n.position+=3,skipSeparationSpace(n,!0,-1));return}if(n.position<n.length-1)throwError(n,"end of the stream or a document separator is expected");else return}function loadDocuments(n,c){n=String(n),c=c||{},n.length!==0&&(n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n.charCodeAt(0)===65279&&(n=n.slice(1)));var l=new State$1(n,c),h=n.indexOf("\0");for(h!==-1&&(l.position=h,throwError(l,"null byte is not allowed in input")),l.input+="\0";l.input.charCodeAt(l.position)===32;)l.lineIndent+=1,l.position+=1;for(;l.position<l.length-1;)readDocument(l);return l.documents}function loadAll$1(n,c,l){c!==null&&typeof c=="object"&&typeof l>"u"&&(l=c,c=null);var h=loadDocuments(n,l);if(typeof c!="function")return h;for(var p=0,g=h.length;p<g;p+=1)c(h[p])}function load$1(n,c){var l=loadDocuments(n,c);if(l.length!==0){if(l.length===1)return l[0];throw new exception("expected a single document in the stream, but found more")}}var loadAll_1=loadAll$1,load_1=load$1,loader={loadAll:loadAll_1,load:load_1},_toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,CHAR_BOM=65279,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_CARRIAGE_RETURN=13,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0";ESCAPE_SEQUENCES[7]="\\a";ESCAPE_SEQUENCES[8]="\\b";ESCAPE_SEQUENCES[9]="\\t";ESCAPE_SEQUENCES[10]="\\n";ESCAPE_SEQUENCES[11]="\\v";ESCAPE_SEQUENCES[12]="\\f";ESCAPE_SEQUENCES[13]="\\r";ESCAPE_SEQUENCES[27]="\\e";ESCAPE_SEQUENCES[34]='\\"';ESCAPE_SEQUENCES[92]="\\\\";ESCAPE_SEQUENCES[133]="\\N";ESCAPE_SEQUENCES[160]="\\_";ESCAPE_SEQUENCES[8232]="\\L";ESCAPE_SEQUENCES[8233]="\\P";var DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],DEPRECATED_BASE60_SYNTAX=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function compileStyleMap(n,c){var l,h,p,g,T,v,I;if(c===null)return{};for(l={},h=Object.keys(c),p=0,g=h.length;p<g;p+=1)T=h[p],v=String(c[T]),T.slice(0,2)==="!!"&&(T="tag:yaml.org,2002:"+T.slice(2)),I=n.compiledTypeMap.fallback[T],I&&_hasOwnProperty.call(I.styleAliases,v)&&(v=I.styleAliases[v]),l[T]=v;return l}function encodeHex(n){var c,l,h;if(c=n.toString(16).toUpperCase(),n<=255)l="x",h=2;else if(n<=65535)l="u",h=4;else if(n<=4294967295)l="U",h=8;else throw new exception("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+l+common.repeat("0",h-c.length)+c}var QUOTING_TYPE_SINGLE=1,QUOTING_TYPE_DOUBLE=2;function State(n){this.schema=n.schema||_default,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=common.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=compileStyleMap(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType=n.quotingType==='"'?QUOTING_TYPE_DOUBLE:QUOTING_TYPE_SINGLE,this.forceQuotes=n.forceQuotes||!1,this.replacer=typeof n.replacer=="function"?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(n,c){for(var l=common.repeat(" ",c),h=0,p=-1,g="",T,v=n.length;h<v;)p=n.indexOf(`
`,h),p===-1?(T=n.slice(h),h=v):(T=n.slice(h,p+1),h=p+1),T.length&&T!==`
`&&(g+=l),g+=T;return g}function generateNextLine(n,c){return`
`+common.repeat(" ",n.indent*c)}function testImplicitResolving(n,c){var l,h,p;for(l=0,h=n.implicitTypes.length;l<h;l+=1)if(p=n.implicitTypes[l],p.resolve(c))return!0;return!1}function isWhitespace(n){return n===CHAR_SPACE||n===CHAR_TAB}function isPrintable(n){return 32<=n&&n<=126||161<=n&&n<=55295&&n!==8232&&n!==8233||57344<=n&&n<=65533&&n!==CHAR_BOM||65536<=n&&n<=1114111}function isNsCharOrWhitespace(n){return isPrintable(n)&&n!==CHAR_BOM&&n!==CHAR_CARRIAGE_RETURN&&n!==CHAR_LINE_FEED}function isPlainSafe(n,c,l){var h=isNsCharOrWhitespace(n),p=h&&!isWhitespace(n);return(l?h:h&&n!==CHAR_COMMA&&n!==CHAR_LEFT_SQUARE_BRACKET&&n!==CHAR_RIGHT_SQUARE_BRACKET&&n!==CHAR_LEFT_CURLY_BRACKET&&n!==CHAR_RIGHT_CURLY_BRACKET)&&n!==CHAR_SHARP&&!(c===CHAR_COLON&&!p)||isNsCharOrWhitespace(c)&&!isWhitespace(c)&&n===CHAR_SHARP||c===CHAR_COLON&&p}function isPlainSafeFirst(n){return isPrintable(n)&&n!==CHAR_BOM&&!isWhitespace(n)&&n!==CHAR_MINUS&&n!==CHAR_QUESTION&&n!==CHAR_COLON&&n!==CHAR_COMMA&&n!==CHAR_LEFT_SQUARE_BRACKET&&n!==CHAR_RIGHT_SQUARE_BRACKET&&n!==CHAR_LEFT_CURLY_BRACKET&&n!==CHAR_RIGHT_CURLY_BRACKET&&n!==CHAR_SHARP&&n!==CHAR_AMPERSAND&&n!==CHAR_ASTERISK&&n!==CHAR_EXCLAMATION&&n!==CHAR_VERTICAL_LINE&&n!==CHAR_EQUALS&&n!==CHAR_GREATER_THAN&&n!==CHAR_SINGLE_QUOTE&&n!==CHAR_DOUBLE_QUOTE&&n!==CHAR_PERCENT&&n!==CHAR_COMMERCIAL_AT&&n!==CHAR_GRAVE_ACCENT}function isPlainSafeLast(n){return!isWhitespace(n)&&n!==CHAR_COLON}function codePointAt(n,c){var l=n.charCodeAt(c),h;return l>=55296&&l<=56319&&c+1<n.length&&(h=n.charCodeAt(c+1),h>=56320&&h<=57343)?(l-55296)*1024+h-56320+65536:l}function needIndentIndicator(n){var c=/^\n* /;return c.test(n)}var STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;function chooseScalarStyle(n,c,l,h,p,g,T,v){var I,R=0,w=null,C=!1,N=!1,D=h!==-1,V=-1,B=isPlainSafeFirst(codePointAt(n,0))&&isPlainSafeLast(codePointAt(n,n.length-1));if(c||T)for(I=0;I<n.length;R>=65536?I+=2:I++){if(R=codePointAt(n,I),!isPrintable(R))return STYLE_DOUBLE;B=B&&isPlainSafe(R,w,v),w=R}else{for(I=0;I<n.length;R>=65536?I+=2:I++){if(R=codePointAt(n,I),R===CHAR_LINE_FEED)C=!0,D&&(N=N||I-V-1>h&&n[V+1]!==" ",V=I);else if(!isPrintable(R))return STYLE_DOUBLE;B=B&&isPlainSafe(R,w,v),w=R}N=N||D&&I-V-1>h&&n[V+1]!==" "}return!C&&!N?B&&!T&&!p(n)?STYLE_PLAIN:g===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:l>9&&needIndentIndicator(n)?STYLE_DOUBLE:T?g===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:N?STYLE_FOLDED:STYLE_LITERAL}function writeScalar(n,c,l,h,p){n.dump=function(){if(c.length===0)return n.quotingType===QUOTING_TYPE_DOUBLE?'""':"''";if(!n.noCompatMode&&(DEPRECATED_BOOLEANS_SYNTAX.indexOf(c)!==-1||DEPRECATED_BASE60_SYNTAX.test(c)))return n.quotingType===QUOTING_TYPE_DOUBLE?'"'+c+'"':"'"+c+"'";var g=n.indent*Math.max(1,l),T=n.lineWidth===-1?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-g),v=h||n.flowLevel>-1&&l>=n.flowLevel;function I(R){return testImplicitResolving(n,R)}switch(chooseScalarStyle(c,v,n.indent,T,I,n.quotingType,n.forceQuotes&&!h,p)){case STYLE_PLAIN:return c;case STYLE_SINGLE:return"'"+c.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(c,n.indent)+dropEndingNewline(indentString(c,g));case STYLE_FOLDED:return">"+blockHeader(c,n.indent)+dropEndingNewline(indentString(foldString(c,T),g));case STYLE_DOUBLE:return'"'+escapeString(c)+'"';default:throw new exception("impossible error: invalid scalar style")}}()}function blockHeader(n,c){var l=needIndentIndicator(n)?String(c):"",h=n[n.length-1]===`
`,p=h&&(n[n.length-2]===`
`||n===`
`),g=p?"+":h?"":"-";return l+g+`
`}function dropEndingNewline(n){return n[n.length-1]===`
`?n.slice(0,-1):n}function foldString(n,c){for(var l=/(\n+)([^\n]*)/g,h=function(){var R=n.indexOf(`
`);return R=R!==-1?R:n.length,l.lastIndex=R,foldLine(n.slice(0,R),c)}(),p=n[0]===`
`||n[0]===" ",g,T;T=l.exec(n);){var v=T[1],I=T[2];g=I[0]===" ",h+=v+(!p&&!g&&I!==""?`
`:"")+foldLine(I,c),p=g}return h}function foldLine(n,c){if(n===""||n[0]===" ")return n;for(var l=/ [^ ]/g,h,p=0,g,T=0,v=0,I="";h=l.exec(n);)v=h.index,v-p>c&&(g=T>p?T:v,I+=`
`+n.slice(p,g),p=g+1),T=v;return I+=`
`,n.length-p>c&&T>p?I+=n.slice(p,T)+`
`+n.slice(T+1):I+=n.slice(p),I.slice(1)}function escapeString(n){for(var c="",l=0,h,p=0;p<n.length;l>=65536?p+=2:p++)l=codePointAt(n,p),h=ESCAPE_SEQUENCES[l],!h&&isPrintable(l)?(c+=n[p],l>=65536&&(c+=n[p+1])):c+=h||encodeHex(l);return c}function writeFlowSequence(n,c,l){var h="",p=n.tag,g,T,v;for(g=0,T=l.length;g<T;g+=1)v=l[g],n.replacer&&(v=n.replacer.call(l,String(g),v)),(writeNode(n,c,v,!1,!1)||typeof v>"u"&&writeNode(n,c,null,!1,!1))&&(h!==""&&(h+=","+(n.condenseFlow?"":" ")),h+=n.dump);n.tag=p,n.dump="["+h+"]"}function writeBlockSequence(n,c,l,h){var p="",g=n.tag,T,v,I;for(T=0,v=l.length;T<v;T+=1)I=l[T],n.replacer&&(I=n.replacer.call(l,String(T),I)),(writeNode(n,c+1,I,!0,!0,!1,!0)||typeof I>"u"&&writeNode(n,c+1,null,!0,!0,!1,!0))&&((!h||p!=="")&&(p+=generateNextLine(n,c)),n.dump&&CHAR_LINE_FEED===n.dump.charCodeAt(0)?p+="-":p+="- ",p+=n.dump);n.tag=g,n.dump=p||"[]"}function writeFlowMapping(n,c,l){var h="",p=n.tag,g=Object.keys(l),T,v,I,R,w;for(T=0,v=g.length;T<v;T+=1)w="",h!==""&&(w+=", "),n.condenseFlow&&(w+='"'),I=g[T],R=l[I],n.replacer&&(R=n.replacer.call(l,I,R)),writeNode(n,c,I,!1,!1)&&(n.dump.length>1024&&(w+="? "),w+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),writeNode(n,c,R,!1,!1)&&(w+=n.dump,h+=w));n.tag=p,n.dump="{"+h+"}"}function writeBlockMapping(n,c,l,h){var p="",g=n.tag,T=Object.keys(l),v,I,R,w,C,N;if(n.sortKeys===!0)T.sort();else if(typeof n.sortKeys=="function")T.sort(n.sortKeys);else if(n.sortKeys)throw new exception("sortKeys must be a boolean or a function");for(v=0,I=T.length;v<I;v+=1)N="",(!h||p!=="")&&(N+=generateNextLine(n,c)),R=T[v],w=l[R],n.replacer&&(w=n.replacer.call(l,R,w)),writeNode(n,c+1,R,!0,!0,!0)&&(C=n.tag!==null&&n.tag!=="?"||n.dump&&n.dump.length>1024,C&&(n.dump&&CHAR_LINE_FEED===n.dump.charCodeAt(0)?N+="?":N+="? "),N+=n.dump,C&&(N+=generateNextLine(n,c)),writeNode(n,c+1,w,!0,C)&&(n.dump&&CHAR_LINE_FEED===n.dump.charCodeAt(0)?N+=":":N+=": ",N+=n.dump,p+=N));n.tag=g,n.dump=p||"{}"}function detectType(n,c,l){var h,p,g,T,v,I;for(p=l?n.explicitTypes:n.implicitTypes,g=0,T=p.length;g<T;g+=1)if(v=p[g],(v.instanceOf||v.predicate)&&(!v.instanceOf||typeof c=="object"&&c instanceof v.instanceOf)&&(!v.predicate||v.predicate(c))){if(l?v.multi&&v.representName?n.tag=v.representName(c):n.tag=v.tag:n.tag="?",v.represent){if(I=n.styleMap[v.tag]||v.defaultStyle,_toString.call(v.represent)==="[object Function]")h=v.represent(c,I);else if(_hasOwnProperty.call(v.represent,I))h=v.represent[I](c,I);else throw new exception("!<"+v.tag+'> tag resolver accepts not "'+I+'" style');n.dump=h}return!0}return!1}function writeNode(n,c,l,h,p,g,T){n.tag=null,n.dump=l,detectType(n,l,!1)||detectType(n,l,!0);var v=_toString.call(n.dump),I=h,R;h&&(h=n.flowLevel<0||n.flowLevel>c);var w=v==="[object Object]"||v==="[object Array]",C,N;if(w&&(C=n.duplicates.indexOf(l),N=C!==-1),(n.tag!==null&&n.tag!=="?"||N||n.indent!==2&&c>0)&&(p=!1),N&&n.usedDuplicates[C])n.dump="*ref_"+C;else{if(w&&N&&!n.usedDuplicates[C]&&(n.usedDuplicates[C]=!0),v==="[object Object]")h&&Object.keys(n.dump).length!==0?(writeBlockMapping(n,c,n.dump,p),N&&(n.dump="&ref_"+C+n.dump)):(writeFlowMapping(n,c,n.dump),N&&(n.dump="&ref_"+C+" "+n.dump));else if(v==="[object Array]")h&&n.dump.length!==0?(n.noArrayIndent&&!T&&c>0?writeBlockSequence(n,c-1,n.dump,p):writeBlockSequence(n,c,n.dump,p),N&&(n.dump="&ref_"+C+n.dump)):(writeFlowSequence(n,c,n.dump),N&&(n.dump="&ref_"+C+" "+n.dump));else if(v==="[object String]")n.tag!=="?"&&writeScalar(n,n.dump,c,g,I);else{if(v==="[object Undefined]")return!1;if(n.skipInvalid)return!1;throw new exception("unacceptable kind of an object to dump "+v)}n.tag!==null&&n.tag!=="?"&&(R=encodeURI(n.tag[0]==="!"?n.tag.slice(1):n.tag).replace(/!/g,"%21"),n.tag[0]==="!"?R="!"+R:R.slice(0,18)==="tag:yaml.org,2002:"?R="!!"+R.slice(18):R="!<"+R+">",n.dump=R+" "+n.dump)}return!0}function getDuplicateReferences(n,c){var l=[],h=[],p,g;for(inspectNode(n,l,h),p=0,g=h.length;p<g;p+=1)c.duplicates.push(l[h[p]]);c.usedDuplicates=new Array(g)}function inspectNode(n,c,l){var h,p,g;if(n!==null&&typeof n=="object")if(p=c.indexOf(n),p!==-1)l.indexOf(p)===-1&&l.push(p);else if(c.push(n),Array.isArray(n))for(p=0,g=n.length;p<g;p+=1)inspectNode(n[p],c,l);else for(h=Object.keys(n),p=0,g=h.length;p<g;p+=1)inspectNode(n[h[p]],c,l)}function dump$1(n,c){c=c||{};var l=new State(c);l.noRefs||getDuplicateReferences(n,l);var h=n;return l.replacer&&(h=l.replacer.call({"":h},"",h)),writeNode(l,0,h,!0,!0)?l.dump+`
`:""}var dump_1=dump$1,dumper={dump:dump_1};function renamed(n,c){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+c+" instead, which is now safe by default.")}}var Type=type,Schema=schema,FAILSAFE_SCHEMA=failsafe,JSON_SCHEMA=json,CORE_SCHEMA=core,DEFAULT_SCHEMA=_default,load=loader.load,loadAll=loader.loadAll,dump=dumper.dump,YAMLException=exception,types={binary,float,map,null:_null,pairs,set,timestamp,bool,int,merge,omap,seq,str},safeLoad=renamed("safeLoad","load"),safeLoadAll=renamed("safeLoadAll","loadAll"),safeDump=renamed("safeDump","dump"),jsYaml={Type,Schema,FAILSAFE_SCHEMA,JSON_SCHEMA,CORE_SCHEMA,DEFAULT_SCHEMA,load,loadAll,dump,YAMLException,types,safeLoad,safeLoadAll,safeDump},dist$1={exports:{}};/*! For license information please see index.js.LICENSE.txt */var dist=dist$1.exports,hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(n,c){(function(l,h){n.exports=h(requireBlockly_compressed())})(dist,l=>(()=>{var h={370:ne=>{ne.exports=l}},p={};function g(ne){var P=p[ne];if(P!==void 0)return P.exports;var z=p[ne]={exports:{}};return h[ne](z,z.exports,g),z.exports}g.d=(ne,P)=>{for(var z in P)g.o(P,z)&&!g.o(ne,z)&&Object.defineProperty(ne,z,{enumerable:!0,get:P[z]})},g.o=(ne,P)=>Object.prototype.hasOwnProperty.call(ne,P),g.r=ne=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ne,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ne,"__esModule",{value:!0})};var T={};g.r(T),g.d(T,{Backpack:()=>D,BackpackChange:()=>C,BackpackOpen:()=>R,backpackChange:()=>w,backpackOpen:()=>I});var v=g(370);v.Msg.COPY_ALL_TO_BACKPACK="Copy All Blocks to Backpack",v.Msg.COPY_TO_BACKPACK="Copy to Backpack",v.Msg.EMPTY_BACKPACK="Empty",v.Msg.PASTE_ALL_FROM_BACKPACK="Paste All Blocks from Backpack",v.Msg.REMOVE_FROM_BACKPACK="Remove from Backpack";const I="backpack_open";class R extends v.Events.UiBase{constructor(P,z){super(z),this.isOpen=P,this.type=I}toJson(){const P=super.toJson();return P.isOpen=this.isOpen,P}static fromJson(P,z,se){const re=super.fromJson(P,z,se);return re.isOpen=P.isOpen,re}}v.registry.register(v.registry.Type.EVENT,I,R);const w="backpack_change";class C extends v.Events.UiBase{constructor(){super(...arguments),this.type=w}}function N(ne){return ne.toFlyoutInfo!==void 0}v.registry.register(v.registry.Type.EVENT,w,C);class D extends v.DragTarget{constructor(P,z){super(),this.workspace_=P,this.id="backpack",this.flyout_=null,this.contents_=[],this.boundEvents=[],this.left_=0,this.top_=0,this.WIDTH_=40,this.HEIGHT_=60,this.MARGIN_VERTICAL_=20,this.MARGIN_HORIZONTAL_=20,this.HOTSPOT_MARGIN_=10,this.svgGroup_=null,this.svgImg_=null,this.spriteTop=10,this.spriteLeft=20,this.spriteSize=80,this.initialized_=!1,this.options=function(se){var re,he,q;const j={allowEmptyBackpackOpen:!0,useFilledBackpackImage:!1,skipSerializerRegistration:!1,contextMenu:{emptyBackpack:!0,removeFromBackpack:!0,copyToBackpack:!0,copyAllToBackpack:!1,pasteAllToBackpack:!1,disablePreconditionChecks:!1}};return se?{allowEmptyBackpackOpen:(re=se.allowEmptyBackpackOpen)!==null&&re!==void 0?re:j.allowEmptyBackpackOpen,useFilledBackpackImage:(he=se.useFilledBackpackImage)!==null&&he!==void 0?he:j.useFilledBackpackImage,skipSerializerRegistration:(q=se.skipSerializerRegistration)!==null&&q!==void 0?q:j.skipSerializerRegistration,contextMenu:Object.assign(Object.assign({},j.contextMenu),se.contextMenu)}:j}(z),this.registerSerializer()}registerSerializer(){this.options.skipSerializerRegistration||v.registry.hasItem(v.registry.Type.SERIALIZER,"backpack")||v.serialization.registry.register("backpack",new ie)}init(){var P,z,se;this.workspace_.getComponentManager().addComponent({component:this,weight:2,capabilities:[v.ComponentManager.Capability.AUTOHIDEABLE,v.ComponentManager.Capability.DRAG_TARGET,v.ComponentManager.Capability.POSITIONABLE]}),this.initFlyout(),this.createDom(),this.attachListeners(),this.options.contextMenu&&(P=this.options.contextMenu,z=this.workspace_,P.emptyBackpack&&function(re){const he=re.configureContextMenu;re.configureContextMenu=(q,j)=>{const ye=re.getComponentManager().getComponent("backpack"),ge=ye&&ye.getClientRect();if(j instanceof PointerEvent&&ge&&(!ye||!ge.contains(j.clientX,j.clientY)))return void(he&&he.call(null,q,j));q.length=0;const Ve={text:v.Msg.EMPTY_BACKPACK,enabled:!!ye.getCount(),callback:function(){ye.empty()},scope:{workspace:re},weight:0};q.push(Ve)}}(z),P.removeFromBackpack&&function(){if(v.ContextMenuRegistry.registry.getItem("remove_from_backpack"))return;const re={displayText:v.Msg.REMOVE_FROM_BACKPACK,preconditionFn:function(he){if(!he.block)return"hidden";const q=he.block.workspace;if(q.isFlyout&&q.targetWorkspace){const j=q.targetWorkspace.getComponentManager().getComponent("backpack"),ye=j&&j.getFlyout();if(j&&ye&&ye.getWorkspace().id===q.id)return"enabled"}return"hidden"},callback:function(he){he.block&&he.block.workspace.targetWorkspace&&he.block.workspace.targetWorkspace.getComponentManager().getComponent("backpack").removeBlock(he.block)},scopeType:v.ContextMenuRegistry.ScopeType.BLOCK,id:"remove_from_backpack",weight:200};v.ContextMenuRegistry.registry.register(re)}(),P.copyToBackpack&&function(re){if(v.ContextMenuRegistry.registry.getItem("copy_to_backpack"))return;const he={displayText:function(q){if(!q.block)return"";const j=q.block.workspace.getComponentManager().getComponent("backpack").getCount();return`${v.Msg.COPY_TO_BACKPACK} (${j})`},preconditionFn:function(q){if(!q.block)return"hidden";const j=q.block.workspace;if(!j.isFlyout){const ye=j.getComponentManager().getComponent("backpack");if(ye)return re?"enabled":ye.containsBlock(q.block)?"disabled":"enabled"}return"hidden"},callback:function(q){q.block&&q.block.workspace.getComponentManager().getComponent("backpack").addBlock(q.block)},scopeType:v.ContextMenuRegistry.ScopeType.BLOCK,id:"copy_to_backpack",weight:200};v.ContextMenuRegistry.registry.register(he)}((se=P.disablePreconditionChecks)!==null&&se!==void 0&&se),P.copyAllToBackpack&&function(){if(v.ContextMenuRegistry.registry.getItem("copy_all_to_backpack"))return;const re={displayText:v.Msg.COPY_ALL_TO_BACKPACK,preconditionFn:function(he){const q=he.workspace;return q&&!q.isFlyout&&q.getComponentManager().getComponent("backpack")?"enabled":"hidden"},callback:function(he){const q=he.workspace;q&&q.getComponentManager().getComponent("backpack").addBlocks(q.getTopBlocks(!0))},scopeType:v.ContextMenuRegistry.ScopeType.WORKSPACE,id:"copy_all_to_backpack",weight:200};v.ContextMenuRegistry.registry.register(re)}(),P.pasteAllToBackpack&&function(){if(v.ContextMenuRegistry.registry.getItem("paste_all_from_backpack"))return;const re={displayText:function(he){if(!he.workspace)return"";const q=he.workspace.getComponentManager().getComponent("backpack").getCount();return`${v.Msg.PASTE_ALL_FROM_BACKPACK} (${q})`},preconditionFn:function(he){const q=he.workspace;return q&&!q.isFlyout&&q.getComponentManager().getComponent("backpack")?"enabled":"hidden"},callback:function(he){const q=he.workspace;q&&q.getComponentManager().getComponent("backpack").getContents().forEach(j=>{v.serialization.blocks.append(JSON.parse(j),q).scheduleSnapAndBump()})},scopeType:v.ContextMenuRegistry.ScopeType.WORKSPACE,id:"paste_all_from_backpack",weight:200};v.ContextMenuRegistry.registry.register(re)}()),this.initialized_=!0,this.workspace_.resize()}dispose(){this.svgGroup_&&v.utils.dom.removeNode(this.svgGroup_);for(const P of this.boundEvents)v.browserEvents.unbind(P);this.boundEvents.length=0}initFlyout(){var P;const z=new v.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer,rendererOverrides:this.workspace_.options.rendererOverrides||void 0,move:{scrollbars:!0}});if(this.workspace_.horizontalLayout){z.toolboxPosition=this.workspace_.toolboxPosition===v.utils.toolbox.Position.TOP?v.utils.toolbox.Position.BOTTOM:v.utils.toolbox.Position.TOP;const re=v.registry.getClassFromOptions(v.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace_.options,!0);if(!re)throw new Error("HorizontalFlyout does not exist");this.flyout_=new re(z)}else{z.toolboxPosition=this.workspace_.toolboxPosition===v.utils.toolbox.Position.RIGHT?v.utils.toolbox.Position.LEFT:v.utils.toolbox.Position.RIGHT;const re=v.registry.getClassFromOptions(v.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,this.workspace_.options,!0);if(!re)throw new Error("VerticalFlyout does not exist");this.flyout_=new re(z)}const se=this.workspace_.getParentSvg().parentNode;se==null||se.appendChild((P=this.flyout_)===null||P===void 0?void 0:P.createDom(v.utils.Svg.SVG)),this.flyout_.init(this.workspace_)}createDom(){this.svgGroup_=v.utils.dom.createSvgElement(v.utils.Svg.G,{},null);const P=v.utils.idGenerator.genUid(),z=v.utils.dom.createSvgElement(v.utils.Svg.CLIPPATH,{id:"blocklyBackpackClipPath"+P},this.svgGroup_);v.utils.dom.createSvgElement(v.utils.Svg.RECT,{width:this.WIDTH_,height:this.HEIGHT_},z),this.svgImg_=v.utils.dom.createSvgElement(v.utils.Svg.IMAGE,{class:"blocklyBackpack","clip-path":"url(#blocklyBackpackClipPath"+P+")",width:this.spriteSize+"px",x:-this.spriteLeft,height:this.spriteSize+"px",y:-this.spriteTop},this.svgGroup_),this.svgImg_.setAttributeNS(v.utils.dom.XLINK_NS,"xlink:href",V),v.utils.dom.insertAfter(this.svgGroup_,this.workspace_.getBubbleCanvas())}attachListeners(){this.svgGroup_&&(this.addEvent(this.svgGroup_,"mousedown",this,this.blockMouseDownWhenOpenable),this.addEvent(this.svgGroup_,"mouseup",this,this.onClick),this.addEvent(this.svgGroup_,"mouseover",this,this.onMouseOver),this.addEvent(this.svgGroup_,"mouseout",this,this.onMouseOut))}addEvent(P,z,se,re){const he=v.browserEvents.bind(P,z,se,re);this.boundEvents.push(he)}getFlyout(){return this.flyout_}getClientRect(){if(!this.svgGroup_)return null;const P=this.svgGroup_.getBoundingClientRect(),z=P.top+this.spriteTop-this.HOTSPOT_MARGIN_,se=z+this.HEIGHT_+2*this.HOTSPOT_MARGIN_,re=P.left+this.spriteLeft-this.HOTSPOT_MARGIN_,he=re+this.WIDTH_+2*this.HOTSPOT_MARGIN_;return new v.utils.Rect(z,se,re,he)}getBoundingRectangle(){return new v.utils.Rect(this.top_,this.top_+this.HEIGHT_,this.left_,this.left_+this.WIDTH_)}position(P,z){if(!this.initialized_)return;const se=this.workspace_.scrollbar,re=se&&se.isVisible()&&se.canScrollVertically(),he=se&&se.isVisible()&&se.canScrollHorizontally();P.toolboxMetrics.position===v.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?(this.left_=P.absoluteMetrics.left+P.viewMetrics.width-this.WIDTH_-this.MARGIN_HORIZONTAL_,re&&!this.workspace_.RTL&&(this.left_-=v.Scrollbar.scrollbarThickness)):(this.left_=this.MARGIN_HORIZONTAL_,re&&this.workspace_.RTL&&(this.left_+=v.Scrollbar.scrollbarThickness));const q=P.toolboxMetrics.position===v.TOOLBOX_AT_BOTTOM;q?(this.top_=P.absoluteMetrics.top+P.viewMetrics.height-this.HEIGHT_-this.MARGIN_VERTICAL_,he&&(this.top_-=v.Scrollbar.scrollbarThickness)):this.top_=P.absoluteMetrics.top+this.MARGIN_VERTICAL_;let j=this.getBoundingRectangle();for(let ye,ge=0;ye=z[ge];ge++)j.intersects(ye)&&(this.top_=q?ye.top-this.HEIGHT_-this.MARGIN_VERTICAL_:ye.bottom+this.MARGIN_VERTICAL_,j=this.getBoundingRectangle(),ge=-1);this.svgGroup_&&this.svgGroup_.setAttribute("transform",`translate(${this.left_},${this.top_})`)}getCount(){return this.contents_.length}getContents(){return[...this.contents_]}onDrop(P){N(P)&&this.addBackpackable(P)}blockToJsonString(P){const z=v.serialization.blocks.save(P);z.kind="BLOCK";const se=function(re,he){for(const q in re)q&&(he.indexOf(q)!==-1&&delete re[q],re[q]&&typeof re[q]=="object"&&se(re[q],he))};return z&&se(z,["id","height","width","pinned","enabled"]),JSON.stringify(z)}blockXmlToJsonString(P){if(!P.startsWith("<block"))throw new Error("Unrecognized XML format");const z=new v.Workspace;try{const se=v.Xml.domToBlock(v.utils.xml.textToDom(P),z);return this.blockToJsonString(se)}finally{z.dispose()}}containsBlock(P){return N(P)?this.containsBackpackable(P):this.contents_.indexOf(this.blockToJsonString(P))!==-1}addBlock(P){N(P)?this.addBackpackable(P):this.addItem(this.blockToJsonString(P))}addBlocks(P){for(const z of P)N(z)?this.addBackpackable(z):this.addItem(this.blockToJsonString(z))}removeBlock(P){N(P)?this.removeBackpackable(P):this.removeItem(this.blockToJsonString(P))}containsBackpackable(P){return P.toFlyoutInfo().every(z=>this.contents_.indexOf(JSON.stringify(z))!==-1)}addBackpackable(P){this.addBackpackables([P])}addBackpackables(P){this.addItems(P.map(z=>z.toFlyoutInfo()).reduce((z,se)=>[...z,...se]).map(z=>JSON.stringify(z)))}removeBackpackable(P){for(const z of P.toFlyoutInfo())this.removeItem(JSON.stringify(z))}addItem(P){this.addItems([P])}addItems(P){const z=this.filterDuplicates(P);z.length&&(this.contents_.unshift(...z),this.onContentChange())}removeItem(P){const z=this.contents_.indexOf(P);z!==-1&&(this.contents_.splice(z,1),this.onContentChange())}setContents(P){this.contents_=[],this.contents_=this.filterDuplicates(P.map(z=>z.startsWith("<block")?this.blockXmlToJsonString(z):z)),this.onContentChange()}empty(){this.getCount()&&(this.contents_.length&&(this.contents_=[],this.onContentChange()),this.close())}onContentChange(){this.maybeRefreshFlyoutContents(),v.Events.fire(new C(this.workspace_.id)),this.options.useFilledBackpackImage&&this.svgImg_&&(this.contents_.length>0?this.svgImg_.setAttributeNS(v.utils.dom.XLINK_NS,"xlink:href",B):this.svgImg_.setAttributeNS(v.utils.dom.XLINK_NS,"xlink:href",V))}filterDuplicates(P){return P.filter((z,se)=>P.indexOf(z)===se&&this.contents_.indexOf(z)===-1)}isOpenable(){return!(this.isOpen()||!this.options.allowEmptyBackpackOpen)||this.getCount()>0}isOpen(){return!!this.flyout_&&this.flyout_.isVisible()}open(){var P;if(!this.isOpenable())return;const z=this.contents_.map(se=>JSON.parse(se));(P=this.flyout_)===null||P===void 0||P.show(z),this.workspace_.scrollbar&&this.workspace_.scrollbar.setVisible&&this.workspace_.scrollbar.setVisible(!1),v.Events.fire(new R(!0,this.workspace_.id))}maybeRefreshFlyoutContents(){var P;if(!this.isOpen())return;const z=this.contents_.map(se=>JSON.parse(se));(P=this.flyout_)===null||P===void 0||P.show(z)}close(){var P;this.isOpen()&&((P=this.flyout_)===null||P===void 0||P.hide(),this.workspace_.scrollbar&&this.workspace_.scrollbar.setVisible&&this.workspace_.scrollbar.setVisible(!0),v.Events.fire(new R(!1,this.workspace_.id)))}autoHide(P){P||this.close()}onClick(P){if(P instanceof MouseEvent&&v.browserEvents.isRightButton(P))return;this.open();const z=new(v.Events.get(v.Events.CLICK))(null,this.workspace_.id,"backpack");v.Events.fire(z)}onDragEnter(P){N(P)&&this.updateHoverStying(!0)}onDragExit(P){this.updateHoverStying(!1)}onMouseOver(){this.isOpenable()&&this.updateHoverStying(!0)}onMouseOut(){this.updateHoverStying(!1)}updateHoverStying(P){const z="blocklyBackpackDarken";this.svgImg_&&(P?v.utils.dom.addClass(this.svgImg_,z):v.utils.dom.removeClass(this.svgImg_,z))}shouldPreventMove(P){return P instanceof v.BlockSvg}blockMouseDownWhenOpenable(P){P instanceof MouseEvent&&!v.browserEvents.isRightButton(P)&&this.isOpenable()&&P.stopPropagation()}}const V="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiM0NTVBNjQiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PGc+PHBhdGggZD0iTTEzLjk3LDUuMzRDMTMuOTgsNS4yMywxNCw1LjEyLDE0LDVjMC0xLjEtMC45LTItMi0ycy0yLDAuOS0yLDJjMCwwLjEyLDAuMDIsMC4yMywwLjAzLDAuMzRDNy42OSw2LjE1LDYsOC4zOCw2LDExdjggYzAsMS4xLDAuOSwyLDIsMmg4YzEuMSwwLDItMC45LDItMnYtOEMxOCw4LjM4LDE2LjMxLDYuMTUsMTMuOTcsNS4zNHogTTExLDVjMC0wLjU1LDAuNDUtMSwxLTFzMSwwLjQ1LDEsMSBjMCwwLjAzLTAuMDEsMC4wNi0wLjAyLDAuMDlDMTIuNjYsNS4wMywxMi4zNCw1LDEyLDVzLTAuNjYsMC4wMy0wLjk4LDAuMDlDMTEuMDEsNS4wNiwxMSw1LjAzLDExLDV6IE0xNiwxM3YxdjAuNSBjMCwwLjI4LTAuMjIsMC41LTAuNSwwLjVTMTUsMTQuNzgsMTUsMTQuNVYxNHYtMUg4di0xaDdoMVYxM3oiLz48L2c+PC9nPjwvc3ZnPg==",B="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMjQiCiAgIGhlaWdodD0iMjQiCiAgIHZpZXdCb3g9IjAgMCAyNCAyNCIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNSIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzMiIgLz4KICA8ZwogICAgIGlkPSJsYXllcjEiPgogICAgPGcKICAgICAgIHN0eWxlPSJmaWxsOiM0NTVhNjQiCiAgICAgICBpZD0iZzg0OCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuMjY0NTgzMzMsMCwwLDAuMjY0NTgzMzMsOC44MjQ5OTk3LDguODI0OTk5NykiPgogICAgICA8ZwogICAgICAgICBpZD0iZzgyNiI+CiAgICAgICAgPHJlY3QKICAgICAgICAgICBmaWxsPSJub25lIgogICAgICAgICAgIGhlaWdodD0iMjQiCiAgICAgICAgICAgd2lkdGg9IjI0IgogICAgICAgICAgIGlkPSJyZWN0ODI0IgogICAgICAgICAgIHg9IjAiCiAgICAgICAgICAgeT0iMCIgLz4KICAgICAgPC9nPgogICAgICA8ZwogICAgICAgICBpZD0iZzgzNCI+CiAgICAgICAgPGcKICAgICAgICAgICBpZD0iZzgyOCIgLz4KICAgICAgICA8ZwogICAgICAgICAgIGlkPSJnMjIyMyI+CiAgICAgICAgICA8ZwogICAgICAgICAgICAgaWQ9ImcyMTAxNiI+CiAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgIHN0eWxlPSJmaWxsOiM0NTVhNjQiCiAgICAgICAgICAgICAgIGlkPSJnMTQ5MyIKICAgICAgICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMy43Nzk1Mjc2LDAsMCwzLjc3OTUyNzYsLTMzLjM1NDMzLC0zMy4zNTQzMykiPgogICAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgICAgaWQ9ImcxNDcxIj4KICAgICAgICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICAgICAgICBpZD0icmVjdDE0NjkiCiAgICAgICAgICAgICAgICAgICBzdHlsZT0iZmlsbDpub25lIgogICAgICAgICAgICAgICAgICAgZD0iTSAwLDAgSCAyNCBWIDI0IEggMCBaIiAvPgogICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICA8ZwogICAgICAgICAgICAgICAgIGlkPSJnMTQ3OSI+CiAgICAgICAgICAgICAgICA8ZwogICAgICAgICAgICAgICAgICAgaWQ9ImcxNDczIiAvPgogICAgICAgICAgICAgICAgPGcKICAgICAgICAgICAgICAgICAgIGlkPSJnMTQ3NyI+CiAgICAgICAgICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICAgICAgICAgIGlkPSJwYXRoMTQ3NSIKICAgICAgICAgICAgICAgICAgICAgZD0ibSAxMiwzIGMgLTEuMSwwIC0yLDAuOSAtMiwyIDAsMC4xMiAwLjAxOTMsMC4yMjk4NDM4IDAuMDI5MywwLjMzOTg0MzggQyA3LjY4OTI5NjUsNi4xNDk4NDMzIDYsOC4zOCA2LDExIHYgOCBjIDAsMS4xIDAuOSwyIDIsMiBoIDggYyAxLjEsMCAyLC0wLjkgMiwtMiBWIDExIEMgMTgsOC4zOCAxNi4zMTA3MDMsNi4xNDk4NDMzIDEzLjk3MDcwMyw1LjMzOTg0MzggMTMuOTgwNzAzLDUuMjI5ODQzOCAxNCw1LjEyIDE0LDUgMTQsMy45IDEzLjEsMyAxMiwzIFogbSAwLDEgYyAwLjU1LDAgMSwwLjQ1IDEsMSAwLDAuMDMgLTAuMDA5NSwwLjA1OTg0NCAtMC4wMTk1MywwLjA4OTg0NCBDIDEyLjY2MDQ2OSw1LjAyOTg0MzggMTIuMzQsNSAxMiw1IDExLjY2LDUgMTEuMzM5NTMxLDUuMDI5ODQzOCAxMS4wMTk1MzEsNS4wODk4NDM4IDExLjAwOTUzMSw1LjA1OTg0MzggMTEsNS4wMyAxMSw1IDExLDQuNDUgMTEuNDUsNCAxMiw0IFogbSAtMy40NzI2NTYyLDYuMzk4NDM4IGggMS4xNTYyNSB2IDIuNjQwNjI0IGggMC4zMDkzMzU0IGwgLTIuMzdlLTUsLTEuMTcxMTQ2IDEuMDgyNzEwNSwtMTBlLTcgMC4wMTEsMS4xNzExNDYgaCAwLjMzMzMwNCBsIC0wLjAzNTA0LC0yLjU4NzMxNSBoIDAuNTc4MTI1IDAuNTc4MTI1IGwgMC4wMTEwNSwyLjU4NzMxNSBoIDAuMzU2MDI0IFYgMTIuMDYwNTQ3IEggMTQuMDYyNSB2IDAuOTc4NTE1IGggMC4zMzAwNzggdiAtMi41NTI3MzQgaCAxLjE1NjI1IHYgMi41NTI3MzQgaCAwLjk2Njc5NyB2IDAuMzU3NDIyIEggOS42ODM1OTM4IDguNTI3MzQzOCA3LjYwMzUxNTYgdiAtMC4zNTc0MjIgaCAwLjkyMzgyODIgeiIKICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICAgIDwvZz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=";v.Css.register(`
.blocklyBackpack {
  opacity: 0.4;
}
.blocklyBackpackDarken {
  opacity: 0.6;
}
.blocklyBackpack:active {
  opacity: 0.8;
}
`);class ie{constructor(){this.priority=v.serialization.priorities.BLOCKS-10}save(P){const z=P.getComponentManager().getComponent("backpack");return z==null?void 0:z.getContents().map(se=>JSON.parse(se))}load(P,z){const se=P.map(he=>JSON.stringify(he)),re=z.getComponentManager().getComponent("backpack");re==null||re.setContents(se)}clear(P){const z=P.getComponentManager().getComponent("backpack");z==null||z.empty()}}return T})())}(dist$1)),dist$1.exports}var distExports=requireDist();const shape$V={type:"reality2_action_set_data",message0:"data %1",args0:[{type:"field_input",name:"value",check:"String",text:""}],colour:300,output:"Json",tooltip:"Set the variable as a copy of the Bee's data.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$V(n,c){const l=n.getFieldValue("value"),p={data:l===""?null:R2.ToJSON(l)};return[JSON.stringify(p),99]}function construct$S(n){return n?{kind:"BLOCK",type:"reality2_action_set_data",fields:{value:R2.ToSimple(R2.JSONPath(n,"data"))}}:null}const reality2_action_set_data={shape:shape$V,process:process$V,construct:construct$S},shape$U={type:"reality2_action_set_jsonpath",message0:"jsonpath %1",args0:[{type:"field_input",name:"value",check:"String",text:""}],colour:300,output:"Json",tooltip:"A JSON Path, which is a string used to pick data out of a JSON stucture.  For example 'information.[].name' returns and array of names from the information array, whilst 'information.0.name' returns the name of the first element of the information array.  If the JSON key doesn't exist, null is returned.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$U(n,c){const l=n.getFieldValue("value"),p={jsonpath:l===""?null:R2.ToJSON(l)};return[JSON.stringify(p),99]}function construct$R(n){return n?{kind:"BLOCK",type:"reality2_action_set_jsonpath",fields:{value:R2.ToSimple(R2.JSONPath(n,"jsonpath"))}}:null}const reality2_action_set_jsonpath={shape:shape$U,process:process$U,construct:construct$R},shape$T={type:"reality2_action_set_value",message0:"%1",args0:[{type:"field_input",name:"value",check:"String",text:""}],colour:300,output:"Json",tooltip:"A value, which can be a number, a string or JSON.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$T(n,c){const l=n.getFieldValue("value"),p=l===""?null:R2.ToJSON(l);return[JSON.stringify(p),99]}function construct$Q(n){return n!=null?{kind:"BLOCK",type:"reality2_action_set_value",fields:{value:R2.ToSimple(n)}}:null}const reality2_action_set_value={shape:shape$T,process:process$T,construct:construct$Q},shape$S={type:"reality2_action_set_calc_binary",message0:"( %1 %2 %3 )",args0:[{type:"input_value",name:"value1"},{type:"field_dropdown",name:"operator",options:[["+","+"],["-","-"],["*","*"],["/","/"],["&&","&&"],["||","||"],["==","=="],["!=","!="],["<","<"],[">",">"],["<=","<="],[">=",">="],["pow","pow"],["fmod","fmod"],["atan2","atan2"],["geohash","geohash"]]},{type:"input_value",name:"value2"}],colour:300,output:"Json",tooltip:"An binary expression",helpUrl:"https://github.com/reality-two/reality2-documentation",inputsInline:!0};function process$S(n,c){const l=c.valueToCode(n,"value1",99),h=c.valueToCode(n,"value2",99),p=n.getFieldValue("operator"),g=l===""?null:R2.ToJSON(l),T=h===""?null:R2.ToJSON(h),v=R2.JSONPath(g,"expr")?R2.JSONPath(g,"expr"):g,I=R2.JSONPath(T,"expr")?R2.JSONPath(T,"expr"):T;let R={};return R[p]=[v,I],[JSON.stringify({expr:R}),99]}function construct$P(n){if(n){const c=Object.keys(n)[0],l=n[c];if(l.length==1){let h={kind:"BLOCK",type:"reality2_action_set_calc_unary",fields:{operator:c},inputs:{value1:{}}};return typeof l[0]=="object"?h.inputs.value1={block:construct$P(l[0])}:h.inputs.value1={block:reality2_action_set_value.construct(l[0])},h}else if(l.length==2){let h={kind:"BLOCK",type:"reality2_action_set_calc_binary",fields:{operator:c},inputs:{value1:{},value2:{}}};return typeof l[0]=="object"?h.inputs.value1={block:construct$P(l[0])}:h.inputs.value1={block:reality2_action_set_value.construct(l[0])},typeof l[1]=="object"?h.inputs.value2={block:construct$P(l[1])}:h.inputs.value2={block:reality2_action_set_value.construct(l[1])},h}else return null}else return null}const reality2_action_set_calc_binary={shape:shape$S,process:process$S,construct:construct$P},shape$R={type:"reality2_action_set",message0:"set %1 to %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"input_value",name:"value",check:"Json",text:""}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Set a variable in the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$R(n,c){const l=n.getFieldValue("key"),h=c.valueToCode(n,"value",99),p=h===""?null:R2.ToJSON(h);return JSON.stringify({command:"set",parameters:{key:l,value:p}})}function construct$O(n){if(n){let c={kind:"BLOCK",type:"reality2_action_set",fields:{key:R2.JSONPath(n,"parameters.key")},inputs:{value:{}}};return R2.JSONPath(n,"parameters.value.data")?c.inputs.value={block:reality2_action_set_data.construct(R2.JSONPath(n,"parameters.value"))}:R2.JSONPath(n,"parameters.value.jsonpath")?c.inputs.value={block:reality2_action_set_jsonpath.construct(R2.JSONPath(n,"parameters.value"))}:R2.JSONPath(n,"parameters.value.expr")?c.inputs.value={block:reality2_action_set_calc_binary.construct(R2.JSONPath(n,"parameters.value.expr"))}:c.inputs.value={block:reality2_action_set_value.construct(R2.JSONPath(n,"parameters.value"))},c}else return null}const reality2_action_set={shape:shape$R,process:process$R,construct:construct$O},shape$Q={type:"reality2_action_set_clear",message0:"clear %1",args0:[{type:"field_input",name:"key",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Remove a variable from the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$Q(n,c){const h={command:"set",parameters:{key:n.getFieldValue("key")}};return JSON.stringify(h)}function construct$N(n){return n?{kind:"BLOCK",type:"reality2_action_set_clear",fields:{key:R2.JSONPath(n,"parameters.key")}}:null}const reality2_action_set_clear={shape:shape$Q,process:process$Q,construct:construct$N},shape$P={type:"reality2_action_debug",message0:"debug",previousStatement:null,nextStatement:null,colour:300,tooltip:"A Debug Task that shows the current data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$P(n,c){return JSON.stringify({command:"debug"})}function construct$M(n){return n?{kind:"BLOCK",type:"reality2_action_debug"}:null}const reality2_action_debug={shape:shape$P,process:process$P,construct:construct$M},shape$O={type:"reality2_action_parameter",message0:"param %1 = %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"field_input",name:"value",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$O(n,c){const l=n.getFieldValue("key"),h=R2.ToJSON(n.getFieldValue("value"));var p={};return p[l]=h,JSON.stringify(p)}function construct$L(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_action_parameter",fields:{key:c[0],value:R2.ToSimple(R2.JSONPath(n,c[0]))}};delete n[c[0]];let h=construct$L(n);return h&&(l.next={block:h}),l}else return null}else return null}const reality2_action_parameter={shape:shape$O,process:process$O,construct:construct$L},shape$N={type:"reality2_action_send",message0:"send %1 to %2 after %3 milliseconds",args0:[{type:"field_input",name:"event",check:"String",text:""},{type:"field_input",name:"to",check:"String",text:""},{type:"field_input",name:"delay",check:"Number",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:"reality2_action_parameter"}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Send an event after a delay with some additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$N(n,c){var l={};const h=n.getFieldValue("event"),p=n.getFieldValue("to"),g=R2.ToSimple(n.getFieldValue("delay")),T=c.statementToCode(n,"parameters");T!==""&&(l=splitConcatenatedJSON(T));const v={command:"send",parameters:{event:h}};return p!==""&&p!=="me"&&(v.parameters.to=p),Object.keys(l).length!==0&&(v.parameters.parameters=l),g&&g>0&&(v.parameters.delay=g),JSON.stringify(v)}function construct$K(n){if(n){let c=R2.ToSimple(R2.JSONPath(n,"parameters.delay")),l=R2.JSONPath(n,"parameters.to"),h={kind:"BLOCK",type:"reality2_action_send",fields:{event:R2.JSONPath(n,"parameters.event"),to:l===""?"me":l,delay:c!==null&&c>0?c:""},inputs:{parameters:{}}},p=reality2_action_parameter.construct(R2.JSONPath(n,"parameters.parameters"));return p&&(h.inputs.parameters={block:p}),h}else return null}const reality2_action_send={shape:shape$N,process:process$N,construct:construct$K},shape$M={type:"reality2_action_send_no_params",message0:"send %1 to %2 after %3 milliseconds",args0:[{type:"field_input",name:"event",check:"String",text:""},{type:"field_input",name:"to",check:"String",text:""},{type:"field_input",name:"delay",check:"Number",text:""}],previousStatement:null,nextStatement:null,colour:330,tooltip:"Send an event after a delay.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$M(n,c){const l=n.getFieldValue("event"),h=n.getFieldValue("to"),p=R2.ToSimple(n.getFieldValue("delay")),g={command:"send",parameters:{event:l}};return h&&(g.parameters.to=h),p&&p>0&&(g.parameters.delay=p),JSON.stringify(g)}function construct$J(n){if(n){let c=R2.ToSimple(R2.JSONPath(n,"parameters.delay")),l=R2.JSONPath(n,"parameters.to");return{kind:"BLOCK",type:"reality2_action_send_no_params",fields:{event:R2.JSONPath(n,"parameters.event"),to:l,delay:c&&c>0?c:""}}}else return null}const reality2_action_send_no_params={shape:shape$M,process:process$M,construct:construct$J},shape$L={type:"reality2_action_send_now",message0:"send %1 to %2",args0:[{type:"field_input",name:"event",check:"String",text:""},{type:"field_input",name:"to",check:"String",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:"reality2_action_parameter"}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Send an event with some additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$L(n,c){var l={};const h=n.getFieldValue("event"),p=n.getFieldValue("to"),g=c.statementToCode(n,"parameters");g!==""&&(l=splitConcatenatedJSON(g));const T={command:"send",parameters:{event:h}};return p&&(T.parameters.to=p),Object.keys(l).length!==0&&(T.parameters.parameters=l),JSON.stringify(T)}function construct$I(n){if(n){R2.ToSimple(R2.JSONPath(n,"parameters.delay"));let c=R2.JSONPath(n,"parameters.to"),l={kind:"BLOCK",type:"reality2_action_send_now",fields:{event:R2.JSONPath(n,"parameters.event"),to:c},inputs:{parameters:{}}},h=reality2_action_parameter.construct(R2.JSONPath(n,"parameters.parameters"));return h&&(l.inputs.parameters={block:h}),l}else return null}const reality2_action_send_now={shape:shape$L,process:process$L,construct:construct$I},shape$K={type:"reality2_action_send_now_no_params",message0:"send %1 to %2",args0:[{type:"field_input",name:"event",check:"String",text:""},{type:"field_input",name:"to",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:330,tooltip:"Send an event.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$K(n,c){const l=n.getFieldValue("event"),h=n.getFieldValue("to"),p={command:"send",parameters:{event:l}};return h&&(p.parameters.to=h),JSON.stringify(p)}function construct$H(n){if(n){R2.ToSimple(R2.JSONPath(n,"parameters.delay"));let c=R2.JSONPath(n,"parameters.to");return{kind:"BLOCK",type:"reality2_action_send_now_no_params",fields:{event:R2.JSONPath(n,"parameters.event"),to:c}}}else return null}const reality2_action_send_now_no_params={shape:shape$K,process:process$K,construct:construct$H},shape$J={type:"reality2_action_send_plugin",message0:"send %1 to antenna %2",args0:[{type:"field_input",name:"command",check:"String",text:""},{type:"field_input",name:"plugin",check:"String",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:"reality2_action_parameter"}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Send an event to an antenna with some additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$J(n,c){var l={};const h=n.getFieldValue("plugin"),p=n.getFieldValue("command"),g=c.statementToCode(n,"parameters");g!==""&&(l=splitConcatenatedJSON(g));const T={command:p,plugin:h};return Object.keys(l).length!==0&&(T.parameters=l),JSON.stringify(T)}function construct$G(n){if(n){let c={kind:"BLOCK",type:"reality2_action_send_plugin",fields:{plugin:R2.JSONPath(n,"plugin"),command:R2.JSONPath(n,"command")},inputs:{parameters:{}}},l=reality2_action_parameter.construct(R2.JSONPath(n,"parameters.parameters"));return l&&(c.inputs.parameters={block:l}),c}else return null}const reality2_action_send_plugin={shape:shape$J,process:process$J,construct:construct$G},shape$I={type:"reality2_action_send_plugin_no_params",message0:"send %1 to antenna %2",args0:[{type:"field_input",name:"command",check:"String",text:""},{type:"field_input",name:"plugin",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:330,tooltip:"Send an event to an antenna.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$I(n,c){const l=n.getFieldValue("plugin"),p={command:n.getFieldValue("command"),plugin:l};return JSON.stringify(p)}function construct$F(n){return n?{kind:"BLOCK",type:"reality2_action_send_plugin_no_params",fields:{plugin:R2.JSONPath(n,"plugin"),command:R2.JSONPath(n,"command")}}:null}const reality2_action_send_plugin_no_params={shape:shape$I,process:process$I,construct:construct$F},shape$H={type:"reality2_action_send_plugin_no_params_no_event",message0:"send to antenna %1",args0:[{type:"field_input",name:"plugin",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:330,tooltip:"Send to an antenna.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$H(n,c){const h={command:"send",plugin:n.getFieldValue("plugin")};return JSON.stringify(h)}function construct$E(n){return n?{kind:"BLOCK",type:"reality2_action_send_plugin_no_params_no_event",fields:{plugin:R2.JSONPath(n,"plugin")}}:null}const reality2_action_send_plugin_no_params_no_event={shape:shape$H,process:process$H,construct:construct$E},shape$G={type:"reality2_action_signal",message0:"signal %1",args0:[{type:"field_input",name:"event",check:"String",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:"reality2_action_parameter"}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Send a signal to any connected devices, with some additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$G(n,c){var l={};const h=n.getFieldValue("event"),p=c.statementToCode(n,"parameters");p!==""&&(l=splitConcatenatedJSON(p));const g={command:"signal",parameters:{event:h,public:!0}};return Object.keys(l).length!==0&&(g.parameters.parameters=l),JSON.stringify(g)}function construct$D(n){if(R2.JSONPath(n,"parameters.public")===!0||R2.JSONPath(n,"public"),n){let c={kind:"BLOCK",type:"reality2_action_signal",fields:{event:R2.JSONPath(n,"parameters.event")},inputs:{parameters:{}}},l=reality2_action_parameter.construct(R2.JSONPath(n,"parameters.parameters"));return l&&(c.inputs.parameters={block:l}),c}else return null}const reality2_action_signal={shape:shape$G,process:process$G,construct:construct$D},shape$F={type:"reality2_action_signal_no_params",message0:"signal %1",args0:[{type:"field_input",name:"event",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:330,tooltip:"Send a signal to any connected devices.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$F(n,c){const h={command:"signal",parameters:{event:n.getFieldValue("event"),public:!0}};return JSON.stringify(h)}function construct$C(n){return R2.JSONPath(n,"parameters.public")===!0||R2.JSONPath(n,"public"),n?{kind:"BLOCK",type:"reality2_action_signal_no_params",fields:{event:R2.JSONPath(n,"parameters.event")}}:null}const reality2_action_signal_no_params={shape:shape$F,process:process$F,construct:construct$C},shape$E={type:"reality2_action_test",message0:"if %1",args0:[{type:"input_value",name:"if"}],message1:"send %1",args1:[{type:"field_input",name:"then",check:"String",text:""}],message2:"otherwise send %1",args2:[{type:"field_input",name:"else",check:"String",text:""}],message3:"to %1",args3:[{type:"field_input",name:"to",check:"String",text:""}],message4:"with %1",args4:[{type:"input_statement",name:"parameters",check:"reality2_action_parameter"}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Test the condition, and if true, send one event or send the other.",helpUrl:"https://github.com/reality-two/reality2-documentation",inputsInline:!0};function process$E(n,c){var l={};const h=c.valueToCode(n,"if",99),p=h===""?null:R2.JSONPath(R2.ToJSON(h),"expr"),g=n.getFieldValue("then"),T=n.getFieldValue("else"),v=n.getFieldValue("to"),I=c.statementToCode(n,"parameters");I!==""&&(l=splitConcatenatedJSON(I));const R={command:"test",parameters:{if:p,then:g}};return T!==""&&(R.parameters.else=T),v!==""&&v!=="me"&&(R.parameters.to=v),Object.keys(l).length!==0&&(R.parameters.parameters=l),JSON.stringify(R)}function construct$B(n){if(n){let c=R2.JSONPath(n,"parameters.to"),l={kind:"BLOCK",type:"reality2_action_test",fields:{then:R2.JSONPath(n,"parameters.then"),else:R2.JSONPath(n,"parameters.else"),to:c===""?"me":c},inputs:{if:{block:reality2_action_set_calc_binary.construct(R2.JSONPath(n,"parameters.if"))},parameters:{}}},h=reality2_action_parameter.construct(R2.JSONPath(n,"parameters.parameters"));return h&&(l.inputs.parameters={block:h}),l}else return null}const reality2_action_test={shape:shape$E,process:process$E,construct:construct$B},shape$D={type:"reality2_action_test_no_params",message0:"if %1",args0:[{type:"input_value",name:"if"}],message1:"send %1",args1:[{type:"field_input",name:"then",check:"String",text:""}],message2:"otherwise send %1",args2:[{type:"field_input",name:"else",check:"String",text:""}],message3:"to %1",args3:[{type:"field_input",name:"to",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Test the condition, and if true, send one event or send the other.",helpUrl:"https://github.com/reality-two/reality2-documentation",inputsInline:!0};function process$D(n,c){const l=c.valueToCode(n,"if",99),h=l===""?null:R2.JSONPath(R2.ToJSON(l),"expr"),p=n.getFieldValue("then"),g=n.getFieldValue("else"),T=n.getFieldValue("to"),v={command:"test",parameters:{if:h,then:p}};return g!==""&&(v.parameters.else=g),T!==""&&T!=="me"&&(v.parameters.to=T),JSON.stringify(v)}function construct$A(n){if(n){let c=R2.JSONPath(n,"parameters.to");return{kind:"BLOCK",type:"reality2_action_test_no_params",fields:{then:R2.JSONPath(n,"parameters.then"),else:R2.JSONPath(n,"parameters.else"),to:c===""?"me":c},inputs:{if:{block:reality2_action_set_calc_binary.construct(R2.JSONPath(n,"parameters.if"))}}}}else return null}const reality2_action_test_no_params={shape:shape$D,process:process$D,construct:construct$A},shape$C={type:"reality2_action_test_simple",message0:"if %1 send %2",args0:[{type:"input_value",name:"if"},{type:"field_input",name:"then",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:300,tooltip:"Test the condition, and if true, send one event or send the other.",helpUrl:"https://github.com/reality-two/reality2-documentation",inputsInline:!0};function process$C(n,c){const l=c.valueToCode(n,"if",99),h=l===""?null:R2.JSONPath(R2.ToJSON(l),"expr"),p=n.getFieldValue("then");return JSON.stringify({command:"test",parameters:{if:h,then:p}})}function construct$z(n){if(n){let c=R2.JSONPath(n,"parameters.to");return{kind:"BLOCK",type:"reality2_action_test_simple",fields:{then:R2.JSONPath(n,"parameters.then"),to:c===""?"me":c},inputs:{if:{block:reality2_action_set_calc_binary.construct(R2.JSONPath(n,"parameters.if"))}}}}else return null}const reality2_action_test_simple={shape:shape$C,process:process$C,construct:construct$z},shape$B={type:"ai_reality2_vars_set",message0:"store %1 as %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"field_input",name:"value",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Store a persistent variable.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$B(n,c){const l=n.getFieldValue("key"),h=R2.convert(n.getFieldValue("value"));return JSON.stringify({plugin:"ai.reality2.vars",command:"set",parameters:{key:l,value:h}})}function construct$y(n){return n?{kind:"BLOCK",type:"ai_reality2_vars_set",fields:{key:R2.JSONPath(n,"parameters.key"),value:R2.JSONPath(n,"parameters.value")}}:null}const ai_reality2_vars_set={shape:shape$B,process:process$B,construct:construct$y},shape$A={type:"ai_reality2_vars_set_no_value",message0:"store %1",args0:[{type:"field_input",name:"key",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Store a persistent variable from the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$A(n,c){const l=n.getFieldValue("key"),h={plugin:"ai.reality2.vars",command:"set",parameters:{key:l,value:"__"+l+"__"}};return JSON.stringify(h)}function construct$x(n){return n?{kind:"BLOCK",type:"ai_reality2_vars_set_no_value",fields:{key:R2.JSONPath(n,"parameters.key")}}:null}const ai_reality2_vars_set_no_value={shape:shape$A,process:process$A,construct:construct$x},shape$z={type:"ai_reality2_vars_get",message0:"fetch %1",args0:[{type:"field_input",name:"key",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Fetch a persistent variable.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$z(n,c){const h={plugin:"ai.reality2.vars",command:"get",parameters:{key:n.getFieldValue("key")}};return JSON.stringify(h)}function construct$w(n){return n?{kind:"BLOCK",type:"ai_reality2_vars_get",fields:{key:R2.JSONPath(n,"parameters.key")}}:null}const ai_reality2_vars_get={shape:shape$z,process:process$z,construct:construct$w},shape$y={type:"ai_reality2_vars_all",message0:"fetch all",previousStatement:null,nextStatement:null,colour:360,tooltip:"Fetch a persistent variable.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$y(n,c){return n.getFieldValue("key"),JSON.stringify({plugin:"ai.reality2.vars",command:"all"})}function construct$v(n){return n?{kind:"BLOCK",type:"ai_reality2_vars_all"}:null}const ai_reality2_vars_all={shape:shape$y,process:process$y,construct:construct$v},shape$x={type:"ai_reality2_vars_clear",message0:"clear all",previousStatement:null,nextStatement:null,colour:360,tooltip:"Clears all the persistent variables for this Bee.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$x(n,c){return n.getFieldValue("key"),JSON.stringify({plugin:"ai.reality2.vars",command:"clear"})}function construct$u(n){return n?{kind:"BLOCK",type:"ai_reality2_vars_clear"}:null}const ai_reality2_vars_clear={shape:shape$x,process:process$x,construct:construct$u},shape$w={type:"ai_reality2_geospatial_set",message0:"set geospatial",message1:"latitude %1",args1:[{type:"field_input",name:"latitude",check:"String",text:""}],message2:"longitude %1",args2:[{type:"field_input",name:"longitude",check:"String",text:""}],message3:"OR geohash %1",args3:[{type:"field_input",name:"geohash",check:"String",text:""}],message4:"altitude %1",args4:[{type:"field_input",name:"altitude",check:"String",text:"0"}],message5:"radius %1",args5:[{type:"field_input",name:"radius",check:"String",text:"0"}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Set geospatial parameters on a Bee.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$w(n,c){const l=R2.convert(n.getFieldValue("latitude")),h=R2.convert(n.getFieldValue("longitude")),p=n.getFieldValue("geohash"),g=R2.convert(n.getFieldValue("altitude")),T=R2.convert(n.getFieldValue("radius"));return JSON.stringify({plugin:"ai.reality2.geospatial",command:"set",parameters:{latitude:l,longitude:h,altitude:g,geohash:p,radius:T}})}function construct$t(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_set",fields:{latitude:R2.JSONPath(n,"parameters.latitude"),longitude:R2.JSONPath(n,"parameters.longitude"),altitude:R2.JSONPath(n,"parameters.altitude"),geohash:R2.JSONPath(n,"parameters.geohash"),radius:R2.JSONPath(n,"parameters.radius")}}:null}const ai_reality2_geospatial_set={shape:shape$w,process:process$w,construct:construct$t},shape$v={type:"ai_reality2_geospatial_set_simple",message0:"set location",previousStatement:null,nextStatement:null,colour:360,tooltip:"Set geospatial parameters on a Bee from the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$v(n,c){return JSON.stringify({plugin:"ai.reality2.geospatial",command:"set"})}function construct$s(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_set_simple"}:null}const ai_reality2_geospatial_set_simple={shape:shape$v,process:process$v,construct:construct$s},shape$u={type:"ai_reality2_geospatial_set_geohash",message0:"set geohash %1",args0:[{type:"field_input",name:"geohash",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Set a Geohash.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$u(n,c){const h={command:"set",parameters:{key:"geohash",value:n.getFieldValue("geohash")}};return JSON.stringify(h)}function construct$r(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_set_geohash",fields:{geohash:R2.JSONPath(n,"parameters.geohash")}}:null}const ai_reality2_geospatial_set_geohash={shape:shape$u,process:process$u,construct:construct$r},shape$t={type:"ai_reality2_geospatial_set_radius",message0:"set radius %1",args0:[{type:"field_input",name:"radius",check:"String",text:"0"}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Set a radius of privacy for a location.  Seeker has to be within the radius in order to find this Bee.  A (default) value of zero (0) means no radius used.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$t(n,c){const h={command:"set",parameters:{key:"radius",value:R2.convert(n.getFieldValue("radius"))}};return JSON.stringify(h)}function construct$q(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_set_radius",fields:{radius:R2.JSONPath(n,"parameters.radius")}}:null}const ai_reality2_geospatial_set_radius={shape:shape$t,process:process$t,construct:construct$q},shape$s={type:"ai_reality2_geospatial_get",message0:"get location",previousStatement:null,nextStatement:null,colour:360,tooltip:"Get geospatial details from a Bee.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$s(n,c){return n.getFieldValue("key"),JSON.stringify({plugin:"ai.reality2.geospatial",command:"get"})}function construct$p(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_get"}:null}const ai_reality2_geospatial_get={shape:shape$s,process:process$s,construct:construct$p},shape$r={type:"ai_reality2_geospatial_search",message0:"search within radius %1",args0:[{type:"field_input",name:"radius",check:"Number",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Search for Bees within the given radius of this Bee (in meters) and return an array of those that are nearby in the 'to' variable.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$r(n,c){const l=R2.convert(n.getFieldValue("radius")),h={plugin:"ai.reality2.geospatial",command:"search"};return l&&(h.parameters={radius:l}),JSON.stringify(h)}function construct$o(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_search",fields:{radius:R2.JSONPath(n,"parameters.radius")}}:null}const ai_reality2_geospatial_search={shape:shape$r,process:process$r,construct:construct$o},shape$q={type:"ai_reality2_geospatial_remove",message0:"remove location",previousStatement:null,nextStatement:null,colour:360,tooltip:"Remove geospatial parameters from a Bee.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$q(n,c){return JSON.stringify({plugin:"ai.reality2.geospatial",command:"delete"})}function construct$n(n){return n?{kind:"BLOCK",type:"ai_reality2_geospatial_remove"}:null}const ai_reality2_geospatial_remove={shape:shape$q,process:process$q,construct:construct$n},shape$p={type:"ai_reality2_backup_save",message0:"save data flow",previousStatement:null,nextStatement:null,colour:360,tooltip:"Save data flow as encrypted blob to database on this node.  Remember to set the encryption and decryption keys in the Bee header.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$p(n,c){return JSON.stringify({plugin:"ai.reality2.backup",command:"store"})}function construct$m(n){return n?{kind:"BLOCK",type:"ai_reality2_backup_save"}:null}const ai_reality2_backup_save={shape:shape$p,process:process$p,construct:construct$m},shape$o={type:"ai_reality2_backup_load",message0:"load into data flow",previousStatement:null,nextStatement:null,colour:360,tooltip:"Load from the encrypted blob on this node into the data flow.  Remember to set the encryption and decryption keys in the Bee header.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$o(n,c){return JSON.stringify({plugin:"ai.reality2.backup",command:"retrieve"})}function construct$l(n){return n?{kind:"BLOCK",type:"ai_reality2_backup_load"}:null}const ai_reality2_backup_load={shape:shape$o,process:process$o,construct:construct$l},shape$n={type:"ai_reality2_backup_delete",message0:"delete saved data",previousStatement:null,nextStatement:null,colour:360,tooltip:"Delete encrypted blob from database on this node.  Remember to set the encryption and decryption keys in the Bee header.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$n(n,c){return JSON.stringify({plugin:"ai.reality2.backup",command:"delete"})}function construct$k(n){return n?{kind:"BLOCK",type:"ai_reality2_backup_delete"}:null}const ai_reality2_backup_delete={shape:shape$n,process:process$n,construct:construct$k};function splitConcatenatedJSON(n,c=!0){let l=[],h=0,p=0;for(let g=0;g<n.length;g++){const T=n[g];if(T==="{")h===0&&(p=g),h++;else if(T==="}"&&(h--,h===0))try{const v=JSON.parse(n.slice(p,g+1));l.push(v)}catch(v){console.error("Invalid JSON object:",v)}}return c?l.reduce((T,v)=>({...T,...v}),{}):l}function interpret_actions(n,c){let l=R2.JSONPath(n,"actions");if(l){let h=l.reduceRight((p,g)=>{let T,v=R2.JSONPath(g,"plugin");if(v=="ai.reality2.vars")switch(R2.JSONPath(g,"command")){case"set":let D=R2.JSONPath(g,"parameters.key");R2.JSONPath(g,"parameters.value")==="__"+D+"__"?(T=ai_reality2_vars_set_no_value.construct(g),T&&p&&(T.next={block:p})):(T=ai_reality2_vars_set.construct(g),T&&p&&(T.next={block:p}));break;case"get":T=ai_reality2_vars_get.construct(g),T&&p&&(T.next={block:p});break;case"all":T=ai_reality2_vars_all.construct(g),T&&p&&(T.next={block:p});break;case"delete":T=ai_reality2_vars_all.construct(g),T&&p&&(T.next={block:p});break;case"clear":T=ai_reality2_vars_clear.construct(g),T&&p&&(T.next={block:p});break}else if(v=="ai.reality2.geospatial")switch(R2.JSONPath(g,"command")){case"set":let D=R2.JSONPath(g,"parameters.latitude"),V=R2.JSONPath(g,"parameters.longitude"),B=R2.JSONPath(g,"parameters.geohash");!D&&!V&&!B?(T=ai_reality2_geospatial_set_simple.construct(g),T&&p&&(T.next={block:p})):!(D||V)&&B?(T=ai_reality2_geospatial_set_geohash.construct(g),T&&p&&(T.next={block:p})):(T=ai_reality2_geospatial_set.construct(g),T&&p&&(T.next={block:p}));break;case"get":T=ai_reality2_geospatial_get.construct(g),T&&p&&(T.next={block:p});break;case"search":T=ai_reality2_geospatial_search.construct(g),T&&p&&(T.next={block:p});break;case"remove":T=ai_reality2_geospatial_remove.construct(g),T&&p&&(T.next={block:p});break}else if(v=="ai.reality2.backup")switch(R2.JSONPath(g,"command")){case"store":T=ai_reality2_backup_save.construct(g),T&&p&&(T.next={block:p});break;case"retrieve":T=ai_reality2_backup_load.construct(g),T&&p&&(T.next={block:p});break;case"delete":T=ai_reality2_backup_delete.construct(g),T&&p&&(T.next={block:p});break}else if(R2.JSONPath(g,"plugin")){var I=R2.JSONPath(g,"parameters.parameters");I&&Object.keys(I).length>0?(T=reality2_action_send_plugin.construct(g),T&&p&&(T.next={block:p})):R2.JSONPath(g,"command")==="send"?(T=reality2_action_send_plugin_no_params_no_event.construct(g),T&&p&&(T.next={block:p})):(T=reality2_action_send_plugin_no_params.construct(g),T&&p&&(T.next={block:p}))}else switch(R2.JSONPath(g,"command")){case"set":let N=R2.JSONPath(g,"parameters.value");if(N!=null){switch(N){case"radius":T=ai_reality2_geospatial_set_radius.construct(g);break;case"geohash":T=ai_reality2_geospatial_set_geohash.construct(g);break;default:T=reality2_action_set.construct(g);break}T&&p&&(T.next={block:p})}else T=reality2_action_set_clear.construct(g),T&&p&&(T.next={block:p});break;case"send":var R=R2.ToSimple(R2.JSONPath(g,"parameters.delay")),I=R2.JSONPath(g,"parameters.parameters");R>0?I&&Object.keys(I).length>0?(T=reality2_action_send.construct(g),T&&p&&(T.next={block:p})):(T=reality2_action_send_no_params.construct(g),T&&p&&(T.next={block:p})):I&&Object.keys(I).length>0?(T=reality2_action_send_now.construct(g),T&&p&&(T.next={block:p})):(T=reality2_action_send_now_no_params.construct(g),T&&p&&(T.next={block:p}));break;case"signal":var I=R2.JSONPath(g,"parameters.parameters");I&&Object.keys(I).length>0?(T=reality2_action_signal.construct(g),T&&p&&(T.next={block:p})):(T=reality2_action_signal_no_params.construct(g),T&&p&&(T.next={block:p}));break;case"debug":T=reality2_action_debug.construct(g),T&&p&&(T.next={block:p});break;case"test":var I=R2.JSONPath(g,"parameters.parameters"),w=R2.JSONPath(g,"parameters.else"),C=R2.JSONPath(g,"parameters.to");I&&Object.keys(I).length>0?(T=reality2_action_test.construct(g),T&&p&&(T.next={block:p})):w||C?(T=reality2_action_test_no_params.construct(g),T&&p&&(T.next={block:p})):(T=reality2_action_test_simple.construct(g),T&&p&&(T.next={block:p}));break}return T},null);c.inputs.actions={block:h}}return c}const shape$m={type:"reality2_key_value",message0:"key %1 = %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"field_input",name:"value",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:50,tooltip:"Keys, which are a form of data, useful for storing secret data such as API keys.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$m(n,c){const l=n.getFieldValue("key"),h=R2.convert(n.getFieldValue("value"));var p={};return p[l]=h,JSON.stringify(p)}function construct$j(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_key_value",fields:{key:c[0],value:R2.JSONPath(n,c[0])}};if(delete n[c[0]],Object.keys(n).length>0){let h=construct$j(n);h&&(l.next={block:h})}return l}else return null}else return null}const reality2_key_value={shape:shape$m,process:process$m,construct:construct$j},shape$l={type:"reality2_encrypt_decrypt_keys",message0:"encryption_key = %1",args0:[{type:"field_input",name:"encryption_key",check:"String",text:"__encryption_key__"}],message1:"decryption_key = %1",args1:[{type:"field_input",name:"decryption_key",check:"String",text:"__decryption_key__"}],previousStatement:null,nextStatement:null,colour:50,tooltip:"Keys, which are a form of data, used specifically for encrypting and decrypting information stored on the Node.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$l(n,c){const l=n.getFieldValue("encryption_key"),h=n.getFieldValue("decryption_key");return JSON.stringify({encryption_key:l,decryption_key:h})}function construct$i(n){if(n){const c=R2.JSONPath(n,"encryption_key");c&&delete n.encryption_key;const l=R2.JSONPath(n,"decryption_key");l&&delete n.decryption_key;let h={kind:"BLOCK",type:"reality2_encrypt_decrypt_keys",fields:{encryption_key:c,decryption_key:l}};if(Object.keys(n).length>0){let p=reality2_key_value.construct(n);p&&(h.next={block:p})}return h}else return null}const reality2_encrypt_decrypt_keys={shape:shape$l,process:process$l,construct:construct$i},shape$k={type:"reality2_data",message0:"data %1 = %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"field_input",name:"value",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:50,tooltip:"Data included with the Bee when set up.  This cannot be altered once the Bee is active, but can be used in the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$k(n,c){const l=n.getFieldValue("key"),h=R2.ToJSON(n.getFieldValue("value"));var p={};return p[l]=h,JSON.stringify(p)}function construct$h(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_data",fields:{key:c[0],value:R2.ToSimple(R2.JSONPath(n,c[0]))}};delete n[c[0]];let h=construct$h(n);return h&&(l.next={block:h}),l}else return null}else return null}const reality2_data={shape:shape$k,process:process$k,construct:construct$h},shape$j={type:"reality2_plugin_header",message0:"header %1 = %2",args0:[{type:"field_input",name:"header",check:"String",text:""},{type:"field_input",name:"data",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:150,tooltip:"When defining an antenna, often there are data to be sent in the header of the API call.  Check with the API definition help pages.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$j(n,c){const l=n.getFieldValue("header"),h=R2.ToJSON(n.getFieldValue("data"));var p={};return p[l]=h,JSON.stringify(p)}function construct$g(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_plugin_header",fields:{header:c[0],data:R2.ToSimple(R2.JSONPath(n,c[0]))}};delete n[c[0]];let h=construct$g(n);return h&&(l.next={block:h}),l}else return null}else return null}const reality2_plugin_header={shape:shape$j,process:process$j,construct:construct$g},shape$i={type:"reality2_plugin_parameter",message0:"param %1 = %2",args0:[{type:"field_input",name:"parameter",check:"String",text:""},{type:"field_input",name:"data",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:150,tooltip:"Some APIs use query parameters after the question mark.  Check with the API definition help pages.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$i(n,c){const l=n.getFieldValue("parameter"),h=R2.ToJSON(n.getFieldValue("data"));var p={};return p[l]=h,JSON.stringify(p)}function construct$f(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_plugin_parameter",fields:{parameter:c[0],data:R2.ToSimple(R2.JSONPath(n,c[0]))}};delete n[c[0]];let h=construct$f(n);return h&&(l.next={block:h}),l}else return null}else return null}const reality2_plugin_parameter={shape:shape$i,process:process$i,construct:construct$f},shape$h={type:"reality2_get_plugin",message0:"ANTENNA %1",args0:[{type:"field_input",name:"name",check:"String",text:"name",tooltip:"Link name in reverse DNS format eg: com.openai.api"}],message1:"%1",args1:[{type:"field_input",name:"description",check:"String",text:"description"}],message2:"GET from %1 with",args2:[{type:"field_input",name:"url",check:"String",text:"",tooltip:"The full URL of the API"}],message3:" - parameters %1",args3:[{type:"input_statement",name:"parameters"}],message4:" - headers %1",args4:[{type:"input_statement",name:"headers"}],message5:"OUTPUT %1 = %2 with event %3",args5:[{type:"field_input",name:"output_key",check:"String",text:""},{type:"field_input",name:"output_value",check:"String",text:"",tooltip:"A JSONPath, for example choices.0.message.content"},{type:"field_input",name:"output_event",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:150,tooltip:"An antenna to get information from an internet connected resource that uses a GET API.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$h(n,c){var l={};l.name=n.getFieldValue("name"),n.getFieldValue("description")!==""&&(l.description=n.getFieldValue("description")),l.url=n.getFieldValue("url"),l.method="GET";const h=c.statementToCode(n,"headers");h!=""&&(l.headers=splitConcatenatedJSON(h));const p=c.statementToCode(n,"parameters");return p!=""&&(l.parameters=splitConcatenatedJSON(p)),l.output={key:n.getFieldValue("output_key"),value:n.getFieldValue("output_value"),event:n.getFieldValue("output_event")},JSON.stringify({plugin:l})}function construct$e(n){let c=R2.JSONPath(n,"description")?R2.JSONPath(n,"description"):"";if(n){let l={kind:"BLOCK",type:"reality2_get_plugin",fields:{name:R2.JSONPath(n,"name"),description:c,url:R2.JSONPath(n,"url"),method:"GET",output_key:R2.JSONPath(n,"output.key"),output_value:R2.JSONPath(n,"output.value"),output_event:R2.JSONPath(n,"output.event")},inputs:{headers:{},parameters:{}}},h=reality2_plugin_header.construct(R2.JSONPath(n,"headers"));h&&(l.inputs.headers={block:h});let p=reality2_plugin_parameter.construct(R2.JSONPath(n,"parameters"));return p&&(l.inputs.parameters={block:p}),l}else return null}const reality2_get_plugin={shape:shape$h,process:process$h,construct:construct$e},shape$g={type:"reality2_plugin_body",message0:"body %1 = %2",args0:[{type:"field_input",name:"key",check:"String",text:""},{type:"field_input",name:"value",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:150,tooltip:"When defining a POST antenna, often there are data to be sent as the body of the API call.  Check with the API definition help pages.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$g(n,c){const l=n.getFieldValue("key"),h=R2.ToJSON(n.getFieldValue("value"));var p={};return p[l]=h,JSON.stringify(p)}function construct$d(n){if(n){let c=Object.keys(n);if(c.length>0){let l={kind:"BLOCK",type:"reality2_plugin_body",fields:{key:c[0],value:R2.ToSimple(R2.JSONPath(n,c[0]))}};delete n[c[0]];let h=construct$d(n);return h&&(l.next={block:h}),l}else return null}else return null}const reality2_plugin_body={shape:shape$g,process:process$g,construct:construct$d},shape$f={type:"reality2_post_plugin",message0:"ANTENNA %1",args0:[{type:"field_input",name:"name",check:"String",text:"name",tooltip:"Antenna name in reverse DNS format eg: com.openai.api"}],message1:"%1",args1:[{type:"field_input",name:"description",check:"String",text:"description"}],message2:"POST to %1 with",args2:[{type:"field_input",name:"url",check:"String",text:"",tooltip:"The full URL of the API"}],message3:" - parameters %1",args3:[{type:"input_statement",name:"parameters"}],message4:" - headers %1",args4:[{type:"input_statement",name:"headers"}],message5:" - body %1",args5:[{type:"input_statement",name:"body"}],message6:"OUTPUT %1 = %2 with event %3",args6:[{type:"field_input",name:"output_key",check:"String",text:""},{type:"field_input",name:"output_value",check:"String",text:"",tooltip:"A JSONPath, for example choices.0.message.content"},{type:"field_input",name:"output_event",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:150,tooltip:"An antenna to retrieve information from an internet connected resource that uses a POST API.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$f(n,c){var l={};l.name=n.getFieldValue("name"),n.getFieldValue("description")!==""&&(l.description=n.getFieldValue("description")),l.url=n.getFieldValue("url"),l.method="POST";const h=c.statementToCode(n,"headers");h!=""&&(l.headers=splitConcatenatedJSON(h));const p=c.statementToCode(n,"body");p!=""&&(l.body=splitConcatenatedJSON(p));const g=c.statementToCode(n,"parameters");return g!=""&&(l.parameters=splitConcatenatedJSON(g)),l.output={key:n.getFieldValue("output_key"),value:n.getFieldValue("output_value"),event:n.getFieldValue("output_event")},JSON.stringify({plugin:l})}function construct$c(n){let c=R2.JSONPath(n,"description")?R2.JSONPath(n,"description"):"";if(n){let l={kind:"BLOCK",type:"reality2_post_plugin",fields:{name:R2.JSONPath(n,"name"),description:c,url:R2.JSONPath(n,"url"),method:"POST",output_key:R2.JSONPath(n,"output.key"),output_value:R2.JSONPath(n,"output.value"),output_event:R2.JSONPath(n,"output.event")},inputs:{headers:{},body:{},parameters:{}}},h=reality2_plugin_header.construct(R2.JSONPath(n,"headers"));h&&(l.inputs.headers={block:h});let p=reality2_plugin_parameter.construct(R2.JSONPath(n,"parameters"));p&&(l.inputs.parameters={block:p});let g=reality2_plugin_body.construct(R2.JSONPath(n,"body"));return g&&(l.inputs.body={block:g}),l}else return null}const reality2_post_plugin={shape:shape$f,process:process$f,construct:construct$c},shape$e={type:"reality2_parameter",message0:"input %1 as %2",args0:[{type:"field_input",name:"parameter",check:"String",text:""},{type:"field_dropdown",name:"type",options:[["number","number"],["string","string"],["boolean","boolean"],["json","json"]],tooltip:"Various parameter types"}],previousStatement:null,nextStatement:null,colour:250,tooltip:"Additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$e(n,c){const l=n.getFieldValue("parameter"),h=n.getFieldValue("type");return'{"'+l+'":"'+h+'"}'}function construct$b(n){if(n){let c=Object.keys(n);if(c.length>0){let l=c[0],h=R2.JSONPath(n,l),p={kind:"BLOCK",type:"reality2_parameter",fields:{parameter:l,type:h}};delete n[c[0]];let g=construct$b(n);return g&&(p.next={block:g}),p}else return null}else return null}const reality2_parameter={shape:shape$e,process:process$e,construct:construct$b},shape$d={type:"reality2_transition",message0:"in state %2 when %3 : %1 happens, go to %4",args0:[{type:"field_dropdown",name:"access",options:[["visible","visible"],["internal","internal"]],tooltip:"Only public events can be triggered by external Sentants."},{type:"field_input",name:"from",check:"String",text:"",tooltip:"from"},{type:"field_input",name:"event",check:"String",text:"",tooltip:"event"},{type:"field_input",name:"to",check:"String",text:"",tooltip:"to"}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:"reality_parameter"}],message2:"TASKS",message3:"%1",args3:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:250,tooltip:"When a Bee is in a particular state, and it receives notice that something has happened, it goes to a new state, and performs some tasks with additional information to add to the data flow.  For example, a switch may be off, then be told to 'turn on', whereupon it goes into the on state.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$d(n,c){var l={};n.getFieldValue("access")==="visible"&&(l.public=!0),l.from=n.getFieldValue("from"),l.event=n.getFieldValue("event"),l.to=n.getFieldValue("to");const h=c.statementToCode(n,"parameters");h!=""&&(l.parameters=splitConcatenatedJSON(h));const p=c.statementToCode(n,"actions");return p!=""&&(l.actions=splitConcatenatedJSON(p,!1)),JSON.stringify(l)}function construct$a(n){if(n){let c={kind:"BLOCK",type:"reality2_transition",fields:{access:R2.JSONPath(n,"public")?"visible":"internal",from:R2.JSONPath(n,"from"),event:R2.JSONPath(n,"event"),to:R2.JSONPath(n,"to")},inputs:{parameters:{},actions:{}}},l=R2.JSONPath(n,"parameters");if(l&&Object.keys(l).length>0){let h=reality2_parameter.construct(l);c.inputs.parameters={block:h}}return interpret_actions(n,c)}else return null}const reality2_transition={shape:shape$d,process:process$d,construct:construct$a},shape$c={type:"reality2_transition_no_params",message0:"in state %2 when %3 : %1 happens, go to %4",args0:[{type:"field_dropdown",name:"access",options:[["visible","visible"],["internal","internal"]],tooltip:"Only public events can be triggered by external Sentants."},{type:"field_input",name:"from",check:"String",text:"",tooltip:"from"},{type:"field_input",name:"event",check:"String",text:"",tooltip:"event"},{type:"field_input",name:"to",check:"String",text:"",tooltip:"to"}],message1:"TASKS",message2:"%1",args2:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:270,tooltip:"When a Bee is in a particular state, and it receives notice that something has happened, it goes to a new state, and performs some tasks.  For example, a switch may be off, then be told to 'turn on', whereupon it goes into the on state.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$c(n,c){var l={};n.getFieldValue("access")==="visible"&&(l.public=!0),l.from=n.getFieldValue("from"),l.event=n.getFieldValue("event"),l.to=n.getFieldValue("to");const h=c.statementToCode(n,"actions");return h!=""&&(l.actions=splitConcatenatedJSON(h,!1)),JSON.stringify(l)}function construct$9(n){if(n){let c={kind:"BLOCK",type:"reality2_transition_no_params",fields:{access:R2.JSONPath(n,"public")?"visible":"internal",from:R2.JSONPath(n,"from"),event:R2.JSONPath(n,"event"),to:R2.JSONPath(n,"to")},inputs:{actions:{}}};return interpret_actions(n,c)}else return null}const reality2_transition_no_params={shape:shape$c,process:process$c,construct:construct$9},shape$b={type:"reality2_simple_transition",message0:"instruction %2 : %1",args0:[{type:"field_dropdown",name:"access",options:[["visible","visible"],["internal","internal"]],tooltip:"Only public events can be triggered by external Sentants."},{type:"field_input",name:"event",check:"String",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:["reality2_parameter"]}],message2:"TASKS",message3:"%1",args3:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:250,tooltip:"Receive an instruction, and subsequently perform some tasks with additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$b(n,c){var l={};n.getFieldValue("access")==="visible"&&(l.public=!0),l.event=n.getFieldValue("event");const h=c.statementToCode(n,"parameters");h!=""&&(l.parameters=splitConcatenatedJSON(h));const p=c.statementToCode(n,"actions");return p!=""&&(l.actions=splitConcatenatedJSON(p,!1)),JSON.stringify(l)}function construct$8(n){if(n){let c={kind:"BLOCK",type:"reality2_simple_transition",fields:{access:R2.JSONPath(n,"public")?"visible":"internal",event:R2.JSONPath(n,"event")},inputs:{parameters:{},actions:{}}},l=R2.JSONPath(n,"parameters");if(l&&Object.keys(l).length>0){let h=reality2_parameter.construct(l);c.inputs.parameters={block:h}}return interpret_actions(n,c)}else return null}const reality2_simple_transition={shape:shape$b,process:process$b,construct:construct$8},shape$a={type:"reality2_simple_transition_no_params",message0:"instruction %2 : %1",args0:[{type:"field_dropdown",name:"access",options:[["visible","visible"],["internal","internal"]],tooltip:"Only public events can be triggered by external Sentants."},{type:"field_input",name:"event",check:"String",text:""}],message1:"TASKS",message2:"%1",args2:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:270,tooltip:"Receive an instruction, and subsequently perform some tasks.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$a(n,c){var l={};n.getFieldValue("access")==="visible"&&(l.public=!0),l.event=n.getFieldValue("event");const h=c.statementToCode(n,"actions");return h!=""&&(l.actions=splitConcatenatedJSON(h,!1)),JSON.stringify(l)}function construct$7(n){if(n){let c={kind:"BLOCK",type:"reality2_simple_transition_no_params",fields:{access:R2.JSONPath(n,"public")?"visible":"internal",event:R2.JSONPath(n,"event")},inputs:{actions:{}}};return interpret_actions(n,c)}else return null}const reality2_simple_transition_no_params={shape:shape$a,process:process$a,construct:construct$7},shape$9={type:"reality2_start_transition",message0:"start as %1",args0:[{type:"field_input",name:"to",check:"String",text:""}],message1:"with %1",args1:[{type:"input_statement",name:"parameters",check:["reality_parameter"]}],message2:"TASKS",message3:"%1",args3:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:250,tooltip:"Perform specific tasks when the Behaviour starts for the first time, with some additional information to add to the data flow.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$9(n,c){var l={};l.from="start",l.event="init",l.to=n.getFieldValue("to");const h=c.statementToCode(n,"parameters");h!=""&&(l.parameters=splitConcatenatedJSON(h));const p=c.statementToCode(n,"actions");return p!=""&&(l.actions=splitConcatenatedJSON(p,!1)),JSON.stringify(l)}function construct$6(n){if(n){let c={kind:"BLOCK",type:"reality2_start_transition",fields:{to:R2.JSONPath(n,"to")},inputs:{parameters:{},actions:{}}},l=R2.JSONPath(n,"parameters");if(l&&Object.keys(l).length>0){let h=reality2_parameter.construct(l);c.inputs.parameters={block:h}}return interpret_actions(n,c)}else return null}const reality2_start_transition={shape:shape$9,process:process$9,construct:construct$6},shape$8={type:"reality2_start_transition_no_params",message0:"start as %1",args0:[{type:"field_input",name:"to",check:"String",text:""}],message1:"TASKS",message2:"%1",args2:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:270,tooltip:"Perform specific tasks when the Behaviour starts for the first time.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$8(n,c){var l={};l.from="start",l.event="init",l.to=n.getFieldValue("to");const h=c.statementToCode(n,"actions");return h!=""&&(l.actions=splitConcatenatedJSON(h,!1)),JSON.stringify(l)}function construct$5(n){if(n){let c={kind:"BLOCK",type:"reality2_start_transition_no_params",fields:{to:R2.JSONPath(n,"to")},inputs:{actions:{}}};return interpret_actions(n,c)}else return null}const reality2_start_transition_no_params={shape:shape$8,process:process$8,construct:construct$5},shape$7={type:"reality2_start_transition_simple",message0:"at start, do",message1:"TASKS",message2:"%1",args2:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:270,tooltip:"Perform specific tasks when the Behaviour starts for the first time.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$7(n,c){var l={};l.from="start",l.event="init";const h=c.statementToCode(n,"actions");return h!=""&&(l.actions=splitConcatenatedJSON(h,!1)),JSON.stringify(l)}function construct$4(n){return n?interpret_actions(n,{kind:"BLOCK",type:"reality2_start_transition_simple",inputs:{actions:{}}}):null}const reality2_start_transition_simple={shape:shape$7,process:process$7,construct:construct$4},shape$6={type:"reality2_monitor",message0:"monitor internal events",message1:"TASKS",message2:"%1",args2:[{type:"input_statement",name:"actions",check:["reality2_action_debug","reality2_action_send","reality2_action_send_plugin","reality2_action_set","reality2_action_signal"]}],previousStatement:null,nextStatement:null,colour:270,tooltip:"Receive events from inside the node such as when Bees are created and deleted and when networks are joined and left.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$6(n,c){var l={event:"__internal"};const h=c.statementToCode(n,"actions");return h!=""&&(l.actions=splitConcatenatedJSON(h,!1)),JSON.stringify(l)}function construct$3(n){return n?interpret_actions(n,{kind:"BLOCK",type:"reality2_monitor",inputs:{actions:{}}}):null}const reality2_monitor={shape:shape$6,process:process$6,construct:construct$3},shape$5={type:"reality2_automation",message0:"BEHAVIOUR %1",args0:[{type:"field_input",name:"name",check:"String",text:"name"}],message1:"%1",args1:[{type:"field_input",name:"description",check:"String",text:"description"}],message2:"DECISIONS",message3:"%1",args3:[{type:"input_statement",name:"transitions",check:"reality2_transition"}],previousStatement:null,nextStatement:null,colour:200,tooltip:"A behaviour, which defines what a Bee is able to do.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$5(n,c){var l={};l.name=n.getFieldValue("name"),n.getFieldValue("description")!==""&&(l.description=n.getFieldValue("description"));const h=c.statementToCode(n,"transitions");return h!=""&&(l.transitions=splitConcatenatedJSON(h,!1)),JSON.stringify({automation:l})}function construct$2(n){if(n){let c={kind:"BLOCK",type:"reality2_automation",fields:{name:R2.JSONPath(n,"name"),description:R2.JSONPath(n,"description")?R2.JSONPath(n,"description"):""},inputs:{transitions:{}}},l=R2.JSONPath(n,"transitions");if(l){let h=l.reduceRight((p,g)=>{let T=g.event,v=g.to,I=g.from,R;if(T=="__internal")R=reality2_monitor.construct(g),R&&p&&(R.next={block:p});else if(T&&!v&&!I){let w=R2.JSONPath(g,"parameters");w&&Object.keys(w).length>0?(R=reality2_simple_transition.construct(g),R&&p&&(R.next={block:p})):(R=reality2_simple_transition_no_params.construct(g),R&&p&&(R.next={block:p}))}else if(T=="init"&&I=="start"){let w=R2.JSONPath(g,"parameters");v?w&&Object.keys(w).length>0?(R=reality2_start_transition.construct(g),R&&p&&(R.next={block:p})):(R=reality2_start_transition_no_params.construct(g),R&&p&&(R.next={block:p})):(R=reality2_start_transition_simple.construct(g),R&&p&&(R.next={block:p}))}else{let w=R2.JSONPath(g,"parameters");w&&Object.keys(w).length>0?(R=reality2_transition.construct(g),R&&p&&(R.next={block:p})):(R=reality2_transition_no_params.construct(g),R&&p&&(R.next={block:p}))}return R},null);c.inputs.transitions={block:h}}return c}else return null}const reality2_automation={shape:shape$5,process:process$5,construct:construct$2},shape$4={type:"reality2_sentant",message0:"BEE %1",args0:[{type:"field_input",name:"name",check:"String",text:"name",tooltip:"Name of Bee"}],message1:"%1",args1:[{type:"field_input",name:"description",check:"String",text:"description"}],message2:" - keys %1",args2:[{type:"input_statement",name:"keys",check:"reality2_encrypt_decrypt_keys"}],message3:" - data %1",args3:[{type:"input_statement",name:"data",check:"reality2_data"}],message4:"ANTENNAE",message5:"%1",args5:[{type:"input_statement",name:"plugins",check:["reality2_get_plugin","reality2_post_plugin"]}],message6:"BEHAVIOURS",message7:"%1",args7:[{type:"input_statement",name:"automations",check:"reality2_automation"}],previousStatement:null,nextStatement:null,colour:50,tooltip:"A Reality2 Sentient Digital Agent, otherwise known as a Bee, or a Sentant.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$4(n,c){var l={};l.name=n.getFieldValue("name"),n.getFieldValue("description")!==""&&(l.description=n.getFieldValue("description"));let h=c.statementToCode(n,"keys");h!=""&&(l.keys=splitConcatenatedJSON(h));let p=c.statementToCode(n,"data");p!=""&&(l.data=splitConcatenatedJSON(p));let g=c.statementToCode(n,"plugins");g!=""&&(l.plugins=splitConcatenatedJSON(g,!1).map(v=>v.plugin));let T=c.statementToCode(n,"automations");return T!=""&&(l.automations=splitConcatenatedJSON(T,!1).map(v=>v.automation)),JSON.stringify({sentant:l})}function construct$1(n){let c=R2.JSONPath(n,"description")?R2.JSONPath(n,"description"):"";if(n){let l={kind:"BLOCK",type:"reality2_sentant",fields:{name:R2.JSONPath(n,"name"),description:c},inputs:{keys:{},data:{},plugins:{},automations:{}}};if(R2.JSONPath(n,"keys.encryption_key")||R2.JSONPath(n,"keys.decryption_key")){let T=reality2_encrypt_decrypt_keys.construct(R2.JSONPath(n,"keys"));T&&(l.inputs.keys={block:T})}else{let T=reality2_key_value.construct(R2.JSONPath(n,"keys"));T&&(l.inputs.keys={block:T})}let h=reality2_data.construct(R2.JSONPath(n,"data"));h&&(l.inputs.data={block:h});let p=R2.JSONPath(n,"plugins");if(p){let T=p.reduceRight((v,I)=>{let R=R2.JSONPath(I,"method"),w;switch(R){case"GET":w=reality2_get_plugin.construct(I),w&&v&&(w.next={block:v});break;case"POST":w=reality2_post_plugin.construct(I),w&&v&&(w.next={block:v});break;default:w=v;break}return w},null);l.inputs.plugins={block:T}}let g=R2.JSONPath(n,"automations");if(g){let T=g.reduceRight((v,I)=>{let R=reality2_automation.construct(I);return R&&v&&(R.next={block:v}),R},null);l.inputs.automations={block:T}}return l}else return null}const reality2_sentant={shape:shape$4,process:process$4,construct:construct$1},shape$3={type:"reality2_swarm",message0:"SWARM %1",args0:[{type:"field_input",name:"name",check:"String",text:"name",tooltip:"Name of Swarm"}],message1:"%1",args1:[{type:"field_input",name:"description",check:"String",text:"description",tooltip:"Swarm description"}],message2:"%1",args2:[{type:"input_statement",name:"sentants",check:["reality2_sentant"]}],colour:20,tooltip:"A swarm of Sentient Digital Agents, otherwise known as Sentants or Bees.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$3(n,c){var l={};l.name=n.getFieldValue("name"),n.getFieldValue("description")!==""&&(l.description=n.getFieldValue("description"));const h=c.statementToCode(n,"sentants");return h!=""&&(l.sentants=splitConcatenatedJSON(h,!1).map(p=>p.sentant)),JSON.stringify({swarm:l})}function construct(n){let c={kind:"BLOCK",type:"reality2_swarm",fields:{name:R2.JSONPath(n,"name"),description:R2.JSONPath(n,"description")?R2.JSONPath(n,"description"):""},inputs:{sentants:{}}},l=R2.JSONPath(n,"sentants");if(l){let h=l.reduceRight((p,g)=>{let T=reality2_sentant.construct(g);return T&&p&&(T.next={block:p}),T},null);c.inputs.sentants={block:h}}return c}const reality2_swarm={shape:shape$3,process:process$3,construct},shape$2={type:"reality2_action_set_calculation",message0:"calc %1",args0:[{type:"field_input",name:"value",check:"String",text:""}],colour:300,output:"Json",tooltip:"An expression in a string in reverse polish format.  So to add 1 and 2, for example, that would '1 2 +'.  To add 1 and 2, then multiply by 3 would be '1 2 + 3 *'.  Numbers from the data flow can be used by putting two underscores on either side, for example: '__answer__'.  Therefore, to add 2 to 'answer' would be 'answer 2 +'",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process$2(n,c){const l=n.getFieldValue("value"),p={expr:l===""?null:R2.ToJSON(l)};return[JSON.stringify(p),99]}const reality2_action_set_calculation={shape:shape$2,process:process$2},shape$1={type:"reality2_action_set_calc_unary",message0:"%2 ( %1 )",args0:[{type:"input_value",name:"value1"},{type:"field_dropdown",name:"operator",options:[["-","-"],["!","!"],["acos","acos"],["acosh","acosh"],["asin","asin"],["asinh","asinh"],["atan","atan"],["atanh","atanh"],["ceil","ceil"],["cos","cos"],["cosh","cosh"],["exp","exp"],["floor","floor"],["log","log"],["log10","log10"],["log2","log2"],["sin","sin"],["sinh","sinh"],["sqrt","sqrt"],["tan","tan"],["tanh","tanh"],["latlong","latlong"]]}],colour:300,output:"Json",tooltip:"An unary expression",helpUrl:"https://github.com/reality-two/reality2-documentation",inputsInline:!0};function process$1(n,c){const l=c.valueToCode(n,"value1",99),h=n.getFieldValue("operator"),p=l===""?null:R2.ToJSON(l),g=R2.JSONPath(p,"expr")?R2.JSONPath(p,"expr"):p;let T={};return T[h]=[g],[JSON.stringify({expr:T}),99]}const reality2_action_set_calc_unary={shape:shape$1,process:process$1},shape={type:"ai_reality2_vars_delete",message0:"delete %1",args0:[{type:"field_input",name:"key",check:"String",text:""}],previousStatement:null,nextStatement:null,colour:360,tooltip:"Delete a persistent variable.",helpUrl:"https://github.com/reality-two/reality2-documentation"};function process(n,c){const h={plugin:"ai.reality2.vars",command:"delete",parameters:{key:n.getFieldValue("key")}};return JSON.stringify(h)}const ai_reality2_vars_delete={shape,process},kind="categoryToolbox",contents=[{kind:"category",colour:20,name:"Swarm",expanded:"true",contents:[{kind:"label",text:"A Swarm of Bees"},{kind:"block",type:"reality2_swarm"}]},{kind:"category",colour:50,name:"Bees",expanded:"true",contents:[{kind:"category",colour:50,name:"Bee",contents:[{kind:"label",text:"A Reality2 Bee"},{kind:"block",type:"reality2_sentant"}]},{kind:"category",colour:50,name:". . . Keys",contents:[{kind:"label",text:"Encryption and Decryption Keys"},{kind:"block",type:"reality2_encrypt_decrypt_keys"},{kind:"label",text:"An Antenna API Key"},{kind:"block",type:"reality2_key_value"}]},{kind:"category",colour:50,name:". . . Data",contents:[{kind:"label",text:"Number, Boolean, String or JSON Data"},{kind:"block",type:"reality2_data"}]}]},{kind:"category",colour:150,name:"Antennae",expanded:"true",contents:[{kind:"category",colour:150,name:"Antenna",contents:[{kind:"label",text:"Simple Antenna"},{kind:"block",type:"reality2_get_plugin"},{kind:"label",text:"Complex Antenna"},{kind:"block",type:"reality2_post_plugin"}]},{kind:"category",colour:150,name:". . . Parameter",contents:[{kind:"label",text:"Query Parameters for use with Antenna"},{kind:"block",type:"reality2_plugin_parameter"}]},{kind:"category",colour:150,name:". . . Header",contents:[{kind:"label",text:"Header Setting for use with Antenna"},{kind:"block",type:"reality2_plugin_header"}]},{kind:"category",colour:150,name:". . . Body",contents:[{kind:"label",text:"Body Setting for use with Antenna"},{kind:"block",type:"reality2_plugin_body"}]}]},{kind:"category",colour:200,name:"Behaviours",expanded:"true",contents:[{kind:"label",text:"A Bee Behaviour"},{kind:"block",type:"reality2_automation"}]},{kind:"sep",gap:"8"},{kind:"category",colour:250,name:"Decisions",expanded:"true",contents:[{kind:"category",colour:250,name:"Start",expanded:"true",contents:[{kind:"label",text:"Decision used once when Bee first starts"},{kind:"block",type:"reality2_start_transition_no_params"},{kind:"block",type:"reality2_start_transition_simple"}]},{kind:"category",colour:250,name:"Instruction",contents:[{kind:"label",text:"An Instruction, where state-of-mind is irrelevant"},{kind:"block",type:"reality2_simple_transition"},{kind:"block",type:"reality2_simple_transition_no_params"}]},{kind:"category",colour:250,name:"Event",contents:[{kind:"label",text:"State-of-mind + Event ==> new State-of-mind"},{kind:"block",type:"reality2_transition"},{kind:"block",type:"reality2_transition_no_params"}]},{kind:"category",colour:250,name:"Monitor",contents:[{kind:"label",text:"Monitor a Hive's internal activity"},{kind:"block",type:"reality2_monitor"}]},{kind:"category",colour:250,name:". . . Inputs",contents:[{kind:"label",text:"Additional Data to add to Flow with a Decision"},{kind:"block",type:"reality2_parameter"}]}]},{kind:"category",colour:300,name:"Tasks",expanded:"true",contents:[{kind:"category",colour:300,name:"Send",expanded:"true",contents:[{kind:"label",text:"Send Data Flow immediately"},{kind:"block",type:"reality2_action_send_now"},{kind:"block",type:"reality2_action_send_now_no_params"},{kind:"label",text:"Send Data Flow a bit later"},{kind:"block",type:"reality2_action_send"},{kind:"block",type:"reality2_action_send_no_params"},{kind:"label",text:"Send Data Flow to an Antenna"},{kind:"block",type:"reality2_action_send_plugin"},{kind:"block",type:"reality2_action_send_plugin_no_params"},{kind:"block",type:"reality2_action_send_plugin_no_params_no_event"}]},{kind:"category",colour:300,name:"Set",expanded:"true",contents:[{kind:"label",text:"Clear Data Flow Variable"},{kind:"block",type:"reality2_action_set_clear"},{kind:"label",text:"Set Data Flow Variable"},{kind:"block",type:"reality2_action_set"},{kind:"label",text:"Pick Value from Sentant Data"},{kind:"block",type:"reality2_action_set_data"},{kind:"label",text:"Pick Value from within a JSON structure"},{kind:"block",type:"reality2_action_set_jsonpath"},{kind:"label",text:"Calculate"},{kind:"block",type:"reality2_action_set_calc_unary"},{kind:"block",type:"reality2_action_set_calc_binary"},{kind:"label",text:"A Number, Boolean, String or JSON"},{kind:"block",type:"reality2_action_set_value"},{kind:"label",text:"A Variable"},{kind:"block",type:"reality2_action_set_value"}]},{kind:"category",colour:300,name:"Signal",expanded:"true",contents:[{kind:"label",text:"Signal Data Flow to watching devices"},{kind:"block",type:"reality2_action_signal"},{kind:"block",type:"reality2_action_signal_no_params"}]},{kind:"category",colour:300,name:"Test",expanded:"true",contents:[{kind:"label",text:"Send event depending on result of Test"},{kind:"block",type:"reality2_action_test"},{kind:"block",type:"reality2_action_test_no_params"},{kind:"block",type:"reality2_action_test_simple"},{kind:"label",text:"Evaluate for Test"},{kind:"block",type:"reality2_action_set_calc_unary"},{kind:"block",type:"reality2_action_set_calc_binary"},{kind:"label",text:"A Number, Boolean, String or JSON"},{kind:"block",type:"reality2_action_set_value"},{kind:"label",text:"A Variable"},{kind:"block",type:"reality2_action_set_value"}]},{kind:"category",colour:300,name:"Debug",expanded:"true",contents:[{kind:"label",text:"Signal Data Flow with a debug event"},{kind:"block",type:"reality2_action_debug"}]},{kind:"category",colour:300,name:". . . Parameters",expanded:"true",contents:[{kind:"label",text:"Additional Data to add to Flow for Tasks"},{kind:"block",type:"reality2_action_parameter"}]},{kind:"sep",gap:"32"},{kind:"category",colour:360,name:"Variables",expanded:"true",contents:[{kind:"label",text:"Persistent Variables"},{kind:"block",type:"ai_reality2_vars_set"},{kind:"block",type:"ai_reality2_vars_set_no_value"},{kind:"block",type:"ai_reality2_vars_get"},{kind:"block",type:"ai_reality2_vars_all"},{kind:"block",type:"ai_reality2_vars_delete"},{kind:"block",type:"ai_reality2_vars_clear"}]},{kind:"category",colour:360,name:"Geospatial",expanded:"true",contents:[{kind:"label",text:"Geospatial Capabilities"},{kind:"block",type:"ai_reality2_geospatial_set"},{kind:"block",type:"ai_reality2_geospatial_set_geohash"},{kind:"block",type:"ai_reality2_geospatial_set_radius"},{kind:"block",type:"ai_reality2_geospatial_set_simple"},{kind:"block",type:"ai_reality2_geospatial_get"},{kind:"block",type:"ai_reality2_geospatial_search"},{kind:"block",type:"ai_reality2_geospatial_remove"}]},{kind:"category",colour:360,name:"Storage",expanded:"true",contents:[{kind:"label",text:"Data Flow Storage"},{kind:"block",type:"ai_reality2_backup_save"},{kind:"block",type:"ai_reality2_backup_load"},{kind:"block",type:"ai_reality2_backup_delete"}]}]}],toolbox={kind,contents};var $$_import_javascriptGenerator=reactive_import(()=>javascriptGenerator),root_7=template("<!> <!>",1),root_11=template("<!> <!>",1),root_14=template("<!> <!>",1),root_18=template("<!> <!>",1),root_10=template("<!> <!> <!>",1),root_5$1=template("<!> <!>",1),root_21=template("<!> <!>",1),root_25=template('<pre style="text-align: left;"> </pre>'),root_26=template('<pre style="text-align: left;"> </pre>'),root_2$1=template('<div style="text-align: center;"><!><!><!></div> <!> <!> <!> <!> <div class="ui scrollable" id="codeDiv"><!></div>',1),root_27=template('<div id="blocklyDiv"></div>'),root_32=template("<!> <!>",1),root_39=template("<!> <!>",1),root_28=template("<!> <!> <!> <!>",1),root$2=template("<!> <!> <!> <!> <!> <!> <!> <!>",1);function Construct(n,c){push(c,!1);const l=mutable_state(),h=mutable_state(),p=mutable_state(),g=mutable_state();let T=prop(c,"r2_node",8);prop(c,"sentantData",24,()=>[]);let v=prop(c,"variables",28,()=>({})),I=prop(c,"savedState",12),R=prop(c,"location",24,()=>({longitude:0,latitude:0})),w=mutable_state(),C=mutable_state(),N,D,V=mutable_state({}),B=mutable_state(""),ie=mutable_state(""),ne={callback:{},codeOnPage:{}},P=[reality2_swarm.shape,reality2_sentant.shape,reality2_key_value.shape,reality2_data.shape,reality2_encrypt_decrypt_keys.shape,reality2_get_plugin.shape,reality2_post_plugin.shape,reality2_plugin_header.shape,reality2_plugin_body.shape,reality2_plugin_parameter.shape,reality2_automation.shape,reality2_parameter.shape,reality2_transition.shape,reality2_transition_no_params.shape,reality2_start_transition.shape,reality2_start_transition_no_params.shape,reality2_start_transition_simple.shape,reality2_simple_transition.shape,reality2_simple_transition_no_params.shape,reality2_monitor.shape,reality2_action_set.shape,reality2_action_set_clear.shape,reality2_action_set_jsonpath.shape,reality2_action_set_data.shape,reality2_action_set_calculation.shape,reality2_action_set_calc_binary.shape,reality2_action_set_calc_unary.shape,reality2_action_set_value.shape,reality2_action_send.shape,reality2_action_send_no_params.shape,reality2_action_send_now.shape,reality2_action_send_now_no_params.shape,reality2_action_send_plugin.shape,reality2_action_send_plugin_no_params.shape,reality2_action_send_plugin_no_params_no_event.shape,reality2_action_debug.shape,reality2_action_test.shape,reality2_action_test_no_params.shape,reality2_action_test_simple.shape,reality2_action_signal.shape,reality2_action_signal_no_params.shape,reality2_action_parameter.shape,ai_reality2_vars_set.shape,ai_reality2_vars_set_no_value.shape,ai_reality2_vars_get.shape,ai_reality2_vars_all.shape,ai_reality2_vars_delete.shape,ai_reality2_vars_clear.shape,ai_reality2_geospatial_set.shape,ai_reality2_geospatial_set_simple.shape,ai_reality2_geospatial_set_geohash.shape,ai_reality2_geospatial_set_radius.shape,ai_reality2_geospatial_get.shape,ai_reality2_geospatial_search.shape,ai_reality2_geospatial_remove.shape,ai_reality2_backup_save.shape,ai_reality2_backup_load.shape,ai_reality2_backup_delete.shape],z={sentant:reality2_sentant.construct,swarm:reality2_swarm.construct,get_plugin:reality2_get_plugin.construct,post_plugin:reality2_post_plugin.construct,automation:reality2_automation.construct};function se(){const le=window.innerHeight-64,ee=document.getElementById("blocklyDiv"),me=document.getElementById("codeDiv");if(ee&&me){const Ee=me.getBoundingClientRect().top,Be=ee.getBoundingClientRect().top+le;set$1(h,`${Be-Ee-30}px`)}set$1(l,`${le}px`)}onMount(()=>{defineBlocksWithJsonArray$1(P),N=inject$1("blocklyDiv",{toolbox,theme:Theme,renderer:"thrasos",zoom:{controls:!0,wheel:!1,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2,pinch:!0},grid:{spacing:20,length:3,colour:"#333",snap:!0},trashcan:!0}),D=new distExports.Backpack(N,{allowEmptyBackpackOpen:!0,useFilledBackpackImage:!0,skipSerializerRegistration:!0,contextMenu:{emptyBackpack:!0,removeFromBackpack:!0,copyToBackpack:!0,copyAllToBackpack:!0,pasteAllToBackpack:!0,disablePreconditionChecks:!1}}),D.init(),window.addEventListener("resize",se),se(),set$1(w,document.createElement("input")),mutate(w,get(w).type="file"),mutate(w,get(w).accept=".json, .yaml"),mutate(w,get(w).onchange=le=>{const ee=le.target.files[0];var me=new FileReader;me.readAsText(ee,"UTF-8"),me.onload=Ee=>{setTimeout(()=>{if(Ee!==null){var Oe=Ee.target.result;if(Oe!==null){if(ee.type.includes("json")){var Be=JSON.parse(Oe);Tt(Be)}else if(ee.type.includes("yaml")){var Ye=jsYaml.load(Oe);Tt(Ye)}}}},50)}}),set$1(C,document.createElement("input")),mutate(C,get(C).type="file"),mutate(C,get(C).onchange=le=>{var ee=le.target.files[0],me=new FileReader;me.readAsText(ee,"UTF-8"),me.onload=Ee=>{Ee!==null&&(v(JSON.parse(Ee.target.result)),ge("Success","Variables loaded successfully","green"))}}),setTimeout(()=>{svgResize$1(N)},0),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_swarm=reality2_swarm.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_sentant=reality2_sentant.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_encrypt_decrypt_keys=reality2_encrypt_decrypt_keys.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_get_plugin=reality2_get_plugin.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_post_plugin=reality2_post_plugin.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_plugin_header=reality2_plugin_header.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_plugin_body=reality2_plugin_body.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_plugin_parameter=reality2_plugin_parameter.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_key_value=reality2_key_value.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_data=reality2_data.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_automation=reality2_automation.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_parameter=reality2_parameter.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_transition=reality2_transition.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_transition_no_params=reality2_transition_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_start_transition=reality2_start_transition.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_start_transition_no_params=reality2_start_transition_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_start_transition_simple=reality2_start_transition_simple.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_simple_transition=reality2_simple_transition.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_simple_transition_no_params=reality2_simple_transition_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_monitor=reality2_monitor.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set=reality2_action_set.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_clear=reality2_action_set_clear.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_jsonpath=reality2_action_set_jsonpath.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_data=reality2_action_set_data.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_calculation=reality2_action_set_calculation.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_calc_binary=reality2_action_set_calc_binary.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_calc_unary=reality2_action_set_calc_unary.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_set_value=reality2_action_set_value.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send=reality2_action_send.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_no_params=reality2_action_send_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_now=reality2_action_send_now.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_now_no_params=reality2_action_send_now_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_plugin=reality2_action_send_plugin.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_plugin_no_params=reality2_action_send_plugin_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_send_plugin_no_params_no_event=reality2_action_send_plugin_no_params_no_event.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_debug=reality2_action_debug.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_test=reality2_action_test.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_test_no_params=reality2_action_test_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_test_simple=reality2_action_test_simple.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_signal=reality2_action_signal.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_signal_no_params=reality2_action_signal_no_params.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.reality2_action_parameter=reality2_action_parameter.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_set=ai_reality2_vars_set.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_set_no_value=ai_reality2_vars_set_no_value.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_get=ai_reality2_vars_get.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_all=ai_reality2_vars_all.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_delete=ai_reality2_vars_delete.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_vars_clear=ai_reality2_vars_clear.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_set=ai_reality2_geospatial_set.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_set_simple=ai_reality2_geospatial_set_simple.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_set_geohash=ai_reality2_geospatial_set_geohash.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_set_radius=ai_reality2_geospatial_set_radius.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_get=ai_reality2_geospatial_get.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_search=ai_reality2_geospatial_search.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_geospatial_remove=ai_reality2_geospatial_remove.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_backup_save=ai_reality2_backup_save.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_backup_load=ai_reality2_backup_load.process),$$_import_javascriptGenerator($$_import_javascriptGenerator().forBlock.ai_reality2_backup_delete=ai_reality2_backup_delete.process),setTimeout(()=>{typeof I()=="object"&&("backpack"in I()&&ye(I().backpack),"workspace"in I()&&q(I().workspace))},2)});function re(){const le=new Uint8Array(32);window.crypto.getRandomValues(le);const ee=btoa(String.fromCharCode(...le));v()&&(v(v().__encryption_key__=ee,!0),v(v().__decryption_key__=ee,!0))}function he(){return serialization$1.workspaces.save(N)}function q(le){serialization$1.workspaces.load(le,N)}function j(){return D.getContents()}function ye(le){D.setContents(le)}onDestroy(()=>{I({workspace:he(),backpack:j()}),window.removeEventListener("resize",se)});function ge(le,ee,me){behavior({type:"toast",settings:{title:le,message:ee,position:"top attached",class:"center aligned huge "+me,className:{toast:"ui message"}}})}function Ve(le,ee){const me={...ee,__latitude__:R().latitude,__longitude__:R().longitude};for(const[Ee,Oe]of Object.entries(me)){const Be=new RegExp(Ee,"g");le=le.replace(Be,Oe)}return le}function de(){Ce(le=>{if(Object.keys(le).length!==0){var ee=Ve(JSON.stringify(le),v()),me=le.hasOwnProperty("sentant"),Ee=le.hasOwnProperty("swarm");if(me){var Oe=le.sentant.name;Oe&&T().sentantGetByName(Oe).then(Be=>{T().sentantUnload(R2.JSONPath(Be,"sentantGet.id")).then(Ye=>{T().sentantLoad(ee).then(Ke=>{ge("Success","Bee Loaded","green")}).catch(Ke=>{ge("Problem","Error Loading","red")})}).catch(Ye=>{ge("Problem","Error Unloading","red")})}).catch(Be=>{T().sentantLoad(ee).then(Ye=>{ge("Success","Bee Loaded","green")})})}else Ee&&T().swarmLoad(ee).then(Be=>{ge("Success","Swarm Loaded","green")}).catch(Be=>{ge("Problem","Error Loading","red")})}else ge("Status","Nothing to load","blue")})}function Tt(le){if(R2.JSONPath(le,"swarm"))D.addItem(JSON.stringify(z.swarm(R2.JSONPath(le,"swarm")))),D.open(),ge("Success","Swarm loaded into backpack","green");else if(R2.JSONPath(le,"sentant"))D.addItem(JSON.stringify(z.sentant(R2.JSONPath(le,"sentant")))),D.open(),ge("Success","Bee loaded into backpack","green");else if(R2.JSONPath(le,"plugin"))switch(R2.JSONPath(le,"plugin.method")){case"GET":D.addItem(JSON.stringify(z.get_plugin(R2.JSONPath(le,"plugin")))),D.open(),ge("Success","Antenna loaded into backpack","green");break;case"POST":D.addItem(JSON.stringify(z.post_plugin(R2.JSONPath(le,"plugin")))),D.open(),ge("Success","Antenna loaded into backpack","green");break;default:ge("Problem","Incorrect format","red")}else R2.JSONPath(le,"automation")?(D.addItem(JSON.stringify(z.automation(R2.JSONPath(le,"automation")))),D.open(),ge("Success","Behaviour loaded into backpack","green")):ge("Problem","Incorrect format","red")}function ze(){Ce(le=>{if(Object.keys(le).length!==0){set$1(V,le);var ee="definition";if(R2.JSONPath(get(g),"swarm.name")?ee=R2.JSONPath(get(g),"swarm.name")+".swarm":R2.JSONPath(get(g),"sentant.name")?ee=R2.JSONPath(get(g),"sentant.name")+".bee":R2.JSONPath(get(g),"plugin.name")?ee=R2.JSONPath(get(g),"plugin.name")+".antenna":R2.JSONPath(get(g),"automation.name")&&(ee=R2.JSONPath(get(g),"automation.name")+".behaviour"),get(p)[0]==="json"){var me=JSON.stringify(get(g));mt(me,ee+".json")}else{var Ee=jsYaml.dump(get(g));mt(Ee,ee+".yaml")}}})}async function mt(le,ee){if(window.showSaveFilePicker)try{const Ee=await(await window.showSaveFilePicker({suggestedName:ee,types:[{description:"Reality2 Files",accept:{"text/plain":[".json",".yaml",".toml"]}}]})).createWritable();await Ee.write(le),await Ee.close(),ge("Success","Definition saved successfully","green")}catch(me){me.name==="AbortError"?ge("Status","Cancelled","blue"):ge("Problem","Could not save","red")}else{const me=new Blob([le],{type:"text/plain"}),Ee=URL.createObjectURL(me),Oe=document.createElement("a");Oe.href=Ee,Oe.download=ee,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),URL.revokeObjectURL(Ee),ge("Success","Saved successfully","green")}}function Ce(le){let ee={},me={},Ee=!1,Oe=0,Be=splitConcatenatedJSON($$_import_javascriptGenerator().workspaceToCode(N),!1);if(Be.forEach(Ye=>{Ye.swarm?(Ee=!0,ee=Ye):Ye.sentant&&Oe++}),!Ee&&Oe>1)ne.callback=le,ne.codeOnPage=Be,behavior("swarm_name","show");else if(Ee&&Oe>0&&(ee.swarm.sentants=[]),Ee)Be.forEach(Ye=>{Ye.sentant&&ee.swarm.sentants.push(Ye.sentant)}),le(ee);else if(Be.length>0){ee=Be[0];const Ye=Object.keys(ee)[0];me[Ye]=ee[Ye],le(me)}else le({})}function St(le){let ee=ne.callback;if(le){let me=ne.codeOnPage,Ee={swarm:{name:get(B),description:get(ie),sentants:[]}};Ee.swarm.sentants=[],me.forEach(Oe=>{Oe.sentant&&Ee.swarm.sentants.push(Oe.sentant)}),ee(Ee)}else ee({})}function _e(le){let ee=document.querySelectorAll(`[id='${le}']`);ee.length>1&&ee.forEach((me,Ee)=>{Ee!==ee.length-1&&me.remove()})}function nt(){Ce(le=>{_e("code_space"),set$1(V,le),behavior("code_space","toggle")})}legacy_pre_effect(()=>{},()=>{set$1(l,"800px")}),legacy_pre_effect(()=>{},()=>{set$1(h,"300px")}),legacy_pre_effect(()=>{},()=>{set$1(p,[])}),legacy_pre_effect(()=>get(V),()=>{set$1(g,get(V))}),legacy_pre_effect_reset(),init();var be=root$2(),Ie=first_child(be);Flyout$2(Ie,{ui:!0,very:!0,wide:!0,id:"code_space",children:(le,ee)=>{Segment(le,{ui:!0,attached:!0,inverted:!0,style:"text-align: left; background-color: #444444; height:100%",children:(me,Ee)=>{var Oe=root_2$1(),Be=first_child(Oe),Ye=child(Be);Text$1(Ye,{ui:!0,large:!0,children:(M,st)=>{var gt=text("YAML  ");append(M,gt)},$$slots:{default:!0}});var Ke=sibling(Ye);Checkbox(Ke,{ui:!0,toggle:!0,large:!0,inverted:!0,value:"json",label:" ",grey:!0,get group(){return get(p)},set group(M){set$1(p,M)},$$legacy:!0});var it=sibling(Ke);Text$1(it,{ui:!0,large:!0,children:(M,st)=>{var gt=text("JSON");append(M,gt)},$$slots:{default:!0}});var Ue=sibling(Be,2);Divider(Ue,{ui:!0,inverted:!0});var Et=sibling(Ue,2);Table(Et,{ui:!0,inverted:!0,children:(M,st)=>{var gt=root_5$1(),Je=first_child(gt);Table_Head(Je,{children:(dt,Xe)=>{Table_Row(dt,{children:(pt,E)=>{var A=root_7(),W=first_child(A);Table_Col(W,{head:!0,children:(ae,xe)=>{var Ct=text("key");append(ae,Ct)},$$slots:{default:!0}});var H=sibling(W,2);Table_Col(H,{head:!0,children:(ae,xe)=>{var Ct=text("value");append(ae,Ct)},$$slots:{default:!0}}),append(pt,A)},$$slots:{default:!0}})},$$slots:{default:!0}});var ut=sibling(Je,2);Table_Body(ut,{children:(dt,Xe)=>{var pt=root_10(),E=first_child(pt);Table_Row(E,{children:(H,ae)=>{var xe=root_11(),Ct=first_child(xe);Table_Col(Ct,{children:(rt,b)=>{var k=text("__latitude__");append(rt,k)},$$slots:{default:!0}});var Qt=sibling(Ct,2);Table_Col(Qt,{children:(rt,b)=>{var k=text();template_effect(()=>set_text(k,R().latitude)),append(rt,k)},$$slots:{default:!0}}),append(H,xe)},$$slots:{default:!0}});var A=sibling(E,2);Table_Row(A,{children:(H,ae)=>{var xe=root_14(),Ct=first_child(xe);Table_Col(Ct,{children:(rt,b)=>{var k=text("__longitude__");append(rt,k)},$$slots:{default:!0}});var Qt=sibling(Ct,2);Table_Col(Qt,{children:(rt,b)=>{var k=text();template_effect(()=>set_text(k,R().longitude)),append(rt,k)},$$slots:{default:!0}}),append(H,xe)},$$slots:{default:!0}});var W=sibling(A,2);each(W,1,()=>Object.keys(v()),index,(H,ae)=>{Table_Row(H,{children:(xe,Ct)=>{var Qt=root_18(),rt=first_child(Qt);Table_Col(rt,{children:(k,F)=>{var X=text();template_effect(()=>set_text(X,get(ae))),append(k,X)},$$slots:{default:!0}});var b=sibling(rt,2);Table_Col(b,{children:(k,F)=>{var X=text();template_effect(()=>set_text(X,v()[get(ae)])),append(k,X)},$$slots:{default:!0}}),append(xe,Qt)},$$slots:{default:!0}})}),append(dt,pt)},$$slots:{default:!0}}),append(M,gt)},$$slots:{default:!0}});var J=sibling(Et,2);Buttons(J,{ui:!0,fluid:!0,horizontal:!0,children:(M,st)=>{var gt=root_21(),Je=first_child(gt);Button(Je,{ui:!0,inverted:!0,blue:!0,"data-variation":"wide","data-tooltip":"Generate encryption keys.  Use the same keys between subsequent versions of a Bee to ensure access to saved data.",$$events:{click:re},children:(dt,Xe)=>{var pt=text("generate encryption and decryption keys");append(dt,pt)},$$slots:{default:!0}});var ut=sibling(Je,2);Button(ut,{ui:!0,inverted:!0,green:!0,$$events:{click:()=>{mt(JSON.stringify(v()),"variables.json")}},children:(dt,Xe)=>{var pt=text("Save Variables");append(dt,pt)},$$slots:{default:!0}}),append(M,gt)},$$slots:{default:!0}});var $e=sibling(J,2);Divider($e,{ui:!0,inverted:!0});var Qe=sibling($e,2),ke=child(Qe);{var yt=M=>{var st=comment(),gt=first_child(st);{var Je=dt=>{var Xe=root_25(),pt=child(Xe);template_effect(E=>set_text(pt,E),[()=>JSON.stringify(get(g),null,2).trim()],derived_safe_equal),append(dt,Xe)},ut=dt=>{var Xe=root_26(),pt=child(Xe);template_effect(E=>set_text(pt,E),[()=>jsYaml.dump(get(g)).trim()],derived_safe_equal),append(dt,Xe)};if_block(gt,dt=>{get(p)[0]==="json"?dt(Je):dt(ut,!1)})}append(M,st)};if_block(ke,M=>{Object.keys(get(g)).length!==0&&M(yt)})}template_effect(()=>set_attribute(Qe,"style",`text-align: left; height:${get(h)??""}; overflow-y: auto; word-wrap: break-word;`)),append(me,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}});var ot=sibling(Ie,2);Pusher(ot,{children:(le,ee)=>{var me=root_27();template_effect(()=>set_attribute(me,"style",`height: ${get(l)??""}; width: 100%;`)),append(le,me)},$$slots:{default:!0}});var Ge=sibling(ot,2);Modal(Ge,{ui:!0,small:!0,id:"swarm_name",children:(le,ee)=>{var me=root_28(),Ee=first_child(me);Icon(Ee,{close:!0});var Oe=sibling(Ee,2);Header(Oe,{children:(Ke,it)=>{var Ue=text("Name your Swarm");append(Ke,Ue)},$$slots:{default:!0}});var Be=sibling(Oe,2);Content(Be,{children:(Ke,it)=>{Table(Ke,{ui:!0,children:(Ue,Et)=>{Table_Body(Ue,{children:(J,$e)=>{var Qe=root_32(),ke=first_child(Qe);Table_Row(ke,{children:(M,st)=>{Table_Col(M,{children:(gt,Je)=>{Input$2(gt,{ui:!0,fluid:!0,children:(ut,dt)=>{Input$2(ut,{text:!0,placeholder:"Swarm name...",get value(){return get(B)},set value(Xe){set$1(B,Xe)},$$legacy:!0})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}});var yt=sibling(ke,2);Table_Row(yt,{children:(M,st)=>{Table_Col(M,{children:(gt,Je)=>{Input$2(gt,{ui:!0,fluid:!0,children:(ut,dt)=>{Input$2(ut,{text:!0,placeholder:"Optional Description",get value(){return get(ie)},set value(Xe){set$1(ie,Xe)},$$legacy:!0})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),append(J,Qe)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}});var Ye=sibling(Be,2);Actions(Ye,{children:(Ke,it)=>{var Ue=root_39(),Et=first_child(Ue);Button(Et,{ui:!0,red:!0,$$events:{click:()=>{behavior("swarm_name","hide"),St(!1)}},children:($e,Qe)=>{var ke=text("Cancel");append($e,ke)},$$slots:{default:!0}});var J=sibling(Et,2);Button(J,{ui:!0,green:!0,$$events:{click:()=>{behavior({id:"swarm_name",commands:["hide"]}),St(!0)}},children:($e,Qe)=>{var ke=text("OK");append($e,ke)},$$slots:{default:!0}}),append(Ke,Ue)},$$slots:{default:!0}}),append(le,me)},$$slots:{default:!0}});var Fe=sibling(Ge,2);Button(Fe,{ui:!0,icon:!0,popup:!0,large:!0,"data-tooltip":"Load keys to use with your Bees.","data-position":"top right",style:"position: fixed; top: 200px; right: 45px; background-color: #696969",$$events:{click:()=>{get(C).click()}},children:(le,ee)=>{Icon(le,{table:!0})},$$slots:{default:!0}});var Se=sibling(Fe,2);Button(Se,{ui:!0,icon:!0,large:!0,popup:!0,"data-tooltip":"Load Swarms, Bees, Antennae or Behaviours from a file.","data-position":"top right",style:"position: fixed; top: 260px; right: 45px; background-color: #696969",$$events:{click:()=>{get(w).click()}},children:(le,ee)=>{Icon(le,{folder:!0,open:!0,outline:!0})},$$slots:{default:!0}});var ve=sibling(Se,2);Button(ve,{ui:!0,icon:!0,large:!0,popup:!0,"data-tooltip":"Save Swarms, Bees, Antennae or Behaviours to a file.","data-position":"top right",style:"position: fixed; top: 320px; right: 45px; background-color: #696969",$$events:{click:ze},children:(le,ee)=>{Icon(le,{share:!0,square:!0})},$$slots:{default:!0}});var We=sibling(ve,2);Button(We,{ui:!0,icon:!0,large:!0,popup:!0,"data-tooltip":"Convert to JSON or YAML and show.","data-position":"top right",style:"position: fixed; top: 440px; right: 45px; background-color: #696969",$$events:{click:()=>{nt()}},children:(le,ee)=>{Icon(le,{code:!0})},$$slots:{default:!0}});var je=sibling(We,2);Button(je,{ui:!0,icon:!0,large:!0,popup:!0,"data-tooltip":"Run the Swarm on the Reality2 node.","data-position":"top right",style:"position: fixed; top: 500px; right: 45px; background-color: #696969",$$events:{click:de},children:(le,ee)=>{Icon(le,{running:!0})},$$slots:{default:!0}}),append(n,be),pop()}var leafletSrc$1={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var leafletSrc=leafletSrc$1.exports,hasRequiredLeafletSrc;function requireLeafletSrc(){return hasRequiredLeafletSrc||(hasRequiredLeafletSrc=1,function(n,c){(function(l,h){h(c)})(leafletSrc,function(l){var h="1.9.4";function p(o){var u,_,m,y;for(_=1,m=arguments.length;_<m;_++){y=arguments[_];for(u in y)o[u]=y[u]}return o}var g=Object.create||function(){function o(){}return function(u){return o.prototype=u,new o}}();function T(o,u){var _=Array.prototype.slice;if(o.bind)return o.bind.apply(o,_.call(arguments,1));var m=_.call(arguments,2);return function(){return o.apply(u,m.length?m.concat(_.call(arguments)):arguments)}}var v=0;function I(o){return"_leaflet_id"in o||(o._leaflet_id=++v),o._leaflet_id}function R(o,u,_){var m,y,O,U;return U=function(){m=!1,y&&(O.apply(_,y),y=!1)},O=function(){m?y=arguments:(o.apply(_,arguments),setTimeout(U,u),m=!0)},O}function w(o,u,_){var m=u[1],y=u[0],O=m-y;return o===m&&_?o:((o-y)%O+O)%O+y}function C(){return!1}function N(o,u){if(u===!1)return o;var _=Math.pow(10,u===void 0?6:u);return Math.round(o*_)/_}function D(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function V(o){return D(o).split(/\s+/)}function B(o,u){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?g(o.options):{});for(var _ in u)o.options[_]=u[_];return o.options}function ie(o,u,_){var m=[];for(var y in o)m.push(encodeURIComponent(_?y.toUpperCase():y)+"="+encodeURIComponent(o[y]));return(!u||u.indexOf("?")===-1?"?":"&")+m.join("&")}var ne=/\{ *([\w_ -]+) *\}/g;function P(o,u){return o.replace(ne,function(_,m){var y=u[m];if(y===void 0)throw new Error("No value provided for variable "+_);return typeof y=="function"&&(y=y(u)),y})}var z=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function se(o,u){for(var _=0;_<o.length;_++)if(o[_]===u)return _;return-1}var re="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function he(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var q=0;function j(o){var u=+new Date,_=Math.max(0,16-(u-q));return q=u+_,window.setTimeout(o,_)}var ye=window.requestAnimationFrame||he("RequestAnimationFrame")||j,ge=window.cancelAnimationFrame||he("CancelAnimationFrame")||he("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function Ve(o,u,_){if(_&&ye===j)o.call(u);else return ye.call(window,T(o,u))}function de(o){o&&ge.call(window,o)}var Tt={__proto__:null,extend:p,create:g,bind:T,get lastId(){return v},stamp:I,throttle:R,wrapNum:w,falseFn:C,formatNum:N,trim:D,splitWords:V,setOptions:B,getParamString:ie,template:P,isArray:z,indexOf:se,emptyImageUrl:re,requestFn:ye,cancelFn:ge,requestAnimFrame:Ve,cancelAnimFrame:de};function ze(){}ze.extend=function(o){var u=function(){B(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},_=u.__super__=this.prototype,m=g(_);m.constructor=u,u.prototype=m;for(var y in this)Object.prototype.hasOwnProperty.call(this,y)&&y!=="prototype"&&y!=="__super__"&&(u[y]=this[y]);return o.statics&&p(u,o.statics),o.includes&&(mt(o.includes),p.apply(null,[m].concat(o.includes))),p(m,o),delete m.statics,delete m.includes,m.options&&(m.options=_.options?g(_.options):{},p(m.options,o.options)),m._initHooks=[],m.callInitHooks=function(){if(!this._initHooksCalled){_.callInitHooks&&_.callInitHooks.call(this),this._initHooksCalled=!0;for(var O=0,U=m._initHooks.length;O<U;O++)m._initHooks[O].call(this)}},u},ze.include=function(o){var u=this.prototype.options;return p(this.prototype,o),o.options&&(this.prototype.options=u,this.mergeOptions(o.options)),this},ze.mergeOptions=function(o){return p(this.prototype.options,o),this},ze.addInitHook=function(o){var u=Array.prototype.slice.call(arguments,1),_=typeof o=="function"?o:function(){this[o].apply(this,u)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(_),this};function mt(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=z(o)?o:[o];for(var u=0;u<o.length;u++)o[u]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Ce={on:function(o,u,_){if(typeof o=="object")for(var m in o)this._on(m,o[m],u);else{o=V(o);for(var y=0,O=o.length;y<O;y++)this._on(o[y],u,_)}return this},off:function(o,u,_){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var m in o)this._off(m,o[m],u);else{o=V(o);for(var y=arguments.length===1,O=0,U=o.length;O<U;O++)y?this._off(o[O]):this._off(o[O],u,_)}return this},_on:function(o,u,_,m){if(typeof u!="function"){console.warn("wrong listener type: "+typeof u);return}if(this._listens(o,u,_)===!1){_===this&&(_=void 0);var y={fn:u,ctx:_};m&&(y.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push(y)}},_off:function(o,u,_){var m,y,O;if(this._events&&(m=this._events[o],!!m)){if(arguments.length===1){if(this._firingCount)for(y=0,O=m.length;y<O;y++)m[y].fn=C;delete this._events[o];return}if(typeof u!="function"){console.warn("wrong listener type: "+typeof u);return}var U=this._listens(o,u,_);if(U!==!1){var K=m[U];this._firingCount&&(K.fn=C,this._events[o]=m=m.slice()),m.splice(U,1)}}},fire:function(o,u,_){if(!this.listens(o,_))return this;var m=p({},u,{type:o,target:this,sourceTarget:u&&u.sourceTarget||this});if(this._events){var y=this._events[o];if(y){this._firingCount=this._firingCount+1||1;for(var O=0,U=y.length;O<U;O++){var K=y[O],Q=K.fn;K.once&&this.off(o,Q,K.ctx),Q.call(K.ctx||this,m)}this._firingCount--}}return _&&this._propagateEvent(m),this},listens:function(o,u,_,m){typeof o!="string"&&console.warn('"string" type argument expected');var y=u;typeof u!="function"&&(m=!!u,y=void 0,_=void 0);var O=this._events&&this._events[o];if(O&&O.length&&this._listens(o,y,_)!==!1)return!0;if(m){for(var U in this._eventParents)if(this._eventParents[U].listens(o,u,_,m))return!0}return!1},_listens:function(o,u,_){if(!this._events)return!1;var m=this._events[o]||[];if(!u)return!!m.length;_===this&&(_=void 0);for(var y=0,O=m.length;y<O;y++)if(m[y].fn===u&&m[y].ctx===_)return y;return!1},once:function(o,u,_){if(typeof o=="object")for(var m in o)this._on(m,o[m],u,!0);else{o=V(o);for(var y=0,O=o.length;y<O;y++)this._on(o[y],u,_,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[I(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[I(o)],this},_propagateEvent:function(o){for(var u in this._eventParents)this._eventParents[u].fire(o.type,p({layer:o.target,propagatedFrom:o.target},o),!0)}};Ce.addEventListener=Ce.on,Ce.removeEventListener=Ce.clearAllEventListeners=Ce.off,Ce.addOneTimeEventListener=Ce.once,Ce.fireEvent=Ce.fire,Ce.hasEventListeners=Ce.listens;var St=ze.extend(Ce);function _e(o,u,_){this.x=_?Math.round(o):o,this.y=_?Math.round(u):u}var nt=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};_e.prototype={clone:function(){return new _e(this.x,this.y)},add:function(o){return this.clone()._add(be(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(be(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new _e(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new _e(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=nt(this.x),this.y=nt(this.y),this},distanceTo:function(o){o=be(o);var u=o.x-this.x,_=o.y-this.y;return Math.sqrt(u*u+_*_)},equals:function(o){return o=be(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=be(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+N(this.x)+", "+N(this.y)+")"}};function be(o,u,_){return o instanceof _e?o:z(o)?new _e(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new _e(o.x,o.y):new _e(o,u,_)}function Ie(o,u){if(o)for(var _=u?[o,u]:o,m=0,y=_.length;m<y;m++)this.extend(_[m])}Ie.prototype={extend:function(o){var u,_;if(!o)return this;if(o instanceof _e||typeof o[0]=="number"||"x"in o)u=_=be(o);else if(o=ot(o),u=o.min,_=o.max,!u||!_)return this;return!this.min&&!this.max?(this.min=u.clone(),this.max=_.clone()):(this.min.x=Math.min(u.x,this.min.x),this.max.x=Math.max(_.x,this.max.x),this.min.y=Math.min(u.y,this.min.y),this.max.y=Math.max(_.y,this.max.y)),this},getCenter:function(o){return be((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return be(this.min.x,this.max.y)},getTopRight:function(){return be(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var u,_;return typeof o[0]=="number"||o instanceof _e?o=be(o):o=ot(o),o instanceof Ie?(u=o.min,_=o.max):u=_=o,u.x>=this.min.x&&_.x<=this.max.x&&u.y>=this.min.y&&_.y<=this.max.y},intersects:function(o){o=ot(o);var u=this.min,_=this.max,m=o.min,y=o.max,O=y.x>=u.x&&m.x<=_.x,U=y.y>=u.y&&m.y<=_.y;return O&&U},overlaps:function(o){o=ot(o);var u=this.min,_=this.max,m=o.min,y=o.max,O=y.x>u.x&&m.x<_.x,U=y.y>u.y&&m.y<_.y;return O&&U},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var u=this.min,_=this.max,m=Math.abs(u.x-_.x)*o,y=Math.abs(u.y-_.y)*o;return ot(be(u.x-m,u.y-y),be(_.x+m,_.y+y))},equals:function(o){return o?(o=ot(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function ot(o,u){return!o||o instanceof Ie?o:new Ie(o,u)}function Ge(o,u){if(o)for(var _=u?[o,u]:o,m=0,y=_.length;m<y;m++)this.extend(_[m])}Ge.prototype={extend:function(o){var u=this._southWest,_=this._northEast,m,y;if(o instanceof Se)m=o,y=o;else if(o instanceof Ge){if(m=o._southWest,y=o._northEast,!m||!y)return this}else return o?this.extend(ve(o)||Fe(o)):this;return!u&&!_?(this._southWest=new Se(m.lat,m.lng),this._northEast=new Se(y.lat,y.lng)):(u.lat=Math.min(m.lat,u.lat),u.lng=Math.min(m.lng,u.lng),_.lat=Math.max(y.lat,_.lat),_.lng=Math.max(y.lng,_.lng)),this},pad:function(o){var u=this._southWest,_=this._northEast,m=Math.abs(u.lat-_.lat)*o,y=Math.abs(u.lng-_.lng)*o;return new Ge(new Se(u.lat-m,u.lng-y),new Se(_.lat+m,_.lng+y))},getCenter:function(){return new Se((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Se(this.getNorth(),this.getWest())},getSouthEast:function(){return new Se(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof Se||"lat"in o?o=ve(o):o=Fe(o);var u=this._southWest,_=this._northEast,m,y;return o instanceof Ge?(m=o.getSouthWest(),y=o.getNorthEast()):m=y=o,m.lat>=u.lat&&y.lat<=_.lat&&m.lng>=u.lng&&y.lng<=_.lng},intersects:function(o){o=Fe(o);var u=this._southWest,_=this._northEast,m=o.getSouthWest(),y=o.getNorthEast(),O=y.lat>=u.lat&&m.lat<=_.lat,U=y.lng>=u.lng&&m.lng<=_.lng;return O&&U},overlaps:function(o){o=Fe(o);var u=this._southWest,_=this._northEast,m=o.getSouthWest(),y=o.getNorthEast(),O=y.lat>u.lat&&m.lat<_.lat,U=y.lng>u.lng&&m.lng<_.lng;return O&&U},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,u){return o?(o=Fe(o),this._southWest.equals(o.getSouthWest(),u)&&this._northEast.equals(o.getNorthEast(),u)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Fe(o,u){return o instanceof Ge?o:new Ge(o,u)}function Se(o,u,_){if(isNaN(o)||isNaN(u))throw new Error("Invalid LatLng object: ("+o+", "+u+")");this.lat=+o,this.lng=+u,_!==void 0&&(this.alt=+_)}Se.prototype={equals:function(o,u){if(!o)return!1;o=ve(o);var _=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return _<=(u===void 0?1e-9:u)},toString:function(o){return"LatLng("+N(this.lat,o)+", "+N(this.lng,o)+")"},distanceTo:function(o){return je.distance(this,ve(o))},wrap:function(){return je.wrapLatLng(this)},toBounds:function(o){var u=180*o/40075017,_=u/Math.cos(Math.PI/180*this.lat);return Fe([this.lat-u,this.lng-_],[this.lat+u,this.lng+_])},clone:function(){return new Se(this.lat,this.lng,this.alt)}};function ve(o,u,_){return o instanceof Se?o:z(o)&&typeof o[0]!="object"?o.length===3?new Se(o[0],o[1],o[2]):o.length===2?new Se(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new Se(o.lat,"lng"in o?o.lng:o.lon,o.alt):u===void 0?null:new Se(o,u,_)}var We={latLngToPoint:function(o,u){var _=this.projection.project(o),m=this.scale(u);return this.transformation._transform(_,m)},pointToLatLng:function(o,u){var _=this.scale(u),m=this.transformation.untransform(o,_);return this.projection.unproject(m)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var u=this.projection.bounds,_=this.scale(o),m=this.transformation.transform(u.min,_),y=this.transformation.transform(u.max,_);return new Ie(m,y)},infinite:!1,wrapLatLng:function(o){var u=this.wrapLng?w(o.lng,this.wrapLng,!0):o.lng,_=this.wrapLat?w(o.lat,this.wrapLat,!0):o.lat,m=o.alt;return new Se(_,u,m)},wrapLatLngBounds:function(o){var u=o.getCenter(),_=this.wrapLatLng(u),m=u.lat-_.lat,y=u.lng-_.lng;if(m===0&&y===0)return o;var O=o.getSouthWest(),U=o.getNorthEast(),K=new Se(O.lat-m,O.lng-y),Q=new Se(U.lat-m,U.lng-y);return new Ge(K,Q)}},je=p({},We,{wrapLng:[-180,180],R:6371e3,distance:function(o,u){var _=Math.PI/180,m=o.lat*_,y=u.lat*_,O=Math.sin((u.lat-o.lat)*_/2),U=Math.sin((u.lng-o.lng)*_/2),K=O*O+Math.cos(m)*Math.cos(y)*U*U,Q=2*Math.atan2(Math.sqrt(K),Math.sqrt(1-K));return this.R*Q}}),le=6378137,ee={R:le,MAX_LATITUDE:85.0511287798,project:function(o){var u=Math.PI/180,_=this.MAX_LATITUDE,m=Math.max(Math.min(_,o.lat),-_),y=Math.sin(m*u);return new _e(this.R*o.lng*u,this.R*Math.log((1+y)/(1-y))/2)},unproject:function(o){var u=180/Math.PI;return new Se((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*u,o.x*u/this.R)},bounds:function(){var o=le*Math.PI;return new Ie([-o,-o],[o,o])}()};function me(o,u,_,m){if(z(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=u,this._c=_,this._d=m}me.prototype={transform:function(o,u){return this._transform(o.clone(),u)},_transform:function(o,u){return u=u||1,o.x=u*(this._a*o.x+this._b),o.y=u*(this._c*o.y+this._d),o},untransform:function(o,u){return u=u||1,new _e((o.x/u-this._b)/this._a,(o.y/u-this._d)/this._c)}};function Ee(o,u,_,m){return new me(o,u,_,m)}var Oe=p({},je,{code:"EPSG:3857",projection:ee,transformation:function(){var o=.5/(Math.PI*ee.R);return Ee(o,.5,-o,.5)}()}),Be=p({},Oe,{code:"EPSG:900913"});function Ye(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Ke(o,u){var _="",m,y,O,U,K,Q;for(m=0,O=o.length;m<O;m++){for(K=o[m],y=0,U=K.length;y<U;y++)Q=K[y],_+=(y?"L":"M")+Q.x+" "+Q.y;_+=u?De.svg?"z":"x":""}return _||"M0 0"}var it=document.documentElement.style,Ue="ActiveXObject"in window,Et=Ue&&!document.addEventListener,J="msLaunchUri"in navigator&&!("documentMode"in document),$e=ei("webkit"),Qe=ei("android"),ke=ei("android 2")||ei("android 3"),yt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),M=Qe&&ei("Google")&&yt<537&&!("AudioNode"in window),st=!!window.opera,gt=!J&&ei("chrome"),Je=ei("gecko")&&!$e&&!st&&!Ue,ut=!gt&&ei("safari"),dt=ei("phantom"),Xe="OTransition"in it,pt=navigator.platform.indexOf("Win")===0,E=Ue&&"transition"in it,A="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ke,W="MozPerspective"in it,H=!window.L_DISABLE_3D&&(E||A||W)&&!Xe&&!dt,ae=typeof orientation<"u"||ei("mobile"),xe=ae&&$e,Ct=ae&&A,Qt=!window.PointerEvent&&window.MSPointerEvent,rt=!!(window.PointerEvent||Qt),b="ontouchstart"in window||!!window.TouchEvent,k=!window.L_NO_TOUCH&&(b||rt),F=ae&&st,X=ae&&Je,oe=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Re=function(){var o=!1;try{var u=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",C,u),window.removeEventListener("testPassiveEventSupport",C,u)}catch{}return o}(),Pe=function(){return!!document.createElement("canvas").getContext}(),Ht=!!(document.createElementNS&&Ye("svg").createSVGRect),fi=!!Ht&&function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Ft=!Ht&&function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var u=o.firstChild;return u.style.behavior="url(#default#VML)",u&&typeof u.adj=="object"}catch{return!1}}(),Kt=navigator.platform.indexOf("Mac")===0,gi=navigator.platform.indexOf("Linux")===0;function ei(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var De={ie:Ue,ielt9:Et,edge:J,webkit:$e,android:Qe,android23:ke,androidStock:M,opera:st,chrome:gt,gecko:Je,safari:ut,phantom:dt,opera12:Xe,win:pt,ie3d:E,webkit3d:A,gecko3d:W,any3d:H,mobile:ae,mobileWebkit:xe,mobileWebkit3d:Ct,msPointer:Qt,pointer:rt,touch:k,touchNative:b,mobileOpera:F,mobileGecko:X,retina:oe,passiveEvents:Re,canvas:Pe,svg:Ht,vml:Ft,inlineSvg:fi,mac:Kt,linux:gi},Jt=De.msPointer?"MSPointerDown":"pointerdown",Ci=De.msPointer?"MSPointerMove":"pointermove",Ii=De.msPointer?"MSPointerUp":"pointerup",Es=De.msPointer?"MSPointerCancel":"pointercancel",Ds={touchstart:Jt,touchmove:Ci,touchend:Ii,touchcancel:Es},Zt={touchstart:ai,touchmove:os,touchend:os,touchcancel:os},mi={},hi=!1;function Bs(o,u,_){return u==="touchstart"&&Tn(),Zt[u]?(_=Zt[u].bind(this,_),o.addEventListener(Ds[u],_,!1),_):(console.warn("wrong event specified:",u),C)}function Fs(o,u,_){if(!Ds[u]){console.warn("wrong event specified:",u);return}o.removeEventListener(Ds[u],_,!1)}function li(o){mi[o.pointerId]=o}function ji(o){mi[o.pointerId]&&(mi[o.pointerId]=o)}function Si(o){delete mi[o.pointerId]}function Tn(){hi||(document.addEventListener(Jt,li,!0),document.addEventListener(Ci,ji,!0),document.addEventListener(Ii,Si,!0),document.addEventListener(Es,Si,!0),hi=!0)}function os(o,u){if(u.pointerType!==(u.MSPOINTER_TYPE_MOUSE||"mouse")){u.touches=[];for(var _ in mi)u.touches.push(mi[_]);u.changedTouches=[u],o(u)}}function ai(o,u){u.MSPOINTER_TYPE_TOUCH&&u.pointerType===u.MSPOINTER_TYPE_TOUCH&&zt(u),os(o,u)}function rs(o){var u={},_,m;for(m in o)_=o[m],u[m]=_&&_.bind?_.bind(o):_;return o=u,u.type="dblclick",u.detail=2,u.isTrusted=!1,u._simulated=!0,u}var ci=200;function En(o,u){o.addEventListener("dblclick",u);var _=0,m;function y(O){if(O.detail!==1){m=O.detail;return}if(!(O.pointerType==="mouse"||O.sourceCapabilities&&!O.sourceCapabilities.firesTouchEvents)){var U=El(O);if(!(U.some(function(Q){return Q instanceof HTMLLabelElement&&Q.attributes.for})&&!U.some(function(Q){return Q instanceof HTMLInputElement||Q instanceof HTMLSelectElement}))){var K=Date.now();K-_<=ci?(m++,m===2&&u(rs(O))):m=1,_=K}}}return o.addEventListener("click",y),{dblclick:u,simDblclick:y}}function tn(o,u){o.removeEventListener("dblclick",u.dblclick),o.removeEventListener("click",u.simDblclick)}var Vt=ti(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ri=ti(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Oi=Ri==="webkitTransition"||Ri==="OTransition"?Ri+"End":"transitionend";function bs(o){return typeof o=="string"?document.getElementById(o):o}function Ni(o,u){var _=o.style[u]||o.currentStyle&&o.currentStyle[u];if((!_||_==="auto")&&document.defaultView){var m=document.defaultView.getComputedStyle(o,null);_=m?m[u]:null}return _==="auto"?null:_}function et(o,u,_){var m=document.createElement(o);return m.className=u||"",_&&_.appendChild(m),m}function It(o){var u=o.parentNode;u&&u.removeChild(o)}function ui(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function Di(o){var u=o.parentNode;u&&u.lastChild!==o&&u.appendChild(o)}function ls(o){var u=o.parentNode;u&&u.firstChild!==o&&u.insertBefore(o,u.firstChild)}function qt(o,u){if(o.classList!==void 0)return o.classList.contains(u);var _=vs(o);return _.length>0&&new RegExp("(^|\\s)"+u+"(\\s|$)").test(_)}function Ze(o,u){if(o.classList!==void 0)for(var _=V(u),m=0,y=_.length;m<y;m++)o.classList.add(_[m]);else if(!qt(o,u)){var O=vs(o);Ki(o,(O?O+" ":"")+u)}}function ft(o,u){o.classList!==void 0?o.classList.remove(u):Ki(o,D((" "+vs(o)+" ").replace(" "+u+" "," ")))}function Ki(o,u){o.className.baseVal===void 0?o.className=u:o.className.baseVal=u}function vs(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function _t(o,u){"opacity"in o.style?o.style.opacity=u:"filter"in o.style&&$i(o,u)}function $i(o,u){var _=!1,m="DXImageTransform.Microsoft.Alpha";try{_=o.filters.item(m)}catch{if(u===1)return}u=Math.round(u*100),_?(_.Enabled=u!==100,_.Opacity=u):o.style.filter+=" progid:"+m+"(opacity="+u+")"}function ti(o){for(var u=document.documentElement.style,_=0;_<o.length;_++)if(o[_]in u)return o[_];return!1}function Mi(o,u,_){var m=u||new _e(0,0);o.style[Vt]=(De.ie3d?"translate("+m.x+"px,"+m.y+"px)":"translate3d("+m.x+"px,"+m.y+"px,0)")+(_?" scale("+_+")":"")}function At(o,u){o._leaflet_pos=u,De.any3d?Mi(o,u):(o.style.left=u.x+"px",o.style.top=u.y+"px")}function xt(o){return o._leaflet_pos||new _e(0,0)}var wi,Wt,Ji;if("onselectstart"in document)wi=function(){qe(window,"selectstart",zt)},Wt=function(){Lt(window,"selectstart",zt)};else{var ys=ti(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);wi=function(){if(ys){var o=document.documentElement.style;Ji=o[ys],o[ys]="none"}},Wt=function(){ys&&(document.documentElement.style[ys]=Ji,Ji=void 0)}}function ii(){qe(window,"dragstart",zt)}function as(){Lt(window,"dragstart",zt)}var Us,ar;function cr(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(Eo(),Us=o,ar=o.style.outlineStyle,o.style.outlineStyle="none",qe(window,"keydown",Eo))}function Eo(){Us&&(Us.style.outlineStyle=ar,Us=void 0,ar=void 0,Lt(window,"keydown",Eo))}function Hs(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function si(o){var u=o.getBoundingClientRect();return{x:u.width/o.offsetWidth||1,y:u.height/o.offsetHeight||1,boundingClientRect:u}}var bo={__proto__:null,TRANSFORM:Vt,TRANSITION:Ri,TRANSITION_END:Oi,get:bs,getStyle:Ni,create:et,remove:It,empty:ui,toFront:Di,toBack:ls,hasClass:qt,addClass:Ze,removeClass:ft,setClass:Ki,getClass:vs,setOpacity:_t,testProp:ti,setTransform:Mi,setPosition:At,getPosition:xt,get disableTextSelection(){return wi},get enableTextSelection(){return Wt},disableImageDrag:ii,enableImageDrag:as,preventOutline:cr,restoreOutline:Eo,getSizedParentNode:Hs,getScale:si};function qe(o,u,_,m){if(u&&typeof u=="object")for(var y in u)hr(o,y,u[y],_);else{u=V(u);for(var O=0,U=u.length;O<U;O++)hr(o,u[O],_,m)}return this}var cs="_leaflet_events";function Lt(o,u,_,m){if(arguments.length===1)Tl(o),delete o[cs];else if(u&&typeof u=="object")for(var y in u)dr(o,y,u[y],_);else if(u=V(u),arguments.length===2)Tl(o,function(K){return se(u,K)!==-1});else for(var O=0,U=u.length;O<U;O++)dr(o,u[O],_,m);return this}function Tl(o,u){for(var _ in o[cs]){var m=_.split(/\d/)[0];(!u||u(m))&&dr(o,m,null,null,_)}}var ur={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function hr(o,u,_,m){var y=u+I(_)+(m?"_"+I(m):"");if(o[cs]&&o[cs][y])return this;var O=function(K){return _.call(m||o,K||window.event)},U=O;!De.touchNative&&De.pointer&&u.indexOf("touch")===0?O=Bs(o,u,O):De.touch&&u==="dblclick"?O=En(o,O):"addEventListener"in o?u==="touchstart"||u==="touchmove"||u==="wheel"||u==="mousewheel"?o.addEventListener(ur[u]||u,O,De.passiveEvents?{passive:!1}:!1):u==="mouseenter"||u==="mouseleave"?(O=function(K){K=K||window.event,_r(o,K)&&U(K)},o.addEventListener(ur[u],O,!1)):o.addEventListener(u,U,!1):o.attachEvent("on"+u,O),o[cs]=o[cs]||{},o[cs][y]=O}function dr(o,u,_,m,y){y=y||u+I(_)+(m?"_"+I(m):"");var O=o[cs]&&o[cs][y];if(!O)return this;!De.touchNative&&De.pointer&&u.indexOf("touch")===0?Fs(o,u,O):De.touch&&u==="dblclick"?tn(o,O):"removeEventListener"in o?o.removeEventListener(ur[u]||u,O,!1):o.detachEvent("on"+u,O),o[cs][y]=null}function sn(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function vo(o){return hr(o,"wheel",sn),this}function Bi(o){return qe(o,"mousedown touchstart dblclick contextmenu",sn),o._leaflet_disable_click=!0,this}function zt(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function Gs(o){return zt(o),sn(o),this}function El(o){if(o.composedPath)return o.composedPath();for(var u=[],_=o.target;_;)u.push(_),_=_.parentNode;return u}function bl(o,u){if(!u)return new _e(o.clientX,o.clientY);var _=si(u),m=_.boundingClientRect;return new _e((o.clientX-m.left)/_.x-u.clientLeft,(o.clientY-m.top)/_.y-u.clientTop)}var Pa=De.linux&&De.chrome?window.devicePixelRatio:De.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function vl(o){return De.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/Pa:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function _r(o,u){var _=u.relatedTarget;if(!_)return!0;try{for(;_&&_!==o;)_=_.parentNode}catch{return!1}return _!==o}var Da={__proto__:null,on:qe,off:Lt,stopPropagation:sn,disableScrollPropagation:vo,disableClickPropagation:Bi,preventDefault:zt,stop:Gs,getPropagationPath:El,getMousePosition:bl,getWheelDelta:vl,isExternalTarget:_r,addListener:qe,removeListener:Lt},yl=St.extend({run:function(o,u,_,m){this.stop(),this._el=o,this._inProgress=!0,this._duration=_||.25,this._easeOutPower=1/Math.max(m||.5,.2),this._startPos=xt(o),this._offset=u.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Ve(this._animate,this),this._step()},_step:function(o){var u=+new Date-this._startTime,_=this._duration*1e3;u<_?this._runFrame(this._easeOut(u/_),o):(this._runFrame(1),this._complete())},_runFrame:function(o,u){var _=this._startPos.add(this._offset.multiplyBy(o));u&&_._round(),At(this._el,_),this.fire("step")},_complete:function(){de(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),$t=St.extend({options:{crs:Oe,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,u){u=B(this,u),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=T(this._onResize,this),this._initEvents(),u.maxBounds&&this.setMaxBounds(u.maxBounds),u.zoom!==void 0&&(this._zoom=this._limitZoom(u.zoom)),u.center&&u.zoom!==void 0&&this.setView(ve(u.center),u.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ri&&De.any3d&&!De.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),qe(this._proxy,Oi,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,u,_){if(u=u===void 0?this._zoom:this._limitZoom(u),o=this._limitCenter(ve(o),u,this.options.maxBounds),_=_||{},this._stop(),this._loaded&&!_.reset&&_!==!0){_.animate!==void 0&&(_.zoom=p({animate:_.animate},_.zoom),_.pan=p({animate:_.animate,duration:_.duration},_.pan));var m=this._zoom!==u?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,u,_.zoom):this._tryAnimatedPan(o,_.pan);if(m)return clearTimeout(this._sizeTimer),this}return this._resetView(o,u,_.pan&&_.pan.noMoveStart),this},setZoom:function(o,u){return this._loaded?this.setView(this.getCenter(),o,{zoom:u}):(this._zoom=o,this)},zoomIn:function(o,u){return o=o||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,u)},zoomOut:function(o,u){return o=o||(De.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,u)},setZoomAround:function(o,u,_){var m=this.getZoomScale(u),y=this.getSize().divideBy(2),O=o instanceof _e?o:this.latLngToContainerPoint(o),U=O.subtract(y).multiplyBy(1-1/m),K=this.containerPointToLatLng(y.add(U));return this.setView(K,u,{zoom:_})},_getBoundsCenterZoom:function(o,u){u=u||{},o=o.getBounds?o.getBounds():Fe(o);var _=be(u.paddingTopLeft||u.padding||[0,0]),m=be(u.paddingBottomRight||u.padding||[0,0]),y=this.getBoundsZoom(o,!1,_.add(m));if(y=typeof u.maxZoom=="number"?Math.min(u.maxZoom,y):y,y===1/0)return{center:o.getCenter(),zoom:y};var O=m.subtract(_).divideBy(2),U=this.project(o.getSouthWest(),y),K=this.project(o.getNorthEast(),y),Q=this.unproject(U.add(K).divideBy(2).add(O),y);return{center:Q,zoom:y}},fitBounds:function(o,u){if(o=Fe(o),!o.isValid())throw new Error("Bounds are not valid.");var _=this._getBoundsCenterZoom(o,u);return this.setView(_.center,_.zoom,u)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,u){return this.setView(o,this._zoom,{pan:u})},panBy:function(o,u){if(o=be(o).round(),u=u||{},!o.x&&!o.y)return this.fire("moveend");if(u.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new yl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),u.noMoveStart||this.fire("movestart"),u.animate!==!1){Ze(this._mapPane,"leaflet-pan-anim");var _=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,_,u.duration||.25,u.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,u,_){if(_=_||{},_.animate===!1||!De.any3d)return this.setView(o,u,_);this._stop();var m=this.project(this.getCenter()),y=this.project(o),O=this.getSize(),U=this._zoom;o=ve(o),u=u===void 0?U:u;var K=Math.max(O.x,O.y),Q=K*this.getZoomScale(U,u),fe=y.distanceTo(m)||1,Ae=1.42,tt=Ae*Ae;function at(Yt){var Po=Yt?-1:1,Kl=Yt?Q:K,Nr=Q*Q-K*K+Po*tt*tt*fe*fe,Qa=2*Kl*tt*fe,Mr=Nr/Qa,Jl=Math.sqrt(Mr*Mr+1)-Mr,Zl=Jl<1e-9?-18:Math.log(Jl);return Zl}function Ti(Yt){return(Math.exp(Yt)-Math.exp(-Yt))/2}function Gt(Yt){return(Math.exp(Yt)+Math.exp(-Yt))/2}function di(Yt){return Ti(Yt)/Gt(Yt)}var Xt=at(0);function Vi(Yt){return K*(Gt(Xt)/Gt(Xt+Ae*Yt))}function Lr(Yt){return K*(Gt(Xt)*di(Xt+Ae*Yt)-Ti(Xt))/tt}function ks(Yt){return 1-Math.pow(1-Yt,1.5)}var Za=Date.now(),Yl=(at(1)-Xt)/Ae,qa=_.duration?1e3*_.duration:1e3*Yl*.8;function jl(){var Yt=(Date.now()-Za)/qa,Po=ks(Yt)*Yl;Yt<=1?(this._flyToFrame=Ve(jl,this),this._move(this.unproject(m.add(y.subtract(m).multiplyBy(Lr(Po)/fe)),U),this.getScaleZoom(K/Vi(Po),U),{flyTo:!0})):this._move(o,u)._moveEnd(!0)}return this._moveStart(!0,_.noMoveStart),jl.call(this),this},flyToBounds:function(o,u){var _=this._getBoundsCenterZoom(o,u);return this.flyTo(_.center,_.zoom,u)},setMaxBounds:function(o){return o=Fe(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var u=this.options.minZoom;return this.options.minZoom=o,this._loaded&&u!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var u=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&u!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,u){this._enforcingBounds=!0;var _=this.getCenter(),m=this._limitCenter(_,this._zoom,Fe(o));return _.equals(m)||this.panTo(m,u),this._enforcingBounds=!1,this},panInside:function(o,u){u=u||{};var _=be(u.paddingTopLeft||u.padding||[0,0]),m=be(u.paddingBottomRight||u.padding||[0,0]),y=this.project(this.getCenter()),O=this.project(o),U=this.getPixelBounds(),K=ot([U.min.add(_),U.max.subtract(m)]),Q=K.getSize();if(!K.contains(O)){this._enforcingBounds=!0;var fe=O.subtract(K.getCenter()),Ae=K.extend(O).getSize().subtract(Q);y.x+=fe.x<0?-Ae.x:Ae.x,y.y+=fe.y<0?-Ae.y:Ae.y,this.panTo(this.unproject(y),u),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=p({animate:!1,pan:!0},o===!0?{animate:!0}:o);var u=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var _=this.getSize(),m=u.divideBy(2).round(),y=_.divideBy(2).round(),O=m.subtract(y);return!O.x&&!O.y?this:(o.animate&&o.pan?this.panBy(O):(o.pan&&this._rawPanBy(O),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(T(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:u,newSize:_}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=p({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var u=T(this._handleGeolocationResponse,this),_=T(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(u,_,o):navigator.geolocation.getCurrentPosition(u,_,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var u=o.code,_=o.message||(u===1?"permission denied":u===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:u,message:"Geolocation error: "+_+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var u=o.coords.latitude,_=o.coords.longitude,m=new Se(u,_),y=m.toBounds(o.coords.accuracy*2),O=this._locateOptions;if(O.setView){var U=this.getBoundsZoom(y);this.setView(m,O.maxZoom?Math.min(U,O.maxZoom):U)}var K={latlng:m,bounds:y,timestamp:o.timestamp};for(var Q in o.coords)typeof o.coords[Q]=="number"&&(K[Q]=o.coords[Q]);this.fire("locationfound",K)}},addHandler:function(o,u){if(!u)return this;var _=this[o]=new u(this);return this._handlers.push(_),this.options[o]&&_.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),It(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(de(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)It(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,u){var _="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),m=et("div",_,u||this._mapPane);return o&&(this._panes[o]=m),m},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),u=this.unproject(o.getBottomLeft()),_=this.unproject(o.getTopRight());return new Ge(u,_)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,u,_){o=Fe(o),_=be(_||[0,0]);var m=this.getZoom()||0,y=this.getMinZoom(),O=this.getMaxZoom(),U=o.getNorthWest(),K=o.getSouthEast(),Q=this.getSize().subtract(_),fe=ot(this.project(K,m),this.project(U,m)).getSize(),Ae=De.any3d?this.options.zoomSnap:1,tt=Q.x/fe.x,at=Q.y/fe.y,Ti=u?Math.max(tt,at):Math.min(tt,at);return m=this.getScaleZoom(Ti,m),Ae&&(m=Math.round(m/(Ae/100))*(Ae/100),m=u?Math.ceil(m/Ae)*Ae:Math.floor(m/Ae)*Ae),Math.max(y,Math.min(O,m))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new _e(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,u){var _=this._getTopLeftPoint(o,u);return new Ie(_,_.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,u){var _=this.options.crs;return u=u===void 0?this._zoom:u,_.scale(o)/_.scale(u)},getScaleZoom:function(o,u){var _=this.options.crs;u=u===void 0?this._zoom:u;var m=_.zoom(o*_.scale(u));return isNaN(m)?1/0:m},project:function(o,u){return u=u===void 0?this._zoom:u,this.options.crs.latLngToPoint(ve(o),u)},unproject:function(o,u){return u=u===void 0?this._zoom:u,this.options.crs.pointToLatLng(be(o),u)},layerPointToLatLng:function(o){var u=be(o).add(this.getPixelOrigin());return this.unproject(u)},latLngToLayerPoint:function(o){var u=this.project(ve(o))._round();return u._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(ve(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(Fe(o))},distance:function(o,u){return this.options.crs.distance(ve(o),ve(u))},containerPointToLayerPoint:function(o){return be(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return be(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var u=this.containerPointToLayerPoint(be(o));return this.layerPointToLatLng(u)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ve(o)))},mouseEventToContainerPoint:function(o){return bl(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var u=this._container=bs(o);if(u){if(u._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");qe(u,"scroll",this._onScroll,this),this._containerId=I(u)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&De.any3d,Ze(o,"leaflet-container"+(De.touch?" leaflet-touch":"")+(De.retina?" leaflet-retina":"")+(De.ielt9?" leaflet-oldie":"")+(De.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var u=Ni(o,"position");u!=="absolute"&&u!=="relative"&&u!=="fixed"&&u!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),At(this._mapPane,new _e(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ze(o.markerPane,"leaflet-zoom-hide"),Ze(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,u,_){At(this._mapPane,new _e(0,0));var m=!this._loaded;this._loaded=!0,u=this._limitZoom(u),this.fire("viewprereset");var y=this._zoom!==u;this._moveStart(y,_)._move(o,u)._moveEnd(y),this.fire("viewreset"),m&&this.fire("load")},_moveStart:function(o,u){return o&&this.fire("zoomstart"),u||this.fire("movestart"),this},_move:function(o,u,_,m){u===void 0&&(u=this._zoom);var y=this._zoom!==u;return this._zoom=u,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),m?_&&_.pinch&&this.fire("zoom",_):((y||_&&_.pinch)&&this.fire("zoom",_),this.fire("move",_)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return de(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){At(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[I(this._container)]=this;var u=o?Lt:qe;u(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&u(window,"resize",this._onResize,this),De.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){de(this._resizeRequest),this._resizeRequest=Ve(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,u){for(var _=[],m,y=u==="mouseout"||u==="mouseover",O=o.target||o.srcElement,U=!1;O;){if(m=this._targets[I(O)],m&&(u==="click"||u==="preclick")&&this._draggableMoved(m)){U=!0;break}if(m&&m.listens(u,!0)&&(y&&!_r(O,o)||(_.push(m),y))||O===this._container)break;O=O.parentNode}return!_.length&&!U&&!y&&this.listens(u,!0)&&(_=[this]),_},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var u=o.target||o.srcElement;if(!(!this._loaded||u._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(u))){var _=o.type;_==="mousedown"&&cr(u),this._fireDOMEvent(o,_)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,u,_){if(o.type==="click"){var m=p({},o);m.type="preclick",this._fireDOMEvent(m,m.type,_)}var y=this._findEventTargets(o,u);if(_){for(var O=[],U=0;U<_.length;U++)_[U].listens(u,!0)&&O.push(_[U]);y=O.concat(y)}if(y.length){u==="contextmenu"&&zt(o);var K=y[0],Q={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var fe=K.getLatLng&&(!K._radius||K._radius<=10);Q.containerPoint=fe?this.latLngToContainerPoint(K.getLatLng()):this.mouseEventToContainerPoint(o),Q.layerPoint=this.containerPointToLayerPoint(Q.containerPoint),Q.latlng=fe?K.getLatLng():this.layerPointToLatLng(Q.layerPoint)}for(U=0;U<y.length;U++)if(y[U].fire(u,Q,!0),Q.originalEvent._stopped||y[U].options.bubblingMouseEvents===!1&&se(this._mouseEvents,u)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,u=this._handlers.length;o<u;o++)this._handlers[o].disable()},whenReady:function(o,u){return this._loaded?o.call(u||this,{target:this}):this.on("load",o,u),this},_getMapPanePos:function(){return xt(this._mapPane)||new _e(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,u){var _=o&&u!==void 0?this._getNewPixelOrigin(o,u):this.getPixelOrigin();return _.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,u){var _=this.getSize()._divideBy(2);return this.project(o,u)._subtract(_)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,u,_){var m=this._getNewPixelOrigin(_,u);return this.project(o,u)._subtract(m)},_latLngBoundsToNewLayerBounds:function(o,u,_){var m=this._getNewPixelOrigin(_,u);return ot([this.project(o.getSouthWest(),u)._subtract(m),this.project(o.getNorthWest(),u)._subtract(m),this.project(o.getSouthEast(),u)._subtract(m),this.project(o.getNorthEast(),u)._subtract(m)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,u,_){if(!_)return o;var m=this.project(o,u),y=this.getSize().divideBy(2),O=new Ie(m.subtract(y),m.add(y)),U=this._getBoundsOffset(O,_,u);return Math.abs(U.x)<=1&&Math.abs(U.y)<=1?o:this.unproject(m.add(U),u)},_limitOffset:function(o,u){if(!u)return o;var _=this.getPixelBounds(),m=new Ie(_.min.add(o),_.max.add(o));return o.add(this._getBoundsOffset(m,u))},_getBoundsOffset:function(o,u,_){var m=ot(this.project(u.getNorthEast(),_),this.project(u.getSouthWest(),_)),y=m.min.subtract(o.min),O=m.max.subtract(o.max),U=this._rebound(y.x,-O.x),K=this._rebound(y.y,-O.y);return new _e(U,K)},_rebound:function(o,u){return o+u>0?Math.round(o-u)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(u))},_limitZoom:function(o){var u=this.getMinZoom(),_=this.getMaxZoom(),m=De.any3d?this.options.zoomSnap:1;return m&&(o=Math.round(o/m)*m),Math.max(u,Math.min(_,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ft(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,u){var _=this._getCenterOffset(o)._trunc();return(u&&u.animate)!==!0&&!this.getSize().contains(_)?!1:(this.panBy(_,u),!0)},_createAnimProxy:function(){var o=this._proxy=et("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(u){var _=Vt,m=this._proxy.style[_];Mi(this._proxy,this.project(u.center,u.zoom),this.getZoomScale(u.zoom,1)),m===this._proxy.style[_]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){It(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),u=this.getZoom();Mi(this._proxy,this.project(o,u),this.getZoomScale(u,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,u,_){if(this._animatingZoom)return!0;if(_=_||{},!this._zoomAnimated||_.animate===!1||this._nothingToAnimate()||Math.abs(u-this._zoom)>this.options.zoomAnimationThreshold)return!1;var m=this.getZoomScale(u),y=this._getCenterOffset(o)._divideBy(1-1/m);return _.animate!==!0&&!this.getSize().contains(y)?!1:(Ve(function(){this._moveStart(!0,_.noMoveStart||!1)._animateZoom(o,u,!0)},this),!0)},_animateZoom:function(o,u,_,m){this._mapPane&&(_&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=u,Ze(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:u,noUpdate:m}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(T(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ft(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ba(o,u){return new $t(o,u)}var Fi=ze.extend({options:{position:"topright"},initialize:function(o){B(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var u=this._map;return u&&u.removeControl(this),this.options.position=o,u&&u.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var u=this._container=this.onAdd(o),_=this.getPosition(),m=o._controlCorners[_];return Ze(u,"leaflet-control"),_.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(It(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),Kn=function(o){return new Fi(o)};$t.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},u="leaflet-",_=this._controlContainer=et("div",u+"control-container",this._container);function m(y,O){var U=u+y+" "+u+O;o[y+O]=et("div",U,_)}m("top","left"),m("top","right"),m("bottom","left"),m("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)It(this._controlCorners[o]);It(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var bn=Fi.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,u,_,m){return _<m?-1:m<_?1:0}},initialize:function(o,u,_){B(this,_),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var m in o)this._addLayer(o[m],m);for(m in u)this._addLayer(u[m],m,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return Fi.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,u){return this._addLayer(o,u),this._map?this._update():this},addOverlay:function(o,u){return this._addLayer(o,u,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var u=this._getLayer(I(o));return u&&this._layers.splice(this._layers.indexOf(u),1),this._map?this._update():this},expand:function(){Ze(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(Ze(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):ft(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ft(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",u=this._container=et("div",o),_=this.options.collapsed;u.setAttribute("aria-haspopup",!0),Bi(u),vo(u);var m=this._section=et("section",o+"-list");_&&(this._map.on("click",this.collapse,this),qe(u,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var y=this._layersLink=et("a",o+"-toggle",u);y.href="#",y.title="Layers",y.setAttribute("role","button"),qe(y,{keydown:function(O){O.keyCode===13&&this._expandSafely()},click:function(O){zt(O),this._expandSafely()}},this),_||this.expand(),this._baseLayersList=et("div",o+"-base",m),this._separator=et("div",o+"-separator",m),this._overlaysList=et("div",o+"-overlays",m),u.appendChild(m)},_getLayer:function(o){for(var u=0;u<this._layers.length;u++)if(this._layers[u]&&I(this._layers[u].layer)===o)return this._layers[u]},_addLayer:function(o,u,_){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:u,overlay:_}),this.options.sortLayers&&this._layers.sort(T(function(m,y){return this.options.sortFunction(m.layer,y.layer,m.name,y.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ui(this._baseLayersList),ui(this._overlaysList),this._layerControlInputs=[];var o,u,_,m,y=0;for(_=0;_<this._layers.length;_++)m=this._layers[_],this._addItem(m),u=u||m.overlay,o=o||!m.overlay,y+=m.overlay?0:1;return this.options.hideSingleBase&&(o=o&&y>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=u&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var u=this._getLayer(I(o.target)),_=u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;_&&this._map.fire(_,u)},_createRadioElement:function(o,u){var _='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=_,m.firstChild},_addItem:function(o){var u=document.createElement("label"),_=this._map.hasLayer(o.layer),m;o.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="leaflet-control-layers-selector",m.defaultChecked=_):m=this._createRadioElement("leaflet-base-layers_"+I(this),_),this._layerControlInputs.push(m),m.layerId=I(o.layer),qe(m,"click",this._onInputClick,this);var y=document.createElement("span");y.innerHTML=" "+o.name;var O=document.createElement("span");u.appendChild(O),O.appendChild(m),O.appendChild(y);var U=o.overlay?this._overlaysList:this._baseLayersList;return U.appendChild(u),this._checkDisabledLayers(),u},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,u,_,m=[],y=[];this._handlingClick=!0;for(var O=o.length-1;O>=0;O--)u=o[O],_=this._getLayer(u.layerId).layer,u.checked?m.push(_):u.checked||y.push(_);for(O=0;O<y.length;O++)this._map.hasLayer(y[O])&&this._map.removeLayer(y[O]);for(O=0;O<m.length;O++)this._map.hasLayer(m[O])||this._map.addLayer(m[O]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,u,_,m=this._map.getZoom(),y=o.length-1;y>=0;y--)u=o[y],_=this._getLayer(u.layerId).layer,u.disabled=_.options.minZoom!==void 0&&m<_.options.minZoom||_.options.maxZoom!==void 0&&m>_.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,qe(o,"click",zt),this.expand();var u=this;setTimeout(function(){Lt(o,"click",zt),u._preventClick=!1})}}),pr=function(o,u,_){return new bn(o,u,_)},fr=Fi.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var u="leaflet-control-zoom",_=et("div",u+" leaflet-bar"),m=this.options;return this._zoomInButton=this._createButton(m.zoomInText,m.zoomInTitle,u+"-in",_,this._zoomIn),this._zoomOutButton=this._createButton(m.zoomOutText,m.zoomOutTitle,u+"-out",_,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),_},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,u,_,m,y){var O=et("a",_,m);return O.innerHTML=o,O.href="#",O.title=u,O.setAttribute("role","button"),O.setAttribute("aria-label",u),Bi(O),qe(O,"click",Gs),qe(O,"click",y,this),qe(O,"click",this._refocusOnMap,this),O},_updateDisabled:function(){var o=this._map,u="leaflet-disabled";ft(this._zoomInButton,u),ft(this._zoomOutButton,u),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(Ze(this._zoomOutButton,u),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(Ze(this._zoomInButton,u),this._zoomInButton.setAttribute("aria-disabled","true"))}});$t.mergeOptions({zoomControl:!0}),$t.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new fr,this.addControl(this.zoomControl))});var Jn=function(o){return new fr(o)},gr=Fi.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var u="leaflet-control-scale",_=et("div",u),m=this.options;return this._addScales(m,u+"-line",_),o.on(m.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),_},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,u,_){o.metric&&(this._mScale=et("div",u,_)),o.imperial&&(this._iScale=et("div",u,_))},_update:function(){var o=this._map,u=o.getSize().y/2,_=o.distance(o.containerPointToLatLng([0,u]),o.containerPointToLatLng([this.options.maxWidth,u]));this._updateScales(_)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var u=this._getRoundNum(o),_=u<1e3?u+" m":u/1e3+" km";this._updateScale(this._mScale,_,u/o)},_updateImperial:function(o){var u=o*3.2808399,_,m,y;u>5280?(_=u/5280,m=this._getRoundNum(_),this._updateScale(this._iScale,m+" mi",m/_)):(y=this._getRoundNum(u),this._updateScale(this._iScale,y+" ft",y/u))},_updateScale:function(o,u,_){o.style.width=Math.round(this.options.maxWidth*_)+"px",o.innerHTML=u},_getRoundNum:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),_=o/u;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,u*_}}),Il=function(o){return new gr(o)},Sl='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Zn=Fi.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(De.inlineSvg?Sl+" ":"")+"Leaflet</a>"},initialize:function(o){B(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=et("div","leaflet-control-attribution"),Bi(this._container);for(var u in o._layers)o._layers[u].getAttribution&&this.addAttribution(o._layers[u].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var u in this._attributions)this._attributions[u]&&o.push(u);var _=[];this.options.prefix&&_.push(this.options.prefix),o.length&&_.push(o.join(", ")),this._container.innerHTML=_.join(' <span aria-hidden="true">|</span> ')}}});$t.mergeOptions({attributionControl:!0}),$t.addInitHook(function(){this.options.attributionControl&&new Zn().addTo(this)});var mr=function(o){return new Zn(o)};Fi.Layers=bn,Fi.Zoom=fr,Fi.Scale=gr,Fi.Attribution=Zn,Kn.layers=pr,Kn.zoom=Jn,Kn.scale=Il,Kn.attribution=mr;var Zi=ze.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Zi.addTo=function(o,u){return o.addHandler(u,this),this};var Fa={Events:Ce},$r=De.touch?"touchstart mousedown":"mousedown",Is=St.extend({options:{clickTolerance:3},initialize:function(o,u,_,m){B(this,m),this._element=o,this._dragStartTarget=u||o,this._preventOutline=_},enable:function(){this._enabled||(qe(this._dragStartTarget,$r,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Is._dragging===this&&this.finishDrag(!0),Lt(this._dragStartTarget,$r,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!qt(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){Is._dragging===this&&this.finishDrag();return}if(!(Is._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(Is._dragging=this,this._preventOutline&&cr(this._element),ii(),wi(),!this._moving)){this.fire("down");var u=o.touches?o.touches[0]:o,_=Hs(this._element);this._startPoint=new _e(u.clientX,u.clientY),this._startPos=xt(this._element),this._parentScale=si(_);var m=o.type==="mousedown";qe(document,m?"mousemove":"touchmove",this._onMove,this),qe(document,m?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var u=o.touches&&o.touches.length===1?o.touches[0]:o,_=new _e(u.clientX,u.clientY)._subtract(this._startPoint);!_.x&&!_.y||Math.abs(_.x)+Math.abs(_.y)<this.options.clickTolerance||(_.x/=this._parentScale.x,_.y/=this._parentScale.y,zt(o),this._moved||(this.fire("dragstart"),this._moved=!0,Ze(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ze(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(_),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),At(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){ft(document.body,"leaflet-dragging"),this._lastTarget&&(ft(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Lt(document,"mousemove touchmove",this._onMove,this),Lt(document,"mouseup touchend touchcancel",this._onUp,this),as(),Wt();var u=this._moved&&this._moving;this._moving=!1,Is._dragging=!1,u&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function Tr(o,u,_){var m,y=[1,4,2,8],O,U,K,Q,fe,Ae,tt,at;for(O=0,Ae=o.length;O<Ae;O++)o[O]._code=hs(o[O],u);for(K=0;K<4;K++){for(tt=y[K],m=[],O=0,Ae=o.length,U=Ae-1;O<Ae;U=O++)Q=o[O],fe=o[U],Q._code&tt?fe._code&tt||(at=Qn(fe,Q,tt,u,_),at._code=hs(at,u),m.push(at)):(fe._code&tt&&(at=Qn(fe,Q,tt,u,_),at._code=hs(at,u),m.push(at)),m.push(Q));o=m}return o}function Er(o,u){var _,m,y,O,U,K,Q,fe,Ae;if(!o||o.length===0)throw new Error("latlngs not passed");Ui(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var tt=ve([0,0]),at=Fe(o),Ti=at.getNorthWest().distanceTo(at.getSouthWest())*at.getNorthEast().distanceTo(at.getNorthWest());Ti<1700&&(tt=yo(o));var Gt=o.length,di=[];for(_=0;_<Gt;_++){var Xt=ve(o[_]);di.push(u.project(ve([Xt.lat-tt.lat,Xt.lng-tt.lng])))}for(K=Q=fe=0,_=0,m=Gt-1;_<Gt;m=_++)y=di[_],O=di[m],U=y.y*O.x-O.y*y.x,Q+=(y.x+O.x)*U,fe+=(y.y+O.y)*U,K+=U*3;K===0?Ae=di[0]:Ae=[Q/K,fe/K];var Vi=u.unproject(be(Ae));return ve([Vi.lat+tt.lat,Vi.lng+tt.lng])}function yo(o){for(var u=0,_=0,m=0,y=0;y<o.length;y++){var O=ve(o[y]);u+=O.lat,_+=O.lng,m++}return ve([u/m,_/m])}var Ol={__proto__:null,clipPolygon:Tr,polygonCenter:Er,centroid:yo};function br(o,u){if(!u||!o.length)return o.slice();var _=u*u;return o=vr(o,_),o=Cl(o,_),o}function kl(o,u,_){return Math.sqrt(vn(o,u,_,!0))}function Io(o,u,_){return vn(o,u,_)}function Cl(o,u){var _=o.length,m=typeof Uint8Array<"u"?Uint8Array:Array,y=new m(_);y[0]=y[_-1]=1,qn(o,y,u,0,_-1);var O,U=[];for(O=0;O<_;O++)y[O]&&U.push(o[O]);return U}function qn(o,u,_,m,y){var O=0,U,K,Q;for(K=m+1;K<=y-1;K++)Q=vn(o[K],o[m],o[y],!0),Q>O&&(U=K,O=Q);O>_&&(u[U]=1,qn(o,u,_,m,U),qn(o,u,_,U,y))}function vr(o,u){for(var _=[o[0]],m=1,y=0,O=o.length;m<O;m++)Rl(o[m],o[y])>u&&(_.push(o[m]),y=m);return y<O-1&&_.push(o[O-1]),_}var us;function yr(o,u,_,m,y){var O=m?us:hs(o,_),U=hs(u,_),K,Q,fe;for(us=U;;){if(!(O|U))return[o,u];if(O&U)return!1;K=O||U,Q=Qn(o,u,K,_,y),fe=hs(Q,_),K===O?(o=Q,O=fe):(u=Q,U=fe)}}function Qn(o,u,_,m,y){var O=u.x-o.x,U=u.y-o.y,K=m.min,Q=m.max,fe,Ae;return _&8?(fe=o.x+O*(Q.y-o.y)/U,Ae=Q.y):_&4?(fe=o.x+O*(K.y-o.y)/U,Ae=K.y):_&2?(fe=Q.x,Ae=o.y+U*(Q.x-o.x)/O):_&1&&(fe=K.x,Ae=o.y+U*(K.x-o.x)/O),new _e(fe,Ae,y)}function hs(o,u){var _=0;return o.x<u.min.x?_|=1:o.x>u.max.x&&(_|=2),o.y<u.min.y?_|=4:o.y>u.max.y&&(_|=8),_}function Rl(o,u){var _=u.x-o.x,m=u.y-o.y;return _*_+m*m}function vn(o,u,_,m){var y=u.x,O=u.y,U=_.x-y,K=_.y-O,Q=U*U+K*K,fe;return Q>0&&(fe=((o.x-y)*U+(o.y-O)*K)/Q,fe>1?(y=_.x,O=_.y):fe>0&&(y+=U*fe,O+=K*fe)),U=o.x-y,K=o.y-O,m?U*U+K*K:new _e(y,O)}function Ui(o){return!z(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function So(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ui(o)}function Ir(o,u){var _,m,y,O,U,K,Q,fe;if(!o||o.length===0)throw new Error("latlngs not passed");Ui(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var Ae=ve([0,0]),tt=Fe(o),at=tt.getNorthWest().distanceTo(tt.getSouthWest())*tt.getNorthEast().distanceTo(tt.getNorthWest());at<1700&&(Ae=yo(o));var Ti=o.length,Gt=[];for(_=0;_<Ti;_++){var di=ve(o[_]);Gt.push(u.project(ve([di.lat-Ae.lat,di.lng-Ae.lng])))}for(_=0,m=0;_<Ti-1;_++)m+=Gt[_].distanceTo(Gt[_+1])/2;if(m===0)fe=Gt[0];else for(_=0,O=0;_<Ti-1;_++)if(U=Gt[_],K=Gt[_+1],y=U.distanceTo(K),O+=y,O>m){Q=(O-m)/y,fe=[K.x-Q*(K.x-U.x),K.y-Q*(K.y-U.y)];break}var Xt=u.unproject(be(fe));return ve([Xt.lat+Ae.lat,Xt.lng+Ae.lng])}var Ua={__proto__:null,simplify:br,pointToSegmentDistance:kl,closestPointOnSegment:Io,clipSegment:yr,_getEdgeIntersection:Qn,_getBitCode:hs,_sqClosestPointOnSegment:vn,isFlat:Ui,_flat:So,polylineCenter:Ir},Sr={project:function(o){return new _e(o.lng,o.lat)},unproject:function(o){return new Se(o.y,o.x)},bounds:new Ie([-180,-90],[180,90])},Or={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Ie([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var u=Math.PI/180,_=this.R,m=o.lat*u,y=this.R_MINOR/_,O=Math.sqrt(1-y*y),U=O*Math.sin(m),K=Math.tan(Math.PI/4-m/2)/Math.pow((1-U)/(1+U),O/2);return m=-_*Math.log(Math.max(K,1e-10)),new _e(o.lng*u*_,m)},unproject:function(o){for(var u=180/Math.PI,_=this.R,m=this.R_MINOR/_,y=Math.sqrt(1-m*m),O=Math.exp(-o.y/_),U=Math.PI/2-2*Math.atan(O),K=0,Q=.1,fe;K<15&&Math.abs(Q)>1e-7;K++)fe=y*Math.sin(U),fe=Math.pow((1-fe)/(1+fe),y/2),Q=Math.PI/2-2*Math.atan(O*fe)-U,U+=Q;return new Se(U*u,o.x*u/_)}},Ha={__proto__:null,LonLat:Sr,Mercator:Or,SphericalMercator:ee},Ga=p({},je,{code:"EPSG:3395",projection:Or,transformation:function(){var o=.5/(Math.PI*Or.R);return Ee(o,.5,-o,.5)}()}),yn=p({},je,{code:"EPSG:4326",projection:Sr,transformation:Ee(1/180,1,-1/180,.5)}),wl=p({},We,{projection:Sr,transformation:Ee(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,u){var _=u.lng-o.lng,m=u.lat-o.lat;return Math.sqrt(_*_+m*m)},infinite:!0});We.Earth=je,We.EPSG3395=Ga,We.EPSG3857=Oe,We.EPSG900913=Be,We.EPSG4326=yn,We.Simple=wl;var Hi=St.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[I(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[I(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var u=o.target;if(u.hasLayer(this)){if(this._map=u,this._zoomAnimated=u._zoomAnimated,this.getEvents){var _=this.getEvents();u.on(_,this),this.once("remove",function(){u.off(_,this)},this)}this.onAdd(u),this.fire("add"),u.fire("layeradd",{layer:this})}}});$t.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var u=I(o);return this._layers[u]?this:(this._layers[u]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var u=I(o);return this._layers[u]?(this._loaded&&o.onRemove(this),delete this._layers[u],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return I(o)in this._layers},eachLayer:function(o,u){for(var _ in this._layers)o.call(u,this._layers[_]);return this},_addLayers:function(o){o=o?z(o)?o:[o]:[];for(var u=0,_=o.length;u<_;u++)this.addLayer(o[u])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[I(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var u=I(o);this._zoomBoundLayers[u]&&(delete this._zoomBoundLayers[u],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,u=-1/0,_=this._getZoomSpan();for(var m in this._zoomBoundLayers){var y=this._zoomBoundLayers[m].options;o=y.minZoom===void 0?o:Math.min(o,y.minZoom),u=y.maxZoom===void 0?u:Math.max(u,y.maxZoom)}this._layersMaxZoom=u===-1/0?void 0:u,this._layersMinZoom=o===1/0?void 0:o,_!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ds=Hi.extend({initialize:function(o,u){B(this,u),this._layers={};var _,m;if(o)for(_=0,m=o.length;_<m;_++)this.addLayer(o[_])},addLayer:function(o){var u=this.getLayerId(o);return this._layers[u]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var u=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[u]&&this._map.removeLayer(this._layers[u]),delete this._layers[u],this},hasLayer:function(o){var u=typeof o=="number"?o:this.getLayerId(o);return u in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var u=Array.prototype.slice.call(arguments,1),_,m;for(_ in this._layers)m=this._layers[_],m[o]&&m[o].apply(m,u);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,u){for(var _ in this._layers)o.call(u,this._layers[_]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return I(o)}}),kr=function(o,u){return new ds(o,u)},Ss=ds.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),ds.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),ds.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new Ge;for(var u in this._layers){var _=this._layers[u];o.extend(_.getBounds?_.getBounds():_.getLatLng())}return o}}),Va=function(o,u){return new Ss(o,u)},nn=ze.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){B(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,u){var _=this._getIconUrl(o);if(!_){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var m=this._createImg(_,u&&u.tagName==="IMG"?u:null);return this._setIconStyles(m,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(m.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),m},_setIconStyles:function(o,u){var _=this.options,m=_[u+"Size"];typeof m=="number"&&(m=[m,m]);var y=be(m),O=be(u==="shadow"&&_.shadowAnchor||_.iconAnchor||y&&y.divideBy(2,!0));o.className="leaflet-marker-"+u+" "+(_.className||""),O&&(o.style.marginLeft=-O.x+"px",o.style.marginTop=-O.y+"px"),y&&(o.style.width=y.x+"px",o.style.height=y.y+"px")},_createImg:function(o,u){return u=u||document.createElement("img"),u.src=o,u},_getIconUrl:function(o){return De.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function Al(o){return new nn(o)}var Gi=nn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof Gi.imagePath!="string"&&(Gi.imagePath=this._detectIconPath()),(this.options.imagePath||Gi.imagePath)+nn.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var u=function(_,m,y){var O=m.exec(_);return O&&O[y]};return o=u(o,/^url\((['"])?(.+)\1\)$/,2),o&&u(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=et("div","leaflet-default-icon-path",document.body),u=Ni(o,"background-image")||Ni(o,"backgroundImage");if(document.body.removeChild(o),u=this._stripUrl(u),u)return u;var _=document.querySelector('link[href$="leaflet.css"]');return _?_.href.substring(0,_.href.length-11-1):""}}),Cr=Zi.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new Is(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ze(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ft(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var u=this._marker,_=u._map,m=this._marker.options.autoPanSpeed,y=this._marker.options.autoPanPadding,O=xt(u._icon),U=_.getPixelBounds(),K=_.getPixelOrigin(),Q=ot(U.min._subtract(K).add(y),U.max._subtract(K).subtract(y));if(!Q.contains(O)){var fe=be((Math.max(Q.max.x,O.x)-Q.max.x)/(U.max.x-Q.max.x)-(Math.min(Q.min.x,O.x)-Q.min.x)/(U.min.x-Q.min.x),(Math.max(Q.max.y,O.y)-Q.max.y)/(U.max.y-Q.max.y)-(Math.min(Q.min.y,O.y)-Q.min.y)/(U.min.y-Q.min.y)).multiplyBy(m);_.panBy(fe,{animate:!1}),this._draggable._newPos._add(fe),this._draggable._startPos._add(fe),At(u._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=Ve(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(de(this._panRequest),this._panRequest=Ve(this._adjustPan.bind(this,o)))},_onDrag:function(o){var u=this._marker,_=u._shadow,m=xt(u._icon),y=u._map.layerPointToLatLng(m);_&&At(_,m),u._latlng=y,o.latlng=y,o.oldLatLng=this._oldLatLng,u.fire("move",o).fire("drag",o)},_onDragEnd:function(o){de(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),eo=Hi.extend({options:{icon:new Gi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,u){B(this,u),this._latlng=ve(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var u=this._latlng;return this._latlng=ve(o),this.update(),this.fire("move",{oldLatLng:u,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,u="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),_=o.icon.createIcon(this._icon),m=!1;_!==this._icon&&(this._icon&&this._removeIcon(),m=!0,o.title&&(_.title=o.title),_.tagName==="IMG"&&(_.alt=o.alt||"")),Ze(_,u),o.keyboard&&(_.tabIndex="0",_.setAttribute("role","button")),this._icon=_,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&qe(_,"focus",this._panOnFocus,this);var y=o.icon.createShadow(this._shadow),O=!1;y!==this._shadow&&(this._removeShadow(),O=!0),y&&(Ze(y,u),y.alt=""),this._shadow=y,o.opacity<1&&this._updateOpacity(),m&&this.getPane().appendChild(this._icon),this._initInteraction(),y&&O&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Lt(this._icon,"focus",this._panOnFocus,this),It(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&It(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&At(this._icon,o),this._shadow&&At(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var u=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(u)},_initInteraction:function(){if(this.options.interactive&&(Ze(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Cr)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Cr(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&_t(this._icon,o),this._shadow&&_t(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var u=this.options.icon.options,_=u.iconSize?be(u.iconSize):be(0,0),m=u.iconAnchor?be(u.iconAnchor):be(0,0);o.panInside(this._latlng,{paddingTopLeft:m,paddingBottomRight:_.subtract(m)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Wa(o,u){return new eo(o,u)}var Vs=Hi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return B(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Oo=Vs.extend({options:{fill:!0,radius:10},initialize:function(o,u){B(this,u),this._latlng=ve(o),this._radius=this.options.radius},setLatLng:function(o){var u=this._latlng;return this._latlng=ve(o),this.redraw(),this.fire("move",{oldLatLng:u,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var u=o&&o.radius||this._radius;return Vs.prototype.setStyle.call(this,o),this.setRadius(u),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,u=this._radiusY||o,_=this._clickTolerance(),m=[o+_,u+_];this._pxBounds=new Ie(this._point.subtract(m),this._point.add(m))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function za(o,u){return new Oo(o,u)}var ko=Oo.extend({initialize:function(o,u,_){if(typeof u=="number"&&(u=p({},_,{radius:u})),B(this,u),this._latlng=ve(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new Ge(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:Vs.prototype.setStyle,_project:function(){var o=this._latlng.lng,u=this._latlng.lat,_=this._map,m=_.options.crs;if(m.distance===je.distance){var y=Math.PI/180,O=this._mRadius/je.R/y,U=_.project([u+O,o]),K=_.project([u-O,o]),Q=U.add(K).divideBy(2),fe=_.unproject(Q).lat,Ae=Math.acos((Math.cos(O*y)-Math.sin(u*y)*Math.sin(fe*y))/(Math.cos(u*y)*Math.cos(fe*y)))/y;(isNaN(Ae)||Ae===0)&&(Ae=O/Math.cos(Math.PI/180*u)),this._point=Q.subtract(_.getPixelOrigin()),this._radius=isNaN(Ae)?0:Q.x-_.project([fe,o-Ae]).x,this._radiusY=Q.y-U.y}else{var tt=m.unproject(m.project(this._latlng).subtract([this._mRadius,0]));this._point=_.latLngToLayerPoint(this._latlng),this._radius=this._point.x-_.latLngToLayerPoint(tt).x}this._updateBounds()}});function Xa(o,u,_){return new ko(o,u,_)}var _s=Vs.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,u){B(this,u),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var u=1/0,_=null,m=vn,y,O,U=0,K=this._parts.length;U<K;U++)for(var Q=this._parts[U],fe=1,Ae=Q.length;fe<Ae;fe++){y=Q[fe-1],O=Q[fe];var tt=m(o,y,O,!0);tt<u&&(u=tt,_=m(o,y,O))}return _&&(_.distance=Math.sqrt(u)),_},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ir(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,u){return u=u||this._defaultShape(),o=ve(o),u.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new Ge,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return Ui(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var u=[],_=Ui(o),m=0,y=o.length;m<y;m++)_?(u[m]=ve(o[m]),this._bounds.extend(u[m])):u[m]=this._convertLatLngs(o[m]);return u},_project:function(){var o=new Ie;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),u=new _e(o,o);this._rawPxBounds&&(this._pxBounds=new Ie([this._rawPxBounds.min.subtract(u),this._rawPxBounds.max.add(u)]))},_projectLatlngs:function(o,u,_){var m=o[0]instanceof Se,y=o.length,O,U;if(m){for(U=[],O=0;O<y;O++)U[O]=this._map.latLngToLayerPoint(o[O]),_.extend(U[O]);u.push(U)}else for(O=0;O<y;O++)this._projectLatlngs(o[O],u,_)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var u=this._parts,_,m,y,O,U,K,Q;for(_=0,y=0,O=this._rings.length;_<O;_++)for(Q=this._rings[_],m=0,U=Q.length;m<U-1;m++)K=yr(Q[m],Q[m+1],o,m,!0),K&&(u[y]=u[y]||[],u[y].push(K[0]),(K[1]!==Q[m+1]||m===U-2)&&(u[y].push(K[1]),y++))}},_simplifyPoints:function(){for(var o=this._parts,u=this.options.smoothFactor,_=0,m=o.length;_<m;_++)o[_]=br(o[_],u)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,u){var _,m,y,O,U,K,Q=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(_=0,O=this._parts.length;_<O;_++)for(K=this._parts[_],m=0,U=K.length,y=U-1;m<U;y=m++)if(!(!u&&m===0)&&kl(o,K[y],K[m])<=Q)return!0;return!1}});function Ya(o,u){return new _s(o,u)}_s._flat=So;var qi=_s.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Er(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var u=_s.prototype._convertLatLngs.call(this,o),_=u.length;return _>=2&&u[0]instanceof Se&&u[0].equals(u[_-1])&&u.pop(),u},_setLatLngs:function(o){_s.prototype._setLatLngs.call(this,o),Ui(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ui(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,u=this.options.weight,_=new _e(u,u);if(o=new Ie(o.min.subtract(_),o.max.add(_)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var m=0,y=this._rings.length,O;m<y;m++)O=Tr(this._rings[m],o,!0),O.length&&this._parts.push(O)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var u=!1,_,m,y,O,U,K,Q,fe;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(O=0,Q=this._parts.length;O<Q;O++)for(_=this._parts[O],U=0,fe=_.length,K=fe-1;U<fe;K=U++)m=_[U],y=_[K],m.y>o.y!=y.y>o.y&&o.x<(y.x-m.x)*(o.y-m.y)/(y.y-m.y)+m.x&&(u=!u);return u||_s.prototype._containsPoint.call(this,o,!0)}});function Co(o,u){return new qi(o,u)}var Qi=Ss.extend({initialize:function(o,u){B(this,u),this._layers={},o&&this.addData(o)},addData:function(o){var u=z(o)?o:o.features,_,m,y;if(u){for(_=0,m=u.length;_<m;_++)y=u[_],(y.geometries||y.geometry||y.features||y.coordinates)&&this.addData(y);return this}var O=this.options;if(O.filter&&!O.filter(o))return this;var U=In(o,O);return U?(U.feature=Ws(o),U.defaultOptions=U.options,this.resetStyle(U),O.onEachFeature&&O.onEachFeature(o,U),this.addLayer(U)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=p({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(u){this._setLayerStyle(u,o)},this)},_setLayerStyle:function(o,u){o.setStyle&&(typeof u=="function"&&(u=u(o.feature)),o.setStyle(u))}});function In(o,u){var _=o.type==="Feature"?o.geometry:o,m=_?_.coordinates:null,y=[],O=u&&u.pointToLayer,U=u&&u.coordsToLatLng||Ro,K,Q,fe,Ae;if(!m&&!_)return null;switch(_.type){case"Point":return K=U(m),on(O,o,K,u);case"MultiPoint":for(fe=0,Ae=m.length;fe<Ae;fe++)K=U(m[fe]),y.push(on(O,o,K,u));return new Ss(y);case"LineString":case"MultiLineString":return Q=Sn(m,_.type==="LineString"?0:1,U),new _s(Q,u);case"Polygon":case"MultiPolygon":return Q=Sn(m,_.type==="Polygon"?1:2,U),new qi(Q,u);case"GeometryCollection":for(fe=0,Ae=_.geometries.length;fe<Ae;fe++){var tt=In({geometry:_.geometries[fe],type:"Feature",properties:o.properties},u);tt&&y.push(tt)}return new Ss(y);case"FeatureCollection":for(fe=0,Ae=_.features.length;fe<Ae;fe++){var at=In(_.features[fe],u);at&&y.push(at)}return new Ss(y);default:throw new Error("Invalid GeoJSON object.")}}function on(o,u,_,m){return o?o(u,_):new eo(_,m&&m.markersInheritOptions&&m)}function Ro(o){return new Se(o[1],o[0],o[2])}function Sn(o,u,_){for(var m=[],y=0,O=o.length,U;y<O;y++)U=u?Sn(o[y],u-1,_):(_||Ro)(o[y]),m.push(U);return m}function wo(o,u){return o=ve(o),o.alt!==void 0?[N(o.lng,u),N(o.lat,u),N(o.alt,u)]:[N(o.lng,u),N(o.lat,u)]}function Dt(o,u,_,m){for(var y=[],O=0,U=o.length;O<U;O++)y.push(u?Dt(o[O],Ui(o[O])?0:u-1,_,m):wo(o[O],m));return!u&&_&&y.length>0&&y.push(y[0].slice()),y}function On(o,u){return o.feature?p({},o.feature,{geometry:u}):Ws(u)}function Ws(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var rn={toGeoJSON:function(o){return On(this,{type:"Point",coordinates:wo(this.getLatLng(),o)})}};eo.include(rn),ko.include(rn),Oo.include(rn),_s.include({toGeoJSON:function(o){var u=!Ui(this._latlngs),_=Dt(this._latlngs,u?1:0,!1,o);return On(this,{type:(u?"Multi":"")+"LineString",coordinates:_})}}),qi.include({toGeoJSON:function(o){var u=!Ui(this._latlngs),_=u&&!Ui(this._latlngs[0]),m=Dt(this._latlngs,_?2:u?1:0,!0,o);return u||(m=[m]),On(this,{type:(_?"Multi":"")+"Polygon",coordinates:m})}}),ds.include({toMultiPoint:function(o){var u=[];return this.eachLayer(function(_){u.push(_.toGeoJSON(o).geometry.coordinates)}),On(this,{type:"MultiPoint",coordinates:u})},toGeoJSON:function(o){var u=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(u==="MultiPoint")return this.toMultiPoint(o);var _=u==="GeometryCollection",m=[];return this.eachLayer(function(y){if(y.toGeoJSON){var O=y.toGeoJSON(o);if(_)m.push(O.geometry);else{var U=Ws(O);U.type==="FeatureCollection"?m.push.apply(m,U.features):m.push(U)}}}),_?On(this,{geometries:m,type:"GeometryCollection"}):{type:"FeatureCollection",features:m}}});function Ll(o,u){return new Qi(o,u)}var Nl=Ll,kn=Hi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,u,_){this._url=o,this._bounds=Fe(u),B(this,_)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ze(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){It(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&Di(this._image),this},bringToBack:function(){return this._map&&ls(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=Fe(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",u=this._image=o?this._url:et("img");if(Ze(u,"leaflet-image-layer"),this._zoomAnimated&&Ze(u,"leaflet-zoom-animated"),this.options.className&&Ze(u,this.options.className),u.onselectstart=C,u.onmousemove=C,u.onload=T(this.fire,this,"load"),u.onerror=T(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=u.src;return}u.src=this._url,u.alt=this.options.alt},_animateZoom:function(o){var u=this._map.getZoomScale(o.zoom),_=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;Mi(this._image,_,u)},_reset:function(){var o=this._image,u=new Ie(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),_=u.getSize();At(o,u.min),o.style.width=_.x+"px",o.style.height=_.y+"px"},_updateOpacity:function(){_t(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),to=function(o,u,_){return new kn(o,u,_)},Rr=kn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",u=this._image=o?this._url:et("video");if(Ze(u,"leaflet-image-layer"),this._zoomAnimated&&Ze(u,"leaflet-zoom-animated"),this.options.className&&Ze(u,this.options.className),u.onselectstart=C,u.onmousemove=C,u.onloadeddata=T(this.fire,this,"load"),o){for(var _=u.getElementsByTagName("source"),m=[],y=0;y<_.length;y++)m.push(_[y].src);this._url=_.length>0?m:[u.src];return}z(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(u.style,"objectFit")&&(u.style.objectFit="fill"),u.autoplay=!!this.options.autoplay,u.loop=!!this.options.loop,u.muted=!!this.options.muted,u.playsInline=!!this.options.playsInline;for(var O=0;O<this._url.length;O++){var U=et("source");U.src=this._url[O],u.appendChild(U)}}});function Cn(o,u,_){return new Rr(o,u,_)}var io=kn.extend({_initImage:function(){var o=this._image=this._url;Ze(o,"leaflet-image-layer"),this._zoomAnimated&&Ze(o,"leaflet-zoom-animated"),this.options.className&&Ze(o,this.options.className),o.onselectstart=C,o.onmousemove=C}});function Ml(o,u,_){return new io(o,u,_)}var es=Hi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,u){o&&(o instanceof Se||z(o))?(this._latlng=ve(o),B(this,u)):(B(this,o),this._source=u),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&_t(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&_t(this._container,1),this.bringToFront(),this.options.interactive&&(Ze(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?(_t(this._container,0),this._removeTimeout=setTimeout(T(It,void 0,this._container),200)):It(this._container),this.options.interactive&&(ft(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=ve(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Di(this._container),this},bringToBack:function(){return this._map&&ls(this._container),this},_prepareOpen:function(o){var u=this._source;if(!u._map)return!1;if(u instanceof Ss){u=null;var _=this._source._layers;for(var m in _)if(_[m]._map){u=_[m];break}if(!u)return!1;this._source=u}if(!o)if(u.getCenter)o=u.getCenter();else if(u.getLatLng)o=u.getLatLng();else if(u.getBounds)o=u.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,u=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof u=="string")o.innerHTML=u;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(u)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),u=be(this.options.offset),_=this._getAnchor();this._zoomAnimated?At(this._container,o.add(_)):u=u.add(o).add(_);var m=this._containerBottom=-u.y,y=this._containerLeft=-Math.round(this._containerWidth/2)+u.x;this._container.style.bottom=m+"px",this._container.style.left=y+"px"}},_getAnchor:function(){return[0,0]}});$t.include({_initOverlay:function(o,u,_,m){var y=u;return y instanceof o||(y=new o(m).setContent(u)),_&&y.setLatLng(_),y}}),Hi.include({_initOverlay:function(o,u,_,m){var y=_;return y instanceof o?(B(y,m),y._source=this):(y=u&&!m?u:new o(m,this),y.setContent(_)),y}});var Ao=es.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,es.prototype.openOn.call(this,o)},onAdd:function(o){es.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Vs||this._source.on("preclick",sn))},onRemove:function(o){es.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Vs||this._source.off("preclick",sn))},getEvents:function(){var o=es.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",u=this._container=et("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),_=this._wrapper=et("div",o+"-content-wrapper",u);if(this._contentNode=et("div",o+"-content",_),Bi(u),vo(this._contentNode),qe(u,"contextmenu",sn),this._tipContainer=et("div",o+"-tip-container",u),this._tip=et("div",o+"-tip",this._tipContainer),this.options.closeButton){var m=this._closeButton=et("a",o+"-close-button",u);m.setAttribute("role","button"),m.setAttribute("aria-label","Close popup"),m.href="#close",m.innerHTML='<span aria-hidden="true">&#215;</span>',qe(m,"click",function(y){zt(y),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,u=o.style;u.width="",u.whiteSpace="nowrap";var _=o.offsetWidth;_=Math.min(_,this.options.maxWidth),_=Math.max(_,this.options.minWidth),u.width=_+1+"px",u.whiteSpace="",u.height="";var m=o.offsetHeight,y=this.options.maxHeight,O="leaflet-popup-scrolled";y&&m>y?(u.height=y+"px",Ze(o,O)):ft(o,O),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var u=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),_=this._getAnchor();At(this._container,u.add(_))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,u=parseInt(Ni(this._container,"marginBottom"),10)||0,_=this._container.offsetHeight+u,m=this._containerWidth,y=new _e(this._containerLeft,-_-this._containerBottom);y._add(xt(this._container));var O=o.layerPointToContainerPoint(y),U=be(this.options.autoPanPadding),K=be(this.options.autoPanPaddingTopLeft||U),Q=be(this.options.autoPanPaddingBottomRight||U),fe=o.getSize(),Ae=0,tt=0;O.x+m+Q.x>fe.x&&(Ae=O.x+m-fe.x+Q.x),O.x-Ae-K.x<0&&(Ae=O.x-K.x),O.y+_+Q.y>fe.y&&(tt=O.y+_-fe.y+Q.y),O.y-tt-K.y<0&&(tt=O.y-K.y),(Ae||tt)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([Ae,tt]))}},_getAnchor:function(){return be(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ja=function(o,u){return new Ao(o,u)};$t.mergeOptions({closePopupOnClick:!0}),$t.include({openPopup:function(o,u,_){return this._initOverlay(Ao,o,u,_).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),Hi.include({bindPopup:function(o,u){return this._popup=this._initOverlay(Ao,this._popup,o,u),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof Ss||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){Gs(o);var u=o.layer||o.target;if(this._popup._source===u&&!(u instanceof Vs)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=u,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var Lo=es.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){es.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){es.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=es.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",u=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=et("div",u),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+I(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var u,_,m=this._map,y=this._container,O=m.latLngToContainerPoint(m.getCenter()),U=m.layerPointToContainerPoint(o),K=this.options.direction,Q=y.offsetWidth,fe=y.offsetHeight,Ae=be(this.options.offset),tt=this._getAnchor();K==="top"?(u=Q/2,_=fe):K==="bottom"?(u=Q/2,_=0):K==="center"?(u=Q/2,_=fe/2):K==="right"?(u=0,_=fe/2):K==="left"?(u=Q,_=fe/2):U.x<O.x?(K="right",u=0,_=fe/2):(K="left",u=Q+(Ae.x+tt.x)*2,_=fe/2),o=o.subtract(be(u,_,!0)).add(Ae).add(tt),ft(y,"leaflet-tooltip-right"),ft(y,"leaflet-tooltip-left"),ft(y,"leaflet-tooltip-top"),ft(y,"leaflet-tooltip-bottom"),Ze(y,"leaflet-tooltip-"+K),At(y,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&_t(this._container,o)},_animateZoom:function(o){var u=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(u)},_getAnchor:function(){return be(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),xl=function(o,u){return new Lo(o,u)};$t.include({openTooltip:function(o,u,_){return this._initOverlay(Lo,o,u,_).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),Hi.include({bindTooltip:function(o,u){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lo,this._tooltip,o,u),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var u=o?"off":"on",_={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?_.add=this._openTooltip:(_.mouseover=this._openTooltip,_.mouseout=this.closeTooltip,_.click=this._openTooltip,this._map?this._addFocusListeners():_.add=this._addFocusListeners),this._tooltip.options.sticky&&(_.mousemove=this._moveTooltip),this[u](_),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof Ss||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var u=typeof o.getElement=="function"&&o.getElement();u&&(qe(u,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),qe(u,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var u=typeof o.getElement=="function"&&o.getElement();u&&u.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var u=this;this._map.once("moveend",function(){u._openOnceFlag=!1,u._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var u=o.latlng,_,m;this._tooltip.options.sticky&&o.originalEvent&&(_=this._map.mouseEventToContainerPoint(o.originalEvent),m=this._map.containerPointToLayerPoint(_),u=this._map.layerPointToLatLng(m)),this._tooltip.setLatLng(u)}});var Pl=nn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var u=o&&o.tagName==="DIV"?o:document.createElement("div"),_=this.options;if(_.html instanceof Element?(ui(u),u.appendChild(_.html)):u.innerHTML=_.html!==!1?_.html:"",_.bgPos){var m=be(_.bgPos);u.style.backgroundPosition=-m.x+"px "+-m.y+"px"}return this._setIconStyles(u,"icon"),u},createShadow:function(){return null}});function Dl(o){return new Pl(o)}nn.Default=Gi;var zs=Hi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:De.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){B(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),It(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Di(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ls(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=R(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof _e?o:new _e(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var u=this.getPane().children,_=-o(-1/0,1/0),m=0,y=u.length,O;m<y;m++)O=u[m].style.zIndex,u[m]!==this._container&&O&&(_=o(_,+O));isFinite(_)&&(this.options.zIndex=_+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!De.ielt9){_t(this._container,this.options.opacity);var o=+new Date,u=!1,_=!1;for(var m in this._tiles){var y=this._tiles[m];if(!(!y.current||!y.loaded)){var O=Math.min(1,(o-y.loaded)/200);_t(y.el,O),O<1?u=!0:(y.active?_=!0:this._onOpaqueTile(y),y.active=!0)}}_&&!this._noPrune&&this._pruneTiles(),u&&(de(this._fadeFrame),this._fadeFrame=Ve(this._updateOpacity,this))}},_onOpaqueTile:C,_initContainer:function(){this._container||(this._container=et("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,u=this.options.maxZoom;if(o!==void 0){for(var _ in this._levels)_=Number(_),this._levels[_].el.children.length||_===o?(this._levels[_].el.style.zIndex=u-Math.abs(o-_),this._onUpdateLevel(_)):(It(this._levels[_].el),this._removeTilesAtZoom(_),this._onRemoveLevel(_),delete this._levels[_]);var m=this._levels[o],y=this._map;return m||(m=this._levels[o]={},m.el=et("div","leaflet-tile-container leaflet-zoom-animated",this._container),m.el.style.zIndex=u,m.origin=y.project(y.unproject(y.getPixelOrigin()),o).round(),m.zoom=o,this._setZoomTransform(m,y.getCenter(),y.getZoom()),C(m.el.offsetWidth),this._onCreateLevel(m)),this._level=m,m}},_onUpdateLevel:C,_onRemoveLevel:C,_onCreateLevel:C,_pruneTiles:function(){if(this._map){var o,u,_=this._map.getZoom();if(_>this.options.maxZoom||_<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)u=this._tiles[o],u.retain=u.current;for(o in this._tiles)if(u=this._tiles[o],u.current&&!u.active){var m=u.coords;this._retainParent(m.x,m.y,m.z,m.z-5)||this._retainChildren(m.x,m.y,m.z,m.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var u in this._tiles)this._tiles[u].coords.z===o&&this._removeTile(u)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)It(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,u,_,m){var y=Math.floor(o/2),O=Math.floor(u/2),U=_-1,K=new _e(+y,+O);K.z=+U;var Q=this._tileCoordsToKey(K),fe=this._tiles[Q];return fe&&fe.active?(fe.retain=!0,!0):(fe&&fe.loaded&&(fe.retain=!0),U>m?this._retainParent(y,O,U,m):!1)},_retainChildren:function(o,u,_,m){for(var y=2*o;y<2*o+2;y++)for(var O=2*u;O<2*u+2;O++){var U=new _e(y,O);U.z=_+1;var K=this._tileCoordsToKey(U),Q=this._tiles[K];if(Q&&Q.active){Q.retain=!0;continue}else Q&&Q.loaded&&(Q.retain=!0);_+1<m&&this._retainChildren(y,O,_+1,m)}},_resetView:function(o){var u=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),u,u)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var u=this.options;return u.minNativeZoom!==void 0&&o<u.minNativeZoom?u.minNativeZoom:u.maxNativeZoom!==void 0&&u.maxNativeZoom<o?u.maxNativeZoom:o},_setView:function(o,u,_,m){var y=Math.round(u);this.options.maxZoom!==void 0&&y>this.options.maxZoom||this.options.minZoom!==void 0&&y<this.options.minZoom?y=void 0:y=this._clampZoom(y);var O=this.options.updateWhenZooming&&y!==this._tileZoom;(!m||O)&&(this._tileZoom=y,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),y!==void 0&&this._update(o),_||this._pruneTiles(),this._noPrune=!!_),this._setZoomTransforms(o,u)},_setZoomTransforms:function(o,u){for(var _ in this._levels)this._setZoomTransform(this._levels[_],o,u)},_setZoomTransform:function(o,u,_){var m=this._map.getZoomScale(_,o.zoom),y=o.origin.multiplyBy(m).subtract(this._map._getNewPixelOrigin(u,_)).round();De.any3d?Mi(o.el,y,m):At(o.el,y)},_resetGrid:function(){var o=this._map,u=o.options.crs,_=this._tileSize=this.getTileSize(),m=this._tileZoom,y=this._map.getPixelWorldBounds(this._tileZoom);y&&(this._globalTileRange=this._pxBoundsToTileRange(y)),this._wrapX=u.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,u.wrapLng[0]],m).x/_.x),Math.ceil(o.project([0,u.wrapLng[1]],m).x/_.y)],this._wrapY=u.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([u.wrapLat[0],0],m).y/_.x),Math.ceil(o.project([u.wrapLat[1],0],m).y/_.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var u=this._map,_=u._animatingZoom?Math.max(u._animateToZoom,u.getZoom()):u.getZoom(),m=u.getZoomScale(_,this._tileZoom),y=u.project(o,this._tileZoom).floor(),O=u.getSize().divideBy(m*2);return new Ie(y.subtract(O),y.add(O))},_update:function(o){var u=this._map;if(u){var _=this._clampZoom(u.getZoom());if(o===void 0&&(o=u.getCenter()),this._tileZoom!==void 0){var m=this._getTiledPixelBounds(o),y=this._pxBoundsToTileRange(m),O=y.getCenter(),U=[],K=this.options.keepBuffer,Q=new Ie(y.getBottomLeft().subtract([K,-K]),y.getTopRight().add([K,-K]));if(!(isFinite(y.min.x)&&isFinite(y.min.y)&&isFinite(y.max.x)&&isFinite(y.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var fe in this._tiles){var Ae=this._tiles[fe].coords;(Ae.z!==this._tileZoom||!Q.contains(new _e(Ae.x,Ae.y)))&&(this._tiles[fe].current=!1)}if(Math.abs(_-this._tileZoom)>1){this._setView(o,_);return}for(var tt=y.min.y;tt<=y.max.y;tt++)for(var at=y.min.x;at<=y.max.x;at++){var Ti=new _e(at,tt);if(Ti.z=this._tileZoom,!!this._isValidTile(Ti)){var Gt=this._tiles[this._tileCoordsToKey(Ti)];Gt?Gt.current=!0:U.push(Ti)}}if(U.sort(function(Xt,Vi){return Xt.distanceTo(O)-Vi.distanceTo(O)}),U.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var di=document.createDocumentFragment();for(at=0;at<U.length;at++)this._addTile(U[at],di);this._level.el.appendChild(di)}}}},_isValidTile:function(o){var u=this._map.options.crs;if(!u.infinite){var _=this._globalTileRange;if(!u.wrapLng&&(o.x<_.min.x||o.x>_.max.x)||!u.wrapLat&&(o.y<_.min.y||o.y>_.max.y))return!1}if(!this.options.bounds)return!0;var m=this._tileCoordsToBounds(o);return Fe(this.options.bounds).overlaps(m)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var u=this._map,_=this.getTileSize(),m=o.scaleBy(_),y=m.add(_),O=u.unproject(m,o.z),U=u.unproject(y,o.z);return[O,U]},_tileCoordsToBounds:function(o){var u=this._tileCoordsToNwSe(o),_=new Ge(u[0],u[1]);return this.options.noWrap||(_=this._map.wrapLatLngBounds(_)),_},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var u=o.split(":"),_=new _e(+u[0],+u[1]);return _.z=+u[2],_},_removeTile:function(o){var u=this._tiles[o];u&&(It(u.el),delete this._tiles[o],this.fire("tileunload",{tile:u.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){Ze(o,"leaflet-tile");var u=this.getTileSize();o.style.width=u.x+"px",o.style.height=u.y+"px",o.onselectstart=C,o.onmousemove=C,De.ielt9&&this.options.opacity<1&&_t(o,this.options.opacity)},_addTile:function(o,u){var _=this._getTilePos(o),m=this._tileCoordsToKey(o),y=this.createTile(this._wrapCoords(o),T(this._tileReady,this,o));this._initTile(y),this.createTile.length<2&&Ve(T(this._tileReady,this,o,null,y)),At(y,_),this._tiles[m]={el:y,coords:o,current:!0},u.appendChild(y),this.fire("tileloadstart",{tile:y,coords:o})},_tileReady:function(o,u,_){u&&this.fire("tileerror",{error:u,tile:_,coords:o});var m=this._tileCoordsToKey(o);_=this._tiles[m],_&&(_.loaded=+new Date,this._map._fadeAnimated?(_t(_.el,0),de(this._fadeFrame),this._fadeFrame=Ve(this._updateOpacity,this)):(_.active=!0,this._pruneTiles()),u||(Ze(_.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:_.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),De.ielt9||!this._map._fadeAnimated?Ve(this._pruneTiles,this):setTimeout(T(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var u=new _e(this._wrapX?w(o.x,this._wrapX):o.x,this._wrapY?w(o.y,this._wrapY):o.y);return u.z=o.z,u},_pxBoundsToTileRange:function(o){var u=this.getTileSize();return new Ie(o.min.unscaleBy(u).floor(),o.max.unscaleBy(u).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function Ka(o){return new zs(o)}var Rn=zs.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,u){this._url=o,u=B(this,u),u.detectRetina&&De.retina&&u.maxZoom>0?(u.tileSize=Math.floor(u.tileSize/2),u.zoomReverse?(u.zoomOffset--,u.minZoom=Math.min(u.maxZoom,u.minZoom+1)):(u.zoomOffset++,u.maxZoom=Math.max(u.minZoom,u.maxZoom-1)),u.minZoom=Math.max(0,u.minZoom)):u.zoomReverse?u.minZoom=Math.min(u.maxZoom,u.minZoom):u.maxZoom=Math.max(u.minZoom,u.maxZoom),typeof u.subdomains=="string"&&(u.subdomains=u.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,u){return this._url===o&&u===void 0&&(u=!0),this._url=o,u||this.redraw(),this},createTile:function(o,u){var _=document.createElement("img");return qe(_,"load",T(this._tileOnLoad,this,u,_)),qe(_,"error",T(this._tileOnError,this,u,_)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(_.referrerPolicy=this.options.referrerPolicy),_.alt="",_.src=this.getTileUrl(o),_},getTileUrl:function(o){var u={r:De.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var _=this._globalTileRange.max.y-o.y;this.options.tms&&(u.y=_),u["-y"]=_}return P(this._url,p(u,this.options))},_tileOnLoad:function(o,u){De.ielt9?setTimeout(T(o,this,null,u),0):o(null,u)},_tileOnError:function(o,u,_){var m=this.options.errorTileUrl;m&&u.getAttribute("src")!==m&&(u.src=m),o(_,u)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,u=this.options.maxZoom,_=this.options.zoomReverse,m=this.options.zoomOffset;return _&&(o=u-o),o+m},_getSubdomain:function(o){var u=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[u]},_abortLoading:function(){var o,u;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(u=this._tiles[o].el,u.onload=C,u.onerror=C,!u.complete)){u.src=re;var _=this._tiles[o].coords;It(u),delete this._tiles[o],this.fire("tileabort",{tile:u,coords:_})}},_removeTile:function(o){var u=this._tiles[o];if(u)return u.el.setAttribute("src",re),zs.prototype._removeTile.call(this,o)},_tileReady:function(o,u,_){if(!(!this._map||_&&_.getAttribute("src")===re))return zs.prototype._tileReady.call(this,o,u,_)}});function Bl(o,u){return new Rn(o,u)}var Fl=Rn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,u){this._url=o;var _=p({},this.defaultWmsParams);for(var m in u)m in this.options||(_[m]=u[m]);u=B(this,u);var y=u.detectRetina&&De.retina?2:1,O=this.getTileSize();_.width=O.x*y,_.height=O.y*y,this.wmsParams=_},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var u=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[u]=this._crs.code,Rn.prototype.onAdd.call(this,o)},getTileUrl:function(o){var u=this._tileCoordsToNwSe(o),_=this._crs,m=ot(_.project(u[0]),_.project(u[1])),y=m.min,O=m.max,U=(this._wmsVersion>=1.3&&this._crs===yn?[y.y,y.x,O.y,O.x]:[y.x,y.y,O.x,O.y]).join(","),K=Rn.prototype.getTileUrl.call(this,o);return K+ie(this.wmsParams,K,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+U},setParams:function(o,u){return p(this.wmsParams,o),u||this.redraw(),this}});function No(o,u){return new Fl(o,u)}Rn.WMS=Fl,Bl.wms=No;var ps=Hi.extend({options:{padding:.1},initialize:function(o){B(this,o),I(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ze(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,u){var _=this._map.getZoomScale(u,this._zoom),m=this._map.getSize().multiplyBy(.5+this.options.padding),y=this._map.project(this._center,u),O=m.multiplyBy(-_).add(y).subtract(this._map._getNewPixelOrigin(o,u));De.any3d?Mi(this._container,O,_):At(this._container,O)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,u=this._map.getSize(),_=this._map.containerPointToLayerPoint(u.multiplyBy(-o)).round();this._bounds=new Ie(_,_.add(u.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ul=ps.extend({options:{tolerance:0},getEvents:function(){var o=ps.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ps.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");qe(o,"mousemove",this._onMouseMove,this),qe(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),qe(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){de(this._redrawRequest),delete this._ctx,It(this._container),Lt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var u in this._layers)o=this._layers[u],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ps.prototype._update.call(this);var o=this._bounds,u=this._container,_=o.getSize(),m=De.retina?2:1;At(u,o.min),u.width=m*_.x,u.height=m*_.y,u.style.width=_.x+"px",u.style.height=_.y+"px",De.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){ps.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[I(o)]=o;var u=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=u),this._drawLast=u,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var u=o._order,_=u.next,m=u.prev;_?_.prev=m:this._drawLast=m,m?m.next=_:this._drawFirst=_,delete o._order,delete this._layers[I(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var u=o.options.dashArray.split(/[, ]+/),_=[],m,y;for(y=0;y<u.length;y++){if(m=Number(u[y]),isNaN(m))return;_.push(m)}o.options._dashArray=_}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||Ve(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var u=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ie,this._redrawBounds.extend(o._pxBounds.min.subtract([u,u])),this._redrawBounds.extend(o._pxBounds.max.add([u,u]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var u=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,u.x,u.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,u=this._redrawBounds;if(this._ctx.save(),u){var _=u.getSize();this._ctx.beginPath(),this._ctx.rect(u.min.x,u.min.y,_.x,_.y),this._ctx.clip()}this._drawing=!0;for(var m=this._drawFirst;m;m=m.next)o=m.layer,(!u||o._pxBounds&&o._pxBounds.intersects(u))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,u){if(this._drawing){var _,m,y,O,U=o._parts,K=U.length,Q=this._ctx;if(K){for(Q.beginPath(),_=0;_<K;_++){for(m=0,y=U[_].length;m<y;m++)O=U[_][m],Q[m?"lineTo":"moveTo"](O.x,O.y);u&&Q.closePath()}this._fillStroke(Q,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var u=o._point,_=this._ctx,m=Math.max(Math.round(o._radius),1),y=(Math.max(Math.round(o._radiusY),1)||m)/m;y!==1&&(_.save(),_.scale(1,y)),_.beginPath(),_.arc(u.x,u.y/y,m,0,Math.PI*2,!1),y!==1&&_.restore(),this._fillStroke(_,o)}},_fillStroke:function(o,u){var _=u.options;_.fill&&(o.globalAlpha=_.fillOpacity,o.fillStyle=_.fillColor||_.color,o.fill(_.fillRule||"evenodd")),_.stroke&&_.weight!==0&&(o.setLineDash&&o.setLineDash(u.options&&u.options._dashArray||[]),o.globalAlpha=_.opacity,o.lineWidth=_.weight,o.strokeStyle=_.color,o.lineCap=_.lineCap,o.lineJoin=_.lineJoin,o.stroke())},_onClick:function(o){for(var u=this._map.mouseEventToLayerPoint(o),_,m,y=this._drawFirst;y;y=y.next)_=y.layer,_.options.interactive&&_._containsPoint(u)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(_))&&(m=_);this._fireEvent(m?[m]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var u=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,u)}},_handleMouseOut:function(o){var u=this._hoveredLayer;u&&(ft(this._container,"leaflet-interactive"),this._fireEvent([u],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,u){if(!this._mouseHoverThrottled){for(var _,m,y=this._drawFirst;y;y=y.next)_=y.layer,_.options.interactive&&_._containsPoint(u)&&(m=_);m!==this._hoveredLayer&&(this._handleMouseOut(o),m&&(Ze(this._container,"leaflet-interactive"),this._fireEvent([m],o,"mouseover"),this._hoveredLayer=m)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(T(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,u,_){this._map._fireDOMEvent(u,_||u.type,o)},_bringToFront:function(o){var u=o._order;if(u){var _=u.next,m=u.prev;if(_)_.prev=m;else return;m?m.next=_:_&&(this._drawFirst=_),u.prev=this._drawLast,this._drawLast.next=u,u.next=null,this._drawLast=u,this._requestRedraw(o)}},_bringToBack:function(o){var u=o._order;if(u){var _=u.next,m=u.prev;if(m)m.next=_;else return;_?_.prev=m:m&&(this._drawLast=m),u.prev=null,u.next=this._drawFirst,this._drawFirst.prev=u,this._drawFirst=u,this._requestRedraw(o)}}});function so(o){return De.canvas?new Ul(o):null}var wn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Mo={_initContainer:function(){this._container=et("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ps.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var u=o._container=wn("shape");Ze(u,"leaflet-vml-shape "+(this.options.className||"")),u.coordsize="1 1",o._path=wn("path"),u.appendChild(o._path),this._updateStyle(o),this._layers[I(o)]=o},_addPath:function(o){var u=o._container;this._container.appendChild(u),o.options.interactive&&o.addInteractiveTarget(u)},_removePath:function(o){var u=o._container;It(u),o.removeInteractiveTarget(u),delete this._layers[I(o)]},_updateStyle:function(o){var u=o._stroke,_=o._fill,m=o.options,y=o._container;y.stroked=!!m.stroke,y.filled=!!m.fill,m.stroke?(u||(u=o._stroke=wn("stroke")),y.appendChild(u),u.weight=m.weight+"px",u.color=m.color,u.opacity=m.opacity,m.dashArray?u.dashStyle=z(m.dashArray)?m.dashArray.join(" "):m.dashArray.replace(/( *, *)/g," "):u.dashStyle="",u.endcap=m.lineCap.replace("butt","flat"),u.joinstyle=m.lineJoin):u&&(y.removeChild(u),o._stroke=null),m.fill?(_||(_=o._fill=wn("fill")),y.appendChild(_),_.color=m.fillColor||m.color,_.opacity=m.fillOpacity):_&&(y.removeChild(_),o._fill=null)},_updateCircle:function(o){var u=o._point.round(),_=Math.round(o._radius),m=Math.round(o._radiusY||_);this._setPath(o,o._empty()?"M0 0":"AL "+u.x+","+u.y+" "+_+","+m+" 0,"+65535*360)},_setPath:function(o,u){o._path.v=u},_bringToFront:function(o){Di(o._container)},_bringToBack:function(o){ls(o._container)}},xo=De.vml?wn:Ye,no=ps.extend({_initContainer:function(){this._container=xo("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=xo("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){It(this._container),Lt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ps.prototype._update.call(this);var o=this._bounds,u=o.getSize(),_=this._container;(!this._svgSize||!this._svgSize.equals(u))&&(this._svgSize=u,_.setAttribute("width",u.x),_.setAttribute("height",u.y)),At(_,o.min),_.setAttribute("viewBox",[o.min.x,o.min.y,u.x,u.y].join(" ")),this.fire("update")}},_initPath:function(o){var u=o._path=xo("path");o.options.className&&Ze(u,o.options.className),o.options.interactive&&Ze(u,"leaflet-interactive"),this._updateStyle(o),this._layers[I(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){It(o._path),o.removeInteractiveTarget(o._path),delete this._layers[I(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var u=o._path,_=o.options;u&&(_.stroke?(u.setAttribute("stroke",_.color),u.setAttribute("stroke-opacity",_.opacity),u.setAttribute("stroke-width",_.weight),u.setAttribute("stroke-linecap",_.lineCap),u.setAttribute("stroke-linejoin",_.lineJoin),_.dashArray?u.setAttribute("stroke-dasharray",_.dashArray):u.removeAttribute("stroke-dasharray"),_.dashOffset?u.setAttribute("stroke-dashoffset",_.dashOffset):u.removeAttribute("stroke-dashoffset")):u.setAttribute("stroke","none"),_.fill?(u.setAttribute("fill",_.fillColor||_.color),u.setAttribute("fill-opacity",_.fillOpacity),u.setAttribute("fill-rule",_.fillRule||"evenodd")):u.setAttribute("fill","none"))},_updatePoly:function(o,u){this._setPath(o,Ke(o._parts,u))},_updateCircle:function(o){var u=o._point,_=Math.max(Math.round(o._radius),1),m=Math.max(Math.round(o._radiusY),1)||_,y="a"+_+","+m+" 0 1,0 ",O=o._empty()?"M0 0":"M"+(u.x-_)+","+u.y+y+_*2+",0 "+y+-_*2+",0 ";this._setPath(o,O)},_setPath:function(o,u){o._path.setAttribute("d",u)},_bringToFront:function(o){Di(o._path)},_bringToBack:function(o){ls(o._path)}});De.vml&&no.include(Mo);function Xs(o){return De.svg||De.vml?new no(o):null}$t.include({getRenderer:function(o){var u=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return u||(u=this._renderer=this._createRenderer()),this.hasLayer(u)||this.addLayer(u),u},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var u=this._paneRenderers[o];return u===void 0&&(u=this._createRenderer({pane:o}),this._paneRenderers[o]=u),u},_createRenderer:function(o){return this.options.preferCanvas&&so(o)||Xs(o)}});var wr=qi.extend({initialize:function(o,u){qi.prototype.initialize.call(this,this._boundsToLatLngs(o),u)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=Fe(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function Os(o,u){return new wr(o,u)}no.create=xo,no.pointsToPath=Ke,Qi.geometryToLayer=In,Qi.coordsToLatLng=Ro,Qi.coordsToLatLngs=Sn,Qi.latLngToCoords=wo,Qi.latLngsToCoords=Dt,Qi.getFeature=On,Qi.asFeature=Ws,$t.mergeOptions({boxZoom:!0});var Hl=Zi.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){qe(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Lt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){It(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),wi(),ii(),this._startPoint=this._map.mouseEventToContainerPoint(o),qe(document,{contextmenu:Gs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=et("div","leaflet-zoom-box",this._container),Ze(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var u=new Ie(this._point,this._startPoint),_=u.getSize();At(this._box,u.min),this._box.style.width=_.x+"px",this._box.style.height=_.y+"px"},_finish:function(){this._moved&&(It(this._box),ft(this._container,"leaflet-crosshair")),Wt(),as(),Lt(document,{contextmenu:Gs,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(T(this._resetState,this),0);var u=new Ge(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(u).fire("boxzoomend",{boxZoomBounds:u})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});$t.addInitHook("addHandler","boxZoom",Hl),$t.mergeOptions({doubleClickZoom:!0});var Gl=Zi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var u=this._map,_=u.getZoom(),m=u.options.zoomDelta,y=o.originalEvent.shiftKey?_-m:_+m;u.options.doubleClickZoom==="center"?u.setZoom(y):u.setZoomAround(o.containerPoint,y)}});$t.addInitHook("addHandler","doubleClickZoom",Gl),$t.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Ar=Zi.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new Is(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}Ze(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ft(this._map._container,"leaflet-grab"),ft(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var u=Fe(this._map.options.maxBounds);this._offsetLimit=ot(this._map.latLngToContainerPoint(u.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(u.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var u=this._lastTime=+new Date,_=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(_),this._times.push(u),this._prunePositions(u)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),u=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=u.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,u){return o-(o-u)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),u=this._offsetLimit;o.x<u.min.x&&(o.x=this._viscousLimit(o.x,u.min.x)),o.y<u.min.y&&(o.y=this._viscousLimit(o.y,u.min.y)),o.x>u.max.x&&(o.x=this._viscousLimit(o.x,u.max.x)),o.y>u.max.y&&(o.y=this._viscousLimit(o.y,u.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,u=Math.round(o/2),_=this._initialWorldOffset,m=this._draggable._newPos.x,y=(m-u+_)%o+u-_,O=(m+u+_)%o-u-_,U=Math.abs(y+_)<Math.abs(O+_)?y:O;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=U},_onDragEnd:function(o){var u=this._map,_=u.options,m=!_.inertia||o.noInertia||this._times.length<2;if(u.fire("dragend",o),m)u.fire("moveend");else{this._prunePositions(+new Date);var y=this._lastPos.subtract(this._positions[0]),O=(this._lastTime-this._times[0])/1e3,U=_.easeLinearity,K=y.multiplyBy(U/O),Q=K.distanceTo([0,0]),fe=Math.min(_.inertiaMaxSpeed,Q),Ae=K.multiplyBy(fe/Q),tt=fe/(_.inertiaDeceleration*U),at=Ae.multiplyBy(-tt/2).round();!at.x&&!at.y?u.fire("moveend"):(at=u._limitOffset(at,u.options.maxBounds),Ve(function(){u.panBy(at,{duration:tt,easeLinearity:U,noMoveStart:!0,animate:!0})}))}}});$t.addInitHook("addHandler","dragging",Ar),$t.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Vl=Zi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),qe(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Lt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,u=document.documentElement,_=o.scrollTop||u.scrollTop,m=o.scrollLeft||u.scrollLeft;this._map._container.focus(),window.scrollTo(m,_)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var u=this._panKeys={},_=this.keyCodes,m,y;for(m=0,y=_.left.length;m<y;m++)u[_.left[m]]=[-1*o,0];for(m=0,y=_.right.length;m<y;m++)u[_.right[m]]=[o,0];for(m=0,y=_.down.length;m<y;m++)u[_.down[m]]=[0,o];for(m=0,y=_.up.length;m<y;m++)u[_.up[m]]=[0,-1*o]},_setZoomDelta:function(o){var u=this._zoomKeys={},_=this.keyCodes,m,y;for(m=0,y=_.zoomIn.length;m<y;m++)u[_.zoomIn[m]]=o;for(m=0,y=_.zoomOut.length;m<y;m++)u[_.zoomOut[m]]=-o},_addHooks:function(){qe(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Lt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var u=o.keyCode,_=this._map,m;if(u in this._panKeys){if(!_._panAnim||!_._panAnim._inProgress)if(m=this._panKeys[u],o.shiftKey&&(m=be(m).multiplyBy(3)),_.options.maxBounds&&(m=_._limitOffset(be(m),_.options.maxBounds)),_.options.worldCopyJump){var y=_.wrapLatLng(_.unproject(_.project(_.getCenter()).add(m)));_.panTo(y)}else _.panBy(m)}else if(u in this._zoomKeys)_.setZoom(_.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[u]);else if(u===27&&_._popup&&_._popup.options.closeOnEscapeKey)_.closePopup();else return;Gs(o)}}});$t.addInitHook("addHandler","keyboard",Vl),$t.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ln=Zi.extend({addHooks:function(){qe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Lt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var u=vl(o),_=this._map.options.wheelDebounceTime;this._delta+=u,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var m=Math.max(_-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(T(this._performZoom,this),m),Gs(o)},_performZoom:function(){var o=this._map,u=o.getZoom(),_=this._map.options.zoomSnap||0;o._stop();var m=this._delta/(this._map.options.wheelPxPerZoomLevel*4),y=4*Math.log(2/(1+Math.exp(-Math.abs(m))))/Math.LN2,O=_?Math.ceil(y/_)*_:y,U=o._limitZoom(u+(this._delta>0?O:-O))-u;this._delta=0,this._startTime=null,U&&(o.options.scrollWheelZoom==="center"?o.setZoom(u+U):o.setZoomAround(this._lastMousePos,u+U))}});$t.addInitHook("addHandler","scrollWheelZoom",ln);var Wl=600;$t.mergeOptions({tapHold:De.touchNative&&De.safari&&De.mobile,tapTolerance:15});var zl=Zi.extend({addHooks:function(){qe(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Lt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var u=o.touches[0];this._startPos=this._newPos=new _e(u.clientX,u.clientY),this._holdTimeout=setTimeout(T(function(){this._cancel(),this._isTapValid()&&(qe(document,"touchend",zt),qe(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",u))},this),Wl),qe(document,"touchend touchcancel contextmenu",this._cancel,this),qe(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){Lt(document,"touchend",zt),Lt(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),Lt(document,"touchend touchcancel contextmenu",this._cancel,this),Lt(document,"touchmove",this._onMove,this)},_onMove:function(o){var u=o.touches[0];this._newPos=new _e(u.clientX,u.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,u){var _=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:u.screenX,screenY:u.screenY,clientX:u.clientX,clientY:u.clientY});_._simulated=!0,u.target.dispatchEvent(_)}});$t.addInitHook("addHandler","tapHold",zl),$t.mergeOptions({touchZoom:De.touch,bounceAtZoomLimits:!0});var Xl=Zi.extend({addHooks:function(){Ze(this._map._container,"leaflet-touch-zoom"),qe(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ft(this._map._container,"leaflet-touch-zoom"),Lt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var u=this._map;if(!(!o.touches||o.touches.length!==2||u._animatingZoom||this._zooming)){var _=u.mouseEventToContainerPoint(o.touches[0]),m=u.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=u.getSize()._divideBy(2),this._startLatLng=u.containerPointToLatLng(this._centerPoint),u.options.touchZoom!=="center"&&(this._pinchStartLatLng=u.containerPointToLatLng(_.add(m)._divideBy(2))),this._startDist=_.distanceTo(m),this._startZoom=u.getZoom(),this._moved=!1,this._zooming=!0,u._stop(),qe(document,"touchmove",this._onTouchMove,this),qe(document,"touchend touchcancel",this._onTouchEnd,this),zt(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var u=this._map,_=u.mouseEventToContainerPoint(o.touches[0]),m=u.mouseEventToContainerPoint(o.touches[1]),y=_.distanceTo(m)/this._startDist;if(this._zoom=u.getScaleZoom(y,this._startZoom),!u.options.bounceAtZoomLimits&&(this._zoom<u.getMinZoom()&&y<1||this._zoom>u.getMaxZoom()&&y>1)&&(this._zoom=u._limitZoom(this._zoom)),u.options.touchZoom==="center"){if(this._center=this._startLatLng,y===1)return}else{var O=_._add(m)._divideBy(2)._subtract(this._centerPoint);if(y===1&&O.x===0&&O.y===0)return;this._center=u.unproject(u.project(this._pinchStartLatLng,this._zoom).subtract(O),this._zoom)}this._moved||(u._moveStart(!0,!1),this._moved=!0),de(this._animRequest);var U=T(u._move,u,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Ve(U,this,!0),zt(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,de(this._animRequest),Lt(document,"touchmove",this._onTouchMove,this),Lt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});$t.addInitHook("addHandler","touchZoom",Xl),$t.BoxZoom=Hl,$t.DoubleClickZoom=Gl,$t.Drag=Ar,$t.Keyboard=Vl,$t.ScrollWheelZoom=ln,$t.TapHold=zl,$t.TouchZoom=Xl,l.Bounds=Ie,l.Browser=De,l.CRS=We,l.Canvas=Ul,l.Circle=ko,l.CircleMarker=Oo,l.Class=ze,l.Control=Fi,l.DivIcon=Pl,l.DivOverlay=es,l.DomEvent=Da,l.DomUtil=bo,l.Draggable=Is,l.Evented=St,l.FeatureGroup=Ss,l.GeoJSON=Qi,l.GridLayer=zs,l.Handler=Zi,l.Icon=nn,l.ImageOverlay=kn,l.LatLng=Se,l.LatLngBounds=Ge,l.Layer=Hi,l.LayerGroup=ds,l.LineUtil=Ua,l.Map=$t,l.Marker=eo,l.Mixin=Fa,l.Path=Vs,l.Point=_e,l.PolyUtil=Ol,l.Polygon=qi,l.Polyline=_s,l.Popup=Ao,l.PosAnimation=yl,l.Projection=Ha,l.Rectangle=wr,l.Renderer=ps,l.SVG=no,l.SVGOverlay=io,l.TileLayer=Rn,l.Tooltip=Lo,l.Transformation=me,l.Util=Tt,l.VideoOverlay=Rr,l.bind=T,l.bounds=ot,l.canvas=so,l.circle=Xa,l.circleMarker=za,l.control=Kn,l.divIcon=Dl,l.extend=p,l.featureGroup=Va,l.geoJSON=Ll,l.geoJson=Nl,l.gridLayer=Ka,l.icon=Al,l.imageOverlay=to,l.latLng=ve,l.latLngBounds=Fe,l.layerGroup=kr,l.map=Ba,l.marker=Wa,l.point=be,l.polygon=Co,l.polyline=Ya,l.popup=ja,l.rectangle=Os,l.setOptions=B,l.stamp=I,l.svg=Xs,l.svgOverlay=Ml,l.tileLayer=Bl,l.tooltip=xl,l.transformation=Ee,l.version=h,l.videoOverlay=Cn;var Ja=window.L;l.noConflict=function(){return window.L=Ja,this},window.L=l})}(leafletSrc$1,leafletSrc$1.exports)),leafletSrc$1.exports}var leafletSrcExports=requireLeafletSrc(),root$1=template('<div id="map"></div>');function Map$1(n,c){push(c,!1);let l=prop(c,"r2_node",8),h=prop(c,"sentantData",24,()=>[]),p=prop(c,"location",24,()=>({longitude:0,latitude:0})),g,T=mutable_state("400px"),v={};onMount(()=>{g=leafletSrcExports.map("map").setView([p().latitude,p().longitude],13),leafletSrcExports.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png?access_token={token}",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',token:"pk.eyJ1Ijoicm95Y2RhdmllcyIsImEiOiJua2ZoY3JnIn0.2ybExrs-yDA5hLbt838zdg"}).addTo(g),R(),setTimeout(()=>{g.invalidateSize()},0),window.addEventListener("resize",R),h().forEach(C=>{v.hasOwnProperty(C.name)&&g.hasLayer(v[C.name])&&g.removeLayer(v[C.name]),l().awaitSignal(C.id,"get",N=>{if(R2.JSONPath(N,"status")=="connected")l().sentantSend(C.id,"get_position",{});else{if(!(C.name in v)){let D=R2.JSONPath(N,"parameters"),V=I(),B=leafletSrcExports.marker([D.latitude,D.longitude],{icon:V,draggable:!0});v[C.name]=B,v[C.name].addTo(g)}v[C.name].on("click",()=>{const D=document.createElement("div");D.innerHTML=`
                            <div class="card ui" style="width: 250px; padding: 0px;">
                                <div class="image">
                                    <img src="/images/bee_blue.png">
                                </div>
                                <div class="content" style="text-align: center;">
                                    <div class="header">${C.name}</div>
                                    <p><Text ui tiny blue>${C.id}</Text></p>
                                    <p>${C.description}</p>
                                </div>
                            </div>
                        `,leafletSrcExports.popup({offset:[30,20]}).setLatLng(v[C.name].getLatLng()).setContent(D).openOn(g)}),v[C.name].on("dragend",function(D){var V=D.target,B=V.getLatLng();V.setLatLng(new leafletSrcExports.LatLng(B.lat,B.lng),{draggable:"true"}),l().sentantSend(C.id,"set_position",{latitude:B.lat,longitude:B.lng})})}})})}),onDestroy(()=>{window.removeEventListener("resize",R),g.remove()});function I(){var C=leafletSrcExports.icon({iconUrl:"/images/marker-icon.svg",iconSize:[60,60],iconAnchor:[0,0],shadowUrl:"/images/marker-shadow.svg",shadowSize:[60,60],shadowAnchor:[1,1]});return C}function R(){set$1(T,`${window.innerHeight-64}px`),g&&g.invalidateSize()}init();var w=root$1();template_effect(()=>set_attribute(w,"style",`width: 100%; height: ${get(T)??""}; position: absolute`)),append(n,w),pop()}const getQuery=()=>typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,getQueryStringVal=n=>getQuery().get(n);var root_5=template("<!> <!> <!>",1),root_15=template("<!> Grid",1),root_16=template("<!> Map",1),root_17=template("<!> Construct",1),root_13=template("<!> <!> <!> <!>",1),root_12=template("<!> <!>",1),root_3=template("<!> <!> <!>",1),root_2=template("<!> <!>",1),root=template("<main><!></main>");function App(n,c){push(c,!1);const l=mutable_state(),h=mutable_state(),p=mutable_state(),g=mutable_state(),T=mutable_state(),v=mutable_state(),I=mutable_state(),R=mutable_state(),w=mutable_state(),C=mutable_state(),N=mutable_state(),D=mutable_state();let V;var B=mutable_state([]),ie=mutable_state("loading"),ne=mutable_state({});let P=mutable_state({}),z=mutable_state(0),se=mutable_state("400px"),re;const he=()=>{set$1(z,window.innerWidth),set$1(se,`${window.innerHeight-64}px`)};let q=new R2(window.location.hostname,Number(window.location.port));onMount(()=>(get(T)!=null?safe_get(ie)=="id":get(g)!=null?safe_get(ie)=="name":(set$1(ie,"start"),set$1(I,"")),re=document.createElement("input"),re.type="file",re.onchange=_e=>{var nt=_e.target.files[0],be=new FileReader;be.readAsText(nt,"UTF-8"),be.onload=Ie=>{Ie!==null&&set$1(N,JSON.parse(Ie.target.result))}},V=navigator.geolocation.watchPosition(_e=>{console.log(_e.coords),set$1(ne,{latitude:_e.coords.latitude,longitude:_e.coords.longitude,altitude:_e.coords.altitude,accuracy:_e.coords.accuracy,altitudeAccuracy:_e.coords.altitudeAccuracy,heading:_e.coords.heading,speed:_e.coords.speed})},_e=>{console.error("Error getting location:",_e.message)}),he(),window.addEventListener("resize",he),()=>{window.removeEventListener("resize",he)})),onDestroy(()=>{V&&navigator.geolocation.clearWatch(V)}),get(T)==null&&get(g)==null&&setTimeout(()=>{q.monitor(_e=>{ye(_e)}),j().then(_e=>{set$1(ie,_e.state),set$1(B,_e.data)})},100);function j(){return new Promise((_e,nt)=>{get(T)!=null?(set$1(ie,"loading"),q.sentantGet(get(T),{},"name id description events { event parameters } signals").then(be=>{let Ie=R2.JSONPath(be,"data.sentantGet");Ie==null?_e({state:"id",data:[]}):_e({state:"id",data:[Ie]})}).catch(be=>{_e({state:"error",data:[]})})):get(g)!=null?(set$1(ie,"loading"),q.sentantGetByName(get(g),{},"name id description events { event parameters } signals").then(be=>{let Ie=R2.JSONPath(be,"data.sentantGet");Ie==null?_e({state:"name",data:[]}):_e({state:"name",data:[Ie]})}).catch(be=>{_e({state:"error",data:[]})})):(get(v)!=null||get(I)!=null||get(R)!=null||get(C)!=null)&&(set$1(ie,"loading"),q.sentantAll({},"name id description events { event parameters } signals").then(be=>{let Ie=R2.JSONPath(be,"data.sentantAll");Ie==null?_e({state:get(C)!=null?"construct":get(v)!=null?"map":get(R)!=null?"mr":"view",data:[]}):_e({state:get(C)!=null?"construct":get(v)!=null?"map":get(R)!=null?"mr":"view",data:Ie})}).catch(be=>{_e({state:"error",data:[]})}))})}function ye(_e){if(get(g)==null&&get(T)==null){var nt=R2.JSONPath(_e,"parameters.id"),be=R2.JSONPath(_e,"parameters.name");if(nt!==null&&be!=="view")switch(R2.JSONPath(_e,"parameters.activity")){case"created":q.sentantGet(nt,{},"name id description events { event parameters } signals").then(Ie=>{set$1(B,get(l).concat(R2.JSONPath(Ie,"data.sentantGet")))});break;case"deleted":set$1(B,get(l).map(Ie=>(nt==R2.JSONPath(Ie,"id")&&(Ie.name=".deleted"),Ie)));break}}}function ge(_e){let nt=_e.detail.value;nt=="view"||nt=="map"?j().then(be=>{be.state!=="error"?(set$1(ie,nt),set$1(B,be.data)):set$1(ie,be.state)}):set$1(ie,nt)}function Ve(_e){let nt=!0;for(let be=0;be<_e.length;be++)if(R2.JSONPath(_e[be],"name")!=="monitor"){nt=!1;break}return nt}function de(){j().then(_e=>{set$1(ie,_e.state),set$1(B,_e.data)})}function Tt(_e){_e.key==="Enter"&&_e.target.id==="path"&&(get(D).split("|").length>1,window.location.href="localhost")}legacy_pre_effect(()=>safe_get(B),()=>{set$1(l,safe_get(B))}),legacy_pre_effect(()=>safe_get(ie),()=>{set$1(h,safe_get(ie))}),legacy_pre_effect(()=>safe_get(ne),()=>{set$1(p,safe_get(ne))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(g,getQueryStringVal("name"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(T,getQueryStringVal("id"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(v,getQueryStringVal("map"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(I,getQueryStringVal("view"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(R,getQueryStringVal("mr"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(w,getQueryStringVal("variables"))}),legacy_pre_effect(()=>getQueryStringVal,()=>{set$1(C,getQueryStringVal("construct"))}),legacy_pre_effect(()=>get(w),()=>{set$1(N,get(w)?JSON.parse(decodeURIComponent(get(w))):{})}),legacy_pre_effect(()=>(get(g),get(T)),()=>{set$1(D,window.location.hostname+(get(g)?"|"+get(g):"")+(get(T)?"|"+get(T):""))}),legacy_pre_effect_reset(),init();var ze=root();event("keydown",$window,Tt),set_attribute(ze,"style","padding: 0px;");var mt=child(ze);{var Ce=_e=>{Login(_e)},St=_e=>{var nt=root_2(),be=first_child(nt);Menu$2(be,{ui:!0,top:!0,attached:!0,grey:!0,inverted:!0,borderless:!0,children:(ot,Ge)=>{var Fe=root_3(),Se=first_child(Fe);Item(Se,{children:(le,ee)=>{Buttons(le,{ui:!0,icon:!0,children:(me,Ee)=>{var Oe=root_5(),Be=first_child(Oe);Button(Be,{ui:!0,grey:!0,$$events:{click:()=>history.back()},children:(it,Ue)=>{Icon(it,{arrow:!0,left:!0})},$$slots:{default:!0}});var Ye=sibling(Be,2);Button(Ye,{ui:!0,grey:!0,$$events:{click:()=>history.forward()},children:(it,Ue)=>{Icon(it,{arrow:!0,right:!0})},$$slots:{default:!0}});var Ke=sibling(Ye,2);Button(Ke,{ui:!0,grey:!0,$$events:{click:de},children:(it,Ue)=>{Icon(it,{redo:!0})},$$slots:{default:!0}}),append(me,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}});var ve=sibling(Se,2);const We=derived_safe_equal(()=>"margin: auto; width:"+(get(z)-260)+"px;");Item(ve,{get style(){return get(We)},children:(le,ee)=>{Input$2(le,{ui:!0,big:!0,style:"width:100%;",children:(me,Ee)=>{Input$2(me,{id:"path",text:!0,placeholder:"Enter Path...",get value(){return get(D)},set value(Oe){set$1(D,Oe)},$$legacy:!0})},$$slots:{default:!0}})},$$slots:{default:!0}});var je=sibling(ve,2);Menu$2(je,{right:!0,children:(le,ee)=>{Dropdown(le,{ui:!0,item:!0,style:"position: relative; z-index:1010",children:(me,Ee)=>{var Oe=root_12(),Be=first_child(Oe);Icon(Be,{sidebar:!0});var Ye=sibling(Be,2);Menu$2(Ye,{vertical:!0,ui:!0,style:"width: 350px;",children:(Ke,it)=>{var Ue=root_13(),Et=first_child(Ue);Header(Et,{ui:!0,children:(ke,yt)=>{var M=text("View");append(ke,M)},$$slots:{default:!0}});var J=sibling(Et,2);Item(J,{icon:!0,value:"view",$$events:{click:ge},children:(ke,yt)=>{var M=root_15(),st=first_child(M);Icon(st,{ui:!0,th:!0}),append(ke,M)},$$slots:{default:!0}});var $e=sibling(J,2);Item($e,{icon:!0,value:"map",$$events:{click:ge},children:(ke,yt)=>{var M=root_16(),st=first_child(M);Icon(st,{ui:!0,map:!0,outline:!0}),append(ke,M)},$$slots:{default:!0}});var Qe=sibling($e,2);Item(Qe,{icon:!0,value:"construct",$$events:{click:ge},children:(ke,yt)=>{var M=root_17(),st=first_child(M);Icon(st,{ui:!0,hammer:!0}),append(ke,M)},$$slots:{default:!0}}),append(Ke,Ue)},$$slots:{default:!0}}),append(me,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}}),append(ot,Fe)},$$slots:{default:!0}});var Ie=sibling(be,2);Segment(Ie,{ui:!0,bottom:!0,attached:!0,grey:!0,compact:!0,get style(){return`height: ${get(se)??""}; width: 100%; padding: 0px;`},children:(ot,Ge)=>{var Fe=comment(),Se=first_child(Fe);{var ve=je=>{Message(je,{ui:!0,centered:!0,blue:!0,massive:!0,style:"position: fixed; top: 100; left: 0; right: 0; z-index: 1000;",children:(le,ee)=>{Content(le,{ui:!0,children:(me,Ee)=>{var Oe=text("Loading ...");append(me,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}})},We=je=>{var le=comment(),ee=first_child(le);{var me=Oe=>{Message(Oe,{ui:!0,centered:!0,red:!0,massive:!0,style:"position: fixed; top: 100; left: 0; right: 0; z-index: 1000;",children:(Be,Ye)=>{Content(Be,{ui:!0,children:(Ke,it)=>{var Ue=text("Something bad happened");append(Ke,Ue)},$$slots:{default:!0}})},$$slots:{default:!0}})},Ee=Oe=>{var Be=comment(),Ye=first_child(Be);{var Ke=Ue=>{Message(Ue,{ui:!0,centered:!0,blue:!0,massive:!0,style:"position: fixed; top: 100; left: 0; right: 0; z-index: 1000;",children:(Et,J)=>{Content(Et,{ui:!0,children:($e,Qe)=>{var ke=text("Loading ...");append($e,ke)},$$slots:{default:!0}})},$$slots:{default:!0}})},it=Ue=>{var Et=comment(),J=first_child(Et);{var $e=ke=>{Construct(ke,{r2_node:q,get sentantData(){return get(l)},get location(){return get(p)},get savedState(){return get(P)},set savedState(yt){set$1(P,yt)},get variables(){return get(N)},set variables(yt){set$1(N,yt)},$$legacy:!0})},Qe=ke=>{var yt=comment(),M=first_child(yt);{var st=Je=>{Cards(Je,{ui:!0,centered:!0,children:(ut,dt)=>{SentantCard(ut,{get sentant(){return get(l)[0]},r2_node:q,get variables(){return get(N)}})},$$slots:{default:!0}})},gt=Je=>{var ut=comment(),dt=first_child(ut);{var Xe=E=>{Cards(E,{ui:!0,centered:!0,children:(A,W)=>{SentantCard(A,{get sentant(){return get(l)[0]},r2_node:q,get variables(){return get(N)}})},$$slots:{default:!0}})},pt=E=>{var A=comment(),W=first_child(A);{var H=xe=>{Map$1(xe,{r2_node:q,get sentantData(){return get(l)},get location(){return get(p)}})},ae=xe=>{var Ct=comment(),Qt=first_child(Ct);{var rt=k=>{Message(k,{ui:!0,centered:!0,green:!0,massive:!0,style:"position: fixed; top: 100; left: 0; right: 0; z-index: 1000;",children:(F,X)=>{Content(F,{ui:!0,children:(oe,Re)=>{var Pe=text("No Sentants");append(oe,Pe)},$$slots:{default:!0}})},$$slots:{default:!0}})},b=k=>{var F=comment(),X=first_child(F);{var oe=Pe=>{SentantCards(Pe,{r2_node:q,get sentantData(){return get(l)},get variables(){return get(N)}})},Re=Pe=>{var Ht=comment(),fi=first_child(Ht);{var Ft=Kt=>{Message(Kt,{ui:!0,centered:!0,blue:!0,massive:!0,style:"position: fixed; top: 100; left: 0; right: 0; z-index: 1000;",children:(gi,ei)=>{Content(gi,{ui:!0,children:(De,Jt)=>{var Ci=text("Coming soon ...");append(De,Ci)},$$slots:{default:!0}})},$$slots:{default:!0}})};if_block(fi,Kt=>{get(h)=="mr"&&Kt(Ft)},!0)}append(Pe,Ht)};if_block(X,Pe=>{get(h)=="view"?Pe(oe):Pe(Re,!1)},!0)}append(k,F)};if_block(Qt,k=>{Ve(get(l))?k(rt):k(b,!1)},!0)}append(xe,Ct)};if_block(W,xe=>{get(h)=="map"?xe(H):xe(ae,!1)},!0)}append(E,A)};if_block(dt,E=>{get(h)=="name"?E(Xe):E(pt,!1)},!0)}append(Je,ut)};if_block(M,Je=>{get(h)=="id"?Je(st):Je(gt,!1)},!0)}append(ke,yt)};if_block(J,ke=>{get(h)=="construct"?ke($e):ke(Qe,!1)},!0)}append(Ue,Et)};if_block(Ye,Ue=>{get(h)=="loading"?Ue(Ke):Ue(it,!1)},!0)}append(Oe,Be)};if_block(ee,Oe=>{get(h)=="error"?Oe(me):Oe(Ee,!1)},!0)}append(je,le)};if_block(Se,je=>{get(h)=="start"?je(ve):je(We,!1)})}append(ot,Fe)},$$slots:{default:!0}}),append(_e,nt)};if_block(mt,_e=>{get(h)=="login"?_e(Ce):_e(St,!1)})}append(n,ze),pop()}mount(App,{target:document.getElementById("app")});
